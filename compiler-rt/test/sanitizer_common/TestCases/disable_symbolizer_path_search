// REQUIRES: static-libs

// RUN: %clangxx %s -o %t -DDISABLE_SYMBOLIZER_PATH_SEARCH=1
// RUN: %run %t 2>&1 | FileCheck %s --check-prefix=CHECK

// RUN: %clangxx %s -o %t -DDISABLE_SYMBOLIZER_PATH_SEARCH=0
// RUN: %run %t 2>&1 | FileCheck %s --check-prefix=CHECK-ALLOCATOR

// REQUIRES: shell

// Mobile device will not have symbolizer in provided path.
// UNSUPPORTED: ios, android

#include <sanitizer/common_interface_defs.h>
#include <stdio.h>

static void Symbolize() {
  char buffer[100];
  __sanitizer_symbolize_pc(__builtin_return_address(0), "%p %F %L", buffer,
                           sizeof(buffer));
  printf("%s\n", buffer);
}

int main() {
  Symbolize();
}

// CHECK: Symbolizer path search is disabled
// CHECK-ALLOCATOR: {{0x.* in main}}
