# Xen VM Configuration Template: Tactical Client
# LAT5150 DRVMIL Tactical Interface Client VM
#
# Purpose: Isolated VM for accessing tactical self-coding interface
# Security: Separate VM for operational security (compartmentalization)
#
# Usage:
#   1. Copy this file: cp tactical-client.cfg /etc/xen/tactical-client.cfg
#   2. Customize values below
#   3. Create VM: xl create /etc/xen/tactical-client.cfg
#   4. Start VM: xl console tactical-client
#

# ═══════════════════════════════════════════════════════════
# BASIC CONFIGURATION
# ═══════════════════════════════════════════════════════════

# VM name
name = "tactical-client"

# Kernel and boot
kernel = "/usr/lib/grub-xen/grub-x86_64-xen.bin"
# OR for PV:
# kernel = "/boot/vmlinuz"
# ramdisk = "/boot/initrd.img"

# VM type
type = "pvh"  # PVH (hardware-assisted PV) - recommended
# type = "hvm"  # Full hardware virtualization
# type = "pv"   # Paravirtualization

# Boot parameters
bootloader = "pygrub"
bootloader_args = [ "--kernel=/boot/vmlinuz", "--ramdisk=/boot/initrd.img" ]

# ═══════════════════════════════════════════════════════════
# RESOURCES
# ═══════════════════════════════════════════════════════════

# Memory (MB)
memory = 2048
maxmem = 4096

# CPUs
vcpus = 2
cpus = "0-1"  # Pin to specific cores

# ═══════════════════════════════════════════════════════════
# STORAGE
# ═══════════════════════════════════════════════════════════

# Root disk
disk = [
    'phy:/dev/vg0/tactical-client-root,xvda,w',
    # OR file-based:
    # 'file:/var/lib/xen/images/tactical-client.img,xvda,w',
]

# Optional: Additional data disk
# disk = [
#     'phy:/dev/vg0/tactical-client-root,xvda,w',
#     'phy:/dev/vg0/tactical-client-data,xvdb,w',
# ]

# Root device
root = "/dev/xvda1 ro"

# ═══════════════════════════════════════════════════════════
# NETWORKING
# ═══════════════════════════════════════════════════════════

# Network interface
vif = [
    'bridge=xenbr0,mac=00:16:3e:01:01:01',
]

# Static IP configuration (set in VM)
# IP: 192.168.100.10
# Gateway: 192.168.100.1
# DNS: 192.168.100.1

# ═══════════════════════════════════════════════════════════
# DISPLAY/CONSOLE
# ═══════════════════════════════════════════════════════════

# VNC for GUI access
vnc = 1
vnclisten = "127.0.0.1"  # Localhost only for security
vncpasswd = "tactical2025"  # Change this!
vncdisplay = 1

# Serial console
serial = "pty"

# ═══════════════════════════════════════════════════════════
# SECURITY
# ═══════════════════════════════════════════════════════════

# TEMPEST: Disable USB passthrough
#usbdevice = []

# TEMPEST: Disable sound
#soundhw = ""

# Security: No direct hardware access
# pci = []

# Security: Restrict CPUID features
# cpuid = [ "0x00000001:ecx=0x00000000,0x00000000" ]

# ═══════════════════════════════════════════════════════════
# LOGGING
# ═══════════════════════════════════════════════════════════

# Log file
# logfile = "/var/log/xen/tactical-client.log"

# ═══════════════════════════════════════════════════════════
# POWER MANAGEMENT
# ═══════════════════════════════════════════════════════════

# On VM crash/reboot
on_poweroff = "destroy"
on_reboot = "restart"
on_crash = "restart"

# ═══════════════════════════════════════════════════════════
# ADDITIONAL OPTIONS
# ═══════════════════════════════════════════════════════════

# Builder
#builder = "hvm"

# Shadow memory (for HVM)
#shadow_memory = 8

# Timer mode
#timer_mode = "no_delay_for_missed_ticks"

# ═══════════════════════════════════════════════════════════
# POST-CREATION SETUP (Inside VM)
# ═══════════════════════════════════════════════════════════

# 1. Configure network:
#    echo "auto eth0" >> /etc/network/interfaces
#    echo "iface eth0 inet static" >> /etc/network/interfaces
#    echo "    address 192.168.100.10" >> /etc/network/interfaces
#    echo "    netmask 255.255.255.0" >> /etc/network/interfaces
#    echo "    gateway 192.168.100.1" >> /etc/network/interfaces

# 2. Add host to /etc/hosts:
#    echo "192.168.100.1  tactical-host" >> /etc/hosts

# 3. Setup SSH tunnel (Method 1 - Recommended):
#    Copy xen-vm-ssh-tunnel.sh to VM
#    ./xen-vm-ssh-tunnel.sh 192.168.100.1

# 4. OR use bridge access (Method 2 - if configured):
#    Access: https://192.168.100.1:8443/

# 5. Install browser:
#    apt-get install firefox-esr
#    # OR: apt-get install chromium

# 6. Access tactical interface:
#    firefox http://localhost:5001  # If using SSH tunnel
#    # OR: firefox https://192.168.100.1:8443/  # If using bridge access
