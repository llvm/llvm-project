<!DOCTYPE html>
<!-- saved from url=(0117)https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db -->
<html lang="en" data-rh="lang"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="origin-trial" content="A7vZI3v+Gz7JfuRolKNM4Aff6zaGuT7X0mf3wtoZTnKv6497cVMnhy03KDqX7kBz/q/iidW7srW31oQbBt4VhgoAAACUeyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGUuY29tOjQ0MyIsImZlYXR1cmUiOiJEaXNhYmxlVGhpcmRQYXJ0eVN0b3JhZ2VQYXJ0aXRpb25pbmczIiwiZXhwaXJ5IjoxNzU3OTgwODAwLCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><title>Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries | by Fareed Khan | Oct, 2025 | Level Up Coding</title><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1"><meta data-rh="true" name="theme-color" content="#000000"><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"><meta data-rh="true" property="al:ios:app_name" content="Medium"><meta data-rh="true" property="al:ios:app_store_id" content="828256236"><meta data-rh="true" property="al:android:package" content="com.medium.reader"><meta data-rh="true" property="fb:app_id" content="542599432471018"><meta data-rh="true" property="og:site_name" content="Medium"><meta data-rh="true" name="apple-itunes-app" content="app-id=828256236, app-argument=/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db, affiliate-data=pt=698524&amp;ct=smart_app_banner&amp;mt=8"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-10-20T03:36:07.255Z"><meta data-rh="true" name="title" content="Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries | by Fareed Khan | Oct, 2025 | Level Up Coding"><meta data-rh="true" property="og:title" content="Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries"><meta data-rh="true" property="al:android:url" content="medium://p/af69c5e044db"><meta data-rh="true" property="al:ios:url" content="medium://p/af69c5e044db"><meta data-rh="true" property="al:android:app_name" content="Medium"><meta data-rh="true" name="description" content="“” is published by Fareed Khan in Level Up Coding."><meta data-rh="true" property="og:description" content="Planning, Retrieval, Reflection, Critique, Synthesis and more"><meta data-rh="true" property="og:url" content="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db"><meta data-rh="true" property="al:web:url" content="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db"><meta data-rh="true" property="og:image" content="https://miro.medium.com/v2/resize:fit:1200/1*ls6zh1GCk5oO_5JzVvTyRg.png"><meta data-rh="true" property="article:author" content="https://medium.com/@fareedkhandev"><meta data-rh="true" name="author" content="Fareed Khan"><meta data-rh="true" name="robots" content="index,noarchive,follow,max-image-preview:large"><meta data-rh="true" name="referrer" content="unsafe-url"><meta data-rh="true" property="twitter:title" content="Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries"><meta data-rh="true" name="twitter:site" content="@gitconnected"><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/af69c5e044db"><meta data-rh="true" property="twitter:description" content="Planning, Retrieval, Reflection, Critique, Synthesis and more"><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/v2/resize:fit:1200/1*ls6zh1GCk5oO_5JzVvTyRg.png"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:label1" content="Reading time"><meta data-rh="true" name="twitter:data1" content="68 min read"><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="https://levelup.gitconnected.com/osd.xml"><link data-rh="true" rel="manifest" href="https://levelup.gitconnected.com/manifest.json"><link data-rh="true" rel="preconnect" href="https://www.google.com/"><link data-rh="true" rel="preconnect" href="https://www.gstatic.com/" crossorigin=""><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/unbound.css"><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/unbound.css"><link data-rh="true" rel="author" href="https://medium.com/@fareedkhandev"><link data-rh="true" rel="canonical" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db"><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/af69c5e044db"><script type="text/javascript" async="" charset="utf-8" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/recaptcha__en.js" crossorigin="anonymous" integrity="sha384-qNLemyKcD24MKXWUXqTaOJ9ESai7afdFb4RzK+fa3lNAf2knAo6+3YtXf5YGXQM5"></script><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@id":"https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db","@type":"SocialMediaPosting","image":["https://miro.medium.com/"],"url":"https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db","dateCreated":"2025-10-20T03:36:07Z","datePublished":"2025-10-20T03:36:07Z","dateModified":"2025-10-20T03:36:07Z","headline":"Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries","name":"Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries","description":"“” is published by Fareed Khan in Level Up Coding.","identifier":"af69c5e044db","author":{"@context":"https://schema.org","@id":"https://medium.com/@fareedkhandev","@type":"Person","identifier":"fareedkhandev","name":"Fareed Khan","url":"https://medium.com/@fareedkhandev"},"creator":{"@context":"https://schema.org","@id":"https://medium.com/@fareedkhandev","@type":"Person","identifier":"fareedkhandev","name":"Fareed Khan","url":"https://medium.com/@fareedkhandev"},"publisher":{"@context":"https://schema.org","@type":"Organization","@id":"https://levelup.gitconnected.com","name":"Level Up Coding","description":"Coding tutorials and news. The developer homepage gitconnected.com \u0026\u0026 skilled.dev \u0026\u0026 levelup.dev","url":"https://levelup.gitconnected.com","sameAs":["https://twitter.com/gitconnected","https://facebook.com/gitconnectednetwork","https://instagram.com/skilled.dev/"],"logo":{"@type":"ImageObject","width":400,"height":400,"url":"https://miro.medium.com/v2/resize:fit:400/1%2A5D9oYBd58pyjMkV_5-zXXQ.jpeg"}},"mainEntityOfPage":"https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db","isAccessibleForFree":false,"hasPart":{"@type":"WebPageElement","isAccessibleForFree":false,"cssSelector":".meteredContent"}}</script><script data-rh="true" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/enterprise.js" async="true"></script><style type="text/css" data-fela-rehydration="551" data-fela-type="STATIC">html{box-sizing:border-box;-webkit-text-size-adjust:100%}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}#speechify-root{font-family:Sohne, sans-serif}div[data-popper-reference-hidden="true"]{visibility:hidden;pointer-events:none}.grecaptcha-badge{visibility:hidden}
/*XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>*/.hljs {background: #fff;color: black;
}/* Gray DOCTYPE selectors like WebKit */
.xml .hljs-meta {color: #c0c0c0;
}.hljs-comment,
.hljs-quote {color: #007400;
}.hljs-tag,
.hljs-attribute,
.hljs-keyword,
.hljs-selector-tag,
.hljs-literal,
.hljs-name {color: #aa0d91;
}.hljs-variable,
.hljs-template-variable {color: #3F6E74;
}.hljs-code,
.hljs-string,
.hljs-meta .hljs-string {color: #c41a16;
}.hljs-regexp,
.hljs-link {color: #0E0EFF;
}.hljs-title,
.hljs-symbol,
.hljs-bullet,
.hljs-number {color: #1c00cf;
}.hljs-section,
.hljs-meta {color: #643820;
}.hljs-title.class_,
.hljs-class .hljs-title,
.hljs-type,
.hljs-built_in,
.hljs-params {color: #5c2699;
}.hljs-attr {color: #836C28;
}.hljs-subst {color: #000;
}.hljs-formula {background-color: #eee;font-style: italic;
}.hljs-addition {background-color: #baeeba;
}.hljs-deletion {background-color: #ffc8bd;
}.hljs-selector-id,
.hljs-selector-class {color: #9b703f;
}.hljs-doctag,
.hljs-strong {font-weight: bold;
}.hljs-emphasis {font-style: italic;
}
</style><style type="text/css" data-fela-rehydration="551" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-moz-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-webkit-keyframes k1{0%{transform:translate(-50%, -100px)}100%{transform:translate(-50%, 0)}}@-moz-keyframes k1{0%{transform:translate(-50%, -100px)}100%{transform:translate(-50%, 0)}}@keyframes k1{0%{transform:translate(-50%, -100px)}100%{transform:translate(-50%, 0)}}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.d{display:none}.m{display:block}.n{position:sticky}.o{top:0}.p{z-index:500}.q{padding:0 24px}.r{align-items:center}.s{border-bottom:solid 1px #F2F2F2}.z{height:41px}.ab{line-height:20px}.ac{display:flex}.ae{gap:32px}.af{height:57px}.ag{flex:1 0 auto}.ah{color:inherit}.ai{fill:inherit}.aj{font-size:inherit}.ak{border:none}.al{font-family:inherit}.am{letter-spacing:inherit}.an{font-weight:inherit}.ao{padding:0}.ap{margin:0}.aq{cursor:pointer}.ar:disabled{cursor:not-allowed}.as:disabled{color:#6B6B6B}.at:disabled{fill:#6B6B6B}.aw{width:auto}.ax path{fill:#242424}.ay{height:25px}.az{margin-left:24px}.ba{border-radius:20px}.bb{width:240px}.bc{background:#F9F9F9}.bd path{fill:#6B6B6B}.bf{outline:none}.bg{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.bh{font-size:14px}.bi{width:100%}.bj{padding:10px 20px 10px 0}.bk{background-color:transparent}.bl{color:#242424}.bm::placeholder{color:#6B6B6B}.bn{display:inline-block}.bo{margin-left:12px}.bp{margin-right:12px}.bq{border-radius:4px}.br{height:24px}.bx{background-color:#F9F9F9}.by{border-radius:50%}.bz{height:32px}.ca{width:32px}.cb{flex:0 0 auto}.cd{flex:1 1 auto}.ci{justify-content:center}.co{max-width:680px}.cp{min-width:0}.cq{animation:k1 1.2s ease-in-out infinite}.cr{height:100vh}.cs{margin-bottom:16px}.ct{margin-top:48px}.cu{align-items:flex-start}.cv{flex-direction:column}.cw{justify-content:space-between}.cx{margin-bottom:24px}.dd{width:80%}.de{background-color:#F2F2F2}.dk{height:44px}.dl{width:44px}.dm{margin:auto 0}.dn{margin-bottom:4px}.do{height:16px}.dp{width:120px}.dq{width:80px}.dw{margin-bottom:8px}.dx{width:96%}.dy{width:98%}.dz{width:81%}.ea{margin-left:8px}.eb{color:#6B6B6B}.ec{font-size:13px}.ed{height:100%}.ew{color:#FFFFFF}.ex{fill:#FFFFFF}.ey{background:#1A8917}.ez{border-color:#1A8917}.fd:disabled{cursor:inherit !important}.fe:disabled{opacity:0.3}.ff:disabled:hover{background:#1A8917}.fg:disabled:hover{border-color:#1A8917}.fh{border-radius:99em}.fi{border-width:1px}.fj{border-style:solid}.fk{box-sizing:border-box}.fl{text-decoration:none}.fm{text-align:center}.fn{margin-left:16px}.fo{border:inherit}.fr{position:relative}.fs{fill:#6B6B6B}.ft{gap:8px}.fw{position:absolute}.fx{width:1px}.fy{height:1px}.fz{margin:-1px}.ga{overflow:hidden}.gb{clip:rect(0, 0, 0, 0)}.gc{white-space:nowrap}.gd{border-width:0}.ge{margin-right:32px}.gf{background:transparent}.gg svg{margin-left:4px}.gh svg{fill:#6B6B6B}.gj{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.05)}.gl{max-width:100%}.gm{text-overflow:ellipsis}.gn{border-bottom:1px solid #F2F2F2}.go{height:3px}.gp{background-color:#3972E0}.gq{max-width:1192px}.gw{font-weight:500}.hk{margin:0 8px}.hl{display:inline}.hm{font-size:16px}.hn{line-height:24px}.ho{pointer-events:none}.hp{will-change:opacity, transform}.hq{width:calc(100% - 0px)}.ht{opacity:0}.hu{transform:translateY(89px)}.hv{width:148px}.hw{border-radius:2px}.hx{height:38px}.hy{width:38px}.ia{margin-top:16px}.ib{text-decoration:underline}.ic{word-wrap:break-word}.id{word-break:break-word}.ij{margin:0 24px}.in{background:rgba(255, 255, 255, 1)}.io{border:1px solid #F2F2F2}.ip{box-shadow:0 1px 4px #F2F2F2}.iq{max-height:100vh}.ir{overflow-y:auto}.is{left:0}.it{top:calc(100vh + 100px)}.iu{bottom:calc(100vh + 100px)}.iv{width:10px}.iw{margin-top:32px}.ix{display:inline-flex}.iy{padding:6px 12px 6px 10px}.iz{border-radius:8px}.ja:after{display:block}.jb:after{content:""}.jc:after{clear:both}.jd{line-height:1.23}.je{letter-spacing:0}.jf{font-style:normal}.jg{font-weight:700}.jw{margin-top:0px}.jx{margin-bottom:-0.27em}.jy{line-height:1.394}.ky{gap:12px}.kz{align-items:baseline}.la{width:36px}.lb{height:36px}.lc{border:2px solid rgba(255, 255, 255, 1)}.ld{z-index:0}.le{box-shadow:none}.lf{border:1px solid rgba(0, 0, 0, 0.05)}.lg{margin-bottom:2px}.lh{flex-wrap:nowrap}.lj{width:12px}.lk{flex-wrap:wrap}.ll{padding-left:8px}.lm{padding-right:8px}.mn> *{flex-shrink:0}.mo{overflow-x:scroll}.mp::-webkit-scrollbar{display:none}.mq{scrollbar-width:none}.mr{-ms-overflow-style:none}.ms{width:74px}.mt{flex-direction:row}.mu{z-index:2}.mv{margin-right:4px}.my{-webkit-user-select:none}.mz{border:0}.na{fill:rgba(117, 117, 117, 1)}.nd{outline:0}.ne{user-select:none}.nf> svg{pointer-events:none}.no{cursor:progress}.np{margin-left:4px}.nq{opacity:1}.nr{padding:4px 0}.nu{width:16px}.ob{padding:8px 2px}.oc svg{color:#6B6B6B}.ot{line-height:1.58}.ou{letter-spacing:-0.004em}.ov{font-family:source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif}.pl{margin-bottom:-0.46em}.pm{clear:both}.ps{height:auto}.pt{margin-top:10px}.pu{max-width:728px}.pv{margin-left:auto}.pw{margin-right:auto}.pz{background:none}.qa{color:#1A8917}.qb{list-style-type:decimal}.qc{margin-left:30px}.qd{padding-left:0px}.qj{border-top:none}.qk{margin-bottom:50px}.ql{height:52px}.qm{max-height:52px}.qn{box-sizing:content-box}.qo{position:static}.qp{z-index:1}.qr{max-width:155px}.qx{margin-right:20px}.qy{margin-bottom:64px}.qz{margin-bottom:48px}.rm{height:48px}.rn{width:48px}.ro{height:64px}.rp{width:64px}.rq{align-self:flex-end}.rw{padding-right:4px}.sd{margin-top:8px}.se{white-space:pre-wrap}.sk{height:0px}.sw{gap:18px}.sx{fill:rgba(61, 61, 61, 1)}.sz{padding-bottom:20px}.tf{padding:8px 16px}.tg{fill:#242424}.th{background:0}.ti{border-color:#242424}.tk:disabled:hover{color:#242424}.tl:disabled:hover{fill:#242424}.tm:disabled:hover{border-color:#242424}.tx{border-bottom:solid 1px #E5E5E5}.ty{margin-top:72px}.tz{padding:24px 0}.ua{margin-bottom:0px}.ub{margin-right:16px}.uc path{stroke:#242424}.ud{border-radius:19px}.ue{padding:9px 16px 9px 16px}.uf{word-break:keep-all}.au:hover:not(:disabled){color:rgba(25, 25, 25, 1)}.av:hover:not(:disabled){fill:rgba(25, 25, 25, 1)}.fa:hover{background:#156D12}.fb:hover{border-color:#156D12}.fc:hover{cursor:pointer}.fu:hover{color:#242424}.fv:hover{fill:#242424}.gi:hover svg{fill:#242424}.gk:hover{background-color:rgba(0, 0, 0, 0.1)}.hz:hover{background-color:none}.li:hover{text-decoration:underline}.nc:hover{fill:rgba(8, 8, 8, 1)}.ns:hover{fill:#000000}.nt:hover p{color:#000000}.nv:hover{color:#000000}.od:hover svg{color:#000000}.sy:hover{fill:rgba(25, 25, 25, 1)}.tj:hover{border-color:#242424}.be:focus-within path{fill:#242424}.nb:focus{fill:rgba(8, 8, 8, 1)}.oe:focus svg{color:#000000}.ng:active{border-style:none}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="all and (min-width: 1080px)">.e{display:none}.bw{width:64px}.cc{display:block}.cn{margin:0 64px}.dc{height:48px}.dj{margin-bottom:52px}.dv{margin-bottom:48px}.em{font-size:14px}.eo{line-height:20px}.eu{font-size:13px}.ev{padding:5px 12px}.fq{display:flex}.gv{max-width:250px}.hh{font-size:20px}.hi{line-height:24px}.hj{letter-spacing:0}.ii{margin-bottom:50px}.im{max-width:680px}.jt{font-size:42px}.ju{line-height:52px}.jv{letter-spacing:-0.011em}.kl{font-size:22px}.km{margin-top:0.92em}.kn{line-height:28px}.kw{align-items:center}.kx{flex-direction:row}.lz{border-top:solid 1px #F2F2F2}.ma{border-bottom:solid 1px #F2F2F2}.mb{margin:32px 0 0}.mc{padding:3px 8px}.ml> *{margin-right:24px}.mm> :last-child{margin-right:0}.nn{margin-top:0px}.oa{margin:0}.pi{margin-top:2.14em}.pj{line-height:32px}.pk{letter-spacing:-0.003em}.pr{margin-top:56px}.qi{margin-top:1.14em}.qw{display:inline-block}.rc{margin-bottom:0}.rd{margin-right:20px}.rr{max-width:500px}.sj{margin-bottom:88px}.st{font-size:24px}.su{line-height:30px}.sv{letter-spacing:-0.016em}.te{margin:40px 0 16px}.tr{width:min-width}.tw{padding-top:72px}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.f{display:none}.nm{margin-top:0px}.px{margin-left:auto}.py{text-align:center}.qv{display:inline-block}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="all and (max-width: 903.98px)">.g{display:none}.nl{margin-top:0px}.qu{display:inline-block}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="all and (max-width: 727.98px)">.h{display:none}.nj{margin-top:0px}.nk{margin-right:0px}.qt{display:inline-block}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="all and (max-width: 551.98px)">.i{display:none}.t{display:flex}.u{justify-content:space-between}.bs{width:24px}.ce{min-width:100%}.cj{margin:0 24px}.cy{height:40px}.df{margin-bottom:44px}.dr{margin-bottom:32px}.ee{font-size:13px}.ef{line-height:20px}.ep{padding:0px 8px 1px}.gr{max-width:150px}.gx{font-size:16px}.gy{letter-spacing:0}.ie{margin-bottom:2px}.jh{font-size:32px}.ji{line-height:38px}.jj{letter-spacing:-0.014em}.jz{font-size:18px}.ka{margin-top:0.79em}.kb{line-height:24px}.ko{align-items:flex-start}.kp{flex-direction:column-reverse}.ln{margin:24px -24px 0}.lo{padding:0}.md> *{margin-right:8px}.me> :last-child{margin-right:24px}.mw{margin-left:0px}.nh{margin-top:0px}.ni{margin-right:0px}.nw{margin:0}.of{border:1px solid #F2F2F2}.og{border-radius:99em}.oh{padding:0px 16px 0px 12px}.oi{height:38px}.oj{align-items:center}.ol svg{margin-right:8px}.ow{margin-top:1.56em}.ox{line-height:28px}.oy{letter-spacing:-0.003em}.pn{margin-top:40px}.qe{margin-top:1.34em}.qs{display:inline-block}.rb{flex-direction:column}.rk{margin-bottom:20px}.rl{margin-right:0}.rv{max-width:100%}.rx{font-size:24px}.ry{line-height:30px}.rz{letter-spacing:-0.016em}.sf{margin-bottom:64px}.sl{font-size:20px}.ta{margin:32px 0 16px}.tn{width:100%}.ts{padding-top:48px}.ok:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.j{display:none}.bv{width:64px}.ch{min-width:100%}.cm{margin:0 64px}.db{height:48px}.di{margin-bottom:52px}.du{margin-bottom:48px}.ek{font-size:14px}.el{line-height:20px}.es{font-size:13px}.et{padding:5px 12px}.fp{display:flex}.gu{max-width:250px}.he{font-size:20px}.hf{line-height:24px}.hg{letter-spacing:0}.ih{margin-bottom:50px}.il{max-width:680px}.jq{font-size:42px}.jr{line-height:52px}.js{letter-spacing:-0.011em}.ki{font-size:22px}.kj{margin-top:0.92em}.kk{line-height:28px}.ku{align-items:center}.kv{flex-direction:row}.lv{border-top:solid 1px #F2F2F2}.lw{border-bottom:solid 1px #F2F2F2}.lx{margin:32px 0 0}.ly{padding:3px 8px}.mj> *{margin-right:24px}.mk> :last-child{margin-right:0}.nz{margin:0}.pf{margin-top:2.14em}.pg{line-height:32px}.ph{letter-spacing:-0.003em}.pq{margin-top:56px}.qh{margin-top:1.14em}.re{margin-bottom:0}.rf{margin-right:20px}.rs{max-width:500px}.si{margin-bottom:88px}.sq{font-size:24px}.sr{line-height:30px}.ss{letter-spacing:-0.016em}.td{margin:40px 0 16px}.tq{width:min-width}.tv{padding-top:72px}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.k{display:none}.x{display:flex}.y{justify-content:space-between}.bu{width:64px}.cg{min-width:100%}.cl{margin:0 48px}.da{height:48px}.dh{margin-bottom:52px}.dt{margin-bottom:48px}.ei{font-size:13px}.ej{line-height:20px}.er{padding:0px 8px 1px}.gt{max-width:250px}.hb{font-size:20px}.hc{line-height:24px}.hd{letter-spacing:0}.ig{margin-bottom:50px}.ik{max-width:680px}.jn{font-size:42px}.jo{line-height:52px}.jp{letter-spacing:-0.011em}.kf{font-size:22px}.kg{margin-top:0.92em}.kh{line-height:28px}.ks{align-items:center}.kt{flex-direction:row}.lr{border-top:solid 1px #F2F2F2}.ls{border-bottom:solid 1px #F2F2F2}.lt{margin:32px 0 0}.lu{padding:3px 8px}.mh> *{margin-right:24px}.mi> :last-child{margin-right:0}.ny{margin:0}.pc{margin-top:2.14em}.pd{line-height:32px}.pe{letter-spacing:-0.003em}.pp{margin-top:56px}.qg{margin-top:1.14em}.rg{margin-bottom:0}.rh{margin-right:20px}.rt{max-width:500px}.sh{margin-bottom:88px}.sn{font-size:24px}.so{line-height:30px}.sp{letter-spacing:-0.016em}.tc{margin:40px 0 16px}.tp{width:min-width}.tu{padding-top:72px}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.l{display:none}.v{display:flex}.w{justify-content:space-between}.bt{width:24px}.cf{min-width:100%}.ck{margin:0 24px}.cz{height:40px}.dg{margin-bottom:44px}.ds{margin-bottom:32px}.eg{font-size:13px}.eh{line-height:20px}.eq{padding:0px 8px 1px}.gs{max-width:150px}.gz{font-size:16px}.ha{letter-spacing:0}.if{margin-bottom:2px}.jk{font-size:32px}.jl{line-height:38px}.jm{letter-spacing:-0.014em}.kc{font-size:18px}.kd{margin-top:0.79em}.ke{line-height:24px}.kq{align-items:flex-start}.kr{flex-direction:column-reverse}.lp{margin:24px 0 0}.lq{padding:0}.mf> *{margin-right:8px}.mg> :last-child{margin-right:8px}.mx{margin-left:0px}.nx{margin:0}.om{border:1px solid #F2F2F2}.on{border-radius:99em}.oo{padding:0px 16px 0px 12px}.op{height:38px}.oq{align-items:center}.os svg{margin-right:8px}.oz{margin-top:1.56em}.pa{line-height:28px}.pb{letter-spacing:-0.003em}.po{margin-top:40px}.qf{margin-top:1.34em}.ra{flex-direction:column}.ri{margin-bottom:20px}.rj{margin-right:0}.ru{max-width:100%}.sa{font-size:24px}.sb{line-height:30px}.sc{letter-spacing:-0.016em}.sg{margin-bottom:64px}.sm{font-size:20px}.tb{margin:32px 0 16px}.to{width:100%}.tt{padding-top:48px}.or:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="print">.qq{display:none}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.hr{transition:opacity 200ms}</style><style type="text/css" data-fela-rehydration="551" data-fela-type="RULE" media="all and (max-width: 1232px)">.hs{display:none}</style><link rel="icon" href="https://miro.medium.com/v2/resize:fill:134:134/1*MMpkJtmeCME-6BmGNH5l8A.png" data-rh="true"><link rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/v2/resize:fill:160:160/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156" data-rh="true"><link rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/v2/resize:fill:126:126/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156" data-rh="true"><link rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/v2/resize:fill:80:80/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156" data-rh="true"><link rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/v2/resize:fill:63:63/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156" data-rh="true"><link rel="mask-icon" href="https://miro.medium.com/v2/resize:fill:525:525/7*GAOKVe--MXbEJmV9230oOQ.png" color="#171717" data-rh="true"><script async="true" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/js" data-rh="true"></script><script data-rh="true">window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-7JY7T788PK');</script><style data-fela-type="RULE" type="text/css" media="(orientation: landscape) and (max-width: 903.98px)"></style></head><body><div id="root"><div class="a b c"><a href="https://levelup.gitconnected.com/sitemap/sitemap.xml" class="d">Sitemap</a><div class="e f g h i j k l"></div><script>document.domain = document.domain;</script><div><script>if (window.self !== window.top) window.location = "about:blank"</script></div><div class="m c"><div class="m n o p c" style="transform: translateY(-57px);"><div class="q r s t u v w x y j e z ab"><a class="eb ai ec bg am b ao ap aq ar as at au av t v x j e r ed ab" href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Faf69c5e044db&amp;%7Efeature=LoOpenInAppButton&amp;%7Echannel=ShowPostUnderCollection&amp;%7Estage=mobileNavBar&amp;source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="ea"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="q r s ac ae af"><div class="ac r ag"><a class="ah ai aj ak al am an ao ap aq ar as at au av ac" aria-label="Homepage" data-testid="headerMediumLogo" href="https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" aria-labelledby="wordmark-medium-desc" viewBox="0 0 719 160" class="aw ax ay"><desc id="wordmark-medium-desc">Medium Logo</desc><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="az i"><div class="ac ak ba bb bc r bd be"><div class="bn" aria-describedby="searchResults" aria-labelledby="searchResults" aria-haspopup="listbox" role="listbox"></div><div class="bo bp ac"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ak bf bg bh ab bi bj bk bl bm" placeholder="Search" value=""></div></div></div><div class="i l x fp fq"><span data-dd-action-name="Susi presentation tracker new_post_topnav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerWriteButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav------------------" rel="noopener follow"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg>Write</div></a></span></div><div class="l k j e"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSearchButton" href="https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow"><div class="bg b bh ab eb fr fs ac r ft fu fv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Search</span></div></a></div><div class="ge i l k"><div class="ac r"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><button class="bg b ee ef ep eg eh eq ei ej er es el et eu eo ev ew ex ey ez fa fb fc fd fe ff fg fh fi fj fk bn fl fm" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fn m"><p class="bg b ee ef eg eh ei ej ek el em eo eb"><span data-dd-action-name="Susi presentation tracker global_nav"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="m"><div><div class="bn" role="tooltip" aria-describedby="1" aria-labelledby="1"><div tabindex="-1" class="bf"><button class="ak gf ao ac r aq fr gg gh gi" aria-label="user options menu" data-testid="headerUserIcon"><div class="m fr"><img alt="" class="m fk by bz ca de" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_dmbNkD5D-u45r44go_cf0g.png" width="32" height="32" loading="lazy" role="presentation"><div class="gj by m bz ca fw o ak gk"></div></div></button></div></div></div></div></div></div><div class="ac"><div class="cb i l k j cc" style="width:0px"></div><div class="cd bi ce cf cg ch" style="width:calc(100% - 0px)"><div class="m"><div><div class="gn bi m"><div class="go bi gp"></div><div class="ac ci"><div class="cj ck cl cm cn gq cp bi"><div class="af ac r"><div class="gr gs gt gu gv m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://levelup.gitconnected.com/?source=post_page---publication_nav-5517fd7b58a6-af69c5e044db---------------------------------------" rel="noopener follow"><h2 class="bg gw gx ef gy gz eh ha hb hc hd he hf hg hh hi hj bl"><div class="gl ga gm gc">Level Up Coding</div></h2></a></div><div class="t v k j e"><span class="hk hl" aria-hidden="true"><span class="bg b hm hn bl">·</span></span><p class="bg b hm hn bl"><button class="ah ai aj fo al am an ao ap aq ar as at ib">Follow publication</button></p></div></div></div></div></div></div><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div data-focus-lock-disabled="disabled"><div class="qq" role="dialog" aria-modal="true" tabindex="-1"><div class="ug uh bi ed ui uj uk aq ht ho ul" aria-hidden="true" role="presentation"></div><div class="um ui un uo up ug ed fk uq ur us nq ut uu uv uw ux uy uz va vb vc ac cv vd" aria-hidden="true"><div class="ve ir"></div></div></div></div><div data-focus-guard="true" tabindex="-1" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div><div class="ho fw hp hq o hr hs ht vf"><div class="ac ci"><div class="cj ck cl cm cn gq cp bi"><div class="hv m"><div class="ho"><div class="ac cu cv"><a href="https://levelup.gitconnected.com/?source=post_page---post_publication_sidebar-5517fd7b58a6-af69c5e044db---------------------------------------" rel="noopener follow"><div class="fr"><img alt="Level Up Coding" class="de hw m hy hx" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_5D9oYBd58pyjMkV_5-zXXQ.jpg" width="38" height="38" loading="lazy"><div class="hw m hx hy fw o gj hz"></div></div></a><div class="ia m"></div><p class="bg b bh ab eb">Coding tutorials and news. The developer homepage <a class="ah ai aj fo al am an ao ap aq ar as at ib ic id" href="http://gitconnected.com/" rel="noopener  ugc nofollow">gitconnected.com</a> &amp;&amp; <a class="ah ai aj fo al am an ao ap aq ar as at ib ic id" href="http://skilled.dev/" rel="noopener  ugc nofollow">skilled.dev</a> &amp;&amp; <a class="ah ai aj fo al am an ao ap aq ar as at ib ic id" href="http://levelup.dev/" rel="noopener  ugc nofollow">levelup.dev</a></p><div class="ia m"></div><p class="bg b bh ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at ib">Follow publication</button></p></div></div></div></div></div></div><div class="ie if ig ih ii m"><div class="ac ci"><div class="cp bi ij ik il im"></div></div><article class="meteredContent"><div class="m"><div class="m"><span class="m"></span><section><div><div class="fw is aeo iu iv ho"></div><div class="speechify-ignore pv pw pu fr i l k j cc"><aside class="up fw o" style="width: 526.869px;"><div class="xu gl fw aeq gc bi ac r ft"><p class="bg b ec ab eb"><span>Top highlight</span></p></div></aside></div><div><div class="speechify-ignore m"><div class="xw xx xy xz ya m"></div><div class="ac ci"><div class="cx ea yb bi pu cp m"><div class="fr yc yd ye wv wx iz yf"><p class="bg b bh ab bl">You're reading for free via <a class="ah ai aj fo al am an ao ap aq ar as at ib" href="https://medium.com/@fareedkhandev?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow">Fareed Khan's</a> Friend Link. <span data-dd-action-name="Susi presentation tracker post_friend_link_meter"><a class="ah ai aj fo al am an ao ap aq ar as at ib" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;source=-----af69c5e044db---------------------post_friend_link_meter------------------" rel="noopener follow">Become a member</a></span> to access the best of Medium.</p></div><div class="yn yo yp yq yr m"><div class="fw yg yh ja yi yj yk yl ym"></div></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><div class="cx ac ft"><div><div class="bn" role="tooltip" aria-describedby="2" aria-labelledby="2"><div tabindex="-1" class="bf"><div class="ix r iy io iz ft aq"><svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg><p class="bg b bh ab eb">Member-only story</p></div></div></div></div></div></div></div></div></div><div class="id ic ja jb jc"><div class="ac ci"><div class="cp bi ij ik il im"><div><h1 id="ef2a" class="pw-post-title jd je jf bg jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx bl" data-testid="storyTitle" data-selectable-paragraph=""><mark class="xs xt aq">Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries</mark></h1></div><div><h2 id="465e" class="pw-subtitle-paragraph jy je jf bg b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn cx eb" data-selectable-paragraph="">Planning, Retrieval, Reflection, Critique, Synthesis and more</h2><div><div class="speechify-ignore ac cw"><div class="speechify-ignore bi m"><div class="ac ko kp kq kr ks kt ku kv kw kx ky"><div class="ac r ky"><div class="ac kz"><div><div class="bn" aria-describedby="105" aria-labelledby="105" role="tooltip"><div tabindex="-1" class="bf"><a href="https://medium.com/@fareedkhandev?source=post_page---byline--af69c5e044db---------------------------------------" rel="noopener follow"><div class="m la lb by lc ld"><div class="m fr"><img alt="Fareed Khan" class="m fk by bz ca de" width="32" height="32" loading="lazy" data-testid="authorPhoto" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_feiUXOR8sid6IPHSHufA-g.jpg"><div class="le by m bz ca fw o lf gk"></div></div></div></a></div></div></div></div><span class="bg b bh ab bl"><div class="lg ac r"><div class="ac r lh"><div class="ac r"><div><div class="bn" aria-describedby="106" aria-labelledby="106" role="tooltip"><div tabindex="-1" class="bf"><span class="bg b bh ab bl"><a class="ah ai aj fo al am an ao ap aq ar as at li" data-testid="authorName" href="https://medium.com/@fareedkhandev?source=post_page---byline--af69c5e044db---------------------------------------" rel="noopener follow">Fareed Khan</a></span></div></div></div></div><div class="lj bn"></div><button class="th uc aq ac ci r wi wj wk" style="border: 1px solid rgb(36, 36, 36);"><span class="bg b bh ab bl bi"><span class="bn uf">Follow</span></span></button></div></div></span></div><div class="ac r lk"><span class="bg b bh ab eb"><div class="ac ag"><span data-testid="storyReadTime">68 min read</span><div class="ll lm m" aria-hidden="true"><span class="m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span></div><span data-testid="storyPublishDate">Oct 20, 2025</span></div></span></div></div><div class="ac cw ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc"><div class="i l x fp fq r"><div class="ms m"><div class="ac r mt mu"><div class="pw-multi-vote-icon fr mv mw mx my"><span data-dd-action-name="Susi presentation tracker clap_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fgitconnected%2Faf69c5e044db&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;user=Fareed+Khan&amp;userId=b856005e5ecd&amp;source=---header_actions--af69c5e044db---------------------clap_footer------------------" rel="noopener follow"><div><div class="bn" aria-describedby="107" aria-labelledby="107" role="tooltip"><div tabindex="-1" class="bf"><div class="mz aq na nb nc nd ao ne nf ng my" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></div></a></span></div><div class="pw-multi-vote-count m nh ni nj nk nl nm nn"><div><div class="bn" aria-describedby="284" aria-labelledby="284" role="tooltip"><div tabindex="-1" class="bf"><p class="bg b ec ab eb"><button class="ah ai aj fo al am an ao ap aq ar as at au av wl nv">1.7K<span class="m i h g qv qw"></span></button></p></div></div></div></div></div></div><div><div class="bn" aria-describedby="108" aria-labelledby="108" role="tooltip"><div tabindex="-1" class="bf"><button class="aq mz nq nr ac r fs ns nt" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="jw"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bg b ec ab eb"><span class="pw-responses-count np jw">18</span></p></button></div></div></div></div><div class="ac r md me mf mg mh mi mj mk ml mm mn mo mp mq mr"><div class="nu l k j e"></div><div class="i l"><div><div class="bn" aria-describedby="109" aria-labelledby="109" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="headerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Faf69c5e044db&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;source=---header_actions--af69c5e044db---------------------bookmark_footer------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div><div class="fk ix cu"><div class="m ag"><div class="ac ci"><div class="nw nx ny nz oa gl cp bi"><div class="ac"><span data-dd-action-name="Susi presentation tracker post_audio_button"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2Fplans%3Fdimension%3Dpost_audio_button%26postId%3Daf69c5e044db&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;source=---header_actions--af69c5e044db---------------------post_audio_button------------------" rel="noopener follow"><div><div class="bn" aria-describedby="110" aria-labelledby="110" role="tooltip"><div tabindex="-1" class="bf"><button aria-label="Listen" data-testid="audioPlayButton" class="ah fs aj fo al am an ob ap aq ar fe oc od nt oe of og oh oi t oj ok ol om on oo op v oq or os"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Listen</p></div></button></div></div></div></a></span></div></div></div></div></div><div class="bn" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bn" aria-describedby="111" aria-labelledby="111" role="tooltip"><div tabindex="-1" class="bf"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="ah fs aj fo al am an ob ap aq ar fe oc od nt oe of og oh oi t oj ok ol om on oo op v oq or os"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Share</p></div></button></div></div></div></div></div></div></div></div></div></div><p id="5245" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Read this story for free: <a class="ah ib" href="https://medium.com/@fareedkhandev/af69c5e044db?sk=b3f7664c8135b95d057cb90312dc0c44" rel="noopener">link</a></p><p id="cd12" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">A RAG system often fails not because the LLM lacks intelligence, but because its <strong class="ov jg">architecture is too simple</strong>. It tries to handle a cyclical, multi-step problem with a linear, one-shot approach.</p><p id="b9f5" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Many complex queries demand <strong class="ov jg">reasoning</strong>, <strong class="ov jg">reflection</strong>, and <strong class="ov jg">smart decisions</strong> about when to act, much like how we retrieve information when faced with a question. That’s where agent-driven actions within the RAG pipeline come into play. Let’s take a look at what a typical deep-thinking RAG pipeline looks like…</p></div></div><div class="pm bi"><figure class="pn po pp pq pr pm bi paragraph-image"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ls6zh1GCk5oO_5JzVvTyRg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ls6zh1GCk5oO_5JzVvTyRg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ls6zh1GCk5oO_5JzVvTyRg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ls6zh1GCk5oO_5JzVvTyRg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ls6zh1GCk5oO_5JzVvTyRg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ls6zh1GCk5oO_5JzVvTyRg.png 1100w, https://miro.medium.com/v2/resize:fit:4800/format:webp/1*ls6zh1GCk5oO_5JzVvTyRg.png 4800w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 100vw" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*ls6zh1GCk5oO_5JzVvTyRg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ls6zh1GCk5oO_5JzVvTyRg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ls6zh1GCk5oO_5JzVvTyRg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ls6zh1GCk5oO_5JzVvTyRg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ls6zh1GCk5oO_5JzVvTyRg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ls6zh1GCk5oO_5JzVvTyRg.png 1100w, https://miro.medium.com/v2/resize:fit:4800/1*ls6zh1GCk5oO_5JzVvTyRg.png 4800w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 100vw"><img alt="" class="bi gl ps c" width="2400" height="2840" loading="eager" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_ls6zh1GCk5oO_5JzVvTyRg.png"></picture><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Deep Thinking RAG Pipeline (Created by <span class="hl"><span class="bn" aria-describedby="112" aria-labelledby="112" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div><div class="ac ci"><div class="cp bi ij ik il im"><ol class=""><li id="84f8" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Plan:</strong> First, the agent decomposes the complex user query into a structured, multi-step research plan, deciding which tool (internal document search or web search) is needed for each step.</li><li id="3668" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Retrieve:</strong> For each step, it executes an adaptive, multi-stage retrieval funnel, using a supervisor to dynamically choose the best search strategy (vector, keyword, or hybrid).</li><li id="e5d5" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Refine:</strong> It then uses a high-precision cross-encoder to rerank the initial results and a distiller agent to compress the best evidence into a concise context.</li><li id="a771" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Reflect:</strong> After each step, the agent summarizes its findings and updates its research history, building a cumulative understanding of the problem.</li><li id="d01a" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Critique:</strong> A policy agent then inspects this history, making a strategic decision to either continue to the next research step, revise its plan if it hits a dead end, or finish.</li><li id="332b" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Synthesize:</strong> Once the research is complete, a final agent synthesizes all the gathered evidence from all sources into a single, comprehensive, and citable answer.</li></ol><p id="ef4d" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">In this blog, we are going to implement the entire <strong class="ov jg">deep thinking RAG pipeline</strong> and compare it with a basic RAG pipeline to demonstrate how it solves <strong class="ov jg">complex multi-hop queries</strong>.</p><p id="6dd4" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">All the code + theory is available in my GitHub Repository:</p><div class="ys yt yu yv yw yx"><a href="https://github.com/FareedKhan-dev/deep-thinking-rag?source=post_page-----af69c5e044db---------------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="yy ac cb"><div class="yz ac cv ci cd za"><h2 class="bg jg hm ab ga zb gm zc zd ze zf je bl">GitHub - FareedKhan-dev/deep-thinking-rag: A Deep Thinking RAG Pipeline to Solve Complex Queries</h2><div class="sd m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">A Deep Thinking RAG Pipeline to Solve Complex Queries - GitHub - FareedKhan-dev/deep-thinking-rag: A Deep Thinking RAG…</h3></div><div class="zg m"><p class="bg b ec ab ga zb gm zc zd ze zf eb">github.com</p></div></div><div class="zh m"><div class="zi m zj zk zl zh zm gl yx"></div></div></div></a></div><h2 id="5bed" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Table of Contents</h2><ul class=""><li id="2894" class="ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#3707" rel="noopener ugc nofollow">Setting up the Environment</a></li><li id="9cca" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#d8b0" rel="noopener ugc nofollow">Sourcing the Knowledge Base</a></li><li id="2ca2" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#4ff4" rel="noopener ugc nofollow">Understanding our Multi-Source, Multi-Hop Query</a></li><li id="927f" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#d416" rel="noopener ugc nofollow">Building a Shallow RAG Pipeline that will Fail</a></li><li id="d260" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#4925" rel="noopener ugc nofollow">Defining the RAG State for Central Agent System</a></li><li id="8126" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#3c26" rel="noopener ugc nofollow">Strategic Planning and Query Formulation</a><br> ∘ <a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#95ca" rel="noopener ugc nofollow">Decomposing the Problem with Tool-Aware Planner</a><br> ∘ <a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#4f3d" rel="noopener ugc nofollow">Optimizing Retrieval with a Query Rewriter Agent</a><br> ∘ <a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#2eea" rel="noopener ugc nofollow">Precision with Metadata-Aware Chunking</a></li><li id="6d30" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#0a1e" rel="noopener ugc nofollow">Creating The Multi-Stage Retrieval Funnel</a><br> ∘ <a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#221d" rel="noopener ugc nofollow">Dynamically Choosing a Strategy Using Supervisor</a><br> ∘ <a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#a4ac" rel="noopener ugc nofollow">Broad Recall with Hybrid, Keyword and Semantic Search</a><br> ∘ <a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#437f" rel="noopener ugc nofollow">High Precision Using a Cross-Encoder Reranker</a><br> ∘ <a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#9692" rel="noopener ugc nofollow">Synthesizing using Contextual Distillation</a></li><li id="7b00" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#b6e1" rel="noopener ugc nofollow">Augmenting Knowledge with Web Search</a></li><li id="a851" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#6bd2" rel="noopener ugc nofollow">Self-Critique and Control Flow Policy</a><br> ∘ <a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#1747" rel="noopener ugc nofollow">Update and Reflect Cumulative Research History</a><br> ∘ <a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#0667" rel="noopener ugc nofollow">Building Policy Agent for Control Flow</a></li><li id="2aa4" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#1091" rel="noopener ugc nofollow">Defining the Graph Nodes</a></li><li id="ceaa" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#d6b9" rel="noopener ugc nofollow">Defining the Conditional Edges</a></li><li id="647e" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#7ba9" rel="noopener ugc nofollow">Wiring the Deep Thinking RAG Machine</a></li><li id="c128" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#1a37" rel="noopener ugc nofollow">Compiling and Visualizing the Iterative Workflow</a></li><li id="035f" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#0094" rel="noopener ugc nofollow">Running the Deep Thinking Pipeline</a></li><li id="40b4" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#b8c7" rel="noopener ugc nofollow">Analyzing the Final, High-Quality Answer</a></li><li id="183e" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#ea93" rel="noopener ugc nofollow">Side by Side Comparison</a></li><li id="db55" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#c905" rel="noopener ugc nofollow">Evaluation Framework and Analyzing Results</a></li><li id="28d0" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#e308" rel="noopener ugc nofollow">Summarizing Our Entire Pipeline</a></li><li id="5707" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><a class="ah ib" href="https://levelup.gitconnected.com/building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db#7840" rel="noopener ugc nofollow">Learned Policies with Markov Decision Processes (MDP)</a></li></ul></div></div></div><div class="ac ci iw abc abd abe" role="separator"><span class="wy by bn go abf qx"></span><span class="wy by bn go abf qx"></span><span class="wy by bn go abf"></span></div><div class="id ic ja jb jc"><div class="ac ci"><div class="cp bi ij ik il im"><h2 id="3707" class="zn zo jf bg zp sl abg kb gy sm abh ke ha sn abi so sp sq abj sr ss st abk su sv zv bl" data-selectable-paragraph="">Setting up the Environment</h2><p id="a55d" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">Before we can start coding the Deep RAG pipeline, we need to begin with a strong foundation because a production-grade AI system is not only about the final algorithm, it is also about the deliberate choices we make during setup.</p><blockquote class="abl"><p id="55c8" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">Each of the steps we are going to implement is important in determining how effective and reliable the final system will be.</p></blockquote><p id="e53d" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">When we start developing a pipeline and performing trial and error with it, it’s better to define our configuration in a plain dictionary format because later on, when the pipeline gets complicated, we can simply refer back to this dictionary to change the config and see its impact on the overall performance.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="8981" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Central Configuration Dictionary to manage all system parameters</span><br>config = {<br>    <span class="hljs-string">"data_dir"</span>: <span class="hljs-string">"./data"</span>,                           <span class="hljs-comment"># Directory to store raw and cleaned data</span><br>    <span class="hljs-string">"vector_store_dir"</span>: <span class="hljs-string">"./vector_store"</span>,           <span class="hljs-comment"># Directory to persist our vector store</span><br>    <span class="hljs-string">"llm_provider"</span>: <span class="hljs-string">"openai"</span>,                       <span class="hljs-comment"># The LLM provider we are using</span><br>    <span class="hljs-string">"reasoning_llm"</span>: <span class="hljs-string">"gpt-4o"</span>,                      <span class="hljs-comment"># The powerful model for planning and synthesis</span><br>    <span class="hljs-string">"fast_llm"</span>: <span class="hljs-string">"gpt-4o-mini"</span>,                      <span class="hljs-comment"># A faster, cheaper model for simpler tasks like the baseline RAG</span><br>    <span class="hljs-string">"embedding_model"</span>: <span class="hljs-string">"text-embedding-3-small"</span>,    <span class="hljs-comment"># The model for creating document embeddings</span><br>    <span class="hljs-string">"reranker_model"</span>: <span class="hljs-string">"cross-encoder/ms-marco-MiniLM-L-6-v2"</span>, <span class="hljs-comment"># The model for precision reranking</span><br>    <span class="hljs-string">"max_reasoning_iterations"</span>: <span class="hljs-number">7</span>,                  <span class="hljs-comment"># A safeguard to prevent the agent from getting into an infinite loop</span><br>    <span class="hljs-string">"top_k_retrieval"</span>: <span class="hljs-number">10</span>,                          <span class="hljs-comment"># Number of documents for initial broad recall</span><br>    <span class="hljs-string">"top_n_rerank"</span>: <span class="hljs-number">3</span>,                              <span class="hljs-comment"># Number of documents to keep after precision reranking</span><br>}</span></pre><p id="478d" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">These keys are pretty easy to understand but there are three keys that are worth mentioning:</p><ul class=""><li id="3e2b" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><code class="de acj ack acl acb b">llm_provider</code>: This is the LLM provider we are using, in this case, OpenAI. I am using OpenAI because we can easily swap models and providers in LangChain, but you can choose any provider that suits your needs like <a class="ah ib" href="http://ollama.com/" rel="noopener ugc nofollow" target="_blank">Ollama</a>.</li><li id="6277" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><code class="de acj ack acl acb b">reasoning_llm</code>: This must be the most powerful in our entire setup because it will be used for planning and synthesis.</li><li id="1b3b" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><code class="de acj ack acl acb b">fast_llm</code>: This should be a faster and cheaper model because it will be used for simpler tasks like the baseline RAG.</li></ul><p id="b2b9" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now we need to import the required libraries that we will be using through our pipeline along with setting the api keys as an environment variabls to avoid exposing it in the code blocks.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="c9ef" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">import</span> os                  <span class="hljs-comment"># For interacting with the operating system (e.g., managing environment variables)</span><br><span class="hljs-keyword">import</span> re                  <span class="hljs-comment"># For regular expression operations, useful for text cleaning</span><br><span class="hljs-keyword">import</span> json                <span class="hljs-comment"># For working with JSON data</span><br><span class="hljs-keyword">from</span> getpass <span class="hljs-keyword">import</span> getpass <span class="hljs-comment"># To securely prompt for user input like API keys without echoing to the screen</span><br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint   <span class="hljs-comment"># For pretty-printing Python objects, making them more readable</span><br><span class="hljs-keyword">import</span> uuid                <span class="hljs-comment"># To generate unique identifiers</span><br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, TypedDict, <span class="hljs-type">Literal</span>, <span class="hljs-type">Optional</span> <span class="hljs-comment"># For type hinting to create clean, readable, and maintainable code</span><br><br><span class="hljs-comment"># Helper function to securely set environment variables if they are not already present</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">_set_env</span>(<span class="hljs-params">var: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-comment"># Check if the environment variable is not already set</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.environ.get(var):<br>        <span class="hljs-comment"># If not, prompt the user to enter it securely</span><br>        os.environ[var] = getpass(<span class="hljs-string">f"Enter your <span class="hljs-subst">{var}</span>: "</span>)<br><br><span class="hljs-comment"># Set the API keys for the services we will use</span><br>_set_env(<span class="hljs-string">"OPENAI_API_KEY"</span>)      <span class="hljs-comment"># For accessing OpenAI models (GPT-4o, embeddings)</span><br>_set_env(<span class="hljs-string">"LANGSMITH_API_KEY"</span>)   <span class="hljs-comment"># For tracing and debugging with LangSmith</span><br>_set_env(<span class="hljs-string">"TAVILY_API_KEY"</span>)      <span class="hljs-comment"># For the web search tool</span><br><br><span class="hljs-comment"># Enable LangSmith tracing to get detailed logs and visualizations of our agent's execution</span><br>os.environ[<span class="hljs-string">"LANGSMITH_TRACING"</span>] = <span class="hljs-string">"true"</span><br><span class="hljs-comment"># Define a project name in LangSmith to organize our runs</span><br>os.environ[<span class="hljs-string">"LANGSMITH_PROJECT"</span>] = <span class="hljs-string">"Advanced-Deep-Thinking-RAG"</span></span></pre><p id="6386" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are also enabling LangSmith for tracing. When you are working with an agentic system that has a complex, cyclical workflow, <strong class="ov jg">tracing is not just a nice-to-have it’s important</strong>. It helps you visualize what’s going on and makes it much easier to debug the agent’s thought process.</p><h2 id="d8b0" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Sourcing the Knowledge Base</h2><p id="f009" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">A production-grade RAG system requires a knowledge base that is both complex and demanding in order to truly demonstrate its effectiveness. For this purpose, we will use <a class="ah ib" href="https://www.sec.gov/Archives/edgar/data/1045810/000104581023000017/nvda-20230129.htm" rel="noopener ugc nofollow" target="_blank"><strong class="ov jg">NVIDIA’s 2023 10-K filing</strong></a>, a comprehensive document exceeding one hundred pages that details the company business operations, financial performance, and disclosed risk factors.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw acp"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ly7XgLA5nZV4WexWi8rKgw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ly7XgLA5nZV4WexWi8rKgw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ly7XgLA5nZV4WexWi8rKgw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ly7XgLA5nZV4WexWi8rKgw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ly7XgLA5nZV4WexWi8rKgw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ly7XgLA5nZV4WexWi8rKgw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*ly7XgLA5nZV4WexWi8rKgw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*ly7XgLA5nZV4WexWi8rKgw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ly7XgLA5nZV4WexWi8rKgw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ly7XgLA5nZV4WexWi8rKgw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ly7XgLA5nZV4WexWi8rKgw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ly7XgLA5nZV4WexWi8rKgw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ly7XgLA5nZV4WexWi8rKgw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*ly7XgLA5nZV4WexWi8rKgw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="389" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_ly7XgLA5nZV4WexWi8rKgw.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Sourcing the Knowledge Base (Created by <span class="hl"><span class="bn" aria-describedby="113" aria-labelledby="113" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="230b" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First, we will implement a <strong class="ov jg">custom function</strong> that programmatically downloads the 10-K filing directly from the <strong class="ov jg">SEC EDGAR database</strong>, parses the raw HTML, and converts it into a clean and structured text format suitable for ingestion by our RAG pipeline. So let’s code that function.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="db08" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">import</span> requests <span class="hljs-comment"># For making HTTP requests to download the document</span><br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup <span class="hljs-comment"># A powerful library for parsing HTML and XML documents</span><br><span class="hljs-keyword">from</span> langchain.docstore.document <span class="hljs-keyword">import</span> Document <span class="hljs-comment"># LangChain's standard data structure for a piece of text</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">download_and_parse_10k</span>(<span class="hljs-params">url, doc_path_raw, doc_path_clean</span>):<br>    <span class="hljs-comment"># Check if the cleaned file already exists to avoid re-downloading</span><br>    <span class="hljs-keyword">if</span> os.path.exists(doc_path_clean):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Cleaned 10-K file already exists at: <span class="hljs-subst">{doc_path_clean}</span>"</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Downloading 10-K filing from <span class="hljs-subst">{url}</span>..."</span>)<br>    <span class="hljs-comment"># Set a User-Agent header to mimic a browser, as some servers block scripts</span><br>    headers = {<span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0'</span>}<br>    <span class="hljs-comment"># Make the GET request to the URL</span><br>    response = requests.get(url, headers=headers)<br>    <span class="hljs-comment"># Raise an error if the download fails (e.g., 404 Not Found)</span><br>    response.raise_for_status()<br><br>    <span class="hljs-comment"># Save the raw HTML content to a file for inspection</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(doc_path_raw, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(response.text)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Raw document saved to <span class="hljs-subst">{doc_path_raw}</span>"</span>)<br><br>    <span class="hljs-comment"># Use BeautifulSoup to parse and clean the HTML content</span><br>    soup = BeautifulSoup(response.content, <span class="hljs-string">'html.parser'</span>)<br><br>    <span class="hljs-comment"># Extract text from common HTML tags, attempting to preserve paragraph structure</span><br>    text = <span class="hljs-string">''</span><br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> soup.find_all([<span class="hljs-string">'p'</span>, <span class="hljs-string">'div'</span>, <span class="hljs-string">'span'</span>]):<br>        <span class="hljs-comment"># Get the text from each tag, stripping extra whitespace, and add newlines</span><br>        text += p.get_text(strip=<span class="hljs-literal">True</span>) + <span class="hljs-string">'\n\n'</span><br><br>    <span class="hljs-comment"># Use regex to clean up excessive newlines and spaces for a cleaner final text</span><br>    clean_text = re.sub(<span class="hljs-string">r'\n{3,}'</span>, <span class="hljs-string">'\n\n'</span>, text).strip() <span class="hljs-comment"># Collapse 3+ newlines into 2</span><br>    clean_text = re.sub(<span class="hljs-string">r'\s{2,}'</span>, <span class="hljs-string">' '</span>, clean_text).strip() <span class="hljs-comment"># Collapse 2+ spaces into 1</span><br><br>    <span class="hljs-comment"># Save the final cleaned text to a .txt file</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(doc_path_clean, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(clean_text)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Cleaned text content extracted and saved to <span class="hljs-subst">{doc_path_clean}</span>"</span>)</span></pre><p id="36d8" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The code is pretty easy to understand, we are using <a class="ah ib" href="https://pypi.org/project/beautifulsoup4/" rel="noopener ugc nofollow" target="_blank">beautifulsoup4</a> to parse the HTML content and extract the text. It will help us to easily navigate the HTML structure and retrieve the relevant information while ignoring any unnecessary elements like scripts or styles.</p><p id="5df7" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now, let’s execute this and see how it works.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="495f" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-built_in">print</span>(<span class="hljs-string">"Downloading and parsing NVIDIA's 2023 10-K filing..."</span>)<br><span class="hljs-comment"># Execute the download and parsing function</span><br>download_and_parse_10k(url_10k, doc_path_raw, doc_path_clean)<br><br><span class="hljs-comment"># Open the cleaned file and print a sample to verify the result</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(doc_path_clean, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Sample content from cleaned 10-K ---"</span>)<br>    <span class="hljs-built_in">print</span>(f.read(<span class="hljs-number">1000</span>) + <span class="hljs-string">"..."</span>)<br><br><br><span class="hljs-comment">#### OUTPUT ####</span><br>Downloading <span class="hljs-keyword">and</span> parsing NVIDIA <span class="hljs-number">2023</span> <span class="hljs-number">10</span>-K filing...<br>Successfully downloaded <span class="hljs-number">10</span>-K filing <span class="hljs-keyword">from</span> https://www.sec.gov/Archives/edgar/data/<span class="hljs-number">1045810</span>/<span class="hljs-number">000</span>104581023000017/nvda-<span class="hljs-number">20230129.</span>htm<br>Raw document saved to ./data/nvda_10k_2023_raw.html<br>Cleaned text content extracted <span class="hljs-keyword">and</span> saved to ./data/nvda_10k_2023_clean.txt<br><br><span class="hljs-comment"># --- Sample content from cleaned 10-K ---</span><br>Item <span class="hljs-number">1.</span> Business. <br> OVERVIEW <br> NVIDIA <span class="hljs-keyword">is</span> the pioneer of accelerated computing. We are a full-stack computing company <span class="hljs-keyword">with</span> a platform strategy that brings together hardware, systems, software, algorithms, libraries, <span class="hljs-keyword">and</span> services to create unique value <span class="hljs-keyword">for</span> the markets we serve. Our work <span class="hljs-keyword">in</span> accelerated computing <span class="hljs-keyword">and</span> AI <span class="hljs-keyword">is</span> reshaping the worlds largest industries <span class="hljs-keyword">and</span> profoundly impacting society. <br> Founded <span class="hljs-keyword">in</span> <span class="hljs-number">1993</span>, we started <span class="hljs-keyword">as</span> a PC graphics chip company, inventing the graphics processing unit, <span class="hljs-keyword">or</span> GPU. The GPU was essential <span class="hljs-keyword">for</span> the growth of the PC gaming market <span class="hljs-keyword">and</span> has since been repurposed to revolutionize computer graphics, high performance computing, <span class="hljs-keyword">or</span> HPC, <span class="hljs-keyword">and</span> AI. <br> The programmability of our GPUs made them ...</span></pre><p id="6670" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are simply calling this function storing all the content in a txt file that will serve as our context for our rag pipeline.</p><p id="d502" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">When we run the above code you can see that it starts download the report for us and we can see how a sample of our downloaded content looks like.</p><h2 id="4ff4" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Understanding our Multi-Source, Multi-Hop Query</h2><p id="072d" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">To test our implemented pipeline and compare it with basic RAG, we need to use a very complex query that covers different aspects of the documents we are working with.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="65d3" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph="">Our Complex Query:<br><br><span class="hljs-string">"Based on NVIDIA's 2023 10-K filing, identify their key risks related to<br>competition. Then, find recent news (post-filing, from 2024) about AMD's<br>AI chip strategy and explain how this new strategy directly addresses or<br>exacerbates one of NVIDIA's stated risks."</span></span></pre><p id="201b" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Let’s break down why this query is so difficult for a standard RAG pipeline:</p><ol class=""><li id="3cbd" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Multi-Hop Reasoning:</strong> It cannot be answered in a single step. The system must first identify the risks, then find the AMD news, and finally synthesize the two.</li><li id="b805" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Multi-Source Knowledge:</strong> The required information lives in two completely different places. The risks are in our static, internal document (the 10-K), while the AMD news is external and requires access to the live web.</li><li id="b2af" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Synthesis and Analysis:</strong> The query doesn’t ask for a simple list of facts. It demands an explanation of how one set of facts makes worse another, a task that requires true synthesis.</li></ol><p id="24f9" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">In the next section we are going to implement basic RAG pipeline actually see how simple RAG is failing this.</p><h2 id="d416" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Building a Shallow RAG Pipeline that will Fail</h2><p id="5441" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">Now that we have our environment configured and our challenging knowledge base ready, our next logical step is to build a standard <strong class="ov jg">vanilla </strong>RAG pipeline. This serves a critical purpose …</p><blockquote class="abl"><p id="2086" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">First building the simplest possible solution, we can run our complex query against it and observe exactly <em class="acw">how</em> and <em class="acw">why</em> it fails.</p></blockquote><p id="699f" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">Here’s what we are going to do in this section:</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw acx"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*cyBvqUWbcun6FrnWDkdUEw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*cyBvqUWbcun6FrnWDkdUEw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*cyBvqUWbcun6FrnWDkdUEw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*cyBvqUWbcun6FrnWDkdUEw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*cyBvqUWbcun6FrnWDkdUEw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*cyBvqUWbcun6FrnWDkdUEw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*cyBvqUWbcun6FrnWDkdUEw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*cyBvqUWbcun6FrnWDkdUEw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*cyBvqUWbcun6FrnWDkdUEw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*cyBvqUWbcun6FrnWDkdUEw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*cyBvqUWbcun6FrnWDkdUEw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*cyBvqUWbcun6FrnWDkdUEw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*cyBvqUWbcun6FrnWDkdUEw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*cyBvqUWbcun6FrnWDkdUEw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="347" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_cyBvqUWbcun6FrnWDkdUEw.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Shallow RAG Pipeline (Created by <span class="hl"><span class="bn" aria-describedby="114" aria-labelledby="114" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><ul class=""><li id="0602" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Load and Chunk the Document:</strong> We will ingest our cleaned 10-K filing and split it into small, fixed-size chunks a common but semantically naive approach.</li><li id="4fe6" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Create a Vector Store:</strong> We then are going to embed these chunks and index them in a ChromaDB vector store to enable basic semantic search.</li><li id="9d45" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Assemble the RAG Chain:</strong> We will be using LangChain Expression Language (<a class="ah ib" href="https://python.langchain.com/docs/concepts/lcel/" rel="noopener ugc nofollow" target="_blank">LCEL</a>), which will wire together our retriever, a prompt template, and an LLM into a linear pipeline.</li><li id="9cd3" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Demonstrate the Critical Failure:</strong> We will execute our multi-hop, multi-source query against this simple system and analyze its inadequate response.</li></ul><p id="6d9b" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First, we need to load our cleaned document and split it. We will use the <code class="de acj ack acl acb b">RecursiveCharacterTextSplitter</code>, a standard tool in the LangChain ecosystem.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="a6d1" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> langchain_community.document_loaders <span class="hljs-keyword">import</span> TextLoader <span class="hljs-comment"># A simple loader for .txt files</span><br><span class="hljs-keyword">from</span> langchain.text_splitter <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter <span class="hljs-comment"># A standard text splitter</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Loading and chunking the document..."</span>)<br><span class="hljs-comment"># Initialize the loader with the path to our cleaned 10-K file</span><br>loader = TextLoader(doc_path_clean, encoding=<span class="hljs-string">'utf-8'</span>)<br><span class="hljs-comment"># Load the document into memory</span><br>documents = loader.load()<br><br><span class="hljs-comment"># Initialize the text splitter with a defined chunk size and overlap</span><br><span class="hljs-comment"># chunk_size=1000: Each chunk will be approximately 1000 characters long.</span><br><span class="hljs-comment"># chunk_overlap=150: Each chunk will share 150 characters with the previous one to maintain some context.</span><br>text_splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="hljs-number">1000</span>, chunk_overlap=<span class="hljs-number">150</span>)<br><span class="hljs-comment"># Split the loaded document into smaller, manageable chunks</span><br>doc_chunks = text_splitter.split_documents(documents)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Document loaded and split into <span class="hljs-subst">{<span class="hljs-built_in">len</span>(doc_chunks)}</span> chunks."</span>)<br><br><br><span class="hljs-comment">#### OUTPUT ####</span><br>Loading <span class="hljs-keyword">and</span> chunking the document...<br>Document loaded <span class="hljs-keyword">and</span> split into <span class="hljs-number">378</span> chunks.</span></pre><p id="808a" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are having <code class="de acj ack acl acb b">378</code> chunks on our main doc, the next step is to make them searchable. For this, we need to create vector embeddings and store them in a database. We will use <a class="ah ib" href="https://www.trychroma.com/" rel="noopener ugc nofollow" target="_blank">ChromaDB</a>, a popular in-memory vector store, and OpenAI <code class="de acj ack acl acb b">text-embedding-3-small</code> model as defined in our config.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="c266" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> Chroma <span class="hljs-comment"># The vector store we will use</span><br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> OpenAIEmbeddings <span class="hljs-comment"># The function to create embeddings</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Creating baseline vector store..."</span>)<br><span class="hljs-comment"># Initialize the embedding function using the model specified in our config</span><br>embedding_function = OpenAIEmbeddings(model=config[<span class="hljs-string">'embedding_model'</span>])<br><br><span class="hljs-comment"># Create the Chroma vector store from our document chunks</span><br><span class="hljs-comment"># This process takes each chunk, creates an embedding for it, and indexes it.</span><br>baseline_vector_store = Chroma.from_documents(<br>    documents=doc_chunks,<br>    embedding=embedding_function<br>)<br><span class="hljs-comment"># Create a retriever from the vector store</span><br><span class="hljs-comment"># The retriever is the component that will actually perform the search.</span><br><span class="hljs-comment"># search_kwargs={"k": 3}: This tells the retriever to return the top 3 most relevant chunks for any given query.</span><br>baseline_retriever = baseline_vector_store.as_retriever(search_kwargs={<span class="hljs-string">"k"</span>: <span class="hljs-number">3</span>})<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Vector store created with <span class="hljs-subst">{baseline_vector_store._collection.count()}</span> embeddings."</span>)<br><br><br><span class="hljs-comment">#### OUTPUT ####</span><br>Creating baseline vector store...<br>Vector store created <span class="hljs-keyword">with</span> <span class="hljs-number">378</span> embeddings.</span></pre><p id="716f" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph=""><code class="de acj ack acl acb b">Chroma.from_documents</code> organize this process and stores all the vectors in an searchable index. The final step is to assemble them into a single, runnable RAG chain using LangChain Expression Language (LCEL).</p><p id="4109" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This chain will define the linear flow of data: from the user’ question to the retriever, then to the prompt, and finally to the LLM.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="9979" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate <span class="hljs-comment"># For creating prompt templates</span><br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI <span class="hljs-comment"># The OpenAI chat model interface</span><br><span class="hljs-keyword">from</span> langchain_core.runnable <span class="hljs-keyword">import</span> RunnablePassthrough <span class="hljs-comment"># A tool to pass inputs through the chain</span><br><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser <span class="hljs-comment"># To parse the LLM's output as a simple string</span><br><br><span class="hljs-comment"># This template instructs the LLM on how to behave.</span><br><span class="hljs-comment"># {context}: This is where we will inject the content from our retrieved documents.</span><br><span class="hljs-comment"># {question}: This is where the user's original question will go.</span><br>template = <span class="hljs-string">"""You are an AI financial analyst. Answer the question based only on the following context:<br>{context}<br><br>Question: {question}<br>"""</span><br>prompt = ChatPromptTemplate.from_template(template)<br><span class="hljs-comment"># We use our 'fast_llm' for this simple task, as defined in our config</span><br>llm = ChatOpenAI(model=config[<span class="hljs-string">"fast_llm"</span>], temperature=<span class="hljs-number">0</span>)<br><br><span class="hljs-comment"># A helper function to format the list of retrieved documents into a single string</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">format_docs</span>(<span class="hljs-params">docs</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"\n\n---\n\n"</span>.join(doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> docs)<br><br><span class="hljs-comment"># The complete RAG chain defined using LCEL's pipe (|) syntax</span><br>baseline_rag_chain = (<br>    <span class="hljs-comment"># The first step is a dictionary that defines the inputs to our prompt</span><br>    {<span class="hljs-string">"context"</span>: baseline_retriever | format_docs, <span class="hljs-string">"question"</span>: RunnablePassthrough()}<br>    <span class="hljs-comment"># The context is generated by taking the question, passing it to the retriever, and formatting the result</span><br>    <span class="hljs-comment"># The original question is passed through unchanged</span><br>    | prompt <span class="hljs-comment"># The dictionary is then passed to the prompt template</span><br>    | llm <span class="hljs-comment"># The formatted prompt is passed to the language model</span><br>    | StrOutputParser() <span class="hljs-comment"># The LLM's output message is parsed into a string</span><br>)</span></pre><p id="7218" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">You do know that we define a dictionary as the first step. Its <code class="de acj ack acl acb b">context</code> key is populated by a sub-chain, the input question goes to the <code class="de acj ack acl acb b">baseline_retriever</code>, and its output (a list of <code class="de acj ack acl acb b">Document</code> objects) is formatted into a single string by <code class="de acj ack acl acb b">format_docs</code>. The <code class="de acj ack acl acb b">question</code> key is populated by simply passing the original input through using <code class="de acj ack acl acb b">RunnablePassthrough</code>.</p><p id="a7eb" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Let’s run this simple pipeline and understand where it is failing.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="e55a" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> rich.console <span class="hljs-keyword">import</span> Console <span class="hljs-comment"># For pretty-printing output with markdown</span><br><span class="hljs-keyword">from</span> rich.markdown <span class="hljs-keyword">import</span> Markdown<br><br><span class="hljs-comment"># Initialize the rich console for better output formatting</span><br>console = Console()<br><br><span class="hljs-comment"># Our complex, multi-hop, multi-source query</span><br>complex_query_adv = <span class="hljs-string">"Based on NVIDIA's 2023 10-K filing, identify their key risks related to competition. Then, find recent news (post-filing, from 2024) about AMD's AI chip strategy and explain how this new strategy directly addresses or exacerbates one of NVIDIA's stated risks."</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Executing complex query on the baseline RAG chain..."</span>)<br><span class="hljs-comment"># Invoke the chain with our challenging query</span><br>baseline_result = baseline_rag_chain.invoke(complex_query_adv)<br><br>console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- BASELINE RAG FAILED OUTPUT ---"</span>)<br><span class="hljs-comment"># Print the result using markdown formatting for readability</span><br>console.<span class="hljs-built_in">print</span>(Markdown(baseline_result))</span></pre><p id="4956" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">When you run the above code we get the following output.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="9c46" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>Executing complex query on the baseline RAG chain...<br><br>--- BASELINE RAG FAILED OUTPUT ---<br>Based on the provided context, NVIDIA operates <span class="hljs-keyword">in</span> an intensely competitive semiconductor<br>industry and faces competition from companies like AMD. The context mentions<br>that the industry is characterized by rapid technological change. However, the provided documents <span class="hljs-keyword">do</span> not contain any specific information about AMD<span class="hljs-string">'s recent AI chip strategy from 2024 or how it might impact NVIDIA'</span>s stated risks.</span></pre><p id="6bdb" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">There are three things that you might have notice in this failed RAG pipeline and its output.</p><ul class=""><li id="47d5" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Irrelevant Context:</strong> Retriever grabs general chunks on <strong class="ov jg">“NVIDIA”</strong>, <strong class="ov jg">“competition”</strong> and <strong class="ov jg">“AMD”</strong> but misses specific 2024 AMD strategy details.</li><li id="8c65" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Missing Information:</strong> Key failure is that 2023 data can’t cover 2024 events. System doesn’t realize it’s lacking crucial info.</li><li id="1fcf" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">No Planning or Tool Use:</strong> Treats complex query as simple. Can’t break it into steps or use tools like web search to fill gaps.</li></ul><blockquote class="abl"><p id="fed1" class="abm abn jf bg abo abp acy acz ada adb adc pl eb" data-selectable-paragraph="">The system failed not because the LLM was dumb but because the <strong class="an">architecture was too simple</strong>. It was a linear, one-shot process trying to solve a cyclical, multi-step problem.</p></blockquote><p id="92ca" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">Now that we have understand the issues with our basic RAG pipeline we can now start implementing our deep thinking methodology and see how well it solves our complex query.</p><h2 id="4925" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Defining the <code class="de acj ack acl acb b">RAG State for </code>Central Agent System</h2><p id="40e2" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">To build our reasoning agent, we first need a way to manage its state. In our simple RAG chain, each step was stateless, but …</p><blockquote class="abl"><p id="b3db" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">an intelligent agent, however, needs a memory. It needs to remember the original question, the plan it created, and the evidence it has gathered so far.</p></blockquote></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="ade adf adg adh adi pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw add"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*zdC2OcniC3JoRIWp669e-w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*zdC2OcniC3JoRIWp669e-w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*zdC2OcniC3JoRIWp669e-w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*zdC2OcniC3JoRIWp669e-w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*zdC2OcniC3JoRIWp669e-w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*zdC2OcniC3JoRIWp669e-w.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*zdC2OcniC3JoRIWp669e-w.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*zdC2OcniC3JoRIWp669e-w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*zdC2OcniC3JoRIWp669e-w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*zdC2OcniC3JoRIWp669e-w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*zdC2OcniC3JoRIWp669e-w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*zdC2OcniC3JoRIWp669e-w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*zdC2OcniC3JoRIWp669e-w.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*zdC2OcniC3JoRIWp669e-w.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="358" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_zdC2OcniC3JoRIWp669e-w.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">RAG State (Created by <span class="hl"><span class="bn" aria-describedby="115" aria-labelledby="115" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="ac2a" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The <code class="de acj ack acl acb b">RAGState</code> will act as a central memory, passed between every node in our LangGraph workflow. To build it, we will define a series of structured data classes, starting with the most fundamental building block: a single step in a research plan.</p><p id="8787" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We want to define the atomic unit of our agent’s plan. Each <code class="de acj ack acl acb b">Step</code> must contain not just a question to be answered, but also the reasoning behind it and, crucially, the specific tool the agent should use. This forces the agent's planning process to be explicit and structured.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="a8c7" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> langchain_core.documents <span class="hljs-keyword">import</span> Document<br><span class="hljs-keyword">from</span> langchain_core.pydantic_v1 <span class="hljs-keyword">import</span> BaseModel, Field<br><br><span class="hljs-comment"># Pydantic model for a single step in the agent's reasoning plan</span><br><span class="hljs-keyword">class</span> <span class="hljs-title.class">Step</span>(<span class="hljs-title.class.inherited">BaseModel</span>):<br>    <span class="hljs-comment"># A specific, answerable sub-question for this research step</span><br>    sub_question: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"A specific, answerable question for this step."</span>)<br>    <span class="hljs-comment"># The agent's justification for why this step is necessary</span><br>    justification: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"A brief explanation of why this step is necessary to answer the main query."</span>)<br>    <span class="hljs-comment"># The specific tool to use for this step: either internal document search or external web search</span><br>    tool: <span class="hljs-type">Literal</span>[<span class="hljs-string">"search_10k"</span>, <span class="hljs-string">"search_web"</span>] = Field(description=<span class="hljs-string">"The tool to use for this step."</span>)<br>    <span class="hljs-comment"># A list of critical keywords to improve the accuracy of the search</span><br>    keywords: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = Field(description=<span class="hljs-string">"A list of critical keywords for searching relevant document sections."</span>)<br>    <span class="hljs-comment"># (Optional) A likely document section to perform a more targeted, filtered search within</span><br>    document_section: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(description=<span class="hljs-string">"A likely document section title (e.g., 'Item 1A. Risk Factors') to search within. Only for 'search_10k' tool."</span>)</span></pre><p id="4d80" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Our<code class="de acj ack acl acb b">Step</code> class, using Pydantic <code class="de acj ack acl acb b">BaseModel</code>, acts as a strict contract for our Planner Agent. The <code class="de acj ack acl acb b">tool: Literal[...]</code> field forces the LLM to make a concrete decision between using our internal knowledge (<code class="de acj ack acl acb b">search_10k</code>) or seeking external information (<code class="de acj ack acl acb b">search_web</code>).</p><blockquote class="abl"><p id="66d9" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">This structured output is far more reliable than trying to parse a natural language plan.</p></blockquote><p id="f979" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">Now that we have defined a single <code class="de acj ack acl acb b">Step</code>, we need a container to hold the entire sequence of steps. We will create a <code class="de acj ack acl acb b">Plan</code> class that is simply a list of <code class="de acj ack acl acb b">Step</code> objects. This represents the agent complete, end-to-end research strategy.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="9c99" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Pydantic model for the overall plan, which is a list of individual steps</span><br><span class="hljs-keyword">class</span> <span class="hljs-title.class">Plan</span>(<span class="hljs-title.class.inherited">BaseModel</span>):<br>    <span class="hljs-comment"># A list of Step objects that outlines the full research plan</span><br>    steps: <span class="hljs-type">List</span>[Step] = Field(description=<span class="hljs-string">"A detailed, multi-step plan to answer the user's query."</span>)</span></pre><p id="221f" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We coded a <code class="de acj ack acl acb b">Plan</code> class that is going to provide the structure for the entire research process. When we invoke our Planner Agent, we will ask it to return a JSON object that conforms to this schema. This make sure that the agent strategy is clear, sequential, and machine-readable before any retrieval actions are taken.</p><p id="349e" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Next, as our agent executes its plan, it needs a way to remember what it has learned. We will define a <code class="de acj ack acl acb b">PastStep</code> dictionary to store the results of each completed step. This will form the agent's <strong class="ov jg">research history</strong> or <strong class="ov jg">lab notebook</strong>.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="daa1" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># A TypedDict to store the results of a completed step in our research history</span><br><span class="hljs-keyword">class</span> <span class="hljs-title.class">PastStep</span>(<span class="hljs-title.class.inherited">TypedDict</span>):<br>    step_index: <span class="hljs-built_in">int</span>              <span class="hljs-comment"># The index of the completed step (e.g., 1, 2, 3)</span><br>    sub_question: <span class="hljs-built_in">str</span>            <span class="hljs-comment"># The sub-question that was addressed in this step</span><br>    retrieved_docs: <span class="hljs-type">List</span>[Document] <span class="hljs-comment"># The precise documents retrieved and reranked for this step</span><br>    summary: <span class="hljs-built_in">str</span>                 <span class="hljs-comment"># The agent's one-sentence summary of the findings from this step</span></span></pre><p id="2673" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This <code class="de acj ack acl acb b">PastStep</code> structure is crucial for the agent's self-critique loop. After each step, we will populate one of these dictionaries and add it to our state. The agent will then be able to review this growing list of summaries to understand what it knows and decide if it has enough information to finish its task.</p><p id="7d09" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Finally, we will bring all these pieces together into the master <code class="de acj ack acl acb b">RAGState</code> dictionary. This is the central object that will flow through our entire graph, holding the original query, the full plan, the history of past steps, and all the intermediate data for the <em class="adj">current</em> step being executed.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="74ba" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># The main state dictionary that will be passed between all nodes in our LangGraph agent</span><br><span class="hljs-keyword">class</span> <span class="hljs-title.class">RAGState</span>(<span class="hljs-title.class.inherited">TypedDict</span>):<br>    original_question: <span class="hljs-built_in">str</span>     <span class="hljs-comment"># The initial, complex query from the user that starts the process</span><br>    plan: Plan                 <span class="hljs-comment"># The multi-step plan generated by the Planner Agent</span><br>    past_steps: <span class="hljs-type">List</span>[PastStep] <span class="hljs-comment"># A cumulative history of completed research steps and their findings</span><br>    current_step_index: <span class="hljs-built_in">int</span>    <span class="hljs-comment"># The index of the current step in the plan being executed</span><br>    retrieved_docs: <span class="hljs-type">List</span>[Document] <span class="hljs-comment"># Documents retrieved in the current step (results of broad recall)</span><br>    reranked_docs: <span class="hljs-type">List</span>[Document]  <span class="hljs-comment"># Documents after precision reranking in the current step</span><br>    synthesized_context: <span class="hljs-built_in">str</span>   <span class="hljs-comment"># The concise, distilled context generated from the reranked docs</span><br>    final_answer: <span class="hljs-built_in">str</span>          <span class="hljs-comment"># The final, synthesized answer to the user's original question</span></span></pre><p id="dfe3" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This <code class="de acj ack acl acb b">RAGState</code> <code class="de acj ack acl acb b">TypedDict</code> is the complete<strong class="ov jg"> mind</strong> of our agent. Every node in our graph will receive this dictionary as input and return an updated version of it as output.</p><p id="7683" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">For example, the <code class="de acj ack acl acb b">plan_node</code> will populate the <code class="de acj ack acl acb b">plan</code> field, the <code class="de acj ack acl acb b">retrieval_node</code> will populate the <code class="de acj ack acl acb b">retrieved_docs</code> field, and so on. This shared, persistent state is what enables the complex, iterative reasoning that our simple RAG chain lacked.</p><p id="d20f" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">With the blueprint for our agent’s memory now defined, we are ready to build the first cognitive component of our system: the Planner Agent that will populate this state.</p><h2 id="3c26" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Strategic Planning and Query Formulation</h2><p id="2376" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">With our <code class="de acj ack acl acb b">RAGState</code> defined, we can now build the first and arguably most critical cognitive component of our agent: its ability to <strong class="ov jg">plan</strong>. This is where our system makes the leap from a simple data fetcher to a true reasoning engine. Instead of naively treating the user's complex query as a single search, our agent will first pause, think, and construct a detailed, step-by-step research strategy.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adk"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*gJK6ZcUlG_7iXANYtqgkOQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*gJK6ZcUlG_7iXANYtqgkOQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*gJK6ZcUlG_7iXANYtqgkOQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*gJK6ZcUlG_7iXANYtqgkOQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*gJK6ZcUlG_7iXANYtqgkOQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*gJK6ZcUlG_7iXANYtqgkOQ.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*gJK6ZcUlG_7iXANYtqgkOQ.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*gJK6ZcUlG_7iXANYtqgkOQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*gJK6ZcUlG_7iXANYtqgkOQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*gJK6ZcUlG_7iXANYtqgkOQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*gJK6ZcUlG_7iXANYtqgkOQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*gJK6ZcUlG_7iXANYtqgkOQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*gJK6ZcUlG_7iXANYtqgkOQ.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*gJK6ZcUlG_7iXANYtqgkOQ.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="453" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_gJK6ZcUlG_7iXANYtqgkOQ.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Strategic Planning (Created by <span class="hl"><span class="bn" aria-describedby="116" aria-labelledby="116" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="4838" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This section is broken down into three key engineering steps:</p><ul class=""><li id="d68b" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">The Tool-Aware Planner:</strong> We will build an LLM-powered agent whose sole job is to decompose the user’s query into a structured <code class="de acj ack acl acb b">Plan</code> object, deciding which tool to use for each step.</li><li id="808d" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">The Query Rewriter:</strong> We’ll create a specialized agent to transform the planner’s simple sub-questions into highly effective, optimized search queries.</li><li id="3af8" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Metadata-Aware Chunking:</strong> We will re-process our source document to add section-level metadata, a crucial step that unlocks high-precision, filtered retrieval.</li></ul><h3 id="95ca" class="adl zo jf bg zp gx adm ef gy gz adn eh ha hb ado hc hd he adp hf hg hh adq hi hj adr bl" data-selectable-paragraph="">Decomposing the Problem with Tool-Aware Planner</h3><p id="7551" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So, basically we want to build the <strong class="ov jg">brain of our operation</strong>. The first thing this brain needs to do when it gets a complex question is to figure out a game plan.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw ads"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*oleBy_sTAyIE_FGX3tgRIQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*oleBy_sTAyIE_FGX3tgRIQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*oleBy_sTAyIE_FGX3tgRIQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*oleBy_sTAyIE_FGX3tgRIQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*oleBy_sTAyIE_FGX3tgRIQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*oleBy_sTAyIE_FGX3tgRIQ.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*oleBy_sTAyIE_FGX3tgRIQ.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*oleBy_sTAyIE_FGX3tgRIQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*oleBy_sTAyIE_FGX3tgRIQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*oleBy_sTAyIE_FGX3tgRIQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*oleBy_sTAyIE_FGX3tgRIQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*oleBy_sTAyIE_FGX3tgRIQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*oleBy_sTAyIE_FGX3tgRIQ.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*oleBy_sTAyIE_FGX3tgRIQ.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="486" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_oleBy_sTAyIE_FGX3tgRIQ.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Decomposing Step (Created by <span class="hl"><span class="bn" aria-describedby="117" aria-labelledby="117" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><blockquote class="abl"><p id="ec45" class="abm abn jf bg abo abp acy acz ada adb adc pl eb" data-selectable-paragraph="">We can’t just throw the whole question at our database and hope for the best. We need to teach the agent how to break the problem down into smaller, manageable pieces.</p></blockquote><p id="ce1e" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">To do this, we will create a dedicated <strong class="ov jg">Planner Agent</strong>. We need to give it a very clear set of instructions, or a prompt, that tells it exactly what its job is.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="6a17" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><span class="hljs-keyword">from</span> rich.pretty <span class="hljs-keyword">import</span> pprint <span class="hljs-keyword">as</span> rprint<br><br><span class="hljs-comment"># The system prompt that instructs the LLM how to behave as a planner</span><br>planner_prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"""You are an expert research planner. Your task is to create a clear, multi-step plan to answer a complex user query by retrieving information from multiple sources.<br>You have two tools available:<br>1. `search_10k`: Use this to search for information within NVIDIA's 2023 10-K financial filing. This is best for historical facts, financial data, and stated company policies or risks from that specific time period.<br>2. `search_web`: Use this to search the public internet for recent news, competitor information, or any topic that is not specific to NVIDIA's 2023 10-K.<br>Decompose the user's query into a series of simple, sequential sub-questions. For each step, decide which tool is more appropriate.<br>For `search_10k` steps, also identify the most likely section of the 10-K (e.g., 'Item 1A. Risk Factors', 'Item 7. Management's Discussion and Analysis...').<br>It is critical to use the exact section titles found in a 10-K filing where possible."""</span>),<br>    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"User Query: {question}"</span>) <span class="hljs-comment"># The user's original, complex query</span><br>])</span></pre><p id="4867" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are basically giving the LLM a new persona: an <strong class="ov jg">expert research planner</strong>. We explicitly tell it about the two tools it has at its disposal (<code class="de acj ack acl acb b">search_10k</code> and <code class="de acj ack acl acb b">search_web</code>) and give it guidance on when to use each one. This is the "tool-aware" part.</p><p id="9896" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are not just asking it for a plan but asking it to create a plan that maps directly to the capabilities we have built.</p><p id="4697" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now we can initiate the reasoning model and chain it together with our prompt. A very important step here is to tell the LLM that its final output must be in the format of our Pydantic <code class="de acj ack acl acb b">Plan</code> class. This makes the output structured and predictable.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="7583" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Initialize our powerful reasoning model, as defined in the config</span><br>reasoning_llm = ChatOpenAI(model=config[<span class="hljs-string">"reasoning_llm"</span>], temperature=0)<br><br><span class="hljs-comment"># Create the planner agent by piping the prompt to the LLM and instructing it to use our structured 'Plan' output</span><br>planner_agent = planner_prompt | reasoning_llm.with_structured_output(Plan)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Tool-Aware Planner Agent created successfully."</span>)<br><br><span class="hljs-comment"># Let's test the planner agent with our complex query to see its output</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Testing Planner Agent ---"</span>)<br>test_plan = planner_agent.invoke({<span class="hljs-string">"question"</span>: complex_query_adv})<br><br>s<span class="hljs-comment"># Use rich's pretty print for a clean, readable display of the Pydantic object</span><br>rprint(test_plan)</span></pre><p id="1b19" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We take our <code class="de acj ack acl acb b">planner_prompt</code>, pipe it to our powerful <code class="de acj ack acl acb b">reasoning_llm</code>, and then use the <code class="de acj ack acl acb b">.with_structured_output(Plan)</code> method. This tells LangChain to use the model function-calling abilities to format its response as a JSON object that perfectly matches our <code class="de acj ack acl acb b">Plan</code> Pydantic schema. This is much more reliable than trying to parse a plain text response.</p><p id="001f" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Let’s look at the output when we test it with our challenge query.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="74d1" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>Tool-Aware Planner Agent created successfully.<br><br>--- Testing Planner Agent ---<br>Plan(<br>│   steps=[<br>│   │   Step(<br>│   │   │   sub_question=<span class="hljs-string">"What are the key risks related to competition as stated in NVIDIA's 2023 10-K filing?"</span>,<br>│   │   │   justification=<span class="hljs-string">"This step is necessary to extract the foundational information about competitive risks directly from the source document as requested by the user."</span>,<br>│   │   │   tool=<span class="hljs-string">'search_10k'</span>,<br>│   │   │   keywords=[<span class="hljs-string">'competition'</span>, <span class="hljs-string">'risk factors'</span>, <span class="hljs-string">'semiconductor industry'</span>, <span class="hljs-string">'competitors'</span>],<br>│   │   │   document_section=<span class="hljs-string">'Item 1A. Risk Factors'</span><br>│   │   ),<br>│   │   Step(<br>│   │   │   sub_question=<span class="hljs-string">"What are the recent news and developments in AMD's AI chip strategy in 2024?"</span>,<br>│   │   │   justification=<span class="hljs-string">"This step requires finding up-to-date, external information that is not available in the 2023 10-K filing. A web search is necessary to get the latest details on AMD's strategy."</span>,<br>│   │   │   tool=<span class="hljs-string">'search_web'</span>,<br>│   │   │   keywords=[<span class="hljs-string">'AMD'</span>, <span class="hljs-string">'AI chip strategy'</span>, <span class="hljs-string">'2024'</span>, <span class="hljs-string">'MI300X'</span>, <span class="hljs-string">'Instinct accelerator'</span>],<br>│   │   │   document_section=None<br>│   │   )<br>│   ]<br>)</span></pre><p id="6d23" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">If we look at the output you can see that the agent didn’t just give us a vague plan, it produced a structured <code class="de acj ack acl acb b">Plan</code> object. It correctly identified that the query has two parts.</p><ol class=""><li id="c351" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph="">For the first part, it knew the answer was in the 10-K and chose the <code class="de acj ack acl acb b">search_10k</code> tool, even correctly guessing the right document section.</li><li id="d809" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">For the second part, it knew "news from 2024" couldn't be in a 2023 document and correctly chose the <code class="de acj ack acl acb b">search_web</code> tool. This is the first sign our pipeline will give promising result at least in the thinking process.</li></ol><h3 id="4f3d" class="adl zo jf bg zp gx adm ef gy gz adn eh ha hb ado hc hd he adp hf hg hh adq hi hj adr bl" data-selectable-paragraph="">Optimizing Retrieval with a Query Rewriter Agent</h3><p id="d8c5" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So, basically we have a plan with good sub-questions.</p><blockquote class="abl"><p id="f65b" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">But a question like “What are the risks?” isn’t a great search query. It’s too generic. Search engines, whether they are vector databases or web search, work best with specific, keyword-rich queries.</p></blockquote></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="ade adf adg adh adi pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adt"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*RKpI8FMaodgwwxmV73YX6w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*RKpI8FMaodgwwxmV73YX6w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*RKpI8FMaodgwwxmV73YX6w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*RKpI8FMaodgwwxmV73YX6w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*RKpI8FMaodgwwxmV73YX6w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*RKpI8FMaodgwwxmV73YX6w.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*RKpI8FMaodgwwxmV73YX6w.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*RKpI8FMaodgwwxmV73YX6w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*RKpI8FMaodgwwxmV73YX6w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*RKpI8FMaodgwwxmV73YX6w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*RKpI8FMaodgwwxmV73YX6w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*RKpI8FMaodgwwxmV73YX6w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*RKpI8FMaodgwwxmV73YX6w.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*RKpI8FMaodgwwxmV73YX6w.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="422" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_RKpI8FMaodgwwxmV73YX6w.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Query Rewriting Agent (Creted by <span class="hl"><span class="bn" aria-describedby="118" aria-labelledby="118" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="77c9" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">To fix this, we will build another small, specialized agent: the <strong class="ov jg">Query Rewriter</strong>. Its only job is to take the sub-question for the current step and make it better for searching by adding relevant keywords and context from what we’ve already learned.</p><p id="883b" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First, let’s design the prompt for this new agent.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="6ae9" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser <span class="hljs-comment"># To parse the LLM's output as a simple string</span><br><br><span class="hljs-comment"># The prompt for our query rewriter, instructing it to act as a search expert</span><br>query_rewriter_prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"""You are a search query optimization expert. Your task is to rewrite a given sub-question into a highly effective search query for a vector database or web search engine, using keywords and context from the research plan.<br>The rewritten query should be specific, use terminology likely to be found in the target source (a financial 10-K or news articles), and be structured to retrieve the most relevant text snippets."""</span>),<br>    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"Current sub-question: {sub_question}\n\nRelevant keywords from plan: {keywords}\n\nContext from past steps:\n{past_context}"</span>)<br>])</span></pre><p id="c4aa" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are basically telling this agent to act like a <strong class="ov jg">search query optimization expert</strong>. We are giving it three pieces of information to work with: the simple <code class="de acj ack acl acb b">sub_question</code>, the <code class="de acj ack acl acb b">keywords</code> our planner already identified, and the <code class="de acj ack acl acb b">past_context</code> from any previous research steps. This gives it all the raw material it needs to construct a much better query.</p><p id="e6ee" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now we can initiate this agent. It’s a simple chain since we just need a string as output.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="b3a5" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Create the agent by piping the prompt to our reasoning LLM and a string output parser</span><br>query_rewriter_agent = query_rewriter_prompt | reasoning_llm | StrOutputParser()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Query Rewriter Agent created successfully."</span>)<br><br><span class="hljs-comment"># Let's test the rewriter agent. We'll pretend we've already completed the first two steps of our plan.</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Testing Query Rewriter Agent ---"</span>)<br><br><span class="hljs-comment"># Let's imagine we are at a final synthesis step that needs context from the first two.</span><br>test_sub_q = <span class="hljs-string">"How does AMD's 2024 AI chip strategy potentially exacerbate the competitive risks identified in NVIDIA's 10-K?"</span><br>test_keywords = [<span class="hljs-string">'impact'</span>, <span class="hljs-string">'threaten'</span>, <span class="hljs-string">'competitive pressure'</span>, <span class="hljs-string">'market share'</span>, <span class="hljs-string">'technological change'</span>]<br><br><span class="hljs-comment"># We create some mock "past context" to simulate what the agent would know at this point in a real run.</span><br>test_past_context = <span class="hljs-string">"Step 1 Summary: NVIDIA's 10-K lists intense competition and rapid technological change as key risks. Step 2 Summary: AMD launched its MI300X AI accelerator in 2024 to directly compete with NVIDIA's H100."</span><br><br><span class="hljs-comment"># Invoke the agent with our test data</span><br>rewritten_q = query_rewriter_agent.invoke({<br>    <span class="hljs-string">"sub_question"</span>: test_sub_q,<br>    <span class="hljs-string">"keywords"</span>: test_keywords,<br>    <span class="hljs-string">"past_context"</span>: test_past_context<br>})<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Original sub-question: <span class="hljs-subst">{test_sub_q}</span>"</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Rewritten Search Query: <span class="hljs-subst">{rewritten_q}</span>"</span>)</span></pre><p id="c7e9" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">To test this properly, we have to simulate a real scenario. We create a <code class="de acj ack acl acb b">test_past_context</code> string that represents the summaries the agent would have already generated from the first two steps of its plan. Then we feed this, along with the next sub-question, to our <code class="de acj ack acl acb b">query_rewriter_agent</code>.</p><p id="1e77" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Let’s look at the result.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="5983" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>Query Rewriter Agent created successfully.<br><br>--- Testing Query Rewriter Agent ---<br>Original sub-question: How does AMD 2024 AI chip strategy potentially exacerbate the competitive risks identified <span class="hljs-keyword">in</span> NVIDIA 10-K?<br>Rewritten Search Query: analysis of how AMD 2024 AI chip strategy, including products like the MI300X, exacerbates NVIDIA<span class="hljs-string">'s stated competitive risks such as rapid technological change and market share erosion in the data center and AI semiconductor industry</span></span></pre><p id="771d" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The original question is for an analyst, he rewritten query is for a search engine. It has been assigned with specific terms like <strong class="ov jg">“MI300X”</strong>, <strong class="ov jg">“market share erosion”</strong> and <strong class="ov jg">“data center”</strong> all of which were synthesized from the keywords and past context.</p><p id="ca28" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">A query like this is far more likely to retrieve exactly the right documents, making our entire system more accurate and efficient. This rewriting step will be a crucial part of our main agentic loop.</p><h3 id="2eea" class="adl zo jf bg zp gx adm ef gy gz adn eh ha hb ado hc hd he adp hf hg hh adq hi hj adr bl" data-selectable-paragraph="">Precision with Metadata-Aware Chunking</h3><p id="b9c1" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So, basically, our Planner Agent is giving us a good opportunity. It’s not just saying <strong class="ov jg">find risks</strong>, it’s giving us a hint: <strong class="ov jg">look for risks in the Item 1A. Risk Factors section</strong>.</p><blockquote class="abl"><p id="02cb" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">But right now, our retriever can’t use that hint. Our vector store is just a big, flat list of 378 text chunks. It has no idea what a “section” is.</p></blockquote></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="ade adf adg adh adi pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adu"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*UUqkwv3zOVjt6QBODlQ49w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*UUqkwv3zOVjt6QBODlQ49w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*UUqkwv3zOVjt6QBODlQ49w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*UUqkwv3zOVjt6QBODlQ49w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*UUqkwv3zOVjt6QBODlQ49w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*UUqkwv3zOVjt6QBODlQ49w.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*UUqkwv3zOVjt6QBODlQ49w.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*UUqkwv3zOVjt6QBODlQ49w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*UUqkwv3zOVjt6QBODlQ49w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*UUqkwv3zOVjt6QBODlQ49w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*UUqkwv3zOVjt6QBODlQ49w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*UUqkwv3zOVjt6QBODlQ49w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*UUqkwv3zOVjt6QBODlQ49w.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*UUqkwv3zOVjt6QBODlQ49w.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="372" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_UUqkwv3zOVjt6QBODlQ49w.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Meta aware chunking (Created by <span class="hl"><span class="bn" aria-describedby="119" aria-labelledby="119" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="0adc" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We need to fix this. We are going to rebuild our document chunks from scratch. This time, for every single chunk we create, we are going to add a <strong class="ov jg">label</strong> or a <strong class="ov jg">tag</strong> its <strong class="ov jg">metadata</strong> that tells our system exactly which section of the 10-K it came from. This will allow our agent to perform highly precise, filtered searches later on.</p><p id="f2a1" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First things first, we need a way to programmatically find where each section begins in our raw text file. If we look at the document, we can see a clear pattern: every major section starts with the word <strong class="ov jg">“ITEM”</strong> followed by a number, like <strong class="ov jg">“ITEM 1A”</strong> or <strong class="ov jg">“ITEM 7”</strong>. This is a perfect job for a regular expression.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="a134" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># This regex is designed to find section titles like 'ITEM 1A.' or 'ITEM 7.' in the 10-K text.</span><br><span class="hljs-comment"># It looks for the word 'ITEM', followed by a space, a number, an optional letter, a period, and then captures the title text.</span><br><span class="hljs-comment"># The `re.IGNORECASE | re.DOTALL` flags make the search case-insensitive and allow '.' to match newlines.</span><br>section_pattern = <span class="hljs-string">r"(ITEM\\s+\\d[A-Z]?\\.\\s*.*?)(?=\\nITEM\\s+\\d[A-Z]?\\.|$)"</span></span></pre><p id="17f8" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are basically creating a pattern that will act as our <strong class="ov jg">section detector</strong>. It should be designed so that it can be flexible enough to catch different formats while being specific enough not to grab the wrong text.</p><p id="5f91" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now we can use this pattern to slice our document into two separate lists: one containing just the section titles, and another containing the content within each section.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="25cf" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># We'll work with the raw text loaded earlier from our Document object</span><br>raw_text = documents[<span class="hljs-number">0</span>].page_content<br><br><span class="hljs-comment"># Use re.findall to apply our pattern and extract all section titles into a list</span><br>section_titles = re.findall(section_pattern, raw_text, re.IGNORECASE | re.DOTALL)<br><br><span class="hljs-comment"># A quick cleanup step to remove any extra whitespace or newlines from the titles</span><br>section_titles = [title.strip().replace(<span class="hljs-string">'\\n'</span>, <span class="hljs-string">' '</span>) <span class="hljs-keyword">for</span> title <span class="hljs-keyword">in</span> section_titles]<br><br><span class="hljs-comment"># Now, use re.split to break the document apart at each point where a section title occurs</span><br>sections_content = re.split(section_pattern, raw_text, flags=re.IGNORECASE | re.DOTALL)<br><br><span class="hljs-comment"># The split results in a list with titles and content mixed, so we filter it to get only the content parts</span><br>sections_content = [content.strip() <span class="hljs-keyword">for</span> content <span class="hljs-keyword">in</span> sections_content <span class="hljs-keyword">if</span> content.strip() <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> content.strip().lower().startswith(<span class="hljs-string">'item '</span>)]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Identified <span class="hljs-subst">{<span class="hljs-built_in">len</span>(section_titles)}</span> document sections."</span>)<br><br><span class="hljs-comment"># This is a crucial sanity check: if the number of titles doesn't match the number of content blocks, something went wrong.</span><br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(section_titles) == <span class="hljs-built_in">len</span>(sections_content), <span class="hljs-string">"Mismatch between titles and content sections"</span></span></pre><p id="a15d" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is a very effective way to parse a semi-structured document. We have used our regex pattern twice: once to get a clean list of all the section titles, and again to split the main text into a list of content blocks. The <code class="de acj ack acl acb b">assert</code> statement gives us confidence that our parsing logic is sound.</p><p id="6bd7" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Okay, now we have the pieces: a list of titles and a corresponding list of contents. We can now loop through them and create our final, metadata-rich chunks.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="cc05" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">import</span> uuid <span class="hljs-comment"># We'll use this to give each chunk a unique ID, which is good practice</span><br><br><span class="hljs-comment"># This list will hold our new, metadata-rich document chunks</span><br>doc_chunks_with_metadata = []<br><br><span class="hljs-comment"># Loop through each section's content along with its title using enumerate</span><br><span class="hljs-keyword">for</span> i, content <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(sections_content):<br>    <span class="hljs-comment"># Get the corresponding title for the current content block</span><br>    section_title = section_titles[i]<br>    <span class="hljs-comment"># Use the same text splitter as before, but this time, we run it ONLY on the content of the current section</span><br>    section_chunks = text_splitter.split_text(content)<br>    <br>    <span class="hljs-comment"># Now, loop through the smaller chunks created from this one section</span><br>    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> section_chunks:<br>        <span class="hljs-comment"># Generate a unique ID for this specific chunk</span><br>        chunk_id = <span class="hljs-built_in">str</span>(uuid.uuid4())<br>        <span class="hljs-comment"># Create a new LangChain Document object for the chunk</span><br>        doc_chunks_with_metadata.append(<br>            Document(<br>                page_content=chunk,<br>                <span class="hljs-comment"># This is the most important part: we attach the metadata</span><br>                metadata={<br>                    <span class="hljs-string">"section"</span>: section_title,      <span class="hljs-comment"># The section this chunk belongs to</span><br>                    <span class="hljs-string">"source_doc"</span>: doc_path_clean,  <span class="hljs-comment"># Where the document came from</span><br>                    <span class="hljs-string">"id"</span>: chunk_id                 <span class="hljs-comment"># The unique ID for this chunk</span><br>                }<br>            )<br>        )<br><br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Created <span class="hljs-subst">{<span class="hljs-built_in">len</span>(doc_chunks_with_metadata)}</span> chunks with section metadata."</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Sample Chunk with Metadata ---"</span>)<br><br><span class="hljs-comment"># To prove it worked, let's find a chunk that we know should be in the 'Risk Factors' section and print it</span><br>sample_chunk = <span class="hljs-built_in">next</span>(c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> doc_chunks_with_metadata <span class="hljs-keyword">if</span> <span class="hljs-string">"Risk Factors"</span> <span class="hljs-keyword">in</span> c.metadata.get(<span class="hljs-string">"section"</span>, <span class="hljs-string">""</span>))<br><span class="hljs-built_in">print</span>(sample_chunk)</span></pre><p id="2bac" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is the core of our upgrade. We iterate through each section one by one. For each section, we create our text chunks. But before we add them to our final list, we create a <code class="de acj ack acl acb b">metadata</code> dictionary and attach the <code class="de acj ack acl acb b">section_title</code>. This effectively <strong class="ov jg">tags</strong> every single chunk with its origin.</p><p id="21ad" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Let’s look at the output and see the difference.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="57e4" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>Processing document and adding metadata...<br>Identified 22 document sections.<br>Created 381 chunks with section metadata.<br><br><br>--- Sample Chunk with Metadata ---<br>Document(<br>│   page_content=<span class="hljs-string">'Our industry is intensely competitive. We operate in the semiconductor\\nindustry, which is intensely competitive and characterized by rapid\\ntechnological change and evolving industry standards. We compete with a number of\\ncompanies that have different business models and different combinations of\\nhardware, software, and systems expertise, many of which have substantially\\ngreater resources than we have. We expect competition to increase from existing\\ncompetitors, as well as new and emerging companies. Our competitors include\\nIntel, AMD, and Qualcomm; cloud service providers, or CSPs, such as Amazon Web\\nServices, or AWS, Google Cloud, and Microsoft Azure; and various companies\\ndeveloping or that may develop processors or systems for the AI, HPC, data\\ncenter, gaming, professional visualization, and automotive markets. Some of our\\ncustomers are also our competitors. Our business could be materially and\\nadversely affected if our competitors announce or introduce new products, services,\\nor technologies that have better performance or features, are less expensive, or\\nthat gain market acceptance.'</span>,<br>│   metadata={<br>│   │   <span class="hljs-string">'section'</span>: <span class="hljs-string">'Item 1A. Risk Factors.'</span>,<br>│   │   <span class="hljs-string">'source_doc'</span>: <span class="hljs-string">'./data/nvda_10k_2023_clean.txt'</span>,<br>│   │   <span class="hljs-string">'id'</span>: <span class="hljs-string">'...'</span><br>│   }<br>)</span></pre><p id="2eaf" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Look at that <code class="de acj ack acl acb b">metadata</code> block. The same chunk of text we had before now has a piece of context attached: <code class="de acj ack acl acb b">'section': 'Item 1A. Risk Factors.'</code>.</p><p id="da61" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now, when our agent needs to find risks, it can tell the retriever, <strong class="ov jg">“Hey, don’t search all 381 chunks. Just search the ones where the section metadata is ‘Item 1A. Risk Factors”</strong>.</p><p id="21ba" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This simple change transforms our retriever from a blunt instrument into a surgical tool, and it is a key principle for building truly production-grade RAG systems.</p><h2 id="0a1e" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Creating The Multi-Stage Retrieval Funnel</h2><p id="97af" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So far, we have engineered a smart planner and enriched our documents with metadata. We are now ready to build the heart of our system: a sophisticated retrieval pipeline.</p><blockquote class="abl"><p id="f844" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">A simple, one-shot semantic search is no longer good enough. For a production-grade agent, we need a retrieval process that is both <strong class="an">adaptive</strong> and <strong class="an">multi-stage</strong>.</p></blockquote><p id="0c2e" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">We will design our retrieval process as a funnel, where each stage refines the results of the previous one:</p><figure class="pn po pp pq pr pm pv pw paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adk"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*LhtpdnklBhuMjKvgQqT3fA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*LhtpdnklBhuMjKvgQqT3fA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*LhtpdnklBhuMjKvgQqT3fA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*LhtpdnklBhuMjKvgQqT3fA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*LhtpdnklBhuMjKvgQqT3fA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*LhtpdnklBhuMjKvgQqT3fA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LhtpdnklBhuMjKvgQqT3fA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*LhtpdnklBhuMjKvgQqT3fA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*LhtpdnklBhuMjKvgQqT3fA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*LhtpdnklBhuMjKvgQqT3fA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*LhtpdnklBhuMjKvgQqT3fA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*LhtpdnklBhuMjKvgQqT3fA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*LhtpdnklBhuMjKvgQqT3fA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*LhtpdnklBhuMjKvgQqT3fA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi gl ps c" width="700" height="503" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_LhtpdnklBhuMjKvgQqT3fA.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Multi Stage Funnel (Created by <span class="hl"><span class="bn" aria-describedby="120" aria-labelledby="120" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure><ul class=""><li id="52d5" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">The Retrieval Supervisor:</strong> We will build a new <strong class="ov jg">supervisor agent </strong>that acts as a dynamic router, analyzing each sub-question and choosing the best search strategy (vector, keyword, or hybrid).</li><li id="3f64" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Stage 1 (Broad Recall):</strong> We will implement the different retrieval strategies that our supervisor can choose from, focusing on casting a wide net to capture all potentially relevant documents.</li><li id="e047" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Stage 2 (High Precision):</strong> We will use a Cross-Encoder model to re-rank the initial results, discarding noise and promoting the most relevant documents to the top.</li><li id="75f2" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Stage 3 (Synthesis):</strong> Finally, we will create a <strong class="ov jg">Distiller Agent </strong>to compress the top-ranked documents into a single, concise paragraph of context for our downstream agents.</li></ul><h3 id="221d" class="adl zo jf bg zp gx adm ef gy gz adn eh ha hb ado hc hd he adp hf hg hh adq hi hj adr bl" data-selectable-paragraph="">Dynamically Choosing a Strategy Using Supervisor</h3><p id="63f1" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So, basically, not all search queries are the same. A question like “What was the revenue for the ‘Compute &amp; Networking’ segment?” contains specific, exact terms. A keyword-based search would be perfect for that.</p><p id="8a19" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">But a question like …</p><blockquote class="abl"><p id="d75f" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">What is the company sentiment on market competition? is conceptual. A semantic, vector-based search would be much better.</p></blockquote></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="ade adf adg adh adi pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adv"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*35nRV07-89IqruNpi3T-qw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*35nRV07-89IqruNpi3T-qw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*35nRV07-89IqruNpi3T-qw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*35nRV07-89IqruNpi3T-qw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*35nRV07-89IqruNpi3T-qw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*35nRV07-89IqruNpi3T-qw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*35nRV07-89IqruNpi3T-qw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*35nRV07-89IqruNpi3T-qw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*35nRV07-89IqruNpi3T-qw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*35nRV07-89IqruNpi3T-qw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*35nRV07-89IqruNpi3T-qw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*35nRV07-89IqruNpi3T-qw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*35nRV07-89IqruNpi3T-qw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*35nRV07-89IqruNpi3T-qw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="506" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_35nRV07-89IqruNpi3T-qw.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Supervisor Agent (Created by <span class="hl"><span class="bn" aria-describedby="121" aria-labelledby="121" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="73e9" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Instead of hardcoding one strategy, we are going to build a small, intelligent agent, <strong class="ov jg">Retrieval Supervisor </strong>to make this decision for us. Its only job is to look at the search query and decide which of our retrieval methods is the most appropriate.</p><p id="7339" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First, we need to define the possible decisions our supervisor can make. We’ll use a Pydantic <code class="de acj ack acl acb b">BaseModel</code> to structure its output.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="befd" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">class</span> <span class="hljs-title.class">RetrievalDecision</span>(<span class="hljs-title.class.inherited">BaseModel</span>):<br>    <span class="hljs-comment"># The chosen retrieval strategy. Must be one of these three options.</span><br>    strategy: <span class="hljs-type">Literal</span>[<span class="hljs-string">"vector_search"</span>, <span class="hljs-string">"keyword_search"</span>, <span class="hljs-string">"hybrid_search"</span>]<br>    <span class="hljs-comment"># The agent's justification for its choice.</span><br>    justification: <span class="hljs-built_in">str</span></span></pre><p id="659e" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The supervisor must choose one of these three strategies and explain its reasoning. This makes its decision-making process transparent and reliable.</p><p id="a9d9" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now, let’s create the prompt that will guide this agent’s behavior.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="1855" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph="">retrieval_supervisor_prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"""You are a retrieval strategy expert. Based on the user's query, you must decide the best retrieval strategy.<br>You have three options:<br>1. `vector_search`: Best for conceptual, semantic, or similarity-based queries.<br>2. `keyword_search`: Best for queries with specific, exact terms, names, or codes (e.g., 'Item 1A', 'Hopper architecture').<br>3. `hybrid_search`: A good default that combines both, but may be less precise than a targeted strategy."""</span>),<br>    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"User Query: {sub_question}"</span>) <span class="hljs-comment"># The rewritten search query will be passed here.</span><br>])</span></pre><p id="d8bf" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We have created a very direct prompt here which is telling the LLM its role is a <strong class="ov jg">retrieval strategy expert</strong> and clearly explaining when each of its available strategies is most effective.</p><p id="3517" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Finally, we can assemble our supervisor agent.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="4895" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Create the agent by piping our prompt to the reasoning LLM and structuring its output with our Pydantic class</span><br>retrieval_supervisor_agent = retrieval_supervisor_prompt | reasoning_llm.with_structured_output(RetrievalDecision)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Retrieval Supervisor Agent created."</span>)<br><br><span class="hljs-comment"># Let's test it with two different types of queries to see how it behaves</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Testing Retrieval Supervisor Agent ---"</span>)<br>query1 = <span class="hljs-string">"revenue growth for the Compute &amp; Networking segment in fiscal year 2023"</span><br>decision1 = retrieval_supervisor_agent.invoke({<span class="hljs-string">"sub_question"</span>: query1})<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Query: '<span class="hljs-subst">{query1}</span>'"</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Decision: <span class="hljs-subst">{decision1.strategy}</span>, Justification: <span class="hljs-subst">{decision1.justification}</span>"</span>)<br><br>query2 = <span class="hljs-string">"general sentiment about market competition and technological innovation"</span><br>decision2 = retrieval_supervisor_agent.invoke({<span class="hljs-string">"sub_question"</span>: query2})<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nQuery: '<span class="hljs-subst">{query2}</span>'"</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Decision: <span class="hljs-subst">{decision2.strategy}</span>, Justification: <span class="hljs-subst">{decision2.justification}</span>"</span>)</span></pre><p id="7ae3" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Here we are wiring it all together.</p><p id="84d9" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Our <code class="de acj ack acl acb b">.with_structured_output(RetrievalDecision)</code> is again doing the heavy lifting, ensuring we get a clean, predictable <code class="de acj ack acl acb b">RetrievalDecision</code> object back from the LLM. Let’s look at the test results.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="6961" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>Retrieval Supervisor Agent created.<br><br><br><span class="hljs-comment"># --- Testing Retrieval Supervisor Agent ---</span><br>Query: <span class="hljs-string">'revenue growth for the Compute &amp; Networking segment in fiscal year 2023'</span><br>Decision: keyword_search, Justification: The query contains specific keywords like <span class="hljs-string">'revenue growth'</span>, <span class="hljs-string">'Compute &amp; Networking'</span>, and <span class="hljs-string">'fiscal year 2023'</span> <span class="hljs-built_in">which</span> are ideal <span class="hljs-keyword">for</span> a keyword-based search to find exact financial figures.<br><br>Query: <span class="hljs-string">'general sentiment about market competition and technological innovation'</span><br>Decision: vector_search, Justification: This query is conceptual and seeks to understand sentiment and broader themes. Vector search is better suited to capture the semantic meaning of <span class="hljs-string">'market competition'</span> and <span class="hljs-string">'technological innovation'</span> rather than relying on exact keywords.</span></pre><p id="b845" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We can see that it correctly identified that the first query is full of specific terms and chose <code class="de acj ack acl acb b">keyword_search</code>.</p><p id="f116" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">For the second query, which is conceptual and abstract, it correctly chose <code class="de acj ack acl acb b">vector_search</code>. This dynamic decision-making at the start of our retrieval funnel is a good upgrade over a one-size-fits-all approach.</p><h3 id="a4ac" class="adl zo jf bg zp gx adm ef gy gz adn eh ha hb ado hc hd he adp hf hg hh adq hi hj adr bl" data-selectable-paragraph="">Broad Recall with Hybrid, Keyword and Semantic Search</h3><p id="c29d" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">Now that we have a supervisor to choose our strategy, we need to build the retrieval strategies themselves. This first stage of our funnel is all about <strong class="ov jg">Recall</strong> our goal is to cast a wide net and capture every document that could possibly be relevant, even if we pick up some noise along the way.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adw"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*N_msI36fuK4CkTokmOFaXg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*N_msI36fuK4CkTokmOFaXg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*N_msI36fuK4CkTokmOFaXg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*N_msI36fuK4CkTokmOFaXg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*N_msI36fuK4CkTokmOFaXg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*N_msI36fuK4CkTokmOFaXg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*N_msI36fuK4CkTokmOFaXg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*N_msI36fuK4CkTokmOFaXg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*N_msI36fuK4CkTokmOFaXg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*N_msI36fuK4CkTokmOFaXg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*N_msI36fuK4CkTokmOFaXg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*N_msI36fuK4CkTokmOFaXg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*N_msI36fuK4CkTokmOFaXg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*N_msI36fuK4CkTokmOFaXg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="349" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_N_msI36fuK4CkTokmOFaXg.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Broad Recall (Created by <span class="hl"><span class="bn" aria-describedby="122" aria-labelledby="122" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="7013" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">To do this, we will implement three distinct search functions that our supervisor can call:</p><ol class=""><li id="f767" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Vector Search:</strong> Our standard semantic search, but now upgraded to use metadata filters.</li><li id="4afc" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Keyword Search (BM25):</strong> A classic, powerful algorithm that excels at finding documents with specific, exact terms.</li><li id="d9c6" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Hybrid Search:</strong> A <strong class="ov jg">best of both</strong> the approaches is to combines the results of vector and keyword search using a technique called Reciprocal Rank Fusion (RRF).</li></ol><p id="bbab" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First, we need to create a new, advanced vector store using the metadata-enriched chunks we created in the previous section.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="eb4b" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <span class="hljs-comment"># A fundamental library for numerical operations in Python</span><br><span class="hljs-keyword">from</span> rank_bm25 <span class="hljs-keyword">import</span> BM25Okapi <span class="hljs-comment"># The library for implementing the BM25 keyword search algorithm</span><br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Creating advanced vector store with metadata..."</span>)<br><br><span class="hljs-comment"># We create a new Chroma vector store, this time using our metadata-rich chunks</span><br>advanced_vector_store = Chroma.from_documents(<br>    documents=doc_chunks_with_metadata,<br>    embedding=embedding_function<br>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Advanced vector store created with <span class="hljs-subst">{advanced_vector_store._collection.count()}</span> embeddings."</span>)</span></pre><p id="b5d0" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is a simple but critical step. This <code class="de acj ack acl acb b">advanced_vector_store</code> now contains the same text as our baseline, but each embedded chunk is tagged with its section title, unlocking our ability to perform filtered searches.</p><p id="abbf" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Next, we need to prepare for our keyword search. The BM25 algorithm works by analyzing the frequency of words in documents. To enable this, we need to pre-process our corpus by splitting each document’s content into a list of words (tokens).</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="3a82" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-built_in">print</span>(<span class="hljs-string">"\nBuilding BM25 index for keyword search..."</span>)<br><br><span class="hljs-comment"># Create a list where each element is a list of words from a document</span><br>tokenized_corpus = [doc.page_content.split(<span class="hljs-string">" "</span>) <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> doc_chunks_with_metadata]<br><br><span class="hljs-comment"># Create a list of all unique document IDs</span><br>doc_ids = [doc.metadata[<span class="hljs-string">"id"</span>] <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> doc_chunks_with_metadata]<br><br><span class="hljs-comment"># Create a mapping from a document's ID back to the full Document object for easy lookup</span><br>doc_map = {doc.metadata[<span class="hljs-string">"id"</span>]: doc <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> doc_chunks_with_metadata}<br><br><span class="hljs-comment"># Initialize the BM25Okapi index with our tokenized corpus</span><br>bm25 = BM25Okapi(tokenized_corpus)</span></pre><p id="000b" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are basically creating the necessary data structures for our BM25 index. The <code class="de acj ack acl acb b">tokenized_corpus</code> is what the algorithm will search over, and the <code class="de acj ack acl acb b">doc_map</code> will allow us to quickly retrieve the full <code class="de acj ack acl acb b">Document</code> object after the search is complete.</p><p id="abed" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now we can define our three retrieval functions.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="d930" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Strategy 1: Pure Vector Search with Metadata Filtering</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">vector_search_only</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span>, section_filter: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span>, k: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):<br>    <span class="hljs-comment"># This dictionary defines the metadata filter. ChromaDB will only search documents that match this.</span><br>    filter_dict = {<span class="hljs-string">"section"</span>: section_filter} <span class="hljs-keyword">if</span> section_filter <span class="hljs-keyword">and</span> <span class="hljs-string">"Unknown"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> section_filter <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span><br>    <span class="hljs-comment"># Perform the similarity search with the optional filter</span><br>    <span class="hljs-keyword">return</span> advanced_vector_store.similarity_search(query, k=k, <span class="hljs-built_in">filter</span>=filter_dict)<br><br><br><span class="hljs-comment"># Strategy 2: Pure Keyword Search (BM25)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">bm25_search_only</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span>, k: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):<br>    <span class="hljs-comment"># Tokenize the incoming query</span><br>    tokenized_query = query.split(<span class="hljs-string">" "</span>)<br>    <span class="hljs-comment"># Get the BM25 scores for the query against all documents in the corpus</span><br>    bm25_scores = bm25.get_scores(tokenized_query)<br>    <span class="hljs-comment"># Get the indices of the top k documents</span><br>    top_k_indices = np.argsort(bm25_scores)[::-<span class="hljs-number">1</span>][:k]<br>    <span class="hljs-comment"># Use our doc_map to return the full Document objects for the top results</span><br>    <span class="hljs-keyword">return</span> [doc_map[doc_ids[i]] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_k_indices]<br><br><span class="hljs-comment"># Strategy 3: Hybrid Search with Reciprocal Rank Fusion (RRF)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">hybrid_search</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span>, section_filter: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span>, k: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):<br>    <span class="hljs-comment"># 1. Perform a keyword search</span><br>    bm25_docs = bm25_search_only(query, k=k)<br>    <span class="hljs-comment"># 2. Perform a semantic search with the metadata filter</span><br>    semantic_docs = vector_search_only(query, section_filter=section_filter, k=k)<br>    <span class="hljs-comment"># 3. Combine and re-rank the results using Reciprocal Rank Fusion (RRF)</span><br>    <span class="hljs-comment"># Get a unique set of all documents found by either search method</span><br>    all_docs = {doc.metadata[<span class="hljs-string">"id"</span>]: doc <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> bm25_docs + semantic_docs}.values()<br>    <span class="hljs-comment"># Create lists of just the document IDs from each search result</span><br>    ranked_lists = [[doc.metadata[<span class="hljs-string">"id"</span>] <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> bm25_docs], [doc.metadata[<span class="hljs-string">"id"</span>] <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> semantic_docs]]<br>    <br>    <span class="hljs-comment"># Initialize a dictionary to store the RRF scores for each document</span><br>    rrf_scores = {}<br>    <span class="hljs-comment"># Loop through each ranked list (BM25 and Semantic)</span><br>    <span class="hljs-keyword">for</span> doc_list <span class="hljs-keyword">in</span> ranked_lists:<br>        <span class="hljs-comment"># Loop through each document ID in the list with its rank (i)</span><br>        <span class="hljs-keyword">for</span> i, doc_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(doc_list):<br>            <span class="hljs-keyword">if</span> doc_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> rrf_scores:<br>                rrf_scores[doc_id] = <span class="hljs-number">0</span><br>            <span class="hljs-comment"># The RRF formula: add 1 / (rank + k) to the score. We use k=61 as a standard default.</span><br>            rrf_scores[doc_id] += <span class="hljs-number">1</span> / (i + <span class="hljs-number">61</span>) <br>    <span class="hljs-comment"># Sort the document IDs based on their final RRF scores in descending order</span><br>    sorted_doc_ids = <span class="hljs-built_in">sorted</span>(rrf_scores.keys(), key=<span class="hljs-keyword">lambda</span> x: rrf_scores[x], reverse=<span class="hljs-literal">True</span>)<br>    <span class="hljs-comment"># Return the top k Document objects based on the fused ranking</span><br>    final_docs = [doc_map[doc_id] <span class="hljs-keyword">for</span> doc_id <span class="hljs-keyword">in</span> sorted_doc_ids[:k]]<br>    <span class="hljs-keyword">return</span> final_docs<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\nAll retrieval strategy functions ready."</span>)</span></pre><p id="63d8" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We have now implemented the core of our adaptive retrieval system.</p><ul class=""><li id="f37a" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph="">The <code class="de acj ack acl acb b">vector_search_only</code> function is our upgraded semantic search. The key addition is the <code class="de acj ack acl acb b">filter=filter_dict</code> argument, which allows us to pass the <code class="de acj ack acl acb b">document_section</code> from our planner's <code class="de acj ack acl acb b">Step</code> and force the search to only consider chunks with that metadata.</li><li id="94e4" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">The <code class="de acj ack acl acb b">bm25_search_only</code> function is our pure keyword retriever. It's incredibly fast and effective for finding specific terms that semantic search might miss.</li><li id="2751" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">The <code class="de acj ack acl acb b">hybrid_search</code> function runs both searches in parallel and then intelligently merges the results using RRF. RRF is a simple but powerful algorithm that ranks documents based on their position in each list, effectively giving more weight to documents that appear high up in <em class="adj">both</em> search results.</li></ul><p id="6cd8" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Let’s do a quick test to see our keyword search in action. We’ll search for the exact section title our planner identified.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="fde7" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Test Keyword Search to see if it can precisely find a specific section</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Testing Keyword Search ---"</span>)<br>test_query = <span class="hljs-string">"Item 1A. Risk Factors"</span><br>test_results = bm25_search_only(test_query)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Query: <span class="hljs-subst">{test_query}</span>"</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Found <span class="hljs-subst">{<span class="hljs-built_in">len</span>(test_results)}</span> documents. Top result section: <span class="hljs-subst">{test_results[<span class="hljs-number">0</span>].metadata[<span class="hljs-string">'section'</span>]}</span>"</span>)</span></pre><pre class="ia aca acb acc bq acd bc bl"><span id="4807" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>Creating advanced vector store with metadata...<br>Advanced vector store created with 381 embeddings.<br><br>Building BM25 index <span class="hljs-keyword">for</span> keyword search...<br>All retrieval strategy <span class="hljs-built_in">functions</span> ready.<br><br><span class="hljs-comment"># --- Testing Keyword Search ---</span><br>Query: Item 1A. Risk Factors<br>Found 10 documents. Top result section: Item 1A. Risk Factors.</span></pre><p id="4208" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The output is exactly what we wanted. The BM25 search, being keyword-focused, was able to perfectly and instantly retrieve the documents from the <strong class="ov jg">Item 1A. Risk Factors</strong> section, just by searching for the title.</p><blockquote class="abl"><p id="cefa" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">Our supervisor can now choose this precise tool when the query contains specific keywords like a section title.</p></blockquote><p id="ce2b" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">With our broad recall stage now built, we have a powerful mechanism for finding all potentially relevant documents. However, this wide net can also bring in irrelevant noise. The next stage of our funnel will focus on filtering this down with high precision.</p><h3 id="437f" class="adl zo jf bg zp gx adm ef gy gz adn eh ha hb ado hc hd he adp hf hg hh adq hi hj adr bl" data-selectable-paragraph="">High Precision Using a Cross-Encoder Reranker</h3><p id="9977" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So, our Stage 1 retrieval is doing a great job at <strong class="ov jg">Recall</strong>. It’s pulling in 10 documents that are potentially relevant to our sub-question.</p><blockquote class="abl"><p id="ae11" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">But that’s the problem they are only <em class="acw">potentially</em> relevant. Feeding all 10 of these chunks directly to our main reasoning LLM is inefficient and risky.</p></blockquote><p id="d6f5" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph=""><strong class="ov jg">It increases token costs and, more importantly, it can confuse the model with noisy, semi-relevant information</strong>.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adx"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*QEAos8S94VeaCuDvOX3aPw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*QEAos8S94VeaCuDvOX3aPw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*QEAos8S94VeaCuDvOX3aPw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*QEAos8S94VeaCuDvOX3aPw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*QEAos8S94VeaCuDvOX3aPw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*QEAos8S94VeaCuDvOX3aPw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*QEAos8S94VeaCuDvOX3aPw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*QEAos8S94VeaCuDvOX3aPw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*QEAos8S94VeaCuDvOX3aPw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*QEAos8S94VeaCuDvOX3aPw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*QEAos8S94VeaCuDvOX3aPw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*QEAos8S94VeaCuDvOX3aPw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*QEAos8S94VeaCuDvOX3aPw.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*QEAos8S94VeaCuDvOX3aPw.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="725" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_QEAos8S94VeaCuDvOX3aPw.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">High Precision (Created by <span class="hl"><span class="bn" aria-describedby="123" aria-labelledby="123" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="77a4" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">What we need now is a <strong class="ov jg">Precision stage</strong>. We need a way to inspect those 10 candidate documents and pick out the absolute best ones. This is where a <strong class="ov jg">Reranker</strong> comes in.</p><p id="f680" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The key difference is how these models work.</p><ol class=""><li id="a512" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph="">Our initial retrieval uses a <strong class="ov jg">bi-encoder</strong> (the embedding model), which creates a vector for the query and documents independently. It’s fast and great for searching over millions of items.</li><li id="b3e2" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">A <strong class="ov jg">cross-encoder</strong>, on the other hand, takes the query and a single document together as a pair and performs a much deeper, more nuanced comparison. It’s slower, but far more accurate.</li></ol><p id="5e38" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">So, basically, we want to build a function that takes our 10 retrieved documents and uses a cross-encoder model to give each one a precise relevance score. Then, we will keep only the top 3, as defined in our <code class="de acj ack acl acb b">config</code>.</p><p id="38df" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First, let’s initialize our cross-encoder model. We’ll use a small but highly effective model from the <code class="de acj ack acl acb b">sentence-transformers</code> library, as specified in our configuration.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="e958" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> CrossEncoder <span class="hljs-comment"># The library for using cross-encoder models</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Initializing CrossEncoder reranker..."</span>)<br><br><span class="hljs-comment"># Initialize the CrossEncoder model using the name from our central config dictionary.</span><br><span class="hljs-comment"># The library will automatically download the model from the Hugging Face Hub if it's not cached.</span><br>reranker = CrossEncoder(config[<span class="hljs-string">"reranker_model"</span>])</span></pre><p id="5327" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are basically loading the pre-trained reranking model into memory. This only needs to be done once. The model we have chosen, <code class="de acj ack acl acb b">ms-marco-MiniLM-L-6-v2</code>, is very popular for this task because it offers a great balance of speed and accuracy.</p><p id="0df4" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now we can create the function that will perform the reranking.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="b9fd" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">def</span> <span class="hljs-title.function">rerank_documents_function</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span>, documents: <span class="hljs-type">List</span>[Document]</span>) -&gt; <span class="hljs-type">List</span>[Document]:<br>    <span class="hljs-comment"># If we have no documents to rerank, return an empty list immediately.</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> documents: <br>        <span class="hljs-keyword">return</span> []<br>        <br>    <span class="hljs-comment"># Create the pairs of [query, document_content] that the cross-encoder needs.</span><br>    pairs = [(query, doc.page_content) <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents]<br>    <br>    <span class="hljs-comment"># Use the reranker to predict a relevance score for each pair. This returns a list of scores.</span><br>    scores = reranker.predict(pairs)<br>    <br>    <span class="hljs-comment"># Combine the original documents with their new scores.</span><br>    doc_scores = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(documents, scores))<br>    <br>    <span class="hljs-comment"># Sort the list of (document, score) tuples in descending order based on the score.</span><br>    doc_scores.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)<br>    <br>    <span class="hljs-comment"># Extract just the Document objects from the top N sorted results.</span><br>    <span class="hljs-comment"># The number of documents to keep is controlled by 'top_n_rerank' in our config.</span><br>    reranked_docs = [doc <span class="hljs-keyword">for</span> doc, score <span class="hljs-keyword">in</span> doc_scores[:config[<span class="hljs-string">"top_n_rerank"</span>]]]<br>    <br>    <span class="hljs-keyword">return</span> reranked_docs</span></pre><p id="3bbc" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This function, <code class="de acj ack acl acb b">rerank_documents_function</code>, is the main part of our precision stage. It takes the <code class="de acj ack acl acb b">query</code> and the list of 10 <code class="de acj ack acl acb b">documents</code> from our recall stage. The most important step is <code class="de acj ack acl acb b">reranker.predict(pairs)</code>.</p><p id="5fa0" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Here, the model isn't creating embeddings, it's performing a full comparison of the query against each document content, producing a relevance score for each one.</p><p id="6306" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">After getting the scores, we simply sort the documents and slice the list to keep only the top 3. The output of this function will be a short, clean, and highly relevant list of documents the perfect context for our downstream agents.</p><p id="abf9" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This funneling approach, moving from a high-recall first stage to a high-precision second stage, is a component of a production-grade RAG system. <strong class="ov jg">It ensures we get the best possible evidence while minimizing noise and cost.</strong></p><h3 id="9692" class="adl zo jf bg zp gx adm ef gy gz adn eh ha hb ado hc hd he adp hf hg hh adq hi hj adr bl" data-selectable-paragraph="">Synthesizing using Contextual Distillation</h3><p id="86c1" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So, our retrieval funnel has worked beautifully. We started with a broad search that gave us 10 potentially relevant documents. Then, our high-precision reranker filtered that down to the top 3, most relevant chunks.</p><p id="36bd" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are in a much better position now, but we can still make one final improvement before handing this information over to our main reasoning agents. Right now, we have three separate text chunks.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw ady"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*JMaG43D23HpXzD4_30XppA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*JMaG43D23HpXzD4_30XppA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*JMaG43D23HpXzD4_30XppA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*JMaG43D23HpXzD4_30XppA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*JMaG43D23HpXzD4_30XppA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JMaG43D23HpXzD4_30XppA.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*JMaG43D23HpXzD4_30XppA.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*JMaG43D23HpXzD4_30XppA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*JMaG43D23HpXzD4_30XppA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*JMaG43D23HpXzD4_30XppA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*JMaG43D23HpXzD4_30XppA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*JMaG43D23HpXzD4_30XppA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*JMaG43D23HpXzD4_30XppA.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*JMaG43D23HpXzD4_30XppA.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="415" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_JMaG43D23HpXzD4_30XppA.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Synthesization (Created by <span class="hl"><span class="bn" aria-describedby="124" aria-labelledby="124" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="9d68" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">While they are all relevant, they might contain redundant information or overlapping sentences. Presenting them as three distinct blocks can still be a bit clunky for an LLM to process.</p><p id="a3ff" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The final stage of our retrieval funnel is <strong class="ov jg">Contextual Distillation</strong>. The goal is simple: take our top 3 highly relevant document chunks and distill them into a single, clean, and concise paragraph. This removes any final redundancy and presents a perfectly synthesized piece of evidence to our downstream agents.</p><blockquote class="abl"><p id="bf4f" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph=""><em class="acw">This distillation step acts as a final compression layer. It ensures the context fed into our more expensive reasoning agents is as dense and information-rich as possible, maximizing signal and minimizing noise.</em></p></blockquote><p id="2daf" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">To do this, we will create another small, specialized agent that we will call the <strong class="ov jg">Distiller Agent</strong>.</p><p id="c1fa" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First, we need to design the prompt that will guide its behavior.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="6cb3" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># The prompt for our distiller agent, instructing it to synthesize and be concise</span><br>distiller_prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"""You are a helpful assistant. Your task is to synthesize the following retrieved document snippets into a single, concise paragraph.<br>The goal is to provide a clear and coherent context that directly answers the question: '{question}'.<br>Focus on removing redundant information and organizing the content logically. Answer only with the synthesized context."""</span>),<br>    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"Retrieved Documents:\n{context}"</span>) <span class="hljs-comment"># The content of our top 3 reranked documents will be passed here</span><br>])</span></pre><p id="efb8" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are basically giving this agent a very focused task. We’re telling it: <strong class="ov jg">“Here are some pieces of text. Your only job is to merge them into one coherent paragraph that answers this specific question”</strong>. The instruction to <strong class="ov jg">“Answer only with the synthesized context” </strong>is important, it prevents the agent from adding any conversational fluff or trying to answer the question itself. It’s purely a text-processing tool.</p><p id="ae39" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now, we can assemble our simple <code class="de acj ack acl acb b">distiller_agent</code>.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="190f" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Create the agent by piping our prompt to the reasoning LLM and a string output parser</span><br>distiller_agent = distiller_prompt | reasoning_llm | StrOutputParser()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Contextual Distiller Agent created."</span>)</span></pre><p id="3dfa" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is another straightforward LCEL chain. We take our <code class="de acj ack acl acb b">distiller_prompt</code>, pipe it to our powerful <code class="de acj ack acl acb b">reasoning_llm</code> to perform the synthesis, and then use a <code class="de acj ack acl acb b">StrOutputParser</code> to get the final, clean paragraph of text.</p><p id="387f" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">With this <code class="de acj ack acl acb b">distiller_agent</code> created, our multi-stage retrieval funnel is now complete. In our main agentic loop, the flow for each research step will be:</p><ol class=""><li id="8cbd" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Supervisor:</strong> Choose a retrieval strategy (<code class="de acj ack acl acb b">vector</code>, <code class="de acj ack acl acb b">keyword</code>, or <code class="de acj ack acl acb b">hybrid</code>).</li><li id="15b0" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Recall Stage:</strong> Execute the chosen strategy to get the top 10 documents.</li><li id="fa07" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Precision Stage:</strong> Use the <code class="de acj ack acl acb b">rerank_documents_function</code> to get the top 3 documents.</li><li id="c629" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Distillation Stage:</strong> Use the <code class="de acj ack acl acb b">distiller_agent</code> to compress the top 3 documents into a single, clean paragraph.</li></ol><p id="6702" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This multi-stage process ensures that the evidence our agent works with is of the highest possible quality. The next step is to give our agent the ability to look beyond its internal knowledge and search the web.</p><h2 id="b6e1" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Augmenting Knowledge with Web Search</h2><p id="d3f9" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So, our retrieval funnel is now incredibly powerful but it has one massive blind spot.</p><blockquote class="abl"><p id="e744" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">It can only see what’s inside our 2023 10-K document. To solve our challenge query, our agent needs to find recent news (post-filing, from 2024) about AMD’s AI chip strategy. That information simply does not exist in our static knowledge base.</p></blockquote><p id="506e" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">To truly build a <strong class="ov jg">“Deep Thinking”</strong> agent, it needs to be able to recognize the limits of its own knowledge and look for answers elsewhere. We need to give it a window to the outside world.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adk"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*EXevl-vbwNaU4UTxWUkdMA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*EXevl-vbwNaU4UTxWUkdMA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*EXevl-vbwNaU4UTxWUkdMA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*EXevl-vbwNaU4UTxWUkdMA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*EXevl-vbwNaU4UTxWUkdMA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*EXevl-vbwNaU4UTxWUkdMA.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*EXevl-vbwNaU4UTxWUkdMA.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*EXevl-vbwNaU4UTxWUkdMA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*EXevl-vbwNaU4UTxWUkdMA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*EXevl-vbwNaU4UTxWUkdMA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*EXevl-vbwNaU4UTxWUkdMA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*EXevl-vbwNaU4UTxWUkdMA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*EXevl-vbwNaU4UTxWUkdMA.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*EXevl-vbwNaU4UTxWUkdMA.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="453" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_EXevl-vbwNaU4UTxWUkdMA.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Augemtation using Web (Created by <span class="hl"><span class="bn" aria-describedby="125" aria-labelledby="125" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="2c26" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is the step where we augment our agent’s capabilities with a new tool: <strong class="ov jg">Web Search</strong>. This transforms our system from a document-specific Q&amp;A bot into a true, multi-source research assistant.</p><p id="84bf" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">For this, we will use the <strong class="ov jg">Tavily Search API</strong>. It’s a search engine built specifically for LLMs, providing clean, ad-free, and relevant search results that are perfect for RAG pipelines. It also integrates seamlessly with LangChain.</p><p id="30c2" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">So, basically, the first thing we need to do is initialize the Tavily search tool itself.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="ed53" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> langchain_community.tools.tavily_search <span class="hljs-keyword">import</span> TavilySearchResults<br><br><span class="hljs-comment"># Initialize the Tavily search tool.</span><br><span class="hljs-comment"># k=3: This parameter instructs the tool to return the top 3 most relevant search results for a given query.</span><br>web_search_tool = TavilySearchResults(k=<span class="hljs-number">3</span>)</span></pre><p id="29cc" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are basically creating an instance of the Tavily search tool that our agent can call. The <code class="de acj ack acl acb b">k=3</code> parameter is a good starting point, providing a few high-quality sources without overwhelming the agent with too much information.</p><p id="6aeb" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now, a raw API response isn’t quite what we need. Our downstream components, the reranker and the distiller are all designed to work with a specific data structure: a list of LangChain <code class="de acj ack acl acb b">Document</code> objects. To ensure seamless integration, we need to create a simple wrapper function. This function will take a query, call the Tavily tool, and then format the raw results into that standard <code class="de acj ack acl acb b">Document</code> structure.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="a259" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">def</span> <span class="hljs-title.function">web_search_function</span>(<span class="hljs-params"><span class="hljs-symbol">query:</span> str</span>) -&gt; List[Document]:<br>    <span class="hljs-comment"># Invoke the Tavily search tool with the provided query.</span><br>    results = web_search_tool.invoke({<span class="hljs-string">"query"</span>: query})<br>    <br>    <span class="hljs-comment"># Format the results into a list of LangChain Document objects.</span><br>    <span class="hljs-comment"># We use a list comprehension for a concise and readable implementation.</span><br>    <span class="hljs-keyword">return</span> [<br>        Document(<br>            <span class="hljs-comment"># The main content of the search result goes into 'page_content'.</span><br>            page_content=res[<span class="hljs-string">"content"</span>],<br>            <span class="hljs-comment"># We store the source URL in the 'metadata' dictionary for citations.</span><br>            metadata={<span class="hljs-string">"source"</span>: res[<span class="hljs-string">"url"</span>]}<br>        ) <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> results<br>    ]</span></pre><p id="04b1" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This <code class="de acj ack acl acb b">web_search_function</code> acts as a crucial adapter. It calls <code class="de acj ack acl acb b">web_search_tool.invoke</code> which returns a list of dictionaries, with each dictionary containing keys like <code class="de acj ack acl acb b">"content"</code> and <code class="de acj ack acl acb b">"url"</code>.</p><ol class=""><li id="664c" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph="">The list comprehension then loops through these results and neatly repackages them into the <code class="de acj ack acl acb b">Document</code> objects our pipeline expects.</li><li id="e17f" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">The <code class="de acj ack acl acb b">page_content</code> gets the main text, and importantly, we store the <code class="de acj ack acl acb b">url</code> in the <code class="de acj ack acl acb b">metadata</code>.</li><li id="bf4e" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">This ensures that when our agent generates its final answer, it can properly cite its web sources.</li></ol><p id="aad8" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This makes our external knowledge source look and feel exactly like our internal one, allowing us to use the same processing pipeline for both.</p><p id="742b" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">With our function ready, let’s give it a quick test to make sure it’s working as expected. We’ll use a query that’s relevant to the second part of our main challenge.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="36a7" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Test the web search function with a query about AMD's 2024 strategy</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Testing Web Search Tool ---"</span>)<br>test_query_web = <span class="hljs-string">"AMD AI chip strategy 2024"</span><br>test_results_web = web_search_function(test_query_web)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Found <span class="hljs-subst">{<span class="hljs-built_in">len</span>(test_results_web)}</span> results for query: '<span class="hljs-subst">{test_query_web}</span>'"</span>)<br><span class="hljs-comment"># Print a snippet from the first result to see what we got back</span><br><span class="hljs-keyword">if</span> test_results_web:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Top result snippet: <span class="hljs-subst">{test_results_web[<span class="hljs-number">0</span>].page_content[:<span class="hljs-number">250</span>]}</span>..."</span>)</span></pre><pre class="ia aca acb acc bq acd bc bl"><span id="a934" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>Web search tool (Tavily) initialized.<br><br>--- Testing Web Search Tool ---<br>Found 3 results <span class="hljs-keyword">for</span> query: <span class="hljs-string">'AMD AI chip strategy 2024'</span><br>Top result snippet: AMD has intensified its battle with Nvidia <span class="hljs-keyword">in</span> the AI chip market with the release of the Instinct MI300X accelerator, a powerful GPU designed to challenge Nvidia<span class="hljs-string">'s H100 in training and inference for large language models. Major cloud providers like Microsoft Azure and Oracle Cloud are adopting the MI300X, indicating strong market interest...</span></span></pre><p id="fb2b" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The output confirms that our tool is working perfectly. It found 3 relevant web pages for our query. The snippet from the top result is exactly the kind of up-to-date, external information our agent was missing.</p><blockquote class="abl"><p id="bade" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">It mentions AMD “Instinct MI300X” and its competition with NVIDIA <strong class="an">“H100”</strong> precisely the evidence needed to solve the second half of our problem.</p></blockquote><p id="0789" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">Our agent now has a window to the outside world, and its planner can intelligently decide when to look through it. The final piece of the puzzle is to give the agent the ability to reflect on its findings and decide when its research is complete.</p><h2 id="6bd2" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Self-Critique and Control Flow Policy</h2><p id="1427" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So far, we have built a powerful research machine. Our agent can create a plan, choose the right tools, and execute a sophisticated retrieval funnel. But one critical piece is missing: the ability to <strong class="ov jg">think about its own progress</strong>. An agent that blindly follows a plan, step by step, is not truly intelligent. It needs a mechanism for self-critique.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adk"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*SyXWUwMyVgI5gXSuVedEfg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*SyXWUwMyVgI5gXSuVedEfg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*SyXWUwMyVgI5gXSuVedEfg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*SyXWUwMyVgI5gXSuVedEfg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*SyXWUwMyVgI5gXSuVedEfg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*SyXWUwMyVgI5gXSuVedEfg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*SyXWUwMyVgI5gXSuVedEfg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*SyXWUwMyVgI5gXSuVedEfg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*SyXWUwMyVgI5gXSuVedEfg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*SyXWUwMyVgI5gXSuVedEfg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*SyXWUwMyVgI5gXSuVedEfg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*SyXWUwMyVgI5gXSuVedEfg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*SyXWUwMyVgI5gXSuVedEfg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*SyXWUwMyVgI5gXSuVedEfg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="535" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_SyXWUwMyVgI5gXSuVedEfg.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Self Critique and Policy Making (Created by <span class="hl"><span class="bn" aria-describedby="126" aria-labelledby="126" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="1fe1" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is where we build the cognitive core of our agent autonomy. After each research step, our agent will pause and reflect. It will look at the new information it just found, compare it to what it already knew, and then make a strategic decision: is my research complete, or do I need to continue?</p><blockquote class="abl"><p id="f8d4" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph=""><em class="acw">This self-critique loop is what elevates our system from a scripted workflow to an autonomous agent. It’s the mechanism that allows it to decide when it has gathered enough evidence to confidently answer the user’s question.</em></p></blockquote><p id="3c71" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">We will implement this using two new specialized agents:</p><ol class=""><li id="3e9f" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">The Reflection Agent:</strong> This agent will take the distilled context from a completed step and create a concise, one-sentence summary. This summary is then added to our agent’s “research history.”</li><li id="f449" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">The Policy Agent:</strong> This is the master strategist. After reflection, it will examine the <em class="adj">entire</em> research history in relation to the original plan and make a crucial decision: <code class="de acj ack acl acb b">CONTINUE_PLAN</code> or <code class="de acj ack acl acb b">FINISH</code>.</li></ol><h3 id="1747" class="adl zo jf bg zp gx adm ef gy gz adn eh ha hb ado hc hd he adp hf hg hh adq hi hj adr bl" data-selectable-paragraph="">Update and Reflect Cumulative Research History</h3><p id="e378" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">After our agent completes a research step (e.g., retrieving and distilling information about NVIDIA’s risks), we don’t want to just move on. We need to integrate this new knowledge into the agent’s memory.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw adz"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*7CeU-usY-EFZhsioTIjU2Q.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*7CeU-usY-EFZhsioTIjU2Q.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*7CeU-usY-EFZhsioTIjU2Q.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*7CeU-usY-EFZhsioTIjU2Q.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*7CeU-usY-EFZhsioTIjU2Q.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*7CeU-usY-EFZhsioTIjU2Q.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*7CeU-usY-EFZhsioTIjU2Q.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*7CeU-usY-EFZhsioTIjU2Q.png 640w, https://miro.medium.com/v2/resize:fit:720/1*7CeU-usY-EFZhsioTIjU2Q.png 720w, https://miro.medium.com/v2/resize:fit:750/1*7CeU-usY-EFZhsioTIjU2Q.png 750w, https://miro.medium.com/v2/resize:fit:786/1*7CeU-usY-EFZhsioTIjU2Q.png 786w, https://miro.medium.com/v2/resize:fit:828/1*7CeU-usY-EFZhsioTIjU2Q.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*7CeU-usY-EFZhsioTIjU2Q.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*7CeU-usY-EFZhsioTIjU2Q.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="335" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_7CeU-usY-EFZhsioTIjU2Q.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Reflective Cumulative (Created by <span class="hl"><span class="bn" aria-describedby="127" aria-labelledby="127" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="ceec" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We will build a <strong class="ov jg">Reflection Agent</strong> whose only job is to perform this integration. It will take the rich, distilled context from the current step and summarize it into a single, factual sentence. This summary then gets added to the <code class="de acj ack acl acb b">past_steps</code> list in our <code class="de acj ack acl acb b">RAGState</code>.</p><p id="8a63" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First, let’s create the prompt for this agent.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="fd6f" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># The prompt for our reflection agent, instructing it to be concise and factual</span><br>reflection_prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"""You are a research assistant. Based on the retrieved context for the current sub-question, write a concise, one-sentence summary of the key findings.<br>This summary will be added to our research history. Be factual and to the point."""</span>),<br>    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"Current sub-question: {sub_question}\n\nDistilled context:\n{context}"</span>)<br>])</span></pre><p id="7e26" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are telling this agent to act like a diligent research assistant. Its task is not to be creative, but to be a good note-taker. It reads the <code class="de acj ack acl acb b">context</code> and writes a <code class="de acj ack acl acb b">summary</code>. Now we can assemble the agent itself.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="a1a1" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Create the agent by piping our prompt to the reasoning LLM and a string output parser</span><br>reflection_agent = reflection_prompt | reasoning_llm | StrOutputParser()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Reflection Agent created."</span>)</span></pre><p id="968a" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This <code class="de acj ack acl acb b">reflection_agent</code> is a part of our cognitive loop. By creating these concise summaries, it builds up a clean, easy-to-read <strong class="ov jg">research history</strong>. This history will be the input for our next, and most important, agent: the one that decides when to stop.</p><h3 id="0667" class="adl zo jf bg zp gx adm ef gy gz adn eh ha hb ado hc hd he adp hf hg hh adq hi hj adr bl" data-selectable-paragraph="">Building Policy Agent for Control Flow</h3><p id="8217" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">This is the brain of our agent autonomy. After the <code class="de acj ack acl acb b">reflection_agent</code> has updated the research history, the <strong class="ov jg">Policy Agent</strong> comes into play. It acts as the supervisor of the whole operation.</p><p id="ff41" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Its job is to look at everything the agent knows — the original question, the initial plan, and the full history of summaries from completed steps and make a high-level strategic decision.</p><figure class="pn po pp pq pr pm pv pw paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw aea"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*oPqtUFOqUh1ntoXjCAdKZQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*oPqtUFOqUh1ntoXjCAdKZQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*oPqtUFOqUh1ntoXjCAdKZQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*oPqtUFOqUh1ntoXjCAdKZQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*oPqtUFOqUh1ntoXjCAdKZQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*oPqtUFOqUh1ntoXjCAdKZQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oPqtUFOqUh1ntoXjCAdKZQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*oPqtUFOqUh1ntoXjCAdKZQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*oPqtUFOqUh1ntoXjCAdKZQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*oPqtUFOqUh1ntoXjCAdKZQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*oPqtUFOqUh1ntoXjCAdKZQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*oPqtUFOqUh1ntoXjCAdKZQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*oPqtUFOqUh1ntoXjCAdKZQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*oPqtUFOqUh1ntoXjCAdKZQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi gl ps c" width="700" height="1021" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_oPqtUFOqUh1ntoXjCAdKZQ.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Policy Agent (Created by <span class="hl"><span class="bn" aria-describedby="128" aria-labelledby="128" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure><p id="a0b5" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We will start by defining the structure of its decision using a Pydantic model.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="7605" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">class</span> <span class="hljs-title.class">Decision</span>(<span class="hljs-title.class.inherited">BaseModel</span>):<br>    <span class="hljs-comment"># The decision must be one of these two actions.</span><br>    next_action: <span class="hljs-type">Literal</span>[<span class="hljs-string">"CONTINUE_PLAN"</span>, <span class="hljs-string">"FINISH"</span>]<br>    <span class="hljs-comment"># The agent must justify its decision.</span><br>    justification: <span class="hljs-built_in">str</span></span></pre><p id="c371" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This <code class="de acj ack acl acb b">Decision</code> class forces our Policy Agent to make a clear, binary choice and to explain its reasoning. This makes its behavior transparent and easy to debug.</p><p id="92c0" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Next, we design the prompt that will guide its decision-making process.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="f01d" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># The prompt for our policy agent, instructing it to act as a master strategist</span><br>policy_prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"""You are a master strategist. Your role is to analyze the research progress and decide the next action.<br>You have the original question, the initial plan, and a log of completed steps with their summaries.<br>- If the collected information in the Research History is sufficient to comprehensively answer the Original Question, decide to FINISH.<br>- Otherwise, if the plan is not yet complete, decide to CONTINUE_PLAN."""</span>),<br>    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"Original Question: {question}\n\nInitial Plan:\n{plan}\n\nResearch History (Completed Steps):\n{history}"</span>)<br>])</span></pre><p id="4f4c" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are basically asking the LLM to perform a meta-analysis. It’s not answering the question itself; it’s reasoning about the <em class="adj">state of the research process</em>. It compares what it has (<code class="de acj ack acl acb b">history</code>) with what it needs (<code class="de acj ack acl acb b">plan</code> and <code class="de acj ack acl acb b">question</code>) and makes a judgment call.</p><p id="e2b2" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now, we can assemble the <code class="de acj ack acl acb b">policy_agent</code>.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="68a5" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Create the agent by piping our prompt to the reasoning LLM and structuring its output with our Decision class</span><br>policy_agent = policy_prompt | reasoning_llm.with_structured_output(Decision)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Policy Agent created."</span>)<br><br><span class="hljs-comment"># Now, let's test the policy agent with two different states of our research process</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Testing Policy Agent (Incomplete State) ---"</span>)<br><br><span class="hljs-comment"># First, a state where only Step 1 is complete.</span><br>plan_str = json.dumps([s.<span class="hljs-built_in">dict</span>() <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> test_plan.steps])<br>incomplete_history = <span class="hljs-string">"Step 1 Summary: NVIDIA's 10-K states that the semiconductor industry is intensely competitive and subject to rapid technological change."</span><br>decision1 = policy_agent.invoke({<span class="hljs-string">"question"</span>: complex_query_adv, <span class="hljs-string">"plan"</span>: plan_str, <span class="hljs-string">"history"</span>: incomplete_history})<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Decision: <span class="hljs-subst">{decision1.next_action}</span>, Justification: <span class="hljs-subst">{decision1.justification}</span>"</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Testing Policy Agent (Complete State) ---"</span>)<br><br><span class="hljs-comment"># Second, a state where both Step 1 and Step 2 are complete.</span><br>complete_history = incomplete_history + <span class="hljs-string">"\nStep 2 Summary: In 2024, AMD launched its MI300X accelerator to directly compete with NVIDIA in the AI chip market, gaining adoption from major cloud providers."</span><br>decision2 = policy_agent.invoke({<span class="hljs-string">"question"</span>: complex_query_adv, <span class="hljs-string">"plan"</span>: plan_str, <span class="hljs-string">"history"</span>: complete_history})<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"Decision: <span class="hljs-subst">{decision2.next_action}</span>, Justification: <span class="hljs-subst">{decision2.justification}</span>"</span>)</span></pre><p id="2ba3" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">To properly test our <code class="de acj ack acl acb b">policy_agent</code>, we simulate two distinct moments in our agent's lifecycle. In the first test, we provide it with a history that only contains the summary from Step 1. In the second, we provide it with the summaries from both Step 1 and Step 2.</p><p id="24b5" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Let’s examine its decisions in each case.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="56ac" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>Policy Agent created.<br><br>--- Testing Policy Agent (Incomplete State) ---<br>Decision: CONTINUE_PLAN, Justification: The research has only identified NVIDIA<span class="hljs-string">'s competitive risks from the 10-K. It has not yet gathered the required external information about AMD'</span>s 2024 strategy, <span class="hljs-built_in">which</span> is the next step <span class="hljs-keyword">in</span> the plan.<br><br>--- Testing Policy Agent (Complete State) ---<br>Decision: FINISH, Justification: The research <span class="hljs-built_in">history</span> now contains comprehensive summaries of both NVIDIA<span class="hljs-string">'s stated competitive risks and AMD'</span>s recent AI chip strategy. All necessary information has been gathered to perform the final synthesis and answer the user<span class="hljs-string">'s question.</span></span></pre><p id="544c" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Let’s understand the output …</p><ul class=""><li id="1872" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">In the incomplete state,</strong> the agent correctly recognized that it was missing the information about AMD’s strategy. It looked at its plan, saw that the next step was to use the web search, and correctly decided to <code class="de acj ack acl acb b">CONTINUE_PLAN</code>.</li><li id="a1e4" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">In the complete state,</strong> after being given the summary from the web search, it analyzed its history again. This time, it recognized that it had all the pieces of the puzzle NVIDIA risks and AMD strategy. It correctly decided that its research was done and it was time to <code class="de acj ack acl acb b">FINISH</code>.</li></ul><p id="9cdc" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">With this <code class="de acj ack acl acb b">policy_agent</code>, we have built the brain of our autonomous system. The final step is to wire all of these components together into a complete, executable workflow using LangGraph.</p><h2 id="1091" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Defining the Graph Nodes</h2><p id="d89e" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">we have designed all these cool, specialized agents. Now it’s time to turn them into the actual building blocks of our workflow. In LangGraph, these building blocks are called <strong class="ov jg">nodes</strong>. A node is just a Python function that does one specific job. It takes the agent’s current memory (<code class="de acj ack acl acb b">RAGState</code>) as input, performs its task, and then returns a dictionary with any updates to that memory.</p><p id="c141" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We will create a node for every major step our agent needs to take.</p><figure class="pn po pp pq pr pm pv pw paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw aeb"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*_e7v5F0sv_1ZJc9GvFsAhw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*_e7v5F0sv_1ZJc9GvFsAhw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*_e7v5F0sv_1ZJc9GvFsAhw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*_e7v5F0sv_1ZJc9GvFsAhw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*_e7v5F0sv_1ZJc9GvFsAhw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*_e7v5F0sv_1ZJc9GvFsAhw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_e7v5F0sv_1ZJc9GvFsAhw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*_e7v5F0sv_1ZJc9GvFsAhw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*_e7v5F0sv_1ZJc9GvFsAhw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*_e7v5F0sv_1ZJc9GvFsAhw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*_e7v5F0sv_1ZJc9GvFsAhw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*_e7v5F0sv_1ZJc9GvFsAhw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*_e7v5F0sv_1ZJc9GvFsAhw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*_e7v5F0sv_1ZJc9GvFsAhw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="bi gl ps c" width="700" height="1374" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1__e7v5F0sv_1ZJc9GvFsAhw.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Graph Nodes (Created by <span class="hl"><span class="bn" aria-describedby="129" aria-labelledby="129" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure><p id="8116" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First up, we need a simple helper function. Since our agents will often need to see the research history, we want a clean way to format the <code class="de acj ack acl acb b">past_steps</code> list into a readable string.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="f26c" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># A helper function to format the research history for prompts</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">get_past_context_str</span>(<span class="hljs-params">past_steps: <span class="hljs-type">List</span>[PastStep]</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-comment"># This takes the list of PastStep dictionaries and joins them into a single string.</span><br>    <span class="hljs-comment"># Each step is clearly labeled for the LLM to understand the context.</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"\\n\\n"</span>.join([<span class="hljs-string">f"Step <span class="hljs-subst">{s[<span class="hljs-string">'step_index'</span>]}</span>: <span class="hljs-subst">{s[<span class="hljs-string">'sub_question'</span>]}</span>\\nSummary: <span class="hljs-subst">{s[<span class="hljs-string">'summary'</span>]}</span>"</span> <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> past_steps])</span></pre><p id="006c" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are basically creating a utility that will be used inside several of our nodes to provide historical context to our prompts.</p><p id="bb45" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now for our first real node: the <code class="de acj ack acl acb b">plan_node</code>. This is the starting point of our agent's reasoning. Its only job is to call our <code class="de acj ack acl acb b">planner_agent</code> and populate the <code class="de acj ack acl acb b">plan</code> field in our <code class="de acj ack acl acb b">RAGState</code>.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="4f53" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Node 1: The Planner</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">plan_node</span>(<span class="hljs-params">state: RAGState</span>) -&gt; <span class="hljs-type">Dict</span>:<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"--- 🧠: Generating Plan ---"</span>)<br>    <span class="hljs-comment"># We call the planner_agent we created earlier, passing in the user's original question.</span><br>    plan = planner_agent.invoke({<span class="hljs-string">"question"</span>: state[<span class="hljs-string">"original_question"</span>]})<br>    rprint(plan)<br>    <span class="hljs-comment"># We return a dictionary with the updates for our RAGState.</span><br>    <span class="hljs-comment"># LangGraph will automatically merge this into the main state.</span><br>    <span class="hljs-keyword">return</span> {<span class="hljs-string">"plan"</span>: plan, <span class="hljs-string">"current_step_index"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"past_steps"</span>: []}</span></pre><p id="1f7f" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This node kicks everything off. It takes the <code class="de acj ack acl acb b">original_question</code> from the state, gets the <code class="de acj ack acl acb b">plan</code>, and then initializes the <code class="de acj ack acl acb b">current_step_index</code> to 0 (to start with the first step) and clears the <code class="de acj ack acl acb b">past_steps</code> history for this new run.</p><p id="4d90" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Next, we need the nodes that actually go and find information. Since our planner can choose between two tools, we need two separate retrieval nodes. Let’s start with the <code class="de acj ack acl acb b">retrieval_node</code> for searching our internal 10-K document.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="2a25" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Node 2a: Retrieval from the 10-K document</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">retrieval_node</span>(<span class="hljs-params">state: RAGState</span>) -&gt; <span class="hljs-type">Dict</span>:<br>    <span class="hljs-comment"># First, get the details for the current step in the plan.</span><br>    current_step_index = state[<span class="hljs-string">"current_step_index"</span>]<br>    current_step = state[<span class="hljs-string">"plan"</span>].steps[current_step_index]<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- 🔍: Retrieving from 10-K (Step <span class="hljs-subst">{current_step_index + <span class="hljs-number">1</span>}</span>: <span class="hljs-subst">{current_step.sub_question}</span>) ---"</span>)<br>    <br>    <span class="hljs-comment"># Use our query rewriter to optimize the sub-question for search.</span><br>    past_context = get_past_context_str(state[<span class="hljs-string">'past_steps'</span>])<br>    rewritten_query = query_rewriter_agent.invoke({<br>        <span class="hljs-string">"sub_question"</span>: current_step.sub_question,<br>        <span class="hljs-string">"keywords"</span>: current_step.keywords,<br>        <span class="hljs-string">"past_context"</span>: past_context<br>    })<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  Rewritten Query: <span class="hljs-subst">{rewritten_query}</span>"</span>)<br>    <br>    <span class="hljs-comment"># Get the supervisor's decision on which retrieval strategy is best.</span><br>    retrieval_decision = retrieval_supervisor_agent.invoke({<span class="hljs-string">"sub_question"</span>: rewritten_query})<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  Supervisor Decision: Use `<span class="hljs-subst">{retrieval_decision.strategy}</span>`. Justification: <span class="hljs-subst">{retrieval_decision.justification}</span>"</span>)<br><br>    <span class="hljs-comment"># Based on the decision, execute the correct retrieval function.</span><br>    <span class="hljs-keyword">if</span> retrieval_decision.strategy == <span class="hljs-string">'vector_search'</span>:<br>        retrieved_docs = vector_search_only(rewritten_query, section_filter=current_step.document_section, k=config[<span class="hljs-string">'top_k_retrieval'</span>])<br>    <span class="hljs-keyword">elif</span> retrieval_decision.strategy == <span class="hljs-string">'keyword_search'</span>:<br>        retrieved_docs = bm25_search_only(rewritten_query, k=config[<span class="hljs-string">'top_k_retrieval'</span>])<br>    <span class="hljs-keyword">else</span>: <span class="hljs-comment"># hybrid_search</span><br>        retrieved_docs = hybrid_search(rewritten_query, section_filter=current_step.document_section, k=config[<span class="hljs-string">'top_k_retrieval'</span>])<br>    <br>    <span class="hljs-comment"># Return the retrieved documents to be added to the state.</span><br>    <span class="hljs-keyword">return</span> {<span class="hljs-string">"retrieved_docs"</span>: retrieved_docs}</span></pre><p id="70cd" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This node is doing a lot of intelligent work. It’s not just a simple retriever. It orchestrates a mini-pipeline: it rewrites the query, asks the supervisor for the best strategy, and then executes that strategy.</p><p id="b371" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now, we need the corresponding node for our other tool: web search.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="d2c8" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Node 2b: Retrieval from the Web</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">web_search_node</span>(<span class="hljs-params">state: RAGState</span>) -&gt; <span class="hljs-type">Dict</span>:<br>    <span class="hljs-comment"># Get the details for the current step.</span><br>    current_step_index = state[<span class="hljs-string">"current_step_index"</span>]<br>    current_step = state[<span class="hljs-string">"plan"</span>].steps[current_step_index]<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- 🌐: Searching Web (Step <span class="hljs-subst">{current_step_index + <span class="hljs-number">1</span>}</span>: <span class="hljs-subst">{current_step.sub_question}</span>) ---"</span>)<br>    <br>    <span class="hljs-comment"># Rewrite the sub-question for a web search engine.</span><br>    past_context = get_past_context_str(state[<span class="hljs-string">'past_steps'</span>])<br>    rewritten_query = query_rewriter_agent.invoke({<br>        <span class="hljs-string">"sub_question"</span>: current_step.sub_question,<br>        <span class="hljs-string">"keywords"</span>: current_step.keywords,<br>        <span class="hljs-string">"past_context"</span>: past_context<br>    })<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  Rewritten Query: <span class="hljs-subst">{rewritten_query}</span>"</span>)<br>    <span class="hljs-comment"># Call our web search function.</span><br>    retrieved_docs = web_search_function(rewritten_query)<br>    <span class="hljs-comment"># Return the results.</span><br>    <span class="hljs-keyword">return</span> {<span class="hljs-string">"retrieved_docs"</span>: retrieved_docs}</span></pre><p id="7970" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This <code class="de acj ack acl acb b">web_search_node</code> is simpler because it doesn't need a supervisor, it just has one way to search the web. But it still uses our powerful query rewriter to make sure the search is as effective as possible.</p><p id="0618" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">After we retrieve documents (from either source), we need to run our precision and synthesis funnel. We’ll create a node for each stage. First, the <code class="de acj ack acl acb b">rerank_node</code>.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="9359" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Node 3: The Reranker</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">rerank_node</span>(<span class="hljs-params">state: RAGState</span>) -&gt; <span class="hljs-type">Dict</span>:<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"--- 🎯: Reranking Documents ---"</span>)<br>    <span class="hljs-comment"># Get the current step's details.</span><br>    current_step_index = state[<span class="hljs-string">"current_step_index"</span>]<br>    current_step = state[<span class="hljs-string">"plan"</span>].steps[current_step_index]<br>    <span class="hljs-comment"># Call our reranking function on the documents we just retrieved.</span><br>    reranked_docs = rerank_documents_function(current_step.sub_question, state[<span class="hljs-string">"retrieved_docs"</span>])<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  Reranked to top <span class="hljs-subst">{<span class="hljs-built_in">len</span>(reranked_docs)}</span> documents."</span>)<br>    <span class="hljs-comment"># Update the state with the high-precision documents.</span><br>    <span class="hljs-keyword">return</span> {<span class="hljs-string">"reranked_docs"</span>: reranked_docs}</span></pre><p id="40ae" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This node takes the <code class="de acj ack acl acb b">retrieved_docs</code> (our broad recall of 10 documents) and uses the cross-encoder to filter them down to the top 3, placing the result in <code class="de acj ack acl acb b">reranked_docs</code>.</p><p id="1c59" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Next, the <code class="de acj ack acl acb b">compression_node</code> will take those top 3 documents and distill them.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="7c1e" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Node 4: The Compressor / Distiller</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">compression_node</span>(<span class="hljs-params">state: RAGState</span>) -&gt; <span class="hljs-type">Dict</span>:<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"--- ✂️: Distilling Context ---"</span>)<br>    <span class="hljs-comment"># Get the current step's details.</span><br>    current_step_index = state[<span class="hljs-string">"current_step_index"</span>]<br>    current_step = state[<span class="hljs-string">"plan"</span>].steps[current_step_index]<br>    <span class="hljs-comment"># Format the top 3 documents into a single string.</span><br>    context = format_docs(state[<span class="hljs-string">"reranked_docs"</span>])<br>    <span class="hljs-comment"># Call our distiller agent to synthesize them into one paragraph.</span><br>    synthesized_context = distiller_agent.invoke({<span class="hljs-string">"question"</span>: current_step.sub_question, <span class="hljs-string">"context"</span>: context})<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  Distilled Context Snippet: <span class="hljs-subst">{synthesized_context[:<span class="hljs-number">200</span>]}</span>..."</span>)<br>    <span class="hljs-comment"># Update the state with the final, clean context.</span><br>    <span class="hljs-keyword">return</span> {<span class="hljs-string">"synthesized_context"</span>: synthesized_context}</span></pre><p id="bb9e" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This node is the last step of our retrieval funnel. It takes the <code class="de acj ack acl acb b">reranked_docs</code> and produces a single, clean <code class="de acj ack acl acb b">synthesized_context</code> paragraph.</p><p id="29eb" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now that we have our evidence, we need to reflect on it and update our research history. This is the job of the <code class="de acj ack acl acb b">reflection_node</code>.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="31bf" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Node 5: The Reflection / Update Step</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">reflection_node</span>(<span class="hljs-params">state: RAGState</span>) -&gt; <span class="hljs-type">Dict</span>:<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"--- : Reflecting on Findings ---"</span>)<br>    <span class="hljs-comment"># Get the current step's details.</span><br>    current_step_index = state[<span class="hljs-string">"current_step_index"</span>]<br>    current_step = state[<span class="hljs-string">"plan"</span>].steps[current_step_index]<br>    <span class="hljs-comment"># Call our reflection agent to summarize the findings.</span><br>    summary = reflection_agent.invoke({<span class="hljs-string">"sub_question"</span>: current_step.sub_question, <span class="hljs-string">"context"</span>: state[<span class="hljs-string">'synthesized_context'</span>]})<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  Summary: <span class="hljs-subst">{summary}</span>"</span>)<br>    <br>    <span class="hljs-comment"># Create a new PastStep dictionary with all the results from this step.</span><br>    new_past_step = {<br>        <span class="hljs-string">"step_index"</span>: current_step_index + <span class="hljs-number">1</span>,<br>        <span class="hljs-string">"sub_question"</span>: current_step.sub_question,<br>        <span class="hljs-string">"retrieved_docs"</span>: state[<span class="hljs-string">'reranked_docs'</span>], <span class="hljs-comment"># We save the reranked docs for final citation</span><br>        <span class="hljs-string">"summary"</span>: summary<br>    }<br>    <span class="hljs-comment"># Append the new step to our history and increment the step index to move to the next step.</span><br>    <span class="hljs-keyword">return</span> {<span class="hljs-string">"past_steps"</span>: state[<span class="hljs-string">"past_steps"</span>] + [new_past_step], <span class="hljs-string">"current_step_index"</span>: current_step_index + <span class="hljs-number">1</span>}</span></pre><p id="7a25" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This node is the bookkeeper of our agent. It calls the <code class="de acj ack acl acb b">reflection_agent</code> to create the summary and then neatly packages all the results of the current research cycle into a <code class="de acj ack acl acb b">new_past_step</code> object. It then adds this to the <code class="de acj ack acl acb b">past_steps</code> list and increments the <code class="de acj ack acl acb b">current_step_index</code>, getting the agent ready for the next loop.</p><p id="9b43" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Finally, when the research is complete, we need one last node to generate the final answer.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="c09f" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Node 6: The Final Answer Generator</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">final_answer_node</span>(<span class="hljs-params">state: RAGState</span>) -&gt; <span class="hljs-type">Dict</span>:<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"--- ✅: Generating Final Answer with Citations ---"</span>)<br>    <span class="hljs-comment"># First, we need to gather all the evidence we've collected from ALL past steps.</span><br>    final_context = <span class="hljs-string">""</span><br>    <span class="hljs-keyword">for</span> i, step <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(state[<span class="hljs-string">'past_steps'</span>]):<br>        final_context += <span class="hljs-string">f"\\n--- Findings from Research Step <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span> ---\\n"</span><br>        <span class="hljs-comment"># We include the source metadata (section or URL) for each document to enable citations.</span><br>        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> step[<span class="hljs-string">'retrieved_docs'</span>]:<br>            source = doc.metadata.get(<span class="hljs-string">'section'</span>) <span class="hljs-keyword">or</span> doc.metadata.get(<span class="hljs-string">'source'</span>)<br>            final_context += <span class="hljs-string">f"Source: <span class="hljs-subst">{source}</span>\\nContent: <span class="hljs-subst">{doc.page_content}</span>\\n\\n"</span><br>    <br>    <span class="hljs-comment"># We create a new prompt specifically for generating the final, citable answer.</span><br>    final_answer_prompt = ChatPromptTemplate.from_messages([<br>        (<span class="hljs-string">"system"</span>, <span class="hljs-string">"""You are an expert financial analyst. Synthesize the research findings from internal documents and web searches into a comprehensive, multi-paragraph answer for the user's original question.<br>Your answer must be grounded in the provided context. At the end of any sentence that relies on specific information, you MUST add a citation. For 10-K documents, use [Source: &lt;section title&gt;]. For web results, use [Source: &lt;URL&gt;]."""</span>),<br>        (<span class="hljs-string">"human"</span>, <span class="hljs-string">"Original Question: {question}\n\nResearch History and Context:\n{context}"</span>)<br>    ])<br>    <br>    <span class="hljs-comment"># We create a temporary agent for this final task and invoke it.</span><br>    final_answer_agent = final_answer_prompt | reasoning_llm | StrOutputParser()<br>    final_answer = final_answer_agent.invoke({<span class="hljs-string">"question"</span>: state[<span class="hljs-string">'original_question'</span>], <span class="hljs-string">"context"</span>: final_context})<br>    <span class="hljs-comment"># Update the state with the final answer.</span><br>    <span class="hljs-keyword">return</span> {<span class="hljs-string">"final_answer"</span>: final_answer}</span></pre><p id="bd49" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This <code class="de acj ack acl acb b">final_answer_node</code> is our grand finale. It consolidates all the high-quality, reranked documents from every step in the <code class="de acj ack acl acb b">past_steps</code> history into one massive context. It then uses a dedicated prompt to instruct our powerful <code class="de acj ack acl acb b">reasoning_llm</code> to synthesize this information into a comprehensive, multi-paragraph answer that includes citations, bringing our research process to a successful conclusion.</p><p id="5c90" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">With all our nodes defined, we now have all the building blocks for our agent. The next step is to define the “wires” that connect them and control the flow of the graph.</p><h2 id="d6b9" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Defining the Conditional Edges</h2><p id="bff2" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So, we have built all of our nodes. We have a planner, retrievers, a reranker, a distiller, and a reflector. Think of them as a collection of experts in a room. Now we need to define the rules of conversation. Who speaks when? How do we decide what to do next?</p><p id="b2f2" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is the job of <strong class="ov jg">edges</strong> in LangGraph. Simple edges are straightforward, <strong class="ov jg">“after Node A, always go to Node B”</strong>. But the real intelligence comes from <strong class="ov jg">conditional edges</strong>.</p><blockquote class="abl"><p id="ab32" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">A conditional edge is a function that looks at the agent’s current memory (<code class="de acj ack acl acb b">RAGState</code>) and makes a decision, routing the workflow down different paths based on the situation.</p></blockquote><p id="58df" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">We need two key decision-making functions for our agent:</p><ol class=""><li id="0799" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">A Tool Router (</strong><code class="de acj ack acl acb b"><strong class="ov jg">route_by_tool</strong></code><strong class="ov jg">):</strong> After the plan is made, this function will look at the <em class="adj">current step</em> of the plan and decide whether to send the workflow to the <code class="de acj ack acl acb b">retrieve_10k</code> node or the <code class="de acj ack acl acb b">retrieve_web</code> node.</li><li id="7b3b" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">The Main Control Loop (</strong><code class="de acj ack acl acb b"><strong class="ov jg">should_continue_node</strong></code><strong class="ov jg">):</strong> This is the most important one. After each research step is completed and reflected upon, this function will call our <code class="de acj ack acl acb b">policy_agent</code> to decide whether to continue to the next step in the plan or to finish the research and generate the final answer.</li></ol><p id="a7d5" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">First, let’s build our simple tool router.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="df12" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Conditional Edge 1: The Tool Router</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">route_by_tool</span>(<span class="hljs-params">state: RAGState</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-comment"># Get the index of the current step we are on.</span><br>    current_step_index = state[<span class="hljs-string">"current_step_index"</span>]<br>    <span class="hljs-comment"># Get the full details of the current step from the plan.</span><br>    current_step = state[<span class="hljs-string">"plan"</span>].steps[current_step_index]<br>    <span class="hljs-comment"># Return the name of the tool specified for this step.</span><br>    <span class="hljs-comment"># LangGraph will use this string to decide which node to go to next.</span><br>    <span class="hljs-keyword">return</span> current_step.tool</span></pre><p id="6c66" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This function is very simple, but crucial. It acts as a switchboard. It reads the <code class="de acj ack acl acb b">current_step_index</code> from the state, finds the corresponding <code class="de acj ack acl acb b">Step</code> in the <code class="de acj ack acl acb b">plan</code>, and returns the value of its <code class="de acj ack acl acb b">tool</code> field (which will be either <code class="de acj ack acl acb b">"search_10k"</code> or <code class="de acj ack acl acb b">"search_web"</code>). When we wire up our graph, we will tell it to use this function's output to choose the next node.</p><p id="b0ad" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now we need to create a function that controls our agent’s primary reasoning loop. This is where our <code class="de acj ack acl acb b">policy_agent</code> comes into play.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="ceb0" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Conditional Edge 2: The Main Control Loop</span><br><span class="hljs-keyword">def</span> <span class="hljs-title.function">should_continue_node</span>(<span class="hljs-params">state: RAGState</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"--- 🚦: Evaluating Policy ---"</span>)<br>    <span class="hljs-comment"># Get the index of the step we are about to start.</span><br>    current_step_index = state[<span class="hljs-string">"current_step_index"</span>]<br>    <br>    <span class="hljs-comment"># First, check our basic stopping conditions.</span><br>    <span class="hljs-comment"># Condition 1: Have we completed all the steps in the plan?</span><br>    <span class="hljs-keyword">if</span> current_step_index &gt;= <span class="hljs-built_in">len</span>(state[<span class="hljs-string">"plan"</span>].steps):<br>        console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"  -&gt; Plan complete. Finishing."</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"finish"</span><br>    <br>    <span class="hljs-comment"># Condition 2: Have we exceeded our safety limit for the number of iterations?</span><br>    <span class="hljs-keyword">if</span> current_step_index &gt;= config[<span class="hljs-string">"max_reasoning_iterations"</span>]:<br>        console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"  -&gt; Max iterations reached. Finishing."</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"finish"</span><br><br>    <span class="hljs-comment"># A special case: If the last retrieval step failed to find any documents,</span><br>    <span class="hljs-comment"># there's no point in reflecting. It's better to just move on to the next step.</span><br>    <span class="hljs-keyword">if</span> state.get(<span class="hljs-string">"reranked_docs"</span>) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> state[<span class="hljs-string">"reranked_docs"</span>]:<br>        console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"  -&gt; Retrieval failed for the last step. Continuing with next step in plan."</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"continue"</span><br><br>    <span class="hljs-comment"># If none of the basic conditions are met, it's time to ask our Policy Agent.</span><br>    <span class="hljs-comment"># We format the history and plan into strings for the prompt.</span><br>    history = get_past_context_str(state[<span class="hljs-string">'past_steps'</span>])<br>    plan_str = json.dumps([s.<span class="hljs-built_in">dict</span>() <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> state[<span class="hljs-string">'plan'</span>].steps])<br><br>    <span class="hljs-comment"># Invoke the policy agent to get its strategic decision.</span><br>    decision = policy_agent.invoke({<span class="hljs-string">"question"</span>: state[<span class="hljs-string">"original_question"</span>], <span class="hljs-string">"plan"</span>: plan_str, <span class="hljs-string">"history"</span>: history})<br>    console.<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  -&gt; Decision: <span class="hljs-subst">{decision.next_action}</span> | Justification: <span class="hljs-subst">{decision.justification}</span>"</span>)<br>    <br>    <span class="hljs-comment"># Based on the agent's decision, return the appropriate signal.</span><br>    <span class="hljs-keyword">if</span> decision.next_action == <span class="hljs-string">"FINISH"</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"finish"</span><br>    <span class="hljs-keyword">else</span>: <span class="hljs-comment"># CONTINUE_PLAN</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"continue"</span></span></pre><p id="e2e1" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This <code class="de acj ack acl acb b">should_continue_node</code> function is the cognitive core of our agent's control flow. It runs after every <code class="de acj ack acl acb b">reflection_node</code>.</p><ol class=""><li id="dc56" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph="">It first checks for simple, hardcoded <strong class="ov jg">stopping criteria</strong>. Has the plan run out of steps? Have we hit our <code class="de acj ack acl acb b">max_reasoning_iterations</code> safety limit? These prevent the agent from running forever.</li><li id="a4b0" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">If those checks pass, it then invokes our powerful <code class="de acj ack acl acb b">policy_agent</code>. It gives the policy agent all the context it needs: the original goal (<code class="de acj ack acl acb b">question</code>), the full <code class="de acj ack acl acb b">plan</code>, and the <code class="de acj ack acl acb b">history</code> of what's been accomplished so far.</li><li id="a648" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">Finally, it takes the <code class="de acj ack acl acb b">policy_agent</code>'s structured output (<code class="de acj ack acl acb b">CONTINUE_PLAN</code> or <code class="de acj ack acl acb b">FINISH</code>) and returns the simple string <code class="de acj ack acl acb b">"continue"</code> or <code class="de acj ack acl acb b">"finish"</code>. LangGraph will use this string to either loop back for another research cycle or proceed to the <code class="de acj ack acl acb b">final_answer_node</code>.</li></ol><p id="932a" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">With our nodes (the experts) and our conditional edges (the rules of conversation) now defined, we have everything we need.</p><blockquote class="abl"><p id="a0f5" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">It’s time to assemble all these pieces into a complete, functioning <code class="de acj ack acl acb b">StateGraph</code>.</p></blockquote><h2 id="7ba9" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn aec so sp sq aed sr ss st aee su sv zv bl" data-selectable-paragraph="">Wiring the Deep Thinking RAG Machine</h2><p id="363a" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">We have all of our individual components ready to go:</p><ol class=""><li id="5991" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph="">our nodes (<strong class="ov jg">workers</strong>)</li><li id="bc1b" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">our conditional edges (<strong class="ov jg">managers</strong>).</li></ol><p id="f517" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now it’s time to wire them all together into a single, cohesive system.</p><p id="641a" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We will use LangGraph’s <code class="de acj ack acl acb b">StateGraph</code> to define the complete cognitive architecture of our agent. This is where we lay out the blueprint of our agent's thought process, defining exactly how information flows from one step to the next.</p><p id="09ca" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The first thing we need to do is create an instance of the <code class="de acj ack acl acb b">StateGraph</code>. We will tell it that the <strong class="ov jg">"state" </strong>it will be passing around is our <code class="de acj ack acl acb b">RAGState</code> dictionary.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="d716" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph, END <span class="hljs-comment"># Import the main graph components</span><br><br><span class="hljs-comment"># Instantiate the graph, telling it to use our RAGState TypedDict as its state schema.</span><br>graph = StateGraph(RAGState)</span></pre><p id="90f1" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We now have an empty graph. The next step is to add all the nodes we defined earlier. The <code class="de acj ack acl acb b">.add_node()</code> method takes two arguments: a unique string name for the node, and the Python function that the node will execute.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="31e5" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># Add all of our Python functions as nodes in the graph</span><br>graph.add_node(<span class="hljs-string">"plan"</span>, plan_node)                     <span class="hljs-comment"># The node that creates the initial plan</span><br>graph.add_node(<span class="hljs-string">"retrieve_10k"</span>, retrieval_node)        <span class="hljs-comment"># The node for internal document retrieval</span><br>graph.add_node(<span class="hljs-string">"retrieve_web"</span>, web_search_node)       <span class="hljs-comment"># The node for external web search</span><br>graph.add_node(<span class="hljs-string">"rerank"</span>, rerank_node)                 <span class="hljs-comment"># The node that performs precision reranking</span><br>graph.add_node(<span class="hljs-string">"compress"</span>, compression_node)          <span class="hljs-comment"># The node that distills the context</span><br>graph.add_node(<span class="hljs-string">"reflect"</span>, reflection_node)            <span class="hljs-comment"># The node that summarizes findings and updates history</span><br>graph.add_node(<span class="hljs-string">"generate_final_answer"</span>, final_answer_node) <span class="hljs-comment"># The node that synthesizes the final answer</span></span></pre><p id="ff24" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Now all our experts are in the room. The final and most critical step is to define the “wires” that connect them. This is where we use the <code class="de acj ack acl acb b">.add_edge()</code> and <code class="de acj ack acl acb b">.add_conditional_edges()</code> methods to define the flow of control.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="0626" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># The entry point of our graph is the "plan" node. Every run starts here.</span><br>graph.set_entry_point(<span class="hljs-string">"plan"</span>)<br><br><span class="hljs-comment"># After the "plan" node, we use our first conditional edge to decide which tool to use.</span><br>graph.add_conditional_edges(<br>    <span class="hljs-string">"plan"</span>,           <span class="hljs-comment"># The source node</span><br>    route_by_tool,    <span class="hljs-comment"># The function that makes the decision</span><br>    {                 <span class="hljs-comment"># A dictionary mapping the function's output string to the destination node</span><br>        <span class="hljs-string">"search_10k"</span>: <span class="hljs-string">"retrieve_10k"</span>,<br>        <span class="hljs-string">"search_web"</span>: <span class="hljs-string">"retrieve_web"</span>,<br>    },<br>)<br><br><span class="hljs-comment"># After retrieving from either the 10-K or the web, the flow is linear for a bit.</span><br>graph.add_edge(<span class="hljs-string">"retrieve_10k"</span>, <span class="hljs-string">"rerank"</span>) <span class="hljs-comment"># After internal retrieval, always go to rerank.</span><br>graph.add_edge(<span class="hljs-string">"retrieve_web"</span>, <span class="hljs-string">"rerank"</span>) <span class="hljs-comment"># After web retrieval, also always go to rerank.</span><br>graph.add_edge(<span class="hljs-string">"rerank"</span>, <span class="hljs-string">"compress"</span>)      <span class="hljs-comment"># After reranking, always go to compress.</span><br>graph.add_edge(<span class="hljs-string">"compress"</span>, <span class="hljs-string">"reflect"</span>)     <span class="hljs-comment"># After compressing, always go to reflect.</span><br><br><span class="hljs-comment"># After the "reflect" node, we hit our main conditional edge, which controls the reasoning loop.</span><br>graph.add_conditional_edges(<br>    <span class="hljs-string">"reflect"</span>,        <span class="hljs-comment"># The source node</span><br>    should_continue_node, <span class="hljs-comment"># The function that calls our Policy Agent</span><br>    {                 <span class="hljs-comment"># A dictionary mapping the decision to the next step</span><br>        <span class="hljs-string">"continue"</span>: <span class="hljs-string">"plan"</span>, <span class="hljs-comment"># If the decision is "continue", we loop back to the "plan" node to route the next step.</span><br>        <span class="hljs-string">"finish"</span>: <span class="hljs-string">"generate_final_answer"</span>, <span class="hljs-comment"># If the decision is "finish", we proceed to generate the final answer.</span><br>    },<br>)<br><br><span class="hljs-comment"># The "generate_final_answer" node is the last step before the end.</span><br>graph.add_edge(<span class="hljs-string">"generate_final_answer"</span>, END) <span class="hljs-comment"># After generating the answer, the graph concludes.</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"StateGraph constructed successfully."</span>)</span></pre><p id="add4" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is the blueprint of our agent’s brain. Let’s trace the flow:</p><ol class=""><li id="a3f0" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph="">It always starts at <code class="de acj ack acl acb b">plan</code>.</li><li id="cdd5" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">The <code class="de acj ack acl acb b">route_by_tool</code> conditional edge then acts as a switch, directing the flow to either <code class="de acj ack acl acb b">retrieve_10k</code> or <code class="de acj ack acl acb b">retrieve_web</code>.</li><li id="e7e7" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">Regardless of which retriever runs, the output is always funneled through the <code class="de acj ack acl acb b">rerank</code> -&gt; <code class="de acj ack acl acb b">compress</code> -&gt; <code class="de acj ack acl acb b">reflect</code> pipeline.</li><li id="f18d" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph="">This brings us to the most important part: the <code class="de acj ack acl acb b">should_continue_node</code> conditional edge. This is the heart of our cyclical reasoning.</li></ol><ul class=""><li id="4369" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph="">If the policy agent says <code class="de acj ack acl acb b">CONTINUE_PLAN</code>, the edge sends the workflow all the way back to the <code class="de acj ack acl acb b">plan</code> node. We go back to <code class="de acj ack acl acb b">plan</code> (instead of directly to the next retriever) so that <code class="de acj ack acl acb b">route_by_tool</code> can correctly route the <em class="adj">next</em> step in the plan.</li><li id="2828" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">If the policy agent says <code class="de acj ack acl acb b">FINISH</code>, the edge breaks the loop and sends the workflow to the <code class="de acj ack acl acb b">generate_final_answer</code> node.</li><li id="00fa" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">Finally, after the answer is generated, the graph terminates at <code class="de acj ack acl acb b">END</code>.</li></ul><p id="5394" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We have successfully defined the complete, complex, and cyclical architecture of our Deep Thinking Agent. The only thing left to do is to compile this blueprint into a runnable application and visualize it to see what we have built.</p><h2 id="1a37" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Compiling and Visualizing the Iterative Workflow</h2><p id="d169" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">With our graph fully wired, the final step in the assembly process is to <strong class="ov jg">compile</strong> it. The <code class="de acj ack acl acb b">.compile()</code> method takes our abstract definition of nodes and edges and turns it into a concrete, executable application.</p><p id="5eab" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We can then use a built-in LangGraph utility to generate a diagram of our graph. Visualizing the workflow is incredibly helpful for understanding and debugging complex agentic systems. It transforms our code into an intuitive flowchart that clearly shows the agent’s possible reasoning paths.</p><p id="2bb0" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">So, basically, we’re taking our blueprint and turning it into a real machine.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="21a0" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># The .compile() method takes our graph definition and creates a runnable object.</span><br>deep_thinking_rag_graph = graph.<span class="hljs-built_in">compile</span>()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Graph compiled successfully."</span>)<br><br><br><span class="hljs-comment"># Now, let's visualize the architecture we've built.</span><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> Image, display<br>    <span class="hljs-comment"># We can get a PNG image of the graph's structure.</span><br>    png_image = deep_thinking_rag_graph.get_graph().draw_png()<br>    <span class="hljs-comment"># Display the image in our notebook.</span><br>    display(Image(png_image))<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-comment"># This can fail if pygraphviz and its system dependencies are not installed.</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Graph visualization failed: <span class="hljs-subst">{e}</span>. Please ensure pygraphviz is installed."</span>)</span></pre><p id="37ec" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The <code class="de acj ack acl acb b">deep_thinking_rag_graph</code> object is now our fully functional agent. The visualization code then calls <code class="de acj ack acl acb b">.get_graph().draw_png()</code> to generate a visual representation of the state machine we have constructed.</p></div></div><div class="pm bi"><figure class="pn po pp pq pr pm bi paragraph-image"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*GDH6KmAvZyDgzi0UTa5f7A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*GDH6KmAvZyDgzi0UTa5f7A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*GDH6KmAvZyDgzi0UTa5f7A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*GDH6KmAvZyDgzi0UTa5f7A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*GDH6KmAvZyDgzi0UTa5f7A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*GDH6KmAvZyDgzi0UTa5f7A.png 1100w, https://miro.medium.com/v2/resize:fit:4800/format:webp/1*GDH6KmAvZyDgzi0UTa5f7A.png 4800w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 100vw" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*GDH6KmAvZyDgzi0UTa5f7A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*GDH6KmAvZyDgzi0UTa5f7A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*GDH6KmAvZyDgzi0UTa5f7A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*GDH6KmAvZyDgzi0UTa5f7A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*GDH6KmAvZyDgzi0UTa5f7A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*GDH6KmAvZyDgzi0UTa5f7A.png 1100w, https://miro.medium.com/v2/resize:fit:4800/1*GDH6KmAvZyDgzi0UTa5f7A.png 4800w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 100vw"><img alt="" class="bi gl ps c" width="2400" height="2842" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_GDH6KmAvZyDgzi0UTa5f7A.png"></picture><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Deep Thinking Simpler Pipeline Flow (Created by <span class="hl"><span class="bn" aria-describedby="130" aria-labelledby="130" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="ae37" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We can clearly see:</p><ul class=""><li id="e511" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph="">The initial branching logic where <code class="de acj ack acl acb b">route_by_tool</code> chooses between <code class="de acj ack acl acb b">retrieve_10k</code> and <code class="de acj ack acl acb b">retrieve_web</code>.</li><li id="2022" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">The linear processing pipeline for each research step (<code class="de acj ack acl acb b">rerank</code> -&gt; <code class="de acj ack acl acb b">compress</code> -&gt; <code class="de acj ack acl acb b">reflect</code>).</li><li id="4bfd" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">The crucial <strong class="ov jg">feedback loop</strong> where the <code class="de acj ack acl acb b">should_continue</code> edge sends the workflow back to the <code class="de acj ack acl acb b">plan</code> node to begin the next research cycle.</li><li id="fb60" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">The final “exit ramp” that leads to <code class="de acj ack acl acb b">generate_final_answer</code> once the research is complete.</li></ul><p id="3e19" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is the architecture of a system that can think. Now, let’s put it to the test.</p><h2 id="0094" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Running the Deep Thinking Pipeline</h2><p id="19ce" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">We have engineered a reasoning engine. Now it’s time to see if it can succeed where our baseline system so spectacularly failed.</p><p id="e8e8" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We will invoke our compiled <code class="de acj ack acl acb b">deep_thinking_rag_graph</code> with the exact same multi-hop, multi-source challenge query. We will use the <code class="de acj ack acl acb b">.stream()</code> method to get a real-time, step-by-step trace of the agent's execution, observing its "thought process" as it works through the problem.</p><p id="4d3f" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Here’s the plan for this section:</p><ul class=""><li id="d7c0" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Invoke the Graph:</strong> We’ll run our agent and watch as it executes its plan, switching between tools and building its research history.</li><li id="bad4" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Analyze the Final Output:</strong> We’ll examine the final, synthesized answer to see if it successfully integrated information from both the 10-K and the web.</li><li id="5fd4" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Compare the Results:</strong> We will do a final side-by-side comparison to definitively highlight the architectural advantages of our Deep Thinking agent.</li></ul><p id="a70f" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We will set up our initial input, which is just a dictionary containing the <code class="de acj ack acl acb b">original_question</code>, and then call the <code class="de acj ack acl acb b">.stream()</code> method. The <code class="de acj ack acl acb b">stream</code> method is fantastic for debugging and observation because it yields the state of the graph after each and every node completes its work.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="8b0d" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment"># This will hold the final state of the graph after the run is complete.</span><br>final_state = <span class="hljs-literal">None</span><br><span class="hljs-comment"># The initial input for our graph, containing the original user query.</span><br>graph_input = {<span class="hljs-string">"original_question"</span>: complex_query_adv}<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"--- Invoking Deep Thinking RAG Graph ---"</span>)<br><span class="hljs-comment"># We use .stream() to watch the agent's process in real-time.</span><br><span class="hljs-comment"># "values" mode means we get the full RAGState object after each step.</span><br><span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> deep_thinking_rag_graph.stream(graph_input, stream_mode=<span class="hljs-string">"values"</span>):<br>    <span class="hljs-comment"># The final chunk in the stream will be the terminal state of the graph.</span><br>    final_state = chunk<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Graph Stream Finished ---"</span>)</span></pre><p id="93d4" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This loop is where our agent comes to life. With each iteration, LangGraph executes the next node in the workflow, updates the <code class="de acj ack acl acb b">RAGState</code>, and yields the new state to us. The <code class="de acj ack acl acb b">rich</code> library <code class="de acj ack acl acb b">console.print</code> statements that we embedded inside our nodes will give us a running commentary of the agent's actions and decisions.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="6646" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br><br>--- Invoking Deep Thinking RAG Graph ---<br><br>--- 🧠: Generating Plan ---<br>plan:<br>  steps:<br>  - sub_question: What are the key risks related to competition as stated <span class="hljs-keyword">in</span> NVIDIA<span class="hljs-string">'s 2023 10-K filing?<br>    tool: search_10k<br>    ...<br>  - sub_question: What are the recent news and developments in AMD'</span>s AI chip strategy <span class="hljs-keyword">in</span> 2024?<br>    tool: search_web<br>    ...<br><br>--- 🔍: Retrieving from 10-K (Step 1: ...) ---<br>  Rewritten Query: key competitive risks <span class="hljs-keyword">for</span> NVIDIA <span class="hljs-keyword">in</span> the semiconductor industry...<br>  Supervisor Decision: Use `hybrid_search`. ...<br><br>--- 🎯: Reranking Documents ---<br>  Reranked to top 3 documents.<br><br>--- ✂️: Distilling Context ---<br>  Distilled Context Snippet: NVIDIA operates <span class="hljs-keyword">in</span> the intensely competitive semiconductor industry...<br><br>--- 🤔: Reflecting on Findings ---<br>  Summary: According to its 2023 10-K, NVIDIA operates <span class="hljs-keyword">in</span> an intensely competitive semiconductor industry...<br><br>--- 🚦: Evaluating Policy ---<br>  -&gt; Decision: CONTINUE_PLAN | Justification: The first step...has been completed. The next step...is still pending...<br><br>--- 🌐: Searching Web (Step 2: ...) ---<br>  Rewritten Query: AMD AI chip strategy news and developments 2024...<br><br>--- 🎯: Reranking Documents ---<br>  Reranked to top 3 documents.<br><br>--- ✂️: Distilling Context ---<br>  Distilled Context Snippet: AMD has ramped up its challenge to Nvidia <span class="hljs-keyword">in</span> the AI accelerator market with its Instinct MI300 series...<br><br>--- 🤔: Reflecting on Findings ---<br>  Summary: In 2024, AMD is aggressively competing with NVIDIA <span class="hljs-keyword">in</span> the AI chip market through its Instinct MI300X accelerator...<br><br>--- 🚦: Evaluating Policy ---<br>  -&gt; Decision: FINISH | Justification: The research <span class="hljs-built_in">history</span> now contains comprehensive summaries of both NVIDIA<span class="hljs-string">'s stated risks and AMD'</span>s recent strategy...<br><br>--- ✅: Generating Final Answer with Citations ---<br><br>--- Graph Stream Finished ---</span></pre><p id="131c" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">You can see the execution of our design. The agent:</p><ol class=""><li id="08a4" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Planned:</strong> It created the correct two-step, multi-tool plan.</li><li id="636d" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Executed Step 1:</strong> It used <code class="de acj ack acl acb b">search_10k</code>, ran it through the full retrieval funnel, and reflected on the findings.</li><li id="9b73" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Self-Critiqued:</strong> The policy agent saw the plan was not yet complete and decided to <code class="de acj ack acl acb b">CONTINUE_PLAN</code>.</li><li id="dcf7" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Executed Step 2:</strong> It correctly switched to the <code class="de acj ack acl acb b">search_web</code> tool, ran it through the same funnel, and reflected again.</li><li id="ac14" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Self-Critiqued Again:</strong> This time, the policy agent saw that all necessary information was gathered and correctly decided to <code class="de acj ack acl acb b">FINISH</code>.</li><li id="1e4c" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl qb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Synthesized:</strong> The workflow then proceeded to the <code class="de acj ack acl acb b">generate_final_answer</code> node.</li></ol><p id="b286" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The agent has successfully navigated the complex query. Now, let’s examine the final answer it produced.</p><h2 id="b8c7" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Analyzing the Final, High-Quality Answer</h2><p id="7040" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">The agent has completed its research. The <code class="de acj ack acl acb b">final_state</code> variable now holds the complete <code class="de acj ack acl acb b">RAGState</code>, including the <code class="de acj ack acl acb b">final_answer</code>. Let's print it out and see if it successfully synthesized the information from both sources into a single, analytical response, complete with citations.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="4b36" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph="">console.<span class="hljs-built_in">print</span>(<span class="hljs-string">"--- DEEP THINKING RAG FINAL ANSWER ---"</span>)<br>console.<span class="hljs-built_in">print</span>(Markdown(final_state[<span class="hljs-string">'final_answer'</span>]))</span></pre><pre class="ia aca acb acc bq acd bc bl"><span id="b41f" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>--- DEEP THINKING RAG FINAL ANSWER ---<br>Based on an analysis of NVIDIA<span class="hljs-string">'s 2023 10-K filing and recent news from 2024 regarding AMD'</span>s AI chip strategy, the following synthesis can be made:<br><br>**NVIDIA<span class="hljs-string">'s Stated Competitive Risks:**<br>In its 2023 10-K filing, NVIDIA identifies its operating environment as the "intensely competitive" semiconductor industry, which is characterized by rapid technological change. A primary risk is that competitors, including AMD, could introduce new products with better performance or lower costs that gain significant market acceptance, which could materially and adversely affect its business [Source: Item 1A. Risk Factors.].<br><br>**AMD'</span>s 2024 AI Chip Strategy:**<br>In 2024, AMD has moved aggressively to challenge NVIDIA<span class="hljs-string">'s dominance in the AI hardware market with its Instinct MI300 series of accelerators, particularly the MI300X. This product is designed to compete directly with NVIDIA'</span>s H100 GPU. AMD<span class="hljs-string">'s strategy has gained significant traction, with major cloud providers such as Microsoft Azure and Oracle announcing plans to use the new chips [Source: https://www.reuters.com/technology/amd-forecasts-35-billion-ai-chip-revenue-2024-2024-01-30/].<br><br>**Synthesis and Impact:**<br>AMD'</span>s 2024 AI chip strategy directly exacerbates the competitive risks outlined <span class="hljs-keyword">in</span> NVIDIA<span class="hljs-string">'s 10-K. The successful launch and adoption of the MI300X is a materialization of the specific risk that a competitor could introduce a product with comparable performance. The adoption of AMD'</span>s chips by major cloud providers signifies a direct challenge to NVIDIA<span class="hljs-string">'s market share in the lucrative data center segment, validating NVIDIA'</span>s stated concerns about rapid technological change [Source: Item 1A. Risk Factors. and https://www.cnbc.com/2023/12/06/amd-launches-new-mi300x-ai-chip-to-compete-with-nvidias-h100.html].</span></pre><p id="bfac" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This is a complete success. The answer is a deep list of analysis.</p><ul class=""><li id="7f5e" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph="">It correctly summarizes the risks from the 10-K.</li><li id="54e9" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">It correctly summarizes the AMD news from the web search.</li><li id="cc7b" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">Crucially, in the “Synthesis and Impact” section, it performs the multi-hop reasoning required by the original query, explaining <em class="adj">how</em> the latter exacerbates the former.</li><li id="bd2f" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">Finally, it provides correct <strong class="ov jg">provenance</strong>, with citations pointing to both the internal document section and the external web URLs.</li></ul><h2 id="ea93" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Side by Side Comparison</h2><p id="965a" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">Let’s put the two results side-by-side to make the difference crystal clear.</p><figure class="pn po pp pq pr pm"><div class="aef ga m fr"><div class="aeg aeh m"></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb">Comparison Table (Created by <span class="hl"><span class="bn" aria-describedby="131" aria-labelledby="131" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure><p id="2a8d" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">This comparison provides the definitive conclusion. The architectural shift to a cyclical, tool-aware, and self-critiquing agent results in a dramatic and measurable improvement in performance on complex, real-world queries.</p><h2 id="c905" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Evaluation Framework and Analyzing Results</h2><p id="cead" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">So, we have seen our advanced agent succeed anecdotally on one very hard query. But in a production environment, we need more than just a single success story. We need objective, quantitative, and automated validation.</p></div></div><div class="pm"><div class="ac ci"><div class="nw rv nx ru ny acm cm acn cn aco cp bi"><figure class="pn po pp pq pr pm acq acr paragraph-image"><div role="button" tabindex="0" class="acs act fr acu bi acv"><span class="fw fx fy ao fz ga gb gc gd speechify-ignore">Press enter or click to view image in full size</span><div class="pv pw aei"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*wg7_od82i8wPOs3NN8oLtg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*wg7_od82i8wPOs3NN8oLtg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*wg7_od82i8wPOs3NN8oLtg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*wg7_od82i8wPOs3NN8oLtg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*wg7_od82i8wPOs3NN8oLtg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*wg7_od82i8wPOs3NN8oLtg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/format:webp/1*wg7_od82i8wPOs3NN8oLtg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*wg7_od82i8wPOs3NN8oLtg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*wg7_od82i8wPOs3NN8oLtg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*wg7_od82i8wPOs3NN8oLtg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*wg7_od82i8wPOs3NN8oLtg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*wg7_od82i8wPOs3NN8oLtg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*wg7_od82i8wPOs3NN8oLtg.png 1100w, https://miro.medium.com/v2/resize:fit:2000/1*wg7_od82i8wPOs3NN8oLtg.png 2000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 1000px"><img alt="" class="bi gl ps c" width="1000" height="335" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_wg7_od82i8wPOs3NN8oLtg.png"></picture></div></div><figcaption class="pt fm pu pv pw px py bg b bh ab eb" data-selectable-paragraph="">Evaluation Framework (Created by <span class="hl"><span class="bn" aria-describedby="132" aria-labelledby="132" role="tooltip"><div tabindex="-1" class="bf"><a class="pz qa fl" href="https://medium.com/u/b856005e5ecd?source=post_page---user_mention--af69c5e044db---------------------------------------" rel="noopener" target="_blank">Fareed Khan</a></div></span></span>)</figcaption></figure></div></div></div><div class="ac ci"><div class="cp bi ij ik il im"><p id="e47c" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">To achieve this, we will now build a rigorous evaluation framework using the <strong class="ov jg">RAGAs</strong> (RAG Assessment) library. We will focus on four critical metrics provided by RAGAs:</p><ul class=""><li id="4486" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Context Precision &amp; Recall:</strong> These measure the quality of our retrieval pipeline. <strong class="ov jg">Precision</strong> asks, “Of the documents we retrieved, how many were actually relevant?” (Signal vs. Noise). <strong class="ov jg">Recall</strong> asks, “Of all the relevant documents that exist, how many did we actually find?” (Completeness).</li><li id="aabe" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Answer Faithfulness:</strong> This measures whether the generated answer is grounded in the provided context, acting as our primary check against LLM hallucination.</li><li id="e1ea" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Answer Correctness:</strong> This is the ultimate measure of quality. It compares the generated answer to a manually crafted “ground truth” answer to assess its factual accuracy and completeness.</li></ul><p id="9e1e" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">So, basically, to run a RAGAs evaluation, we need to prepare a dataset. This dataset will contain our challenge query, the answers generated by both our baseline and advanced pipelines, the respective contexts they used, and a “ground truth” answer that we’ll write ourselves to serve as the ideal response.</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="605a" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> Dataset <span class="hljs-comment"># From the Hugging Face datasets library, which RAGAs uses</span><br><span class="hljs-keyword">from</span> ragas <span class="hljs-keyword">import</span> evaluate<br><span class="hljs-keyword">from</span> ragas.metrics <span class="hljs-keyword">import</span> (<br>    context_precision,<br>    context_recall,<br>    faithfulness,<br>    answer_correctness,<br>)<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Preparing evaluation dataset..."</span>)<br><br><span class="hljs-comment"># This is our manually crafted, ideal answer to the complex query.</span><br>ground_truth_answer_adv = <span class="hljs-string">"NVIDIA's 2023 10-K lists intense competition and rapid technological change as key risks. This risk is exacerbated by AMD's 2024 strategy, specifically the launch of the MI300X AI accelerator, which directly competes with NVIDIA's H100 and has been adopted by major cloud providers, threatening NVIDIA's market share in the data center segment."</span><br><br><span class="hljs-comment"># We need to re-run the retriever for the baseline model to get its context for the evaluation.</span><br>retrieved_docs_for_baseline_adv = baseline_retriever.invoke(complex_query_adv)<br>baseline_contexts = [[doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> retrieved_docs_for_baseline_adv]]<br><br><span class="hljs-comment"># For the advanced agent, we'll consolidate all the documents it retrieved across all research steps.</span><br>advanced_contexts_flat = []<br><span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> final_state[<span class="hljs-string">'past_steps'</span>]:<br>    advanced_contexts_flat.extend([doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> step[<span class="hljs-string">'retrieved_docs'</span>]])<br><br><span class="hljs-comment"># We use a set to remove any duplicate documents for a cleaner evaluation.</span><br>advanced_contexts = [<span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(advanced_contexts_flat))]<br><br><span class="hljs-comment"># Now, we construct the dictionary that will be turned into our evaluation dataset.</span><br>eval_data = {<br>    <span class="hljs-string">'question'</span>: [complex_query_adv, complex_query_adv], <span class="hljs-comment"># The same question for both systems</span><br>    <span class="hljs-string">'answer'</span>: [baseline_result, final_state[<span class="hljs-string">'final_answer'</span>]], <span class="hljs-comment"># The answers from each system</span><br>    <span class="hljs-string">'contexts'</span>: baseline_contexts + advanced_contexts, <span class="hljs-comment"># The contexts each system used</span><br>    <span class="hljs-string">'ground_truth'</span>: [ground_truth_answer_adv, ground_truth_answer_adv] <span class="hljs-comment"># The ideal answer</span><br>}<br><br><span class="hljs-comment"># Create the Hugging Face Dataset object.</span><br>eval_dataset = Dataset.from_dict(eval_data)<br><br><span class="hljs-comment"># Define the list of metrics we want to compute.</span><br>metrics = [<br>    context_precision,<br>    context_recall,<br>    faithfulness,<br>    answer_correctness,<br>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Running RAGAs evaluation..."</span>)<br><br><span class="hljs-comment"># Run the evaluation. RAGAs will call an LLM to perform the scoring for each metric.</span><br>result = evaluate(eval_dataset, metrics=metrics, is_async=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"Evaluation complete."</span>)<br><br><span class="hljs-comment"># Format the results into a clean pandas DataFrame for easy comparison.</span><br>results_df = result.to_pandas()<br>results_df.index = [<span class="hljs-string">'baseline_rag'</span>, <span class="hljs-string">'deep_thinking_rag'</span>]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- RAGAs Evaluation Results ---"</span>)<br><span class="hljs-built_in">print</span>(results_df[[<span class="hljs-string">'context_precision'</span>, <span class="hljs-string">'context_recall'</span>, <span class="hljs-string">'faithfulness'</span>, <span class="hljs-string">'answer_correctness'</span>]].T)</span></pre><p id="9729" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">We are setting up a formal experiment. We gather all the necessary artifacts for our single, hard query: the question, the two different answers, the two different sets of context, and our ideal ground truth. We then feed this neatly packaged <code class="de acj ack acl acb b">eval_dataset</code> to the <code class="de acj ack acl acb b">ragas.evaluate</code> function.</p><p id="f7c9" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">Behind the scenes, RAGAs makes a series of LLM calls, asking it to act as a judge. For example, for <code class="de acj ack acl acb b">faithfulness</code>, it will ask, "Is this answer fully supported by this context?" For <code class="de acj ack acl acb b">answer_correctness</code>, it will ask …</p><blockquote class="abl"><p id="fad4" class="abm abn jf bg abo abp abq abr abs abt abu pl eb" data-selectable-paragraph="">How factually similar is this answer to this ground truth answer?</p></blockquote><p id="1d8d" class="pw-post-body-paragraph ot ou jf ov b jz abv ox oy kc abw pa pb hb abx pd pe he aby pg ph hh abz pj pk pl id bl" data-selectable-paragraph="">We can look at the numerical scores …</p><pre class="pn po pp pq pr aca acb acc bq acd bc bl"><span id="70f4" class="ace zo jf acb b bh acf acg m ach aci" data-selectable-paragraph=""><span class="hljs-comment">#### OUTPUT ####</span><br>Preparing evaluation dataset...<br>Running RAGAs evaluation...<br>Evaluation complete.<br><br><br>--- RAGAs Evaluation Results ---<br>                     baseline_rag  deep_thinking_rag<br>context_precision        0.500000           0.890000<br>context_recall           0.333333           1.000000<br>faithfulness             1.000000           1.000000<br>answer_correctness       0.395112           0.991458</span></pre><p id="ec1e" class="pw-post-body-paragraph ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl id bl" data-selectable-paragraph="">The quantitative results provide a definitive and objective verdict on the superiority of the Deep Thinking architecture.</p><ul class=""><li id="4f90" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Context Precision (0.50 vs 0.89):</strong> The baseline’s context was only half-relevant, as it could only retrieve general information about competition. The advanced agent’s multi-step, multi-tool retrieval achieved a perfect precision score.</li><li id="4316" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Context Recall (0.33 vs 1.00):</strong> The baseline retriever completely missed the crucial information from the web, resulting in a very low recall score. The advanced agent’s planning and tool-use ensured all necessary information was found, achieving perfect recall.</li><li id="2e86" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Faithfulness (1.00 vs 1.00):</strong> Both systems were highly faithful. The baseline correctly stated it didn’t have the information, and the advanced agent correctly used the information it found. This is a good sign for both, but faithfulness without correctness is not useful.</li><li id="0a00" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Answer Correctness (0.40 vs 0.99):</strong> This is the ultimate measure of quality. The baseline’s answer was less than 40% correct because it was missing the entire second half of the required analysis. The advanced agent’s answer was nearly perfect.</li></ul><h2 id="e308" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Summarizing Our Entire Pipeline</h2><p id="da85" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">In this guide, we have gone on a complete architecture from a simple, brittle RAG pipeline to a sophisticated autonomous reasoning agent.</p><ul class=""><li id="be10" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph="">We started by building a <strong class="ov jg">vanilla RAG system</strong> and demonstrated its predictable failure on a complex, multi-source query.</li><li id="8086" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">We then systematically engineered a <strong class="ov jg">Deep Thinking Agent</strong>, equipping it with the ability to plan, use multiple tools, and adapt its retrieval strategy.</li><li id="6ec9" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">We built a <strong class="ov jg">multi-stage retrieval funnel</strong> that moves from broad recall (with hybrid search) to high precision (with a cross-encoder reranker) and finally to synthesis (with a distiller agent).</li><li id="ecb8" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">We orchestrated this entire cognitive architecture using <strong class="ov jg">LangGraph</strong>, creating a cyclical, stateful workflow that enables true multi-step reasoning.</li><li id="b4b7" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">We implemented a <strong class="ov jg">self-critique loop</strong>, allowing the agent to recognize failure, revise its own plan, and exit gracefully when an answer cannot be found.</li><li id="87fe" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph="">Finally, we validated our success with a <strong class="ov jg">production-grade evaluation</strong>, using RAGAs to provide objective, quantitative proof of the advanced agent’s superiority.</li></ul><h2 id="7840" class="zn zo jf bg zp sl zq kb gy sm zr ke ha sn zs so sp sq zt sr ss st zu su sv zv bl" data-selectable-paragraph="">Learned Policies with Markov Decision Processes (MDP)</h2><p id="e028" class="pw-post-body-paragraph ot ou jf ov b jz zw ox oy kc zx pa pb hb zy pd pe he zz pg ph hh aba pj pk pl id bl" data-selectable-paragraph="">Our agent have the Policy Agent that decides to <code class="de acj ack acl acb b">CONTINUE</code> or <code class="de acj ack acl acb b">FINISH</code>currently relies on an expensive, general-purpose LLM like GPT-4o for every single decision. While effective, this can be slow and costly in a production environment. The academic frontier offers a more optimized path forward.</p><ul class=""><li id="d375" class="ot ou jf ov b jz ow ox oy kc oz pa pb hb pc pd pe he pf pg ph hh pi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">RAG as a Decision Process:</strong> We can frame our agent’s reasoning loop as a <strong class="ov jg">Markov Decision Process (MDP)</strong>. In this model, each <code class="de acj ack acl acb b">RAGState</code> is a "state," and each action (<code class="de acj ack acl acb b">CONTINUE</code>, <code class="de acj ack acl acb b">REVISE</code>, <code class="de acj ack acl acb b">FINISH</code>) leads to a new state with a certain reward (e.g., finding the right answer).</li><li id="795d" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Learning from Experience:</strong> The thousands of successful and unsuccessful reasoning traces we log in <strong class="ov jg">LangSmith</strong> are invaluable training data. Each trace is an example of the agent navigating this MDP.</li><li id="dd74" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">Training a Policy Model:</strong> Using this data, we could apply <strong class="ov jg">Reinforcement Learning</strong> to train a much smaller, specialized <strong class="ov jg">policy model</strong>.</li><li id="f145" class="ot ou jf ov b jz qe ox oy kc qf pa pb hb qg pd pe he qh pg ph hh qi pj pk pl abb qc qd bl" data-selectable-paragraph=""><strong class="ov jg">The Goal: Speed and Efficiency:</strong> The goal would be to distill the complex reasoning of a model like GPT-4o into a compact, fine-tuned model (e.g., a 7B parameter model). This learned policy could make the <code class="de acj ack acl acb b">CONTINUE</code>/<code class="de acj ack acl acb b">FINISH</code> decision much faster and more cheaply, while being highly optimized for our specific domain. This is the core idea behind advanced research papers like DeepRAG and represents the next level of optimization for autonomous RAG systems.</li></ul><blockquote class="abl"><p id="0fac" class="abm abn jf bg abo abp acy acz ada adb adc pl eb" data-selectable-paragraph="">You can <a class="ah ib" href="https://medium.com/@fareedkhandev" rel="noopener">follow me on Medium</a> if you find this article useful</p></blockquote></div></div></div></div></section></div></div></article></div><div class="ac ci"><div class="cp bi ij ik il im"><div class="aej aek ac lk"><div class="sd ac"><a class="yb ak ao aq" href="https://medium.com/tag/ai?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><div class="tf fr de ael io aem aen bg b bh ab bl gc">AI</div></a></div><div class="sd ac"><a class="yb ak ao aq" href="https://medium.com/tag/artificial-intelligence?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><div class="tf fr de ael io aem aen bg b bh ab bl gc">Artificial Intelligence</div></a></div><div class="sd ac"><a class="yb ak ao aq" href="https://medium.com/tag/data-science?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><div class="tf fr de ael io aem aen bg b bh ab bl gc">Data Science</div></a></div><div class="sd ac"><a class="yb ak ao aq" href="https://medium.com/tag/machine-learning?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><div class="tf fr de ael io aem aen bg b bh ab bl gc">Machine Learning</div></a></div><div class="sd ac"><a class="yb ak ao aq" href="https://medium.com/tag/python?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><div class="tf fr de ael io aem aen bg b bh ab bl gc">Python</div></a></div></div></div></div><div class="m"></div><footer class="qj qk ql qm qn ac r qo qp c"><div class="m ag"><div class="ac ci"><div class="cp bi ij ik il im"><div class="ac cw qq"><div class="ac r mt"><div class="qr m"><span class="m qs qt qu f e"><div class="ac r mt mu"><div class="pw-multi-vote-icon fr mv mw mx my"><span data-dd-action-name="Susi presentation tracker clap_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fgitconnected%2Faf69c5e044db&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;user=Fareed+Khan&amp;userId=b856005e5ecd&amp;source=---footer_actions--af69c5e044db---------------------clap_footer------------------" rel="noopener follow"><div><div class="bn" role="tooltip" aria-describedby="10" aria-labelledby="10"><div tabindex="-1" class="bf"><div class="mz aq na nb nc nd ao ne nf ng my" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></div></a></span></div><div class="pw-multi-vote-count m nh ni nj nk nl nm nn"><div><div class="bn" aria-describedby="61" aria-labelledby="61" role="tooltip"><div tabindex="-1" class="bf"><p class="bg b ec ab eb"><button class="ah ai aj fo al am an ao ap aq ar as at au av wl nv">1.7K<span class="m i h g qv qw"></span></button></p></div></div></div></div></div></span><span class="m i h g qv qw"><div class="ac r mt mu"><div class="pw-multi-vote-icon fr mv mw mx my"><span data-dd-action-name="Susi presentation tracker clap_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fgitconnected%2Faf69c5e044db&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;user=Fareed+Khan&amp;userId=b856005e5ecd&amp;source=---footer_actions--af69c5e044db---------------------clap_footer------------------" rel="noopener follow"><div><div class="bn" role="tooltip" aria-describedby="11" aria-labelledby="11"><div tabindex="-1" class="bf"><div class="mz aq na nb nc nd ao ne nf ng my" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></div></a></span></div><div class="pw-multi-vote-count m nh ni nj nk nl nm nn"><div><div class="bn" aria-describedby="63" aria-labelledby="63" role="tooltip"><div tabindex="-1" class="bf"><p class="bg b ec ab eb"><button class="ah ai aj fo al am an ao ap aq ar as at au av wl nv">1.7K</button></p></div></div></div></div></div></span></div><div class="az ac"><div><div class="bn" role="tooltip" aria-describedby="12" aria-labelledby="12"><div tabindex="-1" class="bf"><button class="aq mz nq nr ac r fs ns nt" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="jw"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bg b bh ab eb"><span class="pw-responses-count np jw">18</span></p></button></div></div></div></div></div><div class="ac r"><div class="qx m cb"><div><div class="bn" role="tooltip" aria-describedby="13" aria-labelledby="13"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-testid="footerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Faf69c5e044db&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;source=---footer_actions--af69c5e044db---------------------bookmark_footer------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div><div class="qx m cb"><div class="bn" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bn" role="tooltip" aria-describedby="14" aria-labelledby="14"><div tabindex="-1" class="bf"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="footerSocialShareButton" class="ah fs aj fo al am an ob ap aq ar fe oc od nt oe"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div></div></footer><div class="qy m"><div class="ac ci"><div class="cp bi ij ik il im"><div class="qz m"><div class="ac kx kv kt ra rb"><div class="rc rd re rf rg rh ri rj rk rl ac cw"><div class="i l"><a href="https://levelup.gitconnected.com/?source=post_page---post_publication_info--af69c5e044db---------------------------------------" rel="noopener follow"><div class="fr"><img alt="Level Up Coding" class="de hw m rn rm" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_5D9oYBd58pyjMkV_5-zXXQ(1).jpg" width="48" height="48" loading="lazy"><div class="hw m rm rn fw o gj hz"></div></div></a></div><div class="k j e"><a href="https://levelup.gitconnected.com/?source=post_page---post_publication_info--af69c5e044db---------------------------------------" rel="noopener follow"><div class="fr"><img alt="Level Up Coding" class="de hw m rp ro" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_5D9oYBd58pyjMkV_5-zXXQ(2).jpg" width="64" height="64" loading="lazy"><div class="hw m ro rp fw o gj hz"></div></div></a></div><div class="k j e rq cb"><div class="ac"><button style="border: 1px solid rgb(36, 36, 36);" class="th uc aq ac ci r ud ms ue"><span class="bg b bh ab bl bi"><span class="bn uf">Follow</span></span></button></div></div></div><div class="ac cv cd"><div class="rr rs rt ru rv m"><a class="ah ai aj al am an ao ap aq ar as at au av ac r" href="https://levelup.gitconnected.com/?source=post_page---post_publication_info--af69c5e044db---------------------------------------" rel="noopener follow"><h2 class="pw-author-name bg gw rx ry rz sa sb sc hb hc hd he hf hg hh hi hj bl"><span class="id rw">Published in <!-- -->Level Up Coding</span></h2></a><div class="sd ac kz"><div class="m cb"><span class="pw-follower-count bg b bh ab eb"><a class="ah ai aj fo al am an ao ap aq ar as at li" rel="noopener follow" href="https://levelup.gitconnected.com/followers?source=post_page---post_publication_info--af69c5e044db---------------------------------------" data-discover="true">279K followers</a></span></div><div class="bg b bh ab eb ac se"><span class="hk m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span><a class="ah ai aj fo al am an ao ap aq ar as at li" rel="noopener follow" href="https://levelup.gitconnected.com/i-tried-everything-to-fix-rag-hallucinations-then-i-found-this-e27105c41d2a?source=post_page---post_publication_info--af69c5e044db---------------------------------------" data-discover="true">Last published&nbsp;<!-- -->1 day ago</a></div></div><div class="ia m"><p class="bg b bh ab bl">Coding tutorials and news. The developer homepage <a class="ah ai aj fo al am an ao ap aq ar as at ib ic id" href="http://gitconnected.com/" rel="noopener  ugc nofollow">gitconnected.com</a> &amp;&amp; <a class="ah ai aj fo al am an ao ap aq ar as at ib ic id" href="http://skilled.dev/" rel="noopener  ugc nofollow">skilled.dev</a> &amp;&amp; <a class="ah ai aj fo al am an ao ap aq ar as at ib ic id" href="http://levelup.dev/" rel="noopener  ugc nofollow">levelup.dev</a></p></div></div></div><div class="i l"><div class="ac"><button style="border: 1px solid rgb(36, 36, 36);" class="th uc aq ac ci r ud ms ue"><span class="bg b bh ab bl bi"><span class="bn uf">Follow</span></span></button></div></div></div></div><div class="ac kx kv kt ra rb"><div class="rc rd re rf rg rh ri rj rk rl ac cw"><div class="i l"><a tabindex="0" href="https://medium.com/@fareedkhandev?source=post_page---post_author_info--af69c5e044db---------------------------------------" rel="noopener follow"><div class="m fr"><img alt="Fareed Khan" class="m fk by rm rn de" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_feiUXOR8sid6IPHSHufA-g(1).jpg" width="48" height="48" loading="lazy"><div class="gj by m rm rn fw o ak hz"></div></div></a></div><div class="k j e"><a tabindex="0" href="https://medium.com/@fareedkhandev?source=post_page---post_author_info--af69c5e044db---------------------------------------" rel="noopener follow"><div class="m fr"><img alt="Fareed Khan" class="m fk by ro rp de" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_feiUXOR8sid6IPHSHufA-g(2).jpg" width="64" height="64" loading="lazy"><div class="gj by m ro rp fw o ak hz"></div></div></a></div><div class="k j e rq cb"><div class="ac"><button class="th uc aq ac ci r ud ms ue" style="border: 1px solid rgb(36, 36, 36);"><span class="bg b bh ab bl bi"><span class="bn uf">Follow</span></span></button></div></div></div><div class="ac cv cd"><div class="rr rs rt ru rv m"><a class="ah ai aj al am an ao ap aq ar as at au av ac r" href="https://medium.com/@fareedkhandev?source=post_page---post_author_info--af69c5e044db---------------------------------------" rel="noopener follow"><h2 class="pw-author-name bg gw rx ry rz sa sb sc hb hc hd he hf hg hh hi hj bl"><span class="id rw">Written by <!-- -->Fareed Khan</span></h2></a><div class="sd ac kz"><div class="m cb"><span class="pw-follower-count bg b bh ab eb"><a class="ah ai aj fo al am an ao ap aq ar as at li" href="https://medium.com/@fareedkhandev/followers?source=post_page---post_author_info--af69c5e044db---------------------------------------" rel="noopener follow">62K followers</a></span></div><div class="bg b bh ab eb ac se"><span class="hk m" aria-hidden="true"><span class="bg b bh ab eb">·</span></span><a class="ah ai aj fo al am an ao ap aq ar as at li" href="https://medium.com/@fareedkhandev/following?source=post_page---post_author_info--af69c5e044db---------------------------------------" rel="noopener follow">1 following</a></div></div><div class="ia m"><p class="bg b bh ab bl">I write on AI, <a class="ah ai aj fo al am an ao ap aq ar as at ib ic id" href="https://www.linkedin.com/in/fareed-khan-dev/" rel="noopener  ugc nofollow">https://www.linkedin.com/in/fareed-khan-dev/</a></p></div></div></div><div class="i l"><div class="ac"><button class="th uc aq ac ci r ud ms ue" style="border: 1px solid rgb(36, 36, 36);"><span class="bg b bh ab bl bi"><span class="bn uf">Follow</span></span></button></div></div></div></div></div></div><div class="sf sg sh si sj m"><div class="sk bi s qy"></div><div class="ac ci"><div class="cp bi ij ik il im"><div class="ac r cw"><h2 class="bg gw sl kb gy sm ke ha sn so sp sq sr ss st su sv bl">Responses (<!-- -->18<!-- -->)</h2><div class="ac sw"><div><div class="bn" role="tooltip" aria-describedby="15" aria-labelledby="15"><div tabindex="-1" class="bf"><a class="sx sy" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page---post_responses--af69c5e044db---------------------------------------" rel="noopener follow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" aria-label="Shield with a checkmark" viewBox="0 0 25 25"><path fill-rule="evenodd" d="M11.987 5.036a.754.754 0 0 1 .914-.01c.972.721 1.767 1.218 2.6 1.543.828.322 1.719.485 2.887.505a.755.755 0 0 1 .741.757c-.018 3.623-.43 6.256-1.449 8.21-1.034 1.984-2.662 3.209-4.966 4.083a.75.75 0 0 1-.537-.003c-2.243-.874-3.858-2.095-4.897-4.074-1.024-1.951-1.457-4.583-1.476-8.216a.755.755 0 0 1 .741-.757c1.195-.02 2.1-.182 2.923-.503.827-.322 1.6-.815 2.519-1.535m.468.903c-.897.69-1.717 1.21-2.623 1.564-.898.35-1.856.527-3.026.565.037 3.45.469 5.817 1.36 7.515.884 1.684 2.25 2.762 4.284 3.571 2.092-.81 3.465-1.89 4.344-3.575.886-1.698 1.299-4.065 1.334-7.512-1.149-.039-2.091-.217-2.99-.567-.906-.353-1.745-.873-2.683-1.561m-.009 9.155a2.672 2.672 0 1 0 0-5.344 2.672 2.672 0 0 0 0 5.344m0 1a3.672 3.672 0 1 0 0-7.344 3.672 3.672 0 0 0 0 7.344m-1.813-3.777.525-.526.916.917 1.623-1.625.526.526-2.149 2.152z" clip-rule="evenodd"></path></svg></a></div></div></div></div></div><div class="sz gn ta tb tc td te m"><div><div class="bg b bh ab bl"><div class="hn"><div class="vp m"><div class="vq ac r"><div class="m fr"><img alt="" class="m fk by bz ca de" width="32" height="32" loading="lazy" role="presentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_dmbNkD5D-u45r44go_cf0g(1).png"><div class="gj by m bz ca fw o ak hz"></div></div><div class="bo ac cu cv ci"><p class="bg b bh ab eb">Write a response</p></div></div><div class="de bq ac cv vi vj"><div class="ac cv fr"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db&amp;source=---post_responses--af69c5e044db---------------------respond_sidebar------------------" rel="noopener follow"><div class="vr m"><p class="bg b bh ab eb">What are your thoughts?</p></div></a></span><div class="cw vk eb ac vl ht vm"><span class="bg b bh ab eb"><div class="ac"><div><div class="bn" aria-describedby="32" aria-labelledby="32" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Bold (⌘B)" class="vs vt vu vv bq ix ci vw vx vy" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M10.308 17.993h-5.92l.11-.894.783-.12c.56-.11.79-.224.79-.448V5.37c0-.225-.113-.336-.902-.448H4.5l-.114-.894h6.255c4.02 0 5.58 1.23 5.58 3.13 0 1.896-1.78 3.125-3.79 3.463v.11c2.69.34 4.25 1.56 4.25 3.57 0 2.35-2.01 3.69-6.37 3.69l.02.01h-.02zm-.335-12.96H8.967V10.5h1.23c1.788 0 2.79-1.23 2.79-2.683 0-1.685-1.004-2.803-3.006-2.803v.02zm-.223 6.36h-.783v5.588l1.225.23h.22c1.67 0 3.01-1.004 3.01-2.792 0-2.122-1.566-3.016-3.69-3.016h.018z"></path></svg></span></div></div></div><div><div class="bn" aria-describedby="33" aria-labelledby="33" role="tooltip"><div tabindex="-1" class="bf"><span role="button" aria-label="Italic (⌘I)" class="vs vt vu vv bq ix ci vw vx vy" tabindex="0"><svg width="21" height="21"><path fill-rule="evenodd" d="M9.847 18.04c-.533 0-2.027-.64-1.92-.853l2.027-7.68-.64-.214-1.387 1.494-.427-.427c.534-1.173 1.707-2.667 2.774-2.667.533 0 2.24.534 2.133.854l-2.133 7.786.533.214 1.6-1.067.427.427c-.64 1.066-1.92 2.133-2.987 2.133m2.347-11.733c-.96 0-1.387-.64-1.387-1.387 0-1.067.747-1.92 1.493-1.92.854 0 1.387.64 1.387 1.493-.107 1.067-.747 1.814-1.493 1.814"></path></svg></span></div></div></div></div></span><div class="vn rq ac vl ht vm"><div class="vo"><button class="bg b ec ab bl vz tg th ti nv ns tj fc fd fe tk tl tm fh fi fj fk bn fl fm" data-testid="CancelResponseButton">Cancel</button></div><button class="bg b ec ab wa vz wb wc wd we tj fc fd wf wg wh fh fi fj fk bn fl fm" disabled="" data-testid="ResponseRespondButton">Respond</button></div></div></div></div></div></div></div></div></div><div class="gn m"><div class="bi ed"><div class="aer aes m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="166" aria-labelledby="166" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/@mg9189b?source=post_page---post_responses--af69c5e044db----0-----------------------------------" rel="noopener follow"><div class="m fr"><div class="m fr"><img alt="Michael Gordon" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/0_0ArBVDw5lRifMoKT.png"><div class="gj by m bz ca fw o ak gk"></div></div><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="none" viewBox="0 0 40 40" role="presentation" aria-hidden="true" focusable="false" class="fw aet aeu do nu"><mask id="path-1-outside-1_5853_41067" width="38" height="38" x="1" y="1" fill="#000" maskUnits="userSpaceOnUse"><path fill="#fff" d="M1 1h38v38H1z"></path><path d="m24.7 25.435-3.552 9.767a1.224 1.224 0 0 1-2.296 0L15.3 25.435a1.24 1.24 0 0 0-.735-.735L4.8 21.148a1.225 1.225 0 0 1 0-2.296l9.766-3.552a1.24 1.24 0 0 0 .735-.735L18.852 4.8a1.224 1.224 0 0 1 2.296 0l3.552 9.766a1.24 1.24 0 0 0 .735.735l9.767 3.552a1.224 1.224 0 0 1 0 2.296L25.435 24.7a1.24 1.24 0 0 0-.735.735"></path></mask><path fill="#FFC017" d="m24.7 25.435-3.552 9.767a1.224 1.224 0 0 1-2.296 0L15.3 25.435a1.24 1.24 0 0 0-.735-.735L4.8 21.148a1.225 1.225 0 0 1 0-2.296l9.766-3.552a1.24 1.24 0 0 0 .735-.735L18.852 4.8a1.224 1.224 0 0 1 2.296 0l3.552 9.766a1.24 1.24 0 0 0 .735.735l9.767 3.552a1.224 1.224 0 0 1 0 2.296L25.435 24.7a1.24 1.24 0 0 0-.735.735"></path><path fill="#fff" d="m21.148 35.202 2.813 1.043.007-.018zm-2.296 0-2.82 1.025.007.018zM15.3 25.435l2.82-1.026-.005-.012zm-.735-.735 1.038-2.815-.012-.005zM4.8 21.148l-1.044 2.813.018.007zm0-2.296-1.026-2.82-.018.007zm9.766-3.552 1.026 2.82.012-.005zm.735-.735 2.815 1.038.005-.012zM18.852 4.8l-2.813-1.044-.007.018zM20 4v3zm1.148.799 2.82-1.026-.007-.018zm3.552 9.766-2.82 1.026.005.012zm.735.735-1.038 2.815.012.005zm9.767 3.552 1.043-2.813-.018-.007zm0 2.296 1.025 2.82.018-.007zM25.435 24.7l-1.026-2.82-.012.005zm-3.555-.29-3.551 9.766 5.639 2.05 3.551-9.766zm-3.544 9.747c.126-.34.353-.632.65-.84l3.426 4.927a4.22 4.22 0 0 0 1.549-1.999zm.65-.84A1.78 1.78 0 0 1 20 33v6c.862 0 1.704-.264 2.412-.756zM20 33c.362 0 .716.11 1.014.318l-3.426 4.926c.708.492 1.55.756 2.412.756zm1.014.318c.297.207.524.5.65.84l-5.625 2.087c.3.809.84 1.506 1.549 1.999zm.657.858L18.12 24.41l-5.64 2.05 3.552 9.768zm-3.556-9.779a4.2 4.2 0 0 0-.98-1.532l-4.243 4.243a1.8 1.8 0 0 1-.407-.636zm-.98-1.532a4.2 4.2 0 0 0-1.532-.98l-2.075 5.63a1.8 1.8 0 0 1-.636-.407zm-1.544-.985L5.824 18.33l-2.05 5.639 9.766 3.551zm-9.749-3.544c.34.126.633.353.84.65l-4.926 3.426a4.22 4.22 0 0 0 1.999 1.549zm.84.65C6.89 19.284 7 19.638 7 20H1c0 .862.264 1.704.756 2.412zM7 20c0 .362-.11.716-.318 1.014l-4.926-3.426A4.22 4.22 0 0 0 1 20zm-.318 1.014c-.207.297-.5.524-.84.65L3.755 16.04c-.809.3-1.506.84-1.999 1.549zm-.858.657 9.767-3.551-2.05-5.64-9.768 3.552zm9.779-3.556a4.2 4.2 0 0 0 1.532-.98l-4.243-4.243c.18-.18.397-.319.636-.407zm1.532-.98c.434-.434.768-.957.98-1.532l-5.63-2.075a1.8 1.8 0 0 1 .407-.636zm.985-1.544 3.551-9.767-5.639-2.05-3.551 9.766zm3.544-9.749c-.126.34-.353.633-.65.84l-3.426-4.926a4.22 4.22 0 0 0-1.549 1.999zm-.65.84A1.78 1.78 0 0 1 20 7V1c-.862 0-1.704.264-2.412.756zM20 7c-.362 0-.716-.11-1.014-.318l3.426-4.926A4.22 4.22 0 0 0 20 1zm-1.014-.318a1.78 1.78 0 0 1-.65-.84l5.625-2.087a4.22 4.22 0 0 0-1.549-1.999zm-.657-.858 3.551 9.767 5.64-2.05-3.552-9.768zm3.556 9.779c.212.575.546 1.098.98 1.532l4.243-4.243c.18.18.319.397.407.636zm.98 1.532c.434.434.957.768 1.532.98l2.075-5.63c.239.088.456.227.636.407zm1.544.985 9.767 3.551 2.05-5.639-9.766-3.551zm9.749 3.544a1.78 1.78 0 0 1-.84-.65l4.926-3.426a4.22 4.22 0 0 0-1.999-1.549zm-.84-.65A1.78 1.78 0 0 1 33 20h6c0-.862-.264-1.704-.756-2.412zM33 20c0-.362.11-.716.318-1.014l4.926 3.426c.492-.708.756-1.55.756-2.412zm.318-1.014c.207-.297.5-.524.84-.65l2.087 5.625c.809-.3 1.506-.84 1.999-1.549zm.858-.657L24.41 21.88l2.05 5.64 9.768-3.552zm-9.779 3.556a4.2 4.2 0 0 0-1.532.98l4.243 4.243a1.8 1.8 0 0 1-.636.407zm-1.532.98a4.2 4.2 0 0 0-.98 1.532l5.63 2.075a1.8 1.8 0 0 1-.407.636z" mask="url(#path-1-outside-1_5853_41067)"></path></svg></div></a></div></div></div><div class="aev m"><div class="ac r"><div><div class="bn" aria-describedby="167" aria-labelledby="167" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r aew aex" href="https://medium.com/@mg9189b?source=post_page---post_responses--af69c5e044db----0-----------------------------------" rel="noopener follow"><div class="ac kz aew"><p class="bg b bh ab ga aey gm zc aez ze afa zf bl">Michael Gordon</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/@mg9189b/great-article-its-immense-medium-needs-better-navigation-options-for-articles-like-this-13db0c5103ed?source=post_page---post_responses--af69c5e044db----0-----------------------------------" rel="noopener follow"><p class="bg b ec ab eb"><span>Oct 21</span></p></a></div></div><div class="bn"><button class="ah fs aj fo al am an ob ap aq ar fe oc od nt oe"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="afb m id"><pre class="se"><div class="afc m"><div class="bg b bh ab bl"><div class="hn">Great article. Its immense! Medium needs better navigation options for articles like this.</div></div></div></pre></div><div class="afd ac r mt cw"><div class="ac r afe"><div class="ac r mt mu"><div class="pw-multi-vote-icon fr ajz mw mx my"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F13db0c5103ed&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mg9189b%2Fgreat-article-its-immense-medium-needs-better-navigation-options-for-articles-like-this-13db0c5103ed&amp;user=Michael+Gordon&amp;userId=fba41fbaf686&amp;source=---post_responses--13db0c5103ed----0-----------------respond_sidebar------------------" rel="noopener follow"><div class="mz aq na nb nc nd ao ne nf ng my" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div></div><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at ib">Reply</button></p></div></div></div></div></div><div class="gn m"><div class="bi ed"><div class="aer aes m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="168" aria-labelledby="168" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/@marry00552?source=post_page---post_responses--af69c5e044db----1-----------------------------------" rel="noopener follow"><div class="m fr"><div class="m fr"><img alt="Mary" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/0__KxFADcr1OrSTJWE.png"><div class="gj by m bz ca fw o ak gk"></div></div></div></a></div></div></div><div class="aev m"><div class="ac r"><div><div class="bn" aria-describedby="169" aria-labelledby="169" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r aew aex" href="https://medium.com/@marry00552?source=post_page---post_responses--af69c5e044db----1-----------------------------------" rel="noopener follow"><div class="ac kz aew"><p class="bg b bh ab ga aey gm zc aez ze afa zf bl">Mary</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/@marry00552/great-article-it-shows-how-adding-planning-reflection-and-multi-agent-reasoning-can-turn-a-7a8dc36e6be9?source=post_page---post_responses--af69c5e044db----1-----------------------------------" rel="noopener follow"><p class="bg b ec ab eb"><span>Oct 24</span></p></a></div></div><div class="bn"><button class="ah fs aj fo al am an ob ap aq ar fe oc od nt oe"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="afb m id"><pre class="se"><div class="afc m"><div class="bg b bh ab bl"><div class="hn">Great article — it shows how adding planning, reflection, and multi-agent reasoning can turn a basic RAG pipeline into a true problem-solving system. A solid step toward more “thinking” AI, though it’s complex to implement in practice.</div></div></div></pre></div><div class="afd ac r mt cw"><div class="ac r afe"><div class="ac r mt mu"><div class="pw-multi-vote-icon fr ajz mw mx my"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F7a8dc36e6be9&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40marry00552%2Fgreat-article-it-shows-how-adding-planning-reflection-and-multi-agent-reasoning-can-turn-a-7a8dc36e6be9&amp;user=Mary&amp;userId=8c59e8685cf4&amp;source=---post_responses--7a8dc36e6be9----1-----------------respond_sidebar------------------" rel="noopener follow"><div class="mz aq na nb nc nd ao ne nf ng my" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div></div><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at ib">Reply</button></p></div></div></div></div></div><div class="gn m"><div class="bi ed"><div class="aer aes m"><div class="ac cw"><div class="ac r"><div><div class="bn" aria-describedby="170" aria-labelledby="170" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/@ernesfokam?source=post_page---post_responses--af69c5e044db----2-----------------------------------" rel="noopener follow"><div class="m fr"><div class="m fr"><img alt="Ernest Fokam" class="m fk by bz ca de" width="32" height="32" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/0_XF5VR1pVMhKnZpml.jpg"><div class="gj by m bz ca fw o ak gk"></div></div></div></a></div></div></div><div class="aev m"><div class="ac r"><div><div class="bn" aria-describedby="171" aria-labelledby="171" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at au av ac r aew aex" href="https://medium.com/@ernesfokam?source=post_page---post_responses--af69c5e044db----2-----------------------------------" rel="noopener follow"><div class="ac kz aew"><p class="bg b bh ab ga aey gm zc aez ze afa zf bl">Ernest Fokam</p></div></a></div></div></div></div><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/@ernesfokam/amazing-article-cudos-a1287527f710?source=post_page---post_responses--af69c5e044db----2-----------------------------------" rel="noopener follow"><p class="bg b ec ab eb"><span>Oct 26</span></p></a></div></div><div class="bn"><button class="ah fs aj fo al am an ob ap aq ar fe oc od nt oe"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"></path></svg></button></div></div><div class="afb m id"><pre class="se"><div class="afc m"><div class="bg b bh ab bl"><div class="hn">Amazing article. Cudos</div></div></div></pre></div><div class="afd ac r mt cw"><div class="ac r afe"><div class="ac r mt mu"><div class="pw-multi-vote-icon fr ajz mw mx my"><span data-dd-action-name="Susi presentation tracker respond_sidebar"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2Fa1287527f710&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ernesfokam%2Famazing-article-cudos-a1287527f710&amp;user=Ernest+Fokam&amp;userId=b4046649b154&amp;source=---post_responses--a1287527f710----2-----------------respond_sidebar------------------" rel="noopener follow"><div class="mz aq na nb nc nd ao ne nf ng my" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></a></span></div></div><p class="bg b ec ab bl"><button class="ah ai aj fo al am an ao ap aq ar as at ib">Reply</button></p></div></div></div></div></div><div class="iw m"><button class="bg b bh ab bl tf tg th ti nv ns tj fc fd fe tk tl tm fh tn to tp tq tr fi fj fk bn fl fm">See all responses</button></div></div></div></div><div class="ts tt tu tv tw m bx"><div class="ac ci"><div class="cp bi ij ik il im"><div class="aff afg dt du dv ia m"><h2 class="bg gw sl kb gy sm ke ha sn so sp sq sr ss st su sv bl">More from Fareed Khan and Level Up Coding</h2></div><div class="afh ac mt lk afi afj afk afl afm afn afo afp afq afr afs aft afu afv afw"><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://levelup.gitconnected.com/building-a-multi-layered-agentic-guardrail-pipeline-to-reduce-hallucinations-and-mitigate-risk-a8f73de24ea7" tabindex="0"><div class="ahg"><div aria-label="Building a Multi-Layered Agentic Guardrail Pipeline to Reduce Hallucinations and Mitigate Risk"><div class="ahi ahj ahk ahl cc"><img alt="Building a Multi-Layered Agentic Guardrail Pipeline to Reduce Hallucinations and Mitigate Risk" class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_fbNI67snOv41sozfmLleyg.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div><div class="m" aria-describedby="196" aria-labelledby="196" role="tooltip"><div tabindex="-1" class="bf"><a href="https://levelup.gitconnected.com/?source=post_page---author_recirc--af69c5e044db----0---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><div class="fr"><img alt="Level Up Coding" class="de hw m ahz ahy" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_5D9oYBd58pyjMkV_5-zXXQ(3).jpg"><div class="hw m ahy ahz fw o gj gk"></div></div></a></div></div></div></div><div class="rw m gc"><p class="bg b ec ab eb">In</p></div><div class="m"><div><div class="m" aria-describedby="197" aria-labelledby="197" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://levelup.gitconnected.com/?source=post_page---author_recirc--af69c5e044db----0---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Level Up Coding</p></a></div></div></div></div><div class="aia m"><p class="bg b ec ab eb">by</p></div><div><div class="m" aria-describedby="198" aria-labelledby="198" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/@fareedkhandev?source=post_page---author_recirc--af69c5e044db----0---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Fareed Khan</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://levelup.gitconnected.com/building-a-multi-layered-agentic-guardrail-pipeline-to-reduce-hallucinations-and-mitigate-risk-a8f73de24ea7?source=post_page---author_recirc--af69c5e044db----0---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" data-discover="true"><div title="Building a Multi-Layered Agentic Guardrail Pipeline to Reduce Hallucinations and Mitigate Risk"><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">Building a Multi-Layered Agentic Guardrail Pipeline to Reduce Hallucinations and Mitigate Risk</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">Layer 1 for Input, layer 2 for Planning, layer 3 for Output</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><div class="qn ac"><div class="bn" aria-describedby="199" aria-labelledby="199"><button class="m ak aq ao" aria-label="Member-only story"><div class=""><div><div class="bn" aria-describedby="200" aria-labelledby="200" role="tooltip"><div tabindex="-1" class="bf"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg></div></div></div></div></button></div></div><span>Oct 6</span><div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" rel="noopener follow" href="https://levelup.gitconnected.com/building-a-multi-layered-agentic-guardrail-pipeline-to-reduce-hallucinations-and-mitigate-risk-a8f73de24ea7?source=post_page---author_recirc--af69c5e044db----0---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" data-discover="true"><div><div class="ac" aria-describedby="201" aria-labelledby="201" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>7</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="202" aria-labelledby="202" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa8f73de24ea7&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-a-multi-layered-agentic-guardrail-pipeline-to-reduce-hallucinations-and-mitigate-risk-a8f73de24ea7&amp;source=---author_recirc--af69c5e044db----0-----------------bookmark_preview----c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span><div class="k j e"><div class="sk bi tx jw"></div></div></div></div></div></div></div></div></article></div></div><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://levelup.gitconnected.com/im-a-middle-aged-developer-and-my-time-to-shine-has-sunset-a1b5d5c6ff2d" tabindex="0"><div class="ahg"><div aria-label="I’m a middle-aged developer, and the way I shine has changed"><div class="ahi ahj ahk ahl cc"><img alt="I’m a middle-aged developer, and the way I shine has changed" class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_pBBbqTOCkTaWdJ6wudXaPA@2x.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div><div class="m" aria-describedby="203" aria-labelledby="203" role="tooltip"><div tabindex="-1" class="bf"><a href="https://levelup.gitconnected.com/?source=post_page---author_recirc--af69c5e044db----1---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><div class="fr"><img alt="Level Up Coding" class="de hw m ahz ahy" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_5D9oYBd58pyjMkV_5-zXXQ(3).jpg"><div class="hw m ahy ahz fw o gj gk"></div></div></a></div></div></div></div><div class="rw m gc"><p class="bg b ec ab eb">In</p></div><div class="m"><div><div class="m" aria-describedby="204" aria-labelledby="204" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://levelup.gitconnected.com/?source=post_page---author_recirc--af69c5e044db----1---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Level Up Coding</p></a></div></div></div></div><div class="aia m"><p class="bg b ec ab eb">by</p></div><div><div class="m" aria-describedby="205" aria-labelledby="205" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://jeffreybakker.medium.com/?source=post_page---author_recirc--af69c5e044db----1---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Jeffrey Bakker</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://levelup.gitconnected.com/im-a-middle-aged-developer-and-my-time-to-shine-has-sunset-a1b5d5c6ff2d?source=post_page---author_recirc--af69c5e044db----1---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" data-discover="true"><div title=""><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">I’m a middle-aged developer, and the way I shine has changed</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">And what matters to me has also changed</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><div class="qn ac"><div class="bn" aria-describedby="206" aria-labelledby="206"><button class="m ak aq ao" aria-label="Member-only story"><div class=""><div><div class="bn" aria-describedby="207" aria-labelledby="207" role="tooltip"><div tabindex="-1" class="bf"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg></div></div></div></div></button></div></div><span>Oct 6</span><div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" rel="noopener follow" href="https://levelup.gitconnected.com/im-a-middle-aged-developer-and-my-time-to-shine-has-sunset-a1b5d5c6ff2d?source=post_page---author_recirc--af69c5e044db----1---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" data-discover="true"><div><div class="ac" aria-describedby="208" aria-labelledby="208" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>164</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="209" aria-labelledby="209" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa1b5d5c6ff2d&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fim-a-middle-aged-developer-and-my-time-to-shine-has-sunset-a1b5d5c6ff2d&amp;source=---author_recirc--af69c5e044db----1-----------------bookmark_preview----c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span><div class="k j e"><div class="sk bi tx jw"></div></div></div></div></div></div></div></div></article></div></div><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://levelup.gitconnected.com/why-your-rag-system-fails-complex-questions-and-how-structure-fixes-everything-4adfc7e810d0" tabindex="0"><div class="ahg"><div aria-label="Why Your RAG System Fails Complex Questions? (And How Structure Fixes Everything)"><div class="ahi ahj ahk ahl cc"><img alt="Why Your RAG System Fails Complex Questions? (And How Structure Fixes Everything)" class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_7VNe9-xi0ZGiRyh60r1QvQ.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div><div class="m" aria-describedby="210" aria-labelledby="210" role="tooltip"><div tabindex="-1" class="bf"><a href="https://levelup.gitconnected.com/?source=post_page---author_recirc--af69c5e044db----2---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><div class="fr"><img alt="Level Up Coding" class="de hw m ahz ahy" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_5D9oYBd58pyjMkV_5-zXXQ(3).jpg"><div class="hw m ahy ahz fw o gj gk"></div></div></a></div></div></div></div><div class="rw m gc"><p class="bg b ec ab eb">In</p></div><div class="m"><div><div class="m" aria-describedby="211" aria-labelledby="211" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://levelup.gitconnected.com/?source=post_page---author_recirc--af69c5e044db----2---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Level Up Coding</p></a></div></div></div></div><div class="aia m"><p class="bg b ec ab eb">by</p></div><div><div class="m" aria-describedby="212" aria-labelledby="212" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/@vivedhaelango?source=post_page---author_recirc--af69c5e044db----2---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Vivedha Elango</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://levelup.gitconnected.com/why-your-rag-system-fails-complex-questions-and-how-structure-fixes-everything-4adfc7e810d0?source=post_page---author_recirc--af69c5e044db----2---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" data-discover="true"><div title="Why Your RAG System Fails Complex Questions? (And How Structure Fixes Everything)"><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">Why Your RAG System Fails Complex Questions? (And How Structure Fixes Everything)</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">Understanding the Retrieval and Structuring (RAS) Paradigm for Precise Reasoning and Domain Expertise with Implementation Examples</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><div class="qn ac"><div class="bn" aria-describedby="213" aria-labelledby="213"><button class="m ak aq ao" aria-label="Member-only story"><div class=""><div><div class="bn" aria-describedby="214" aria-labelledby="214" role="tooltip"><div tabindex="-1" class="bf"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg></div></div></div></div></button></div></div><span>Oct 10</span><div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" rel="noopener follow" href="https://levelup.gitconnected.com/why-your-rag-system-fails-complex-questions-and-how-structure-fixes-everything-4adfc7e810d0?source=post_page---author_recirc--af69c5e044db----2---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" data-discover="true"><div><div class="ac" aria-describedby="215" aria-labelledby="215" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>9</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="216" aria-labelledby="216" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4adfc7e810d0&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fwhy-your-rag-system-fails-complex-questions-and-how-structure-fixes-everything-4adfc7e810d0&amp;source=---author_recirc--af69c5e044db----2-----------------bookmark_preview----c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span><div class="k j e"><div class="sk bi tx jw"></div></div></div></div></div></div></div></div></article></div></div><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://levelup.gitconnected.com/building-an-advanced-agentic-rag-pipeline-that-mimics-a-human-thought-process-687e1fd79f61" tabindex="0"><div class="ahg"><div aria-label="Building an Advanced Agentic RAG Pipeline that Mimics a Human Thought Process"><div class="ahi ahj ahk ahl cc"><img alt="Building an Advanced Agentic RAG Pipeline that Mimics a Human Thought Process" class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_cO88iZwmqxLcoNDi-nI4Tg.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div><div class="m" aria-describedby="217" aria-labelledby="217" role="tooltip"><div tabindex="-1" class="bf"><a href="https://levelup.gitconnected.com/?source=post_page---author_recirc--af69c5e044db----3---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><div class="fr"><img alt="Level Up Coding" class="de hw m ahz ahy" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_5D9oYBd58pyjMkV_5-zXXQ(3).jpg"><div class="hw m ahy ahz fw o gj gk"></div></div></a></div></div></div></div><div class="rw m gc"><p class="bg b ec ab eb">In</p></div><div class="m"><div><div class="m" aria-describedby="218" aria-labelledby="218" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://levelup.gitconnected.com/?source=post_page---author_recirc--af69c5e044db----3---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Level Up Coding</p></a></div></div></div></div><div class="aia m"><p class="bg b ec ab eb">by</p></div><div><div class="m" aria-describedby="219" aria-labelledby="219" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/@fareedkhandev?source=post_page---author_recirc--af69c5e044db----3---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Fareed Khan</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://levelup.gitconnected.com/building-an-advanced-agentic-rag-pipeline-that-mimics-a-human-thought-process-687e1fd79f61?source=post_page---author_recirc--af69c5e044db----3---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" data-discover="true"><div title="Building an Advanced Agentic RAG Pipeline that Mimics a Human Thought Process"><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">Building an Advanced Agentic RAG Pipeline that Mimics a Human Thought Process</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">Ambiguity Checks, Multi-Tool Planning, Self-Correction, Causal Inference and more.</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><div class="qn ac"><div class="bn" aria-describedby="220" aria-labelledby="220"><button class="m ak aq ao" aria-label="Member-only story"><div class=""><div><div class="bn" aria-describedby="221" aria-labelledby="221" role="tooltip"><div tabindex="-1" class="bf"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg></div></div></div></div></button></div></div><span>Sep 16</span><div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" rel="noopener follow" href="https://levelup.gitconnected.com/building-an-advanced-agentic-rag-pipeline-that-mimics-a-human-thought-process-687e1fd79f61?source=post_page---author_recirc--af69c5e044db----3---------------------c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" data-discover="true"><div><div class="ac" aria-describedby="222" aria-labelledby="222" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>21</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="223" aria-labelledby="223" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F687e1fd79f61&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-an-advanced-agentic-rag-pipeline-that-mimics-a-human-thought-process-687e1fd79f61&amp;source=---author_recirc--af69c5e044db----3-----------------bookmark_preview----c3e65a98_46a1_402a_923a_e78ecd0be4b3--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span></div></div></div></div></div></div></article></div></div></div><div class="sk bi tx dr ds ajg ajh aji"></div><div class="ac rb ra kt kv kx"><a class="bg b bh ab bl tf tg th ti nv ns tj fc fd fe tk tl tm fh tn to tp tq tr fi fj fk bn fl fm" href="https://medium.com/@fareedkhandev?source=post_page---author_recirc--af69c5e044db---------------------------------------" rel="noopener follow"><div class="m fm">See all from Fareed Khan</div></a><div class="ajj ajk ajl ajm ajn ajo ajp ajq ajr nn m"><a class="bg b bh ab bl tf tg th ti nv ns tj fc fd fe tk tl tm fh tn to tp tq tr fi fj fk bn fl fm" href="https://levelup.gitconnected.com/?source=post_page---author_recirc--af69c5e044db---------------------------------------" rel="noopener follow"><div class="m fm">See all from Level Up Coding</div></a></div></div></div></div><div class="sk bi tx ajs ajt aju ajv ajw"></div><div class="ac ci"><div class="cp bi ij ik il im"><div class="ajx ajy m"><h2 class="bg gw sl kb gy sm ke ha sn so sp sq sr ss st su sv bl">Recommended from Medium</h2><div class="pn po pp pq pr m"><div class="afh ac mt lk afi afj afk afl afm afn afo afp afq afr afs aft afu afv afw"><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://medium.com/data-science-collective/agentic-ai-single-vs-multi-agent-systems-e5c8b0e3cb28" tabindex="0"><div class="ahg"><div aria-label="Agentic AI: Single vs Multi-Agent Systems"><div class="ahi ahj ahk ahl cc"><img alt="Agentic AI: Single vs Multi-Agent Systems" class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_vWdAWcYmrtkwmY-LnHfiAQ.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div><div class="m" aria-describedby="224" aria-labelledby="224" role="tooltip"><div tabindex="-1" class="bf"><a href="https://medium.com/data-science-collective?source=post_page---read_next_recirc--af69c5e044db----0---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div class="fr"><img alt="Data Science Collective" class="de hw m ahz ahy" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_0nV0Q-FBHj94Kggq00pG2Q.jpg"><div class="hw m ahy ahz fw o gj gk"></div></div></a></div></div></div></div><div class="rw m gc"><p class="bg b ec ab eb">In</p></div><div class="m"><div><div class="m" aria-describedby="225" aria-labelledby="225" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/data-science-collective?source=post_page---read_next_recirc--af69c5e044db----0---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Data Science Collective</p></a></div></div></div></div><div class="aia m"><p class="bg b ec ab eb">by</p></div><div><div class="m" aria-describedby="226" aria-labelledby="226" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/@ilsilfverskiold?source=post_page---read_next_recirc--af69c5e044db----0---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Ida Silfverskiöld</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/data-science-collective/agentic-ai-single-vs-multi-agent-systems-e5c8b0e3cb28?source=post_page---read_next_recirc--af69c5e044db----0---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div title=""><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">Agentic AI: Single vs Multi-Agent Systems</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">Building with a structured data source in LangGraph</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><div class="qn ac"><div class="bn" aria-describedby="227" aria-labelledby="227"><button class="m ak aq ao" aria-label="Member-only story"><div class=""><div><div class="bn" aria-describedby="228" aria-labelledby="228" role="tooltip"><div tabindex="-1" class="bf"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg></div></div></div></div></button></div></div><span>Oct 28</span><div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" href="https://medium.com/data-science-collective/agentic-ai-single-vs-multi-agent-systems-e5c8b0e3cb28?source=post_page---read_next_recirc--af69c5e044db----0---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div><div class="ac" aria-describedby="229" aria-labelledby="229" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>14</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="230" aria-labelledby="230" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe5c8b0e3cb28&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fdata-science-collective%2Fagentic-ai-single-vs-multi-agent-systems-e5c8b0e3cb28&amp;source=---read_next_recirc--af69c5e044db----0-----------------bookmark_preview----567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span><div class="k j e"><div class="sk bi tx jw"></div></div></div></div></div></div></div></div></article></div></div><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://pub.towardsai.net/we-spent-47-000-running-ai-agents-in-production-heres-what-nobody-tells-you-about-a2a-and-mcp-5f845848de33" tabindex="0"><div class="ahg"><div aria-label="We Spent $47,000 Running AI Agents in Production. Here’s What Nobody Tells You About A2A and MCP."><div class="ahi ahj ahk ahl cc"><img alt="We Spent $47,000 Running AI Agents in Production. Here’s What Nobody Tells You About A2A and MCP." class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_BbD5iXryHDZ_hVv2uhuOYg.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div><div class="m" aria-describedby="231" aria-labelledby="231" role="tooltip"><div tabindex="-1" class="bf"><a href="https://pub.towardsai.net/?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div class="fr"><img alt="Towards AI" class="de hw m ahz ahy" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_JyIThO-cLjlChQLb6kSlVQ.png"><div class="hw m ahy ahz fw o gj gk"></div></div></a></div></div></div></div><div class="rw m gc"><p class="bg b ec ab eb">In</p></div><div class="m"><div><div class="m" aria-describedby="232" aria-labelledby="232" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://pub.towardsai.net/?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Towards AI</p></a></div></div></div></div><div class="aia m"><p class="bg b ec ab eb">by</p></div><div><div class="m" aria-describedby="233" aria-labelledby="233" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/@teja.kusireddy23?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Teja Kusireddy</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://pub.towardsai.net/we-spent-47-000-running-ai-agents-in-production-heres-what-nobody-tells-you-about-a2a-and-mcp-5f845848de33?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div title="We Spent $47,000 Running AI Agents in Production. Here’s What Nobody Tells You About A2A and MCP."><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">We Spent $47,000 Running AI Agents in Production. Here’s What Nobody Tells You About A2A and MCP.</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">Multi-agent systems are the future. Agent-to-Agent (A2A) communication and Anthropic’s Model Context Protocol (MCP) are revolutionary. But…</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><span>Oct 16</span><div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" href="https://pub.towardsai.net/we-spent-47-000-running-ai-agents-in-production-heres-what-nobody-tells-you-about-a2a-and-mcp-5f845848de33?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div><div class="ac" aria-describedby="234" aria-labelledby="234" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>106</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="235" aria-labelledby="235" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5f845848de33&amp;operation=register&amp;redirect=https%3A%2F%2Fpub.towardsai.net%2Fwe-spent-47-000-running-ai-agents-in-production-heres-what-nobody-tells-you-about-a2a-and-mcp-5f845848de33&amp;source=---read_next_recirc--af69c5e044db----1-----------------bookmark_preview----567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span></div></div></div></div></div></div></article></div></div></div></div><div class="afh ac mt lk afi afj afk afl afm afn afo afp afq afr afs aft afu afv afw"><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://medium.com/@dharamai2024/building-a-text-to-sql-chatbot-with-rag-langchain-fastapi-and-streamlit-0a8f43488a08" tabindex="0"><div class="ahg"><div aria-label="Building a Text-to-SQL Chatbot with RAG, LangChain, FastAPI And Streamlit"><div class="ahi ahj ahk ahl cc"><img alt="Building a Text-to-SQL Chatbot with RAG, LangChain, FastAPI And Streamlit" class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_s1ggrmDLA-VfEppGMDPKNA.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div class="m"><div><div class="m" aria-describedby="236" aria-labelledby="236" role="tooltip"><div tabindex="-1" class="bf"><a tabindex="-1" href="https://medium.com/@dharamai2024?source=post_page---read_next_recirc--af69c5e044db----0---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div class="m fr"><img alt="Dharmendra Pratap Singh" class="m fk by ahy ahz de" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_jG8dJP2cc8WgTXQSJY9f0g.png"><div class="gj by m ahy ahz fw o ak gk"></div></div></a></div></div></div></div></div><div><div class="m" aria-describedby="237" aria-labelledby="237" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/@dharamai2024?source=post_page---read_next_recirc--af69c5e044db----0---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Dharmendra Pratap Singh</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/@dharamai2024/building-a-text-to-sql-chatbot-with-rag-langchain-fastapi-and-streamlit-0a8f43488a08?source=post_page---read_next_recirc--af69c5e044db----0---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div title="Building a Text-to-SQL Chatbot with RAG, LangChain, FastAPI And Streamlit"><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">Building a Text-to-SQL Chatbot with RAG, LangChain, FastAPI And Streamlit</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">In this project, I built an AI-powered chatbot that converts natural language questions into SQL queries and retrieves answers directly…</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><div class="qn ac"><div class="bn" aria-describedby="238" aria-labelledby="238"><button class="m ak aq ao" aria-label="Member-only story"><div class=""><div><div class="bn" aria-describedby="239" aria-labelledby="239" role="tooltip"><div tabindex="-1" class="bf"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg></div></div></div></div></button></div></div><span>Oct 24</span><div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" href="https://medium.com/@dharamai2024/building-a-text-to-sql-chatbot-with-rag-langchain-fastapi-and-streamlit-0a8f43488a08?source=post_page---read_next_recirc--af69c5e044db----0---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div><div class="ac" aria-describedby="240" aria-labelledby="240" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>9</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="241" aria-labelledby="241" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F0a8f43488a08&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40dharamai2024%2Fbuilding-a-text-to-sql-chatbot-with-rag-langchain-fastapi-and-streamlit-0a8f43488a08&amp;source=---read_next_recirc--af69c5e044db----0-----------------bookmark_preview----567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span><div class="k j e"><div class="sk bi tx jw"></div></div></div></div></div></div></div></div></article></div></div><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://generativeai.pub/stanford-just-killed-prompt-engineering-with-8-words-and-i-cant-believe-it-worked-8349d6524d2b" tabindex="0"><div class="ahg"><div aria-label="Stanford Just Killed Prompt Engineering With 8 Words (And I Can’t Believe It Worked)"><div class="ahi ahj ahk ahl cc"><img alt="Stanford Just Killed Prompt Engineering With 8 Words (And I Can’t Believe It Worked)" class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_va3sFwIm26snbj5ly9ZsgA.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div><div class="m" aria-describedby="242" aria-labelledby="242" role="tooltip"><div tabindex="-1" class="bf"><a href="https://generativeai.pub/?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div class="fr"><img alt="Generative AI" class="de hw m ahz ahy" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_M4RBhIRaSSZB7lXfrGlatA.png"><div class="hw m ahy ahz fw o gj gk"></div></div></a></div></div></div></div><div class="rw m gc"><p class="bg b ec ab eb">In</p></div><div class="m"><div><div class="m" aria-describedby="243" aria-labelledby="243" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://generativeai.pub/?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Generative AI</p></a></div></div></div></div><div class="aia m"><p class="bg b ec ab eb">by</p></div><div><div class="m" aria-describedby="244" aria-labelledby="244" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/@adhamhidawy?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Adham Khaled</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://generativeai.pub/stanford-just-killed-prompt-engineering-with-8-words-and-i-cant-believe-it-worked-8349d6524d2b?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div title="Stanford Just Killed Prompt Engineering With 8 Words (And I Can’t Believe It Worked)"><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">Stanford Just Killed Prompt Engineering With 8 Words (And I Can’t Believe It Worked)</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">ChatGPT keeps giving you the same boring response? This new technique unlocks 2× more creativity from ANY AI model — no training required…</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><div class="qn ac"><div class="bn" aria-describedby="245" aria-labelledby="245"><button class="m ak aq ao" aria-label="Member-only story"><div class=""><div><div class="bn" aria-describedby="246" aria-labelledby="246" role="tooltip"><div tabindex="-1" class="bf"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg></div></div></div></div></button></div></div><span>Oct 20</span><div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" href="https://generativeai.pub/stanford-just-killed-prompt-engineering-with-8-words-and-i-cant-believe-it-worked-8349d6524d2b?source=post_page---read_next_recirc--af69c5e044db----1---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div><div class="ac" aria-describedby="247" aria-labelledby="247" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>358</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="248" aria-labelledby="248" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8349d6524d2b&amp;operation=register&amp;redirect=https%3A%2F%2Fgenerativeai.pub%2Fstanford-just-killed-prompt-engineering-with-8-words-and-i-cant-believe-it-worked-8349d6524d2b&amp;source=---read_next_recirc--af69c5e044db----1-----------------bookmark_preview----567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span><div class="k j e"><div class="sk bi tx jw"></div></div></div></div></div></div></div></div></article></div></div><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://levelup.gitconnected.com/building-a-training-architecture-for-self-improving-ai-agents-c87a4e316b22" tabindex="0"><div class="ahg"><div aria-label="Building a Training Architecture for Self-Improving AI Agents"><div class="ahi ahj ahk ahl cc"><img alt="Building a Training Architecture for Self-Improving AI Agents" class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_Hp_v3Cp10iZfqroG9MOgpw.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div><div class="m" aria-describedby="249" aria-labelledby="249" role="tooltip"><div tabindex="-1" class="bf"><a href="https://levelup.gitconnected.com/?source=post_page---read_next_recirc--af69c5e044db----2---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div class="fr"><img alt="Level Up Coding" class="de hw m ahz ahy" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_5D9oYBd58pyjMkV_5-zXXQ(3).jpg"><div class="hw m ahy ahz fw o gj gk"></div></div></a></div></div></div></div><div class="rw m gc"><p class="bg b ec ab eb">In</p></div><div class="m"><div><div class="m" aria-describedby="250" aria-labelledby="250" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://levelup.gitconnected.com/?source=post_page---read_next_recirc--af69c5e044db----2---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Level Up Coding</p></a></div></div></div></div><div class="aia m"><p class="bg b ec ab eb">by</p></div><div><div class="m" aria-describedby="251" aria-labelledby="251" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/@fareedkhandev?source=post_page---read_next_recirc--af69c5e044db----2---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Fareed Khan</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" rel="noopener follow" href="https://levelup.gitconnected.com/building-a-training-architecture-for-self-improving-ai-agents-c87a4e316b22?source=post_page---read_next_recirc--af69c5e044db----2---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" data-discover="true"><div title=""><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">Building a Training Architecture for Self-Improving AI Agents</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">RL Algorithms, Policy Modeling, Distributed Training and more.</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><div class="qn ac"><div class="bn" aria-describedby="252" aria-labelledby="252"><button class="m ak aq ao" aria-label="Member-only story"><div class=""><div><div class="bn" aria-describedby="253" aria-labelledby="253" role="tooltip"><div tabindex="-1" class="bf"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg></div></div></div></div></button></div></div>3d ago<div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" rel="noopener follow" href="https://levelup.gitconnected.com/building-a-training-architecture-for-self-improving-ai-agents-c87a4e316b22?source=post_page---read_next_recirc--af69c5e044db----2---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" data-discover="true"><div><div class="ac" aria-describedby="254" aria-labelledby="254" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>14</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="255" aria-labelledby="255" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc87a4e316b22&amp;operation=register&amp;redirect=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-a-training-architecture-for-self-improving-ai-agents-c87a4e316b22&amp;source=---read_next_recirc--af69c5e044db----2-----------------bookmark_preview----567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span><div class="k j e"><div class="sk bi tx jw"></div></div></div></div></div></div></div></div></article></div></div><div class="afx afy afz rv aga agb agc ru agd age agf agg xl agh agi agj xm agk agl agm agn"><div class="ago agp agq agr ags ed m"><article class="ed" data-testid="post-preview"><div class="ed qn m"><div class="bi ed"><div class="ed m"><div class="fr ed agt agu agv agw agx agy agz aha ahb ahc ahd ahe ahf" role="link" data-href="https://medium.com/write-a-catalyst/remember-vibe-coders-yeah-theyre-gone-2a1c52eed4ff" tabindex="0"><div class="ahg"><div aria-label="Remember Vibe Coders? Yeah… They’re Gone"><div class="ahi ahj ahk ahl cc"><img alt="Remember Vibe Coders? Yeah… They’re Gone" class="bi ahm ahn aho bx" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_Fgmh0Hdtjy5tL-zfaHUTEg.webp"></div></div></div><div class="ahh ac ci cv"><div class="ac cv ve bi ahp ahq ahr ahs"><div class="aht ahu ahv ahw ahx ac r"><div class="yb m"><div><div class="m" aria-describedby="256" aria-labelledby="256" role="tooltip"><div tabindex="-1" class="bf"><a href="https://medium.com/write-a-catalyst?source=post_page---read_next_recirc--af69c5e044db----3---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div class="fr"><img alt="Write A Catalyst" class="de hw m ahz ahy" width="20" height="20" loading="lazy" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1_KCHN5TM3Ga2PqZHA4hNbaw.png"><div class="hw m ahy ahz fw o gj gk"></div></div></a></div></div></div></div><div class="rw m gc"><p class="bg b ec ab eb">In</p></div><div class="m"><div><div class="m" aria-describedby="257" aria-labelledby="257" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://medium.com/write-a-catalyst?source=post_page---read_next_recirc--af69c5e044db----3---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Write A Catalyst</p></a></div></div></div></div><div class="aia m"><p class="bg b ec ab eb">by</p></div><div><div class="m" aria-describedby="258" aria-labelledby="258" role="tooltip"><div tabindex="-1" class="bf"><a class="ah ai aj fo al am an ao ap aq ar as at li ac r" href="https://adarsh-gupta.medium.com/?source=post_page---read_next_recirc--af69c5e044db----3---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><p class="bg b ec ab ga aey gm zc aez ze afa zf bl">Adarsh Gupta</p></a></div></div></div></div><div class="aib m aic aid aie aif aig id"><div class="aih aii aij aik ail aim ain aio"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/write-a-catalyst/remember-vibe-coders-yeah-theyre-gone-2a1c52eed4ff?source=post_page---read_next_recirc--af69c5e044db----3---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div title=""><h2 class="bg jg sl kb aip aiq gy sm ke air ais ha hb hc ait aiu hd he hf aiv aiw hg hh hi aix aiy hj ga gm zc ze zf bl">Remember Vibe Coders? Yeah… They’re Gone</h2></div><div class="aiz m"><h3 class="bg b hm ab ga zb gm zc zd ze zf eb">Turns out it was the first AI bubble to burst</h3></div></a></div></div><span class="bg b ec ab eb"><div class="rm ac cw ag"><div class="ac r ajc"><div class="qn ac"><div class="bn" aria-describedby="259" aria-labelledby="259"><button class="m ak aq ao" aria-label="Member-only story"><div class=""><div><div class="bn" aria-describedby="260" aria-labelledby="260" role="tooltip"><div tabindex="-1" class="bf"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 64 64"><path fill="#FFC017" d="m39.637 40.831-5.771 15.871a1.99 1.99 0 0 1-3.732 0l-5.771-15.87a2.02 2.02 0 0 0-1.194-1.195L7.298 33.866a1.99 1.99 0 0 1 0-3.732l15.87-5.771a2.02 2.02 0 0 0 1.195-1.194l5.771-15.871a1.99 1.99 0 0 1 3.732 0l5.771 15.87a2.02 2.02 0 0 0 1.194 1.195l15.871 5.771a1.99 1.99 0 0 1 0 3.732l-15.87 5.771a2.02 2.02 0 0 0-1.195 1.194"></path></svg></div></div></div></div></button></div></div><span>Oct 19</span><div class=""><div class="fr aja do ac r"><div class="fw ht ajb ac r ajc"><div class="fn do dq m de"></div></div><a class="fw nq ajb ac r ajc" tabindex="-1" href="https://medium.com/write-a-catalyst/remember-vibe-coders-yeah-theyre-gone-2a1c52eed4ff?source=post_page---read_next_recirc--af69c5e044db----3---------------------567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><div><div class="ac" aria-describedby="261" aria-labelledby="261" role="tooltip"><div tabindex="-1" class="bf"><div class="ac r aew"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#6B6B6B" aria-labelledby="response-filled-16px-desc" viewBox="0 0 16 16"><desc id="response-filled-16px-desc">A response icon</desc><path fill="#6B6B6B" d="M12.344 11.458A5.28 5.28 0 0 0 14 7.526C14 4.483 11.391 2 8.051 2S2 4.483 2 7.527c0 3.051 2.712 5.526 6.059 5.526a6.6 6.6 0 0 0 1.758-.236q.255.223.554.414c.784.51 1.626.768 2.512.768a.37.37 0 0 0 .355-.214.37.37 0 0 0-.03-.384 4.7 4.7 0 0 1-.857-1.958v.014z"></path></svg><span>186</span></div></div></div></div></a></div></div></div><div class="ac r ajd aje"><div class=""><div><div class="bn" aria-describedby="262" aria-labelledby="262" role="tooltip"><div tabindex="-1" class="bf"><span data-dd-action-name="Susi presentation tracker bookmark_preview"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2a1c52eed4ff&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fwrite-a-catalyst%2Fremember-vibe-coders-yeah-theyre-gone-2a1c52eed4ff&amp;source=---read_next_recirc--af69c5e044db----3-----------------bookmark_preview----567c40d8_de92_410e_83e4_19cb5104da0c--------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="eb nv ajf" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div></div></div></div></span></div></div></div></div></div></div></article></div></div></div><div class="sk bi tx dr ds ajg ajh aji"></div><a class="bg b bh ab bl tf tg th ti nv ns tj fc fd fe tk tl tm fh tn to tp tq tr fi fj fk bn fl fm" href="https://medium.com/?source=post_page---read_next_recirc--af69c5e044db---------------------------------------" rel="noopener follow"><div class="m fm">See more recommendations</div></a></div></div></div><div class="i l k"><div class="sk bi tx ty"></div><div class="ac ci"><div class="cp bi ij ik il im"><div class="tz ac mt lk"><div class="ua ub m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://help.medium.com/hc/en-us?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Help</p></a></div><div class="ua ub m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://status.medium.com/?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Status</p></a></div><div class="ua ub m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/about?autoplay=1&amp;source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">About</p></a></div><div class="ua ub m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Careers</p></a></div><div class="ua ub m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="mailto:pressinquiries@medium.com" rel="noopener follow"><p class="bg b ec ab eb">Press</p></a></div><div class="ua ub m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://blog.medium.com/?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Blog</p></a></div><div class="ua ub m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Privacy</p></a></div><div class="ua ub m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Rules</p></a></div><div class="ua ub m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Terms</p></a></div><div class="ua m"><a class="ah ai aj fo al am an ao ap aq ar as at au av" href="https://speechify.com/medium?source=post_page-----af69c5e044db---------------------------------------" rel="noopener follow"><p class="bg b ec ab eb">Text to speech</p></a></div></div></div></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__="main-20251107-200103-cdea0451cc"</script><script>window.__GRAPHQL_URI__ = "https://levelup.gitconnected.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"algolia":{"queries":{}},"cache":{"experimentGroupSet":true,"reason":"This request is not using the cache middleware worker","group":"disabled","tags":["group-edgeCachePosts","post-af69c5e044db","user-b856005e5ecd","collection-5517fd7b58a6"],"serverVariantState":"","middlewareEnabled":false,"cacheStatus":"DYNAMIC","shouldUseCache":false,"vary":[],"pubFeaturingPostPageLabelEnabled":false,"shouldFollowPostQueryEnabled":false},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"isFirefox":false,"routingEntity":{"type":"COLLECTION","id":"5517fd7b58a6","explicit":true},"viewerIsBot":false},"debug":{"requestId":"09697dc1-2cab-4836-97bb-c908e845ecd4","requestTag":"","hybridDevServices":[],"originalSpanCarrier":{"traceparent":"00-70072ddbda98e2b564229201dc4f788a-1c0e5237b496f8e6-01"}},"multiVote":{"clapsPerPost":{}},"navigation":{"hideGoogleOneTap":false,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Flevelup.gitconnected.com\u002Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db","host":"levelup.gitconnected.com","hostname":"levelup.gitconnected.com","referrer":"https:\u002F\u002Flevelup.gitconnected.com\u002Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"partnerProgram":{"selectedCountryCode":null},"staticRouterContext":{"route":{"name":"ShowPostUnderCollection"},"statusCode":200},"toastQueue":[],"currentToast":null,"queryString":"?sk=b3f7664c8135b95d057cb90312dc0c44"},"config":{"nodeEnv":"production","version":"main-20251107-200103-cdea0451cc","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","iosAppId":"828256236","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","recaptchaEnterpriseKeyId":"6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp","datadog":{"applicationId":"6702d87d-a7e0-42fe-bbcb-95b469547ea0","clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","rumToken":"pubf9cc52896502b9413b68ba36fc0c7162","context":{"deployment":{"target":"production","tag":"main-20251107-200103-cdea0451cc","commit":"cdea0451ccbe949fad939e2ef99b3609e480e4fa"}},"datacenter":"us"},"googleAdsCode":"AW-17106321204","googleAnalyticsCode":"G-7JY7T788PK","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium","instanceMerchantId":"13685562959212738550"},"applePay":{"version":3},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumMastodonDomainName":"me.dm","mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"topicToTagMappings":{"accessibility":"accessibility","addiction":"addiction","android-development":"android-development","art":"art","artificial-intelligence":"artificial-intelligence","astrology":"astrology","basic-income":"basic-income","beauty":"beauty","biotech":"biotech","blockchain":"blockchain","books":"books","business":"business","cannabis":"cannabis","cities":"cities","climate-change":"climate-change","comics":"comics","coronavirus":"coronavirus","creativity":"creativity","cryptocurrency":"cryptocurrency","culture":"culture","cybersecurity":"cybersecurity","data-science":"data-science","design":"design","digital-life":"digital-life","disability":"disability","economy":"economy","education":"education","equality":"equality","family":"family","feminism":"feminism","fiction":"fiction","film":"film","fitness":"fitness","food":"food","freelancing":"freelancing","future":"future","gadgets":"gadgets","gaming":"gaming","gun-control":"gun-control","health":"health","history":"history","humor":"humor","immigration":"immigration","ios-development":"ios-development","javascript":"javascript","justice":"justice","language":"language","leadership":"leadership","lgbtqia":"lgbtqia","lifestyle":"lifestyle","machine-learning":"machine-learning","makers":"makers","marketing":"marketing","math":"math","media":"media","mental-health":"mental-health","mindfulness":"mindfulness","money":"money","music":"music","neuroscience":"neuroscience","nonfiction":"nonfiction","outdoors":"outdoors","parenting":"parenting","pets":"pets","philosophy":"philosophy","photography":"photography","podcasts":"podcast","poetry":"poetry","politics":"politics","privacy":"privacy","product-management":"product-management","productivity":"productivity","programming":"programming","psychedelics":"psychedelics","psychology":"psychology","race":"race","relationships":"relationships","religion":"religion","remote-work":"remote-work","san-francisco":"san-francisco","science":"science","self":"self","self-driving-cars":"self-driving-cars","sexuality":"sexuality","social-media":"social-media","society":"society","software-engineering":"software-engineering","space":"space","spirituality":"spirituality","sports":"sports","startups":"startup","style":"style","technology":"technology","transportation":"transportation","travel":"travel","true-crime":"true-crime","tv":"tv","ux":"ux","venture-capital":"venture-capital","visual-design":"visual-design","work":"work","world":"world","writing":"writing"},"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"7*V1_7XP4snlmqrc_0Njontw.png","height":110,"width":500},"postLogo":{"imageId":"167cff2a3d17ac1e64d0762539978f2d54c0058886e8b3c8a03a725a83012ec0","height":630,"width":1200},"postPreviewImage":{"imageId":"bc1f8416df0cad099e43cda2872716e5864f18a73bda2a7547ea082aca9b5632","height":630,"width":1200}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","braintree":{"enabled":true,"merchantId":"m56f8fqpf7ngnrd4","merchantAccountId":{"usd":"AMediumCorporation_instant","eur":"amediumcorporation_EUR","cad":"amediumcorporation_CAD"},"publicKey":"ds2nn34bg2z7j5gd","braintreeEnvironment":"production","dashboardUrl":"https:\u002F\u002Fwww.braintreegateway.com\u002Fmerchants","gracePeriodDurationInDays":14,"mediumMembershipPlanId":{"monthly":"ce105f8c57a3","monthlyV2":"e8a5e126-792b-4ee6-8fba-d574c1b02fc5","monthlyWithTrial":"d5ee3dbe3db8","monthlyPremium":"fa741a9b47a2","yearly":"a40ad4a43185","yearlyV2":"3815d7d6-b8ca-4224-9b8c-182f9047866e","yearlyStaff":"d74fb811198a","yearlyWithTrial":"b3bc7350e5c7","yearlyPremium":"e21bd2c12166","monthlyOneYearFree":"e6c0637a-2bad-4171-ab4f-3c268633d83c","monthly25PercentOffFirstYear":"235ecc62-0cdb-49ae-9378-726cd21c504b","monthly20PercentOffFirstYear":"ba518864-9c13-4a99-91ca-411bf0cac756","monthly15PercentOffFirstYear":"594c029b-9f89-43d5-88f8-8173af4e070e","monthly10PercentOffFirstYear":"c6c7bc9a-40f2-4b51-8126-e28511d5bdb0","monthlyForStudents":"629ebe51-da7d-41fd-8293-34cd2f2030a8","yearlyOneYearFree":"78ba7be9-0d9f-4ece-aa3e-b54b826f2bf1","yearly25PercentOffFirstYear":"2dbb010d-bb8f-4eeb-ad5c-a08509f42d34","yearly20PercentOffFirstYear":"47565488-435b-47f8-bf93-40d5fbe0ebc8","yearly15PercentOffFirstYear":"8259809b-0881-47d9-acf7-6c001c7f720f","yearly10PercentOffFirstYear":"9dd694fb-96e1-472c-8d9e-3c868d5c1506","yearlyForStudents":"e29345ef-ab1c-4234-95c5-70e50fe6bc23","monthlyCad":"p52orjkaceei","yearlyCad":"h4q9g2up9ktt"},"braintreeDiscountId":{"oneMonthFree":"MONTHS_FREE_01","threeMonthsFree":"MONTHS_FREE_03","sixMonthsFree":"MONTHS_FREE_06","fiftyPercentOffOneYear":"FIFTY_PERCENT_OFF_ONE_YEAR"},"3DSecureVersion":"2","defaultCurrency":"usd","providerPlanIdCurrency":{"4ycw":"usd","rz3b":"usd","3kqm":"usd","jzw6":"usd","c2q2":"usd","nnsw":"usd","q8qw":"usd","d9y6":"usd","fx7w":"cad","nwf2":"cad"}},"paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","paypal":{"host":"https:\u002F\u002Fapi.paypal.com:443","clientMode":"production","serverMode":"live","webhookId":"4G466076A0294510S","monthlyPlan":{"planId":"P-9WR0658853113943TMU5FDQA","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlan":{"planId":"P-7N8963881P8875835MU5JOPQ","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com\u002Fredeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"},"oldMonthlyPlan":{"planId":"P-96U02458LM656772MJZUVH2Y","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlan":{"planId":"P-59P80963JF186412JJZU3SMI","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"monthlyPlanWithTrial":{"planId":"P-66C21969LR178604GJPVKUKY","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlanWithTrial":{"planId":"P-6XW32684EX226940VKCT2MFA","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oldMonthlyPlanNoSetupFee":{"planId":"P-4N046520HR188054PCJC7LJI","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlanNoSetupFee":{"planId":"P-7A4913502Y5181304CJEJMXQ","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"sdkUrl":"https:\u002F\u002Fwww.paypal.com\u002Fsdk\u002Fjs"},"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","log":{"json":true,"level":"info"},"imageUploadMaxSizeMb":25,"staffPicks":{"title":"Staff Picks","catalogId":"c7bc6e1ee00f"}},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","viewer":null,"variantFlags":[{"__typename":"VariantFlag","name":"enable_author_cards","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rex_new_push_notification_endpoint","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"available_monthly_premium_plan","valueType":{"__typename":"VariantFlagString","value":"12a660186432"}},{"__typename":"VariantFlag","name":"enable_android_dynamic_aspirational_paywall","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_bg_post_post","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_trial_membership","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_footer_app_buttons","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_submissions_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tag_recs","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_webhook","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rex_post_viewed_digest_filtering","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_apple_sign_in","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_homepage","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_mastodon_avatar_upload","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tipping_v0_android","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"textshots_userid","valueType":{"__typename":"VariantFlagString","value":""}},{"__typename":"VariantFlag","name":"coronavirus_topic_recirc","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_android_offline_reading","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tick_landing_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_trust_service_recaptcha","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_lock_responses","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_topic_portals","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"available_monthly_plan","valueType":{"__typename":"VariantFlagString","value":"60e220181034"}},{"__typename":"VariantFlag","name":"enable_rito_upstream_deadlines","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_seamless_social_sharing","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_in_app_free_trial","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_creator_welcome_email","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ml_rank_enable_ranker_member_split_v1","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"price_smoke_test_yearly","valueType":{"__typename":"VariantFlagString","value":""}},{"__typename":"VariantFlag","name":"enable_premium_tier_badge","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tipping_v0_ios","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_home_post_menu","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"redefined_top_posts","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_update_explore_wtf","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_maim_the_meter","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_mastodon_for_members","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_abandoned_cart_promotion_email","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_continue_this_thread","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_new_stripe_customers","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_moc_load_processor_first_story","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rex_aggregator_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_automod","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_remove_canonical_url_for_pub_editor","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_sunset_lo_non_moc_upsell","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"android_enable_editor_new_publishing_flow","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_boost_experiment","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"enable_google_one_tap","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_notifications_submissions_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_conversion_model_v2","valueType":{"__typename":"VariantFlagString","value":"group_2"}},{"__typename":"VariantFlag","name":"enable_sprig_in_apps","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_writer_notification_upsell_banner","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_dense_post_preview","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"enable_lite_server_upstream_deadlines","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_starspace","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_android_verified_author","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_engagement_service_publish_response","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_inline_comments","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"signup_services","valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap,apple"}},{"__typename":"VariantFlag","name":"enable_braintree_apple_pay","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_intrinsic_automatic_actions","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ranker_v10","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"enable_recirc_model","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_susi_redesign_ios","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"available_annual_plan","valueType":{"__typename":"VariantFlagString","value":"2c754bcc2995"}},{"__typename":"VariantFlag","name":"enable_lite_archive_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_recommended_publishers_query","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_switch_plan_premium_tier","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_hybrid_ranking_model","valueType":{"__typename":"VariantFlagString","value":"experiment"}},{"__typename":"VariantFlag","name":"enable_medium2_kbfd","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_moc_load_processor_c","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_pill_based_home_feed","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_friend_links_creation","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_marketing_emails","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"reengagement_notification_duration","valueType":{"__typename":"VariantFlagNumber","value":3}},{"__typename":"VariantFlag","name":"rex_moc_load_offset","valueType":{"__typename":"VariantFlagNumber","value":-5}},{"__typename":"VariantFlag","name":"allow_access","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"can_send_tips_v0","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_easy_resubscribe","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_medium_com_canonical_urls","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_pre_pp_v4","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_members_only_audio","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_iceland_forced_android","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rex_reading_history","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_lists_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_smart_sidebar_order","valueType":{"__typename":"VariantFlagString","value":"lastPublishedAt"}},{"__typename":"VariantFlag","name":"enable_sprig","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_syntax_highlight","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_integration","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"limit_user_follows","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"reader_fair_distribution_non_qp","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_moc_load_processor_all_recs_surfaces","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_dynamic_paywall_programming","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_premium_tier","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"kiln_enable_new_digest_endpoint","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"onboarding_tags_from_top_views","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"rex_generator_max_candidates","valueType":{"__typename":"VariantFlagNumber","value":1000}},{"__typename":"VariantFlag","name":"allow_signup","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_display_paywall_after_onboarding","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_google_pay","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_dynamic_paywall_optin","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"ios_social_share_sheet","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"price_smoke_test_monthly","valueType":{"__typename":"VariantFlagString","value":""}},{"__typename":"VariantFlag","name":"enable_aurora_pub_follower_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_android_dynamic_programming_paywall","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_live_page_filling_small_publications","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"disable_rex_pub_featuring_recirc","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_paypal","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_mobile_digest","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_sharer_validate_post_share_key","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"allow_test_auth","valueType":{"__typename":"VariantFlagString","value":"disallow"}},{"__typename":"VariantFlag","name":"enable_newsletter_lo_flow_custom_domains","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_reliable_follow_experience_backend","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_friend_links_postpage_banners","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_two_hour_refresh","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_cache_less_following_feed","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_legacy_feed_in_iceland","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_simplified_digest_v2_b","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_user_profile_nofollow_attribute","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_verifications_service","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_deviant_get_variant_flag_from_medium2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_dynamic_paywall_aspiriational","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"goliath_externalsearch_enable_comment_deindexation","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_app_flirty_thirty","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_google_webhook","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_offline_reading","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_knock_push_notification_list_clapped","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"disable_partner_program_enrollment","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_pp_v4","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_deprecate_legacy_providers_v3","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ml_rank_rex_anno","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"rex_enable_filter_viewed_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_updated_writer_stats","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_winback_promotion_email","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"get_highlights_from_engagement","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_friend_links_creation","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"available_annual_premium_plan","valueType":{"__typename":"VariantFlagString","value":"4a442ace1476"}},{"__typename":"VariantFlag","name":"can_receive_tips_v0","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_diversification_rex","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_post_publish_permission_check","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_recaptcha_enterprise","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_image_sharer","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"browsable_stream_config_bucket","valueType":{"__typename":"VariantFlagString","value":"curated-topics"}},{"__typename":"VariantFlag","name":"enable_author_cards_byline","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_sharer_create_post_share_key","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_abandoned_paywall_promotion_email","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_story_page_nofollow_meta_tag","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_autorefresh","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_updated_pub_recs_ui","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"disable_branch_openinapp_android","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_configure_pronouns","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_conversion_ranker_v2","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"enable_lite_publications","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_new_manage_membership_flow","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_pp_country_expansion","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_pp_delinquency_and_forfeiture","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_susi_redesign_android","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_friend_links_postpage_banners","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"signin_services","valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap,apple"}},{"__typename":"VariantFlag","name":"enable_apple_webhook","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_speechify_ios","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_verified_book_author","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_iceland_nux","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_remove_twitter_onboarding_step","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_android_miro_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_group_gifting","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"skip_fs_cache_user_vals","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_mastodon_for_members_username_selection","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_speechify_widget","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"glyph_font_set","valueType":{"__typename":"VariantFlagString","value":"m2-unbound-source-serif-pro"}},{"__typename":"VariantFlag","name":"android_rating_prompt_stories_read_threshold","valueType":{"__typename":"VariantFlagNumber","value":2}},{"__typename":"VariantFlag","name":"enable_entities_to_follow_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_eventstats_event_processing","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lo_homepage","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"enable_see_pronouns","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tribute_landing_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_client","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"limit_post_referrers","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"mobile_custom_app_icon","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_cancellation_discount_v1_1","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_response_markup","valueType":{"__typename":"VariantFlagBoolean","value":true}}],"collectionByDomainOrSlug({\"domainOrSlug\":\"levelup.gitconnected.com\"})":{"__ref":"Collection:5517fd7b58a6"},"postResult({\"id\":\"af69c5e044db\"})":{"__ref":"Post:af69c5e044db"},"collection({\"id\":\"5517fd7b58a6\"})":{"__ref":"Collection:5517fd7b58a6"}},"ImageMetadata:1*MMpkJtmeCME-6BmGNH5l8A.png":{"__typename":"ImageMetadata","id":"1*MMpkJtmeCME-6BmGNH5l8A.png"},"Collection:5517fd7b58a6":{"__typename":"Collection","id":"5517fd7b58a6","favicon":{"__ref":"ImageMetadata:1*MMpkJtmeCME-6BmGNH5l8A.png"},"domain":"levelup.gitconnected.com","slug":"gitconnected","googleAnalyticsId":"UA-110153932-1","name":"Level Up Coding","avatar":{"__ref":"ImageMetadata:1*5D9oYBd58pyjMkV_5-zXXQ.jpeg"},"description":"Coding tutorials and news. The developer homepage gitconnected.com && skilled.dev && levelup.dev","subscriberCount":279818,"latestPostsConnection({\"paging\":{\"limit\":1}})":{"__typename":"PostConnection","posts":[{"__ref":"Post:e27105c41d2a"}]},"compatV3":{"__ref":"Publication:5517fd7b58a6"},"viewerEdge":{"__ref":"CollectionViewerEdge:collectionId:5517fd7b58a6-viewerId:lo_3cc56975dda8"},"twitterUsername":"gitconnected","facebookPageId":null},"ImageMetadata:1*5D9oYBd58pyjMkV_5-zXXQ.jpeg":{"__typename":"ImageMetadata","id":"1*5D9oYBd58pyjMkV_5-zXXQ.jpeg"},"User:a9348a903105":{"__typename":"User","id":"a9348a903105","customDomainState":null,"hasSubdomain":false,"username":"gaurav21s"},"Post:e27105c41d2a":{"__typename":"Post","id":"e27105c41d2a","firstPublishedAt":1762473761410,"creator":{"__ref":"User:a9348a903105"},"collection":{"__ref":"Collection:5517fd7b58a6"},"isSeries":false,"mediumUrl":"https:\u002F\u002Flevelup.gitconnected.com\u002Fi-tried-everything-to-fix-rag-hallucinations-then-i-found-this-e27105c41d2a","sequence":null,"uniqueSlug":"i-tried-everything-to-fix-rag-hallucinations-then-i-found-this-e27105c41d2a"},"Publication:5517fd7b58a6":{"__typename":"Publication","id":"5517fd7b58a6","theme":{"__typename":"PublicationTheme","accentColor":{"__typename":"ColorValue","rgb":"#3972E0"}}},"LinkedAccounts:b856005e5ecd":{"__typename":"LinkedAccounts","mastodon":null,"id":"b856005e5ecd"},"NewsletterV3:5d72ed47a22c":{"__typename":"NewsletterV3","id":"5d72ed47a22c","type":"NEWSLETTER_TYPE_AUTHOR","slug":"b856005e5ecd","name":"b856005e5ecd","collection":null,"user":{"__ref":"User:b856005e5ecd"}},"User:b856005e5ecd":{"__typename":"User","id":"b856005e5ecd","name":"Fareed Khan","username":"fareedkhandev","newsletterV3":{"__ref":"NewsletterV3:5d72ed47a22c"},"linkedAccounts":{"__ref":"LinkedAccounts:b856005e5ecd"},"isSuspended":false,"imageId":"1*feiUXOR8sid6IPHSHufA-g.jpeg","customDomainState":null,"hasSubdomain":false,"verifications":{"__typename":"VerifiedInfo","isBookAuthor":false},"socialStats":{"__typename":"SocialStats","followerCount":62948,"followingCount":0,"collectionFollowingCount":1},"bio":"I write on AI, https:\u002F\u002Fwww.linkedin.com\u002Fin\u002Ffareed-khan-dev\u002F","membership":{"__ref":"Membership:41a6b290-b9a2-489f-b06f-24d115d2eaec"},"allowNotes":true,"viewerEdge":{"__ref":"UserViewerEdge:userId:b856005e5ecd-viewerId:lo_3cc56975dda8"},"twitterScreenName":""},"Membership:41a6b290-b9a2-489f-b06f-24d115d2eaec":{"__typename":"Membership","tier":"MEMBER","id":"41a6b290-b9a2-489f-b06f-24d115d2eaec"},"Paragraph:cbd607e0f2d5_0":{"__typename":"Paragraph","id":"cbd607e0f2d5_0","name":"ef2a","type":"H3","href":null,"layout":null,"metadata":null,"text":"Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:cbd607e0f2d5_1":{"__typename":"Paragraph","id":"cbd607e0f2d5_1","name":"465e","type":"H4","href":null,"layout":null,"metadata":null,"text":"Planning, Retrieval, Reflection, Critique, Synthesis and more","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:cbd607e0f2d5_2":{"__typename":"Paragraph","id":"cbd607e0f2d5_2","name":"5245","type":"P","href":null,"layout":null,"metadata":null,"text":"Read this story for free: link","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":26,"end":30,"href":"https:\u002F\u002Fmedium.com\u002F@fareedkhandev\u002Faf69c5e044db?source=friends_link&sk=b3f7664c8135b95d057cb90312dc0c44","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:cbd607e0f2d5_3":{"__typename":"Paragraph","id":"cbd607e0f2d5_3","name":"cd12","type":"P","href":null,"layout":null,"metadata":null,"text":"A RAG system often fails not because the LLM lacks intelligence, but because its architecture is too simple. It tries to handle a cyclical, multi-step problem with a linear, one-shot approach.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":81,"end":107,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:cbd607e0f2d5_4":{"__typename":"Paragraph","id":"cbd607e0f2d5_4","name":"b9f5","type":"P","href":null,"layout":null,"metadata":null,"text":"Many complex queries demand reasoning, reflection, and smart decisions about when to act, much like how we retrieve information when faced with a question. That’s where agent-driven actions within the RAG pipeline come into play. Let’s take a look at what a typical deep-thinking RAG pipeline looks like…","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":28,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":39,"end":49,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":55,"end":70,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*ls6zh1GCk5oO_5JzVvTyRg.png":{"__typename":"ImageMetadata","id":"1*ls6zh1GCk5oO_5JzVvTyRg.png","originalHeight":2840,"originalWidth":6617,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:cbd607e0f2d5_5":{"__typename":"Paragraph","id":"cbd607e0f2d5_5","name":"67cc","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"__ref":"ImageMetadata:1*ls6zh1GCk5oO_5JzVvTyRg.png"},"text":"Deep Thinking RAG Pipeline (Created by Fareed Khan)","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":39,"end":50,"href":null,"anchorType":"USER","userId":"b856005e5ecd","linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:cbd607e0f2d5_6":{"__typename":"Paragraph","id":"cbd607e0f2d5_6","name":"84f8","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Plan: First, the agent decomposes the complex user query into a structured, multi-step research plan, deciding which tool (internal document search or web search) is needed for each step.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":5,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:cbd607e0f2d5_7":{"__typename":"Paragraph","id":"cbd607e0f2d5_7","name":"3668","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Retrieve: For each step, it executes an adaptive, multi-stage retrieval funnel, using a supervisor to dynamically choose the best search strategy (vector, keyword, or hybrid).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":9,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:cbd607e0f2d5_8":{"__typename":"Paragraph","id":"cbd607e0f2d5_8","name":"e5d5","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Refine: It then uses a high-precision cross-encoder to rerank the initial results and a distiller agent to compress the best evidence into a concise context.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":7,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:cbd607e0f2d5_9":{"__typename":"Paragraph","id":"cbd607e0f2d5_9","name":"a771","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Reflect: After each step, the agent…","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":8,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"CollectionViewerEdge:collectionId:5517fd7b58a6-viewerId:lo_3cc56975dda8":{"__typename":"CollectionViewerEdge","id":"collectionId:5517fd7b58a6-viewerId:lo_3cc56975dda8","isEditor":false,"isMuting":false,"canEditOwnPosts":false,"canEditPosts":false,"isFollowing":false,"isSubscribedToLetters":false,"isSubscribedToMediumNewsletter":false,"isSubscribedToEmails":false,"isWriter":false},"UserViewerEdge:userId:b856005e5ecd-viewerId:lo_3cc56975dda8":{"__typename":"UserViewerEdge","id":"userId:b856005e5ecd-viewerId:lo_3cc56975dda8","isMuting":false},"PostViewerEdge:postId:af69c5e044db-viewerId:lo_3cc56975dda8":{"__typename":"PostViewerEdge","shouldIndexPostForExternalSearch":true,"id":"postId:af69c5e044db-viewerId:lo_3cc56975dda8"},"Tag:ai":{"__typename":"Tag","id":"ai","displayTitle":"AI","normalizedTagSlug":"ai"},"Tag:artificial-intelligence":{"__typename":"Tag","id":"artificial-intelligence","displayTitle":"Artificial Intelligence","normalizedTagSlug":"artificial-intelligence"},"Tag:data-science":{"__typename":"Tag","id":"data-science","displayTitle":"Data Science","normalizedTagSlug":"data-science"},"Tag:machine-learning":{"__typename":"Tag","id":"machine-learning","displayTitle":"Machine Learning","normalizedTagSlug":"machine-learning"},"Tag:python":{"__typename":"Tag","id":"python","displayTitle":"Python","normalizedTagSlug":"python"},"Post:af69c5e044db":{"__typename":"Post","id":"af69c5e044db","collection":{"__ref":"Collection:5517fd7b58a6"},"content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Flevelup.gitconnected.com\u002Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db\"}})":{"__typename":"PostContent","isLockedPreviewOnly":true,"bodyModel":{"__typename":"RichText","sections":[{"__typename":"Section","name":null,"startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}],"paragraphs":[{"__ref":"Paragraph:cbd607e0f2d5_0"},{"__ref":"Paragraph:cbd607e0f2d5_1"},{"__ref":"Paragraph:cbd607e0f2d5_2"},{"__ref":"Paragraph:cbd607e0f2d5_3"},{"__ref":"Paragraph:cbd607e0f2d5_4"},{"__ref":"Paragraph:cbd607e0f2d5_5"},{"__ref":"Paragraph:cbd607e0f2d5_6"},{"__ref":"Paragraph:cbd607e0f2d5_7"},{"__ref":"Paragraph:cbd607e0f2d5_8"},{"__ref":"Paragraph:cbd607e0f2d5_9"}]},"validatedShareKey":"","shareKeyCreator":null},"creator":{"__ref":"User:b856005e5ecd"},"inResponseToEntityType":null,"isLocked":true,"isMarkedPaywallOnly":false,"lockedSource":"LOCKED_POST_SOURCE_UGC","mediumUrl":"https:\u002F\u002Flevelup.gitconnected.com\u002Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db","primaryTopic":null,"topics":[],"isLimitedState":false,"isPublished":true,"allowResponses":true,"responsesLocked":false,"visibility":"LOCKED","latestPublishedVersion":"cbd607e0f2d5","postResponses":{"__typename":"PostResponses","count":18},"responseDistribution":"NOT_DISTRIBUTED","clapCount":1709,"title":"Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries","isSeries":false,"sequence":null,"uniqueSlug":"building-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db","socialTitle":"","socialDek":"","canonicalUrl":"https:\u002F\u002Flevelup.gitconnected.com\u002Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db","metaDescription":"","latestPublishedAt":1760931367255,"readingTime":67.69716981132075,"previewContent":{"__typename":"PreviewContent","subtitle":"Planning, Retrieval, Reflection, Critique, Synthesis and more"},"previewImage":{"__ref":"ImageMetadata:1*ls6zh1GCk5oO_5JzVvTyRg.png"},"isShortform":false,"seoMetaTags":{"__typename":"SEOMetaTags","jsonLd":"{\"@context\":\"https:\u002F\u002Fschema.org\",\"@id\":\"https:\u002F\u002Flevelup.gitconnected.com\u002Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db\",\"@type\":\"SocialMediaPosting\",\"image\":[\"https:\u002F\u002Fmiro.medium.com\u002F\"],\"url\":\"https:\u002F\u002Flevelup.gitconnected.com\u002Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db\",\"dateCreated\":\"2025-10-20T03:36:07Z\",\"datePublished\":\"2025-10-20T03:36:07Z\",\"dateModified\":\"2025-10-20T03:36:07Z\",\"headline\":\"Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries\",\"name\":\"Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries\",\"description\":\"“” is published by Fareed Khan in Level Up Coding.\",\"identifier\":\"af69c5e044db\",\"author\":{\"@context\":\"https:\u002F\u002Fschema.org\",\"@id\":\"https:\u002F\u002Fmedium.com\u002F@fareedkhandev\",\"@type\":\"Person\",\"identifier\":\"fareedkhandev\",\"name\":\"Fareed Khan\",\"url\":\"https:\u002F\u002Fmedium.com\u002F@fareedkhandev\"},\"creator\":{\"@context\":\"https:\u002F\u002Fschema.org\",\"@id\":\"https:\u002F\u002Fmedium.com\u002F@fareedkhandev\",\"@type\":\"Person\",\"identifier\":\"fareedkhandev\",\"name\":\"Fareed Khan\",\"url\":\"https:\u002F\u002Fmedium.com\u002F@fareedkhandev\"},\"publisher\":{\"@context\":\"https:\u002F\u002Fschema.org\",\"@type\":\"Organization\",\"@id\":\"https:\u002F\u002Flevelup.gitconnected.com\",\"name\":\"Level Up Coding\",\"description\":\"Coding tutorials and news. The developer homepage gitconnected.com \\u0026\\u0026 skilled.dev \\u0026\\u0026 levelup.dev\",\"url\":\"https:\u002F\u002Flevelup.gitconnected.com\",\"sameAs\":[\"https:\u002F\u002Ftwitter.com\u002Fgitconnected\",\"https:\u002F\u002Ffacebook.com\u002Fgitconnectednetwork\",\"https:\u002F\u002Finstagram.com\u002Fskilled.dev\u002F\"],\"logo\":{\"@type\":\"ImageObject\",\"width\":400,\"height\":400,\"url\":\"https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:400\u002F1%2A5D9oYBd58pyjMkV_5-zXXQ.jpeg\"}},\"mainEntityOfPage\":\"https:\u002F\u002Flevelup.gitconnected.com\u002Fbuilding-an-agentic-deep-thinking-rag-pipeline-to-solve-complex-queries-af69c5e044db\",\"isAccessibleForFree\":false,\"hasPart\":{\"@type\":\"WebPageElement\",\"isAccessibleForFree\":false,\"cssSelector\":\".meteredContent\"}}"},"seoDescription":"“” is published by Fareed Khan in Level Up Coding.","shortformType":"SHORTFORM_TYPE_LINK","firstPublishedAt":1760931367255,"viewerEdge":{"__ref":"PostViewerEdge:postId:af69c5e044db-viewerId:lo_3cc56975dda8"},"seoTitle":"","isSuspended":false,"license":"ALL_RIGHTS_RESERVED","tags":[{"__ref":"Tag:ai"},{"__ref":"Tag:artificial-intelligence"},{"__ref":"Tag:data-science"},{"__ref":"Tag:machine-learning"},{"__ref":"Tag:python"}],"isFeaturedInPublishedPublication":false,"isNewsletter":false,"statusForCollection":"APPROVED","pendingCollection":null,"detectedLanguage":"en","wordCount":17476}}</script><script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/manifest.6d22dff2.js"></script><script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/723.128cd04d.js"></script><script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/main.16e71a9b.js"></script><script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/5052.eb638269.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/628.add32a62.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/6062.c3638afc.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/7566.14491814.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/3777.af05bea9.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/7908.9ea3c3f3.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/3927.2f9f3eed.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/8640.9dfdf08f.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/9967.08537ce5.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/3862.a0fe9068.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/6372.c6e20496.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/4967.9a25c6a2.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/3404.d2326e3a.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/7381.c53435ab.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/9347.2f2dd2a7.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/4929.2040a04e.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/6834.6c66e3cc.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/8441.773bce63.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/3877.769556c7.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/7979.35c5b2af.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/7975.3f8d607c.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/9256.c0f021df.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/8768.71979c5d.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/6509.24ccb2bc.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/4269.56ac711a.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/3666.122df09d.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/1069.bbe95674.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/6026.904e1f2d.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/7695.47976815.chunk.js"></script>
<script src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/PostPage.MainContent.2a6e2348.chunk.js"></script>
<script id="__LOADABLE_REQUIRED_CHUNKS__" type="application/json">[6183,2951,2698,3974,2527,2886,5258]</script>
<script id="__LOADABLE_REQUIRED_CHUNKS___ext" type="application/json">{"namedChunks":["instrumentation","reporting","PostResponsesContent","responses.editor"]}</script>
<script async="" data-chunk="instrumentation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/instrumentation.434115b9.chunk.js"></script>
<script async="" data-chunk="reporting" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/reporting.851fdaca.chunk.js"></script>
<script async="" data-chunk="PostResponsesContent" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/2698.9eecb474.chunk.js"></script>
<script async="" data-chunk="PostResponsesContent" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/3974.82493a33.chunk.js"></script>
<script async="" data-chunk="PostResponsesContent" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/2527.ed913434.chunk.js"></script>
<script async="" data-chunk="PostResponsesContent" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/PostResponsesContent.e940a3b4.chunk.js"></script>
<script async="" data-chunk="responses.editor" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/responses.editor.d61aa7c4.chunk.js"></script><script>window.main();</script><div><div class="grecaptcha-badge" data-style="bottomright" style="width: 256px; height: 60px; display: block; transition: right 0.3s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0px 0px 5px; border-radius: 2px; overflow: hidden;"><div class="grecaptcha-logo"><iframe title="reCAPTCHA" width="256" height="60" role="presentation" name="a-7edwihse1u0k" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/anchor.html"></iframe></div><div class="grecaptcha-error"></div><textarea id="g-recaptcha-response-100000" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div><iframe style="display: none;" src="./Building an Agentic Deep-Thinking RAG Pipeline to Solve Complex Queries _ by Fareed Khan _ Oct, 2025 _ Level Up Coding_files/saved_resource(1).html"></iframe></div><div><div class="ui o wm wn ia wo wp wq wr ws wt wu wv ww wx co bq wy wz xa nq xb xc"><div class="bg b ec ab ew"><div class="ac cw xd xe"><div class="m" role="alert">To make Medium work, we log user data. By using Medium, you agree to our <a class="ah ai aj fo al am an ao ap aq ar xf xg ib" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9" rel="noopener follow" target="_blank">Privacy Policy</a>, including cookie policy.</div><div class="xh xi xj xk xl xm m xn cb xo"><div class="m fr o xp"><button class="ah ai aj fo al am an ao ap aq ar xf xg xq xr ac" data-testid="close-button" aria-label="close"><svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" viewBox="0 0 19 19" class="ex ew"><path fill-rule="evenodd" d="m13.792 4.6-4.29 4.29-4.29-4.29-.612.613 4.29 4.29-4.29 4.29.613.612 4.29-4.29 4.29 4.29.612-.613-4.29-4.29 4.29-4.29"></path></svg></button></div></div></div></div></div></div></body></html>