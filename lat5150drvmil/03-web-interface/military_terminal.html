<!DOCTYPE html>
<html>
<head>
    <title>DSMIL TACTICAL SYSTEM v7.0</title>
    <meta charset="UTF-8">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            overflow: hidden;
            font-size: 14px;
        }

        .container {
            display: grid;
            grid-template-rows: 60px 1fr 300px;
            height: 100vh;
            padding: 10px;
            gap: 10px;
        }

        .header {
            background: linear-gradient(180deg, #001100 0%, #003300 100%);
            border: 2px solid #0f0;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 10px #0f0;
        }

        .status {
            display: flex;
            gap: 20px;
        }

        .metric {
            font-size: 12px;
            opacity: 0.8;
        }

        .value {
            color: #ff0;
            font-weight: bold;
            margin-left: 5px;
        }

        .main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .panel {
            background: #001100;
            border: 2px solid #0f0;
            padding: 15px;
            overflow-y: auto;
            position: relative;
        }

        .panel-title {
            color: #ff0;
            font-size: 16px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #0f0;
        }

        .command-input {
            background: #000;
            border: 2px solid #0f0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .prompt-line {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prompt {
            color: #0f0;
            font-weight: bold;
        }

        #userInput {
            flex: 1;
            background: #001100;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        #userInput:focus {
            outline: none;
            box-shadow: 0 0 10px #0f0;
        }

        .shortcuts {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
        }

        .shortcut-btn {
            background: #001100;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            transition: all 0.1s;
        }

        .shortcut-btn:hover {
            background: #003300;
            box-shadow: 0 0 5px #0f0;
        }

        .shortcut-btn:active {
            background: #0f0;
            color: #000;
        }

        .output-line {
            padding: 2px 0;
            line-height: 1.4;
        }

        .output-prompt {
            color: #ff0;
        }

        .output-response {
            color: #0f0;
            white-space: pre-wrap;
            margin-bottom: 10px;
        }

        .output-error {
            color: #f00;
        }

        .output-info {
            color: #0ff;
        }

        .loading {
            color: #ff0;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 12px;
        }

        .metric-item {
            padding: 5px;
            background: #000;
            border: 1px solid #0f0;
        }

        .metric-label {
            color: #ff0;
        }

        .metric-value {
            color: #0f0;
            font-size: 16px;
            font-weight: bold;
        }

        .glow {
            text-shadow: 0 0 10px currentColor;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #001100;
        }

        ::-webkit-scrollbar-thumb {
            background: #0f0;
            border: 1px solid #003300;
        }

        .model-select {
            background: #001100;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="title glow">DSMIL TACTICAL SYSTEM v7.0</div>
            <div class="status">
                <span class="metric">NPU:<span class="value" id="npu-tops">26.4</span> TOPS</span>
                <span class="metric">GPU:<span class="value" id="gpu-tops">40</span> TOPS</span>
                <span class="metric">NCS2:<span class="value" id="ncs2-tops">10</span> TOPS</span>
                <span class="metric">AVX512:<span class="value" id="avx512">ON</span></span>
                <span class="metric">MODE5:<span class="value" id="mode5">STD</span></span>
                <span class="metric">USER:<span class="value" id="presence">ACTIVE</span></span>
            </div>
        </div>

        <!-- Main panels -->
        <div class="main">
            <!-- Left: AI Chat -->
            <div class="panel">
                <div class="panel-title">AI TERMINAL - HARDWARE ATTESTED</div>
                <div id="aiOutput" style="height: calc(100% - 30px); overflow-y: auto;"></div>
            </div>

            <!-- Right: System Status -->
            <div class="panel">
                <div class="panel-title">SYSTEM STATUS</div>
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-label">AI MODEL</div>
                        <div class="metric-value" id="ai-model">LOADING...</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">INFERENCE TIME</div>
                        <div class="metric-value" id="inference-time">-- ms</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">TOKENS/SEC</div>
                        <div class="metric-value" id="tokens-sec">--</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">DSMIL DEVICE</div>
                        <div class="metric-value" id="dsmil-device">16</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">ATTESTATION</div>
                        <div class="metric-value" id="attestation">READY</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">FLUX STATUS</div>
                        <div class="metric-value" id="flux-status">STANDBY</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">RAG DOCS</div>
                        <div class="metric-value" id="rag-docs">0</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">TOTAL COMPUTE</div>
                        <div class="metric-value" id="total-compute">76.4</div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <div class="metric-label">RECENT OPERATIONS</div>
                    <div id="recentOps" style="font-size: 11px; margin-top: 5px; max-height: 200px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>

        <!-- Command input -->
        <div class="command-input">
            <div class="prompt-line">
                <span class="prompt">TACTICAL></span>
                <input type="text" id="userInput" placeholder="Enter command or query..." autocomplete="off">
                <select class="model-select" id="modelSelect">
                    <option value="auto">AUTO</option>
                    <option value="fast">FAST</option>
                    <option value="large">LARGE</option>
                </select>
            </div>
            <div class="shortcuts">
                <button class="shortcut-btn" onclick="executeShortcut('status')">F1: STATUS</button>
                <button class="shortcut-btn" onclick="executeShortcut('avx512')">F2: AVX512</button>
                <button class="shortcut-btn" onclick="executeShortcut('npu')">F3: NPU</button>
                <button class="shortcut-btn" onclick="executeShortcut('rag')">F4: RAG</button>
                <button class="shortcut-btn" onclick="executeShortcut('flux')">F5: FLUX</button>
                <button class="shortcut-btn" onclick="executeShortcut('github')">F6: GITHUB</button>
                <button class="shortcut-btn" onclick="executeShortcut('collect')">F7: COLLECT</button>
                <button class="shortcut-btn" onclick="executeShortcut('prompt')">F8: PROMPT</button>
                <button class="shortcut-btn" onclick="executeShortcut('help')">F9: HELP</button>
            </div>
        </div>
    </div>

    <script>
        const aiOutput = document.getElementById('aiOutput');
        const userInput = document.getElementById('userInput');
        const modelSelect = document.getElementById('modelSelect');

        // Command history
        let commandHistory = [];
        let historyIndex = -1;

        // Add output to AI terminal
        function addOutput(text, type = 'response') {
            const div = document.createElement('div');
            div.className = `output-line output-${type}`;
            div.textContent = text;
            aiOutput.appendChild(div);
            aiOutput.scrollTop = aiOutput.scrollHeight;
        }

        function addPrompt(text) {
            const div = document.createElement('div');
            div.className = 'output-line';
            div.innerHTML = `<span class="output-prompt">TACTICAL></span> ${text}`;
            aiOutput.appendChild(div);
            aiOutput.scrollTop = aiOutput.scrollHeight;
        }

        // Execute command
        async function executeCommand(cmd) {
            if (!cmd.trim()) return;

            addPrompt(cmd);
            commandHistory.unshift(cmd);
            historyIndex = -1;

            // Check if it's a shell command or AI query
            if (cmd.startsWith('/') || cmd.startsWith('!')) {
                await executeShellCommand(cmd.substring(1));
            } else {
                await executeAIQuery(cmd);
            }
        }

        // Execute AI query
        async function executeAIQuery(query) {
            const model = modelSelect.value;
            addOutput('â–¶ Processing...', 'loading');

            try {
                const response = await fetch(`/ai/chat?msg=${encodeURIComponent(query)}&model=${model}`);
                const data = await response.json();

                // Remove loading message
                const loading = aiOutput.querySelector('.output-loading');
                if (loading) loading.remove();

                if (data.error) {
                    addOutput(`ERROR: ${data.error}`, 'error');
                    if (data.suggestion) {
                        addOutput(`ðŸ’¡ ${data.suggestion}`, 'info');
                    }
                } else {
                    addOutput(data.response);

                    // Update metrics
                    document.getElementById('ai-model').textContent = data.model_tier.toUpperCase();
                    document.getElementById('inference-time').textContent = `${data.inference_time}s`;
                    document.getElementById('tokens-sec').textContent = data.tokens_per_sec;
                    document.getElementById('attestation').textContent = data.attestation.verified ? 'VALID' : 'FAIL';

                    // Add to recent ops
                    addRecentOp(`AI Query (${data.model_tier}): ${data.inference_time}s`);
                }
            } catch (error) {
                const loading = aiOutput.querySelector('.output-loading');
                if (loading) loading.remove();
                addOutput(`CONNECTION ERROR: ${error.message}`, 'error');
            }
        }

        // Execute shell command
        async function executeShellCommand(cmd) {
            try {
                const response = await fetch(`/exec?cmd=${encodeURIComponent(cmd)}`);
                const data = await response.json();

                if (data.error) {
                    addOutput(`ERROR: ${data.error}`, 'error');
                } else {
                    if (data.stdout) addOutput(data.stdout);
                    if (data.stderr) addOutput(data.stderr, 'error');
                    addRecentOp(`Shell: ${cmd}`);
                }
            } catch (error) {
                addOutput(`ERROR: ${error.message}`, 'error');
            }
        }

        // Shortcut functions
        async function executeShortcut(type) {
            switch(type) {
                case 'status':
                    executeAIQuery('Give me full system status including NPU, GPU, NCS2, AVX-512, and DSMIL devices');
                    break;
                case 'avx512':
                    executeShellCommand('cat /proc/dsmil_avx512');
                    break;
                case 'npu':
                    executeShellCommand('cat /home/john/.claude/npu-military.env');
                    break;
                case 'rag':
                    executeAIQuery('What documents are in the RAG system?');
                    break;
                case 'flux':
                    executeAIQuery('What is my current Flux network allocation and estimated earnings?');
                    break;
                case 'github':
                    executeShellCommand('ls -la /home/john/github_repos');
                    break;
                case 'collect':
                    executeAIQuery('How do I use the smart paper collector?');
                    break;
                case 'prompt':
                    executeCommand('/cat /home/john/.claude/custom_system_prompt.txt');
                    break;
                case 'help':
                    addHelp();
                    break;
            }
        }

        function addHelp() {
            addOutput('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            addOutput('DSMIL TACTICAL SYSTEM v7.0 - COMMAND REFERENCE', 'info');
            addOutput('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            addOutput('', 'info');
            addOutput('AI QUERIES: Type naturally, system auto-routes to fast/large model', 'info');
            addOutput('SHELL COMMANDS: Prefix with ! or /', 'info');
            addOutput('', 'info');
            addOutput('SHORTCUTS:', 'info');
            addOutput('  F1 - Full system status with all hardware', 'info');
            addOutput('  F2 - AVX-512 unlock status', 'info');
            addOutput('  F3 - NPU military mode status', 'info');
            addOutput('  F4 - RAG document system', 'info');
            addOutput('  F5 - Flux network earnings', 'info');
            addOutput('  F6 - GitHub repositories', 'info');
            addOutput('  F7 - Smart paper collector', 'info');
            addOutput('  F8 - View/edit system prompt', 'info');
            addOutput('  F9 - This help', 'info');
            addOutput('', 'info');
            addOutput('HARDWARE: 76.4 TOPS total (NPU 26.4 + GPU 40 + NCS2 10)', 'info');
            addOutput('SECURITY: Mode 5 STANDARD with DSMIL attestation', 'info');
            addOutput('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
        }

        function addRecentOp(text) {
            const recentOps = document.getElementById('recentOps');
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.textContent = `[${timestamp}] ${text}`;
            div.style.color = '#0f0';
            recentOps.insertBefore(div, recentOps.firstChild);

            // Keep only last 20 operations
            while (recentOps.children.length > 20) {
                recentOps.removeChild(recentOps.lastChild);
            }
        }

        // Input handlers
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                executeCommand(this.value);
                this.value = '';
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    this.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    this.value = commandHistory[historyIndex];
                } else if (historyIndex === 0) {
                    historyIndex = -1;
                    this.value = '';
                }
            }
        });

        // F-key handlers
        document.addEventListener('keydown', function(e) {
            if (e.key >= 'F1' && e.key <= 'F9') {
                e.preventDefault();
                const shortcuts = ['status', 'avx512', 'npu', 'rag', 'flux', 'github', 'collect', 'prompt', 'help'];
                const index = parseInt(e.key.substring(1)) - 1;
                executeShortcut(shortcuts[index]);
            }
        });

        // Initialize
        async function init() {
            addOutput('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            addOutput('DSMIL TACTICAL SYSTEM v7.0', 'info');
            addOutput('Hardware-Attested AI with Mode 5 Platform Integrity', 'info');
            addOutput('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            addOutput('', 'info');

            // Check AI status
            try {
                const response = await fetch('/ai/status');
                const data = await response.json();

                if (data.ollama && data.ollama.connected) {
                    addOutput('âœ“ AI Engine: ONLINE', 'info');
                    addOutput(`âœ“ Fast Model: ${data.models.fast.available ? 'READY' : 'UNAVAILABLE'}`, 'info');
                    addOutput(`âœ“ Large Model: ${data.models.large.available ? 'READY' : 'UNAVAILABLE'}`, 'info');
                    addOutput(`âœ“ DSMIL: Mode ${data.dsmil.mode5.mode5_level}`, 'info');
                    document.getElementById('ai-model').textContent = 'READY';
                } else {
                    addOutput('âš  AI Engine: OFFLINE', 'error');
                    addOutput('  Run: ollama pull llama3.2:3b-instruct-q4_K_M', 'error');
                    document.getElementById('ai-model').textContent = 'OFFLINE';
                }
            } catch (error) {
                addOutput('âš  Cannot connect to server', 'error');
            }

            addOutput('', 'info');
            addOutput('Type query or press F9 for help', 'info');
            addOutput('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');

            userInput.focus();

            // Update status metrics every 5 seconds
            setInterval(updateStatus, 5000);
        }

        async function updateStatus() {
            // Update presence
            try {
                const response = await fetch('/exec?cmd=python3%20/home/john/gna_presence_detector.py');
                const data = await response.json();
                if (data.stdout && data.stdout.includes('PRESENT')) {
                    document.getElementById('presence').textContent = 'ACTIVE';
                    document.getElementById('flux-status').textContent = 'MINIMAL';
                } else if (data.stdout && data.stdout.includes('IDLE')) {
                    document.getElementById('presence').textContent = 'IDLE';
                    document.getElementById('flux-status').textContent = 'MODERATE';
                } else {
                    document.getElementById('presence').textContent = 'AWAY';
                    document.getElementById('flux-status').textContent = 'FULL';
                }
            } catch (error) {
                // Silent fail
            }
        }

        // Start
        init();
    </script>
</body>
</html>
