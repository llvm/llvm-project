# DKMS Configuration for TPM2 Early Boot Acceleration
# Package: tpm2-accel-early-dkms
# Version: 1.0.0
#
# Provides Intel NPU/GNA/ME hardware acceleration for TPM2 operations
# with early boot initialization support.

PACKAGE_NAME="tpm2-accel-early"
PACKAGE_VERSION="1.0.0"

# Built modules
BUILT_MODULE_NAME[0]="tpm2_accel_early"
BUILT_MODULE_LOCATION[0]="."
DEST_MODULE_LOCATION[0]="/kernel/drivers/tpm"

# Build configuration
MAKE[0]="make KERNELRELEASE=\${kernelver} KERNEL_DIR=\${kernel_source_dir} -C \${dkms_tree}/\${PACKAGE_NAME}/\${PACKAGE_VERSION}/build all"
CLEAN="make clean"

# Module installation
AUTOINSTALL="yes"
REMAKE_INITRD="yes"

# Minimum kernel version requirement
KERNEL_VERSION_MINIMUM="6.14.0"

# Module parameters (security level defaults to UNCLASSIFIED)
MODULE_CONF[0]="options tpm2_accel_early early_init=1 debug_mode=0 security_level=0"

# Early boot loading configuration
MODULES_CONF[0]="tpm2_accel_early"

# Dependencies
BUILD_DEPENDS[0]="linux-headers"
BUILD_DEPENDS[1]="gcc"
BUILD_DEPENDS[2]="make"

# Module description
PACKAGE_DESCRIPTION="TPM2 Early Boot Hardware Acceleration (Intel NPU 34.0 TOPS)"

# Post-build validation
POST_BUILD="modinfo \${BUILT_MODULE_NAME[0]}.ko && test -s \${BUILT_MODULE_NAME[0]}.ko"

# Post-install (update initramfs for early boot)
POST_INSTALL="update-initramfs -u"
