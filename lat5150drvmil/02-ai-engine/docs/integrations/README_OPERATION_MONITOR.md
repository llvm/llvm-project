# DSMIL Operation Monitor & Controller

## Overview

Enhanced interactive TUI for monitoring and executing operations on all 80 DSMIL devices with 656 total operations.

## Features

‚úì **656 Operations Across 80 Devices** - Complete operation catalog
‚úì **Operation-Level Control** - Execute and monitor individual operations
‚úì **Real-Time Monitoring** - Live execution feedback and status
‚úì **Robust Error Handling** - Comprehensive logging and error recovery
‚úì **Execution History** - Track all operation executions with timestamps
‚úì **Safety Enforcement** - Quarantined devices blocked automatically

## Quick Start

```bash
# Launch the operation monitor TUI
sudo python3 /home/user/LAT5150DRVMIL/02-ai-engine/dsmil_operation_monitor.py
```

## TUI Navigation

### Device List View (Main)

```
Keys:
  ‚Üë/‚Üì     - Navigate devices
  ENTER   - View device operations
  L       - View execution log
  Q       - Quit
```

Shows all 80 devices with:
- Device ID (hex)
- Device name
- Operation count
- Register count
- Group assignment
- Risk level (üü¢ Safe, üü° Monitored, üî¥ Quarantined)

### Operation List View

```
Keys:
  ‚Üë/‚Üì     - Navigate operations
  ENTER   - View operation details
  E       - Execute operation
  ESC     - Back to device list
  Q       - Quit
```

Shows all operations for selected device:
- Operation signature
- Parameter list
- Execution count
- Last status (‚úì Success, ‚úó Failed, ‚äò Skipped)

### Operation Detail View

```
Keys:
  E       - Execute operation
  ESC     - Back to operation list
  Q       - Quit
```

Shows detailed operation information:
- Full signature with types
- Description/docstring
- Parameter details
- Execution statistics
- Last execution result

### Execution Log View

```
Keys:
  ESC     - Back to device list
  Q       - Quit
```

Shows execution history:
- Timestamp
- Device ID
- Operation name
- Duration (ms)
- Status (Success/Failed)

## Operation Execution

The monitor currently supports **safe read-only operations**:

‚úì `initialize()` - Initialize device
‚úì `get_status()` - Get device status
‚úì `get_capabilities()` - Get device capabilities

Operations requiring parameters or with write capabilities are **skipped** for safety.

## Safety Features

1. **Quarantine Enforcement** - Devices marked as QUARANTINED are blocked at execution time
2. **Read-Only Operations** - Only safe read operations execute automatically
3. **Error Logging** - All errors logged to `/tmp/dsmil_operation_monitor.log`
4. **Execution History** - Complete audit trail saved to `/tmp/dsmil_execution_history.json`

## Logs and Output

**TUI Log:**
```bash
tail -f /tmp/dsmil_operation_monitor.log
```

**Execution History:**
```bash
cat /tmp/dsmil_execution_history.json
```

## Examples

### View TPM Control Operations

1. Launch TUI
2. Navigate to `TPMControlDevice (0x8000)` with arrow keys
3. Press ENTER to view 41 operations
4. Navigate to `get_status()`
5. Press E to execute

### Monitor Network Security Device

1. Launch TUI
2. Navigate to `NetworkSecurityDevice (0x8013)`
3. Press ENTER to view operations
4. Press E on any safe operation
5. Press L to view execution log

## Device Statistics

| Statistic | Value |
|-----------|-------|
| Total Devices | 80 |
| Total Operations | 656 |
| Total Registers | 273 |
| Avg Operations/Device | 8.2 |
| Most Complex Device | TPMControlDevice (41 ops) |

## Most Complex Devices

1. **0x8000**: TPMControlDevice - 41 operations
2. **0x8002**: CredentialVaultDevice - 15 operations
3. **0x8050**: StorageEncryptionDevice - 14 operations
4. **0x802A**: NetworkMonitorDevice - 13 operations
5. **0x8005**: PerformanceMonitorDevice - 12 operations

## Data Source

All operation metadata loaded from:
```
/home/user/LAT5150DRVMIL/DSMIL_DEVICE_CAPABILITIES.json
```

Generated by:
```bash
python3 scripts/extract-device-capabilities.py
```

## Integration with Hardware

To execute operations on actual DSMIL hardware:

1. Load DSMIL driver:
```bash
sudo modprobe dsmil-72dev
```

2. Verify device nodes:
```bash
ls -la /dev/dsmil*
```

3. Launch monitor:
```bash
sudo python3 /home/user/LAT5150DRVMIL/02-ai-engine/dsmil_operation_monitor.py
```

## Troubleshooting

### "No devices loaded" Error

**Problem:** Capabilities file not found
**Solution:**
```bash
# Verify file exists
ls -la /home/user/LAT5150DRVMIL/DSMIL_DEVICE_CAPABILITIES.json

# Regenerate if needed
python3 scripts/extract-device-capabilities.py
```

### "Module import failed" Error

**Problem:** Device implementation files not found
**Solution:**
```bash
# Verify device implementations
ls 02-tools/dsmil-devices/devices/device_0x*.py | wc -l
# Should show 80 files
```

### TUI Crashes or Freezes

**Problem:** Terminal size too small or curses error
**Solution:**
```bash
# Ensure terminal is at least 80x24
resize -s 40 120

# Check log for details
tail -f /tmp/dsmil_operation_monitor.log
```

## Advanced Usage

### Export Execution History

After running operations, the execution history is automatically exported:

```bash
# View execution history
cat /tmp/dsmil_execution_history.json | jq .

# Filter successful executions
cat /tmp/dsmil_execution_history.json | jq '.[] | select(.status == "success")'

# Find slow operations
cat /tmp/dsmil_execution_history.json | jq '.[] | select(.duration_ms > 100)'
```

### Analyze Operation Coverage

```bash
# Count executed operations
cat /tmp/dsmil_execution_history.json | jq '. | length'

# List unique operations executed
cat /tmp/dsmil_execution_history.json | jq -r '.[].operation' | sort -u

# Devices with most executions
cat /tmp/dsmil_execution_history.json | jq -r '.[].device_id' | sort | uniq -c | sort -rn
```

## Comparison with dsmil_guided_activation.py

| Feature | guided_activation.py | operation_monitor.py |
|---------|---------------------|---------------------|
| Device Activation | ‚úì Full activation | ‚úó No activation |
| Operation Viewing | ‚úó No | ‚úì All 656 operations |
| Operation Execution | ‚úó No | ‚úì Safe operations |
| Execution History | ‚úó No | ‚úì Full audit trail |
| Device Dependencies | ‚úì Yes | ‚úó No |
| Group Navigation | ‚úì Yes | ‚úó No |

**Use guided_activation.py for:** Device activation and dependency management
**Use operation_monitor.py for:** Operation-level monitoring and execution

## Future Enhancements

- [ ] Parameter input for operations requiring arguments
- [ ] Write operation support with confirmation dialogs
- [ ] Register monitoring and direct register access
- [ ] Device state persistence
- [ ] Operation scheduling and batch execution
- [ ] Integration with dsmil_guided_activation.py

## Security Notes

‚ö†Ô∏è **This tool can execute device operations!**

- Only execute operations you understand
- Review operation signatures before execution
- Monitor execution logs for unexpected behavior
- Quarantined devices (0x8009, 0x800A, 0x800B, 0x8019, 0x8029) are blocked

## Related Tools

- `dsmil_guided_activation.py` - Device activation TUI
- `scripts/dsmil-cli.py` - Command-line device enumeration
- `scripts/extract-device-capabilities.py` - Capability extractor
- `02-tools/dsmil-devices/dsmil_menu.py` - Device control menu

---

**Version:** 1.0.0
**Platform:** Dell Latitude 5450 MIL-SPEC
**Classification:** DSMIL Subsystem Management
**Last Updated:** 2025-11-09
