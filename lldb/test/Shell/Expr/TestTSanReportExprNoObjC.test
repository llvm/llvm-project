# Tests that the TSan Instrumentation Runtime's utility expression
# runs as C (and doesn't try to find decls in the ObjC runtime).
#
# RUN: split-file %s %t
# RUN: %clangxx_host -std=c++11 -g %t/main.cpp -fsanitize=thread -o %t.out
#
# RUN: %lldb -s %t/commands.input %t.out -o exit \
# RUN:     | FileCheck %s --implicit-check-not="AppleObjCDeclVendor"

#--- main.cpp

#include <thread>

char c = '\0';

void f() {
  c = 'x';
}

int main() {
    std::thread t1(f);
    std::thread t2(f);

    t1.join();
    t2.join();
}

#--- commands.input
log enable lldb expr
run

# CHECK: Picked c for expression evaluation.


