version: '3.7'

x-build-clang: &build-clang
    context: .
    dockerfile: compilers/clang.Dockerfile

x-build-gcc: &build-gcc
    context: .
    dockerfile: compilers/gcc.Dockerfile

services:
  gcc-4.8.5:
    build:
      <<: *build-gcc
      args:
        branch: gcc-4_8_5-release
        install_prefix: /opt/gcc-4.8.5
        cherry_pick: ec1cc0263f156f70693a62cf17b254a0029f4852
    image: ericwf/compiler:gcc-4.8.5
  gcc-4.9.4:
    build:
      <<: *build-gcc
      args:
        branch: gcc-4_9_4-release
        install_prefix: /opt/gcc-4.9.4
    image: ericwf/compiler:gcc-4.9.4
  gcc-5:
    build:
      <<: *build-gcc
      args:
        branch: gcc-5_5_0-release
        install_prefix: /opt/gcc-5
    image: ericwf/compiler:gcc-5
  gcc-6:
    build:
      <<: *build-gcc
      args:
        branch: gcc-6_5_0-release
        install_prefix: /opt/gcc-6
    image: ericwf/compiler:gcc-6
  gcc-7:
    build:
      <<: *build-gcc
      args:
        branch: gcc-7_4_0-release
        install_prefix: /opt/gcc-7
    image: ericwf/compiler:gcc-7
  gcc-8:
    build:
      <<: *build-gcc
      args:
        branch: gcc-8_2_0-release
        install_prefix: /opt/gcc-8
    image: ericwf/compiler:gcc-8
  # Add LLVM compilers
  llvm-3.6:
    build:
      <<: *build-clang
      args:
        branch: release/3.6.x
        install_prefix: /opt/llvm-3.6
    image: ericwf/compiler:llvm-3.6
  llvm-3.7:
    build:
      <<: *build-clang
      args:
        branch: release/3.7.x
        install_prefix: /opt/llvm-3.7
    image: ericwf/compiler:llvm-3.7
  llvm-3.8:
    build:
      <<: *build-clang
      args:
        branch: release/3.8.x
        install_prefix: /opt/llvm-3.8
    image: ericwf/compiler:llvm-3.8
  llvm-3.9:
    build:
      <<: *build-clang
      args:
        branch: release/3.9.x
        install_prefix: /opt/llvm-3.9
    image: ericwf/compiler:llvm-3.9
  llvm-4:
    build:
      <<: *build-clang
      args:
        branch: release/4.x
        install_prefix: /opt/llvm-4
    image: ericwf/compiler:llvm-4
  llvm-5:
    build:
      <<: *build-clang
      args:
        branch: release/5.x
        install_prefix: /opt/llvm-5
    image: ericwf/compiler:llvm-5
  llvm-6:
    build:
      <<: *build-clang
      args:
        branch: release/6.x
        install_prefix: /opt/llvm-6
    image: ericwf/compiler:llvm-6
  llvm-7:
    build:
      <<: *build-clang
      args:
        branch: release/7.x
        install_prefix: /opt/llvm-7
    image: ericwf/compiler:llvm-7
  llvm-8:
    build:
      <<: *build-clang
      args:
        branch: release/8.x
        install_prefix: /opt/llvm-8
    image: ericwf/compiler:llvm-8
  gcc-tot:
    build:
      <<: *build-gcc
      args:
        branch: master
        install_prefix: /opt/gcc-tot
    image: ericwf/compiler:gcc-tot
  llvm-tot:
    build:
      <<: *build-clang
      args:
        branch: master
        install_prefix: /opt/llvm-tot
    image: ericwf/compiler:llvm-tot
  compiler-zoo:
    build:
      context: .
      dockerfile: compilers/compiler-zoo.Dockerfile
      target: compiler-zoo
    image: ericwf/compiler-zoo:latest
    depends_on:
      - gcc-4.8.5
      - gcc-4.9.4
      - gcc-5
      - gcc-6
      - gcc-7
      - gcc-8
      - gcc-tot
      - llvm-3.6
      - llvm-3.7
      - llvm-3.8
      - llvm-3.9
      - llvm-4
      - llvm-5
      - llvm-6
      - llvm-7
      - llvm-8
      - llvm-tot
