<!--===- docs/FAQ.md

   Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
   See https://llvm.org/LICENSE.txt for license information.
   SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

-->

<!-- TODO: remove this after adding this page to ToC -->
```{eval-rst}
:orphan:
```

# Frequently Asked Questions (FAQ)

```{contents}
---
local:
---
```

## Driver

### Why do I get a warning or error about an executable stack?

This occurs because Flang's implementation of pointers to internal procedures requires an executable stack.

When an internal procedure is referenced from outside its host scope (e.g., via a procedure pointer), the implementation must ensure that it can still access its host-associated variables.
To achieve this, the current implementation of Flang generates a small piece of code, called a "trampoline", on the stack dynamically.
Since this trampoline code must be executed, the stack needs to be executable.
For a more detailed explanation of trampolines, please refer to the [design document](InternalProcedureTrampolines.md).

However, an executable stack can introduce security vulnerabilities (e.g., by enabling [buffer overflow attacks](https://en.wikipedia.org/wiki/Buffer_overflow#Stack-based_exploitation)).
For this reason, modern linkers often issue a warning or error.
In particular, the LLVM Linker (`lld`) never enables an executable stack unless you explicitly allow it.

> NOTE: The trampoline code generated by Flang is not itself a security risk.
```{note}
The trampoline code generated by Flang is not itself a security risk.
The risk comes from the possibility that other malicious code, if present in the program or its libraries, could be executed from the stack.
```

When you use the Flang driver (i.e., the `flang` command) to generate executables, you can instruct the linker to enable an executable stack with the `-Wl,-z,execstack` or `-Xlinker -zexecstack` flag.

```console
$ flang src.f90 -fuse-ld=lld
ld.lld: error: src.o: requires an executable stack, but -z execstack is not specified
flang-22: error: linker command failed with exit code 1 (use -v to see invocation)
$ flang src.f90 -fuse-ld=lld -Wl,-z,execstack
```
