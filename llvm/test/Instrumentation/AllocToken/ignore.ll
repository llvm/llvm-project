; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; Test for all allocation functions that should be ignored by default.
;
; RUN: opt < %s -passes=inferattrs,alloc-token -S | FileCheck %s

target datalayout = "e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"

declare ptr @strdup(ptr)
declare ptr @__strdup(ptr)
declare ptr @strndup(ptr, i64)
declare ptr @__strndup(ptr, i64)

define ptr @test_ignored_allocation_functions(ptr %ptr) sanitize_alloc_token {
; CHECK-LABEL: define ptr @test_ignored_allocation_functions(
; CHECK-SAME: ptr [[PTR:%.*]]) #[[ATTR2:[0-9]+]] {
; CHECK-NEXT:  [[ENTRY:.*:]]
; CHECK-NEXT:    [[PTR1:%.*]] = call ptr @strdup(ptr [[PTR]])
; CHECK-NEXT:    [[PTR2:%.*]] = call ptr @__strdup(ptr [[PTR]])
; CHECK-NEXT:    [[PTR3:%.*]] = call ptr @strndup(ptr [[PTR]], i64 42)
; CHECK-NEXT:    [[PTR4:%.*]] = call ptr @__strndup(ptr [[PTR]], i64 42)
; CHECK-NEXT:    ret ptr [[PTR1]]
;
entry:
  %ptr1 = call ptr @strdup(ptr %ptr)
  %ptr2 = call ptr @__strdup(ptr %ptr)
  %ptr3 = call ptr @strndup(ptr %ptr, i64 42)
  %ptr4 = call ptr @__strndup(ptr %ptr, i64 42)
  ret ptr %ptr1
}
