; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; Test basic type sanitizer instrumentation.
;
; RUN: opt -passes='tysan' -tysan-outline-instrumentation=false -S %s | FileCheck %s --check-prefix=CHECK-INLINE
; RUN: opt -passes='tysan' -S %s | FileCheck %s --check-prefix=CHECK-OUTLINE

target datalayout = "e-m:e-i64:64-f80:128-n8:16:32:64-S128"

define void @test_swifterror(ptr swifterror) sanitize_type {
; CHECK-LABEL: @test_swifterror(
; CHECK-NEXT:    [[SWIFTERROR_PTR_VALUE:%.*]] = load ptr, ptr [[TMP0:%.*]], align 8
; CHECK-NEXT:    ret void
;
; CHECK-INLINE-LABEL: @test_swifterror(
; CHECK-INLINE-NEXT:    [[SWIFTERROR_PTR_VALUE:%.*]] = load ptr, ptr [[TMP0:%.*]], align 8
; CHECK-INLINE-NEXT:    ret void
;
; CHECK-OUTLINE-LABEL: @test_swifterror(
; CHECK-OUTLINE-NEXT:    [[SWIFTERROR_PTR_VALUE:%.*]] = load ptr, ptr [[TMP0:%.*]], align 8
; CHECK-OUTLINE-NEXT:    ret void
;
  %swifterror_ptr_value = load ptr, ptr %0
  ret void
}

define void @test_swifterror_2(ptr swifterror) sanitize_type {
; CHECK-LABEL: @test_swifterror_2(
; CHECK-NEXT:    store ptr null, ptr [[TMP0:%.*]], align 8
; CHECK-NEXT:    ret void
;
; CHECK-INLINE-LABEL: @test_swifterror_2(
; CHECK-INLINE-NEXT:    store ptr null, ptr [[TMP0:%.*]], align 8
; CHECK-INLINE-NEXT:    ret void
;
; CHECK-OUTLINE-LABEL: @test_swifterror_2(
; CHECK-OUTLINE-NEXT:    store ptr null, ptr [[TMP0:%.*]], align 8
; CHECK-OUTLINE-NEXT:    ret void
;
  store ptr null, ptr %0
  ret void
}
