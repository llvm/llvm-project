# RUN: llc %s -start-after=livedebugvalues -debugger-tune=gdb --filetype=obj -o - \
# RUN: | llvm-dwarfdump - | FileCheck %s

# Generated from IR crash reproducer with `llc -stop-after=livedebugvalues -simplify-mir`.
# Check the GNU equivalent of DW_AT_call_target_clobbered is emitted without
# hitting assertions (DWARF version 4, -debugger-tune=gdb).

# CHECK: DW_AT_GNU_call_site_target_clobbered

--- |
  target datalayout = "e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-i128:128-f80:128-n8:16:32:64-S128"
  target triple = "x86_64-unknown-linux-gnu"

  define void @foo(ptr %p) !dbg !5 {
  entry:
    %call = tail call ptr %p(i64 0)
    ret void
  }

  !llvm.dbg.cu = !{!0}
  !llvm.module.flags = !{!3, !4}

  !0 = distinct !DICompileUnit(language: DW_LANG_C_plus_plus_14, file: !1, isOptimized: true, runtimeVersion: 0, emissionKind: FullDebug, enums: !2, retainedTypes: !2, globals: !2, imports: !2, splitDebugInlining: false)
  !1 = !DIFile(filename: "test.cpp", directory: ".")
  !2 = !{}
  !3 = !{i32 2, !"Debug Info Version", i32 3}
  !4 = !{i32 7, !"Dwarf Version", i32 4}
  !5 = distinct !DISubprogram(name: "foo", linkageName: "foo", scope: !1, file: !1, line: 479, type: !6, scopeLine: 479, flags: DIFlagPrototyped | DIFlagAllCallsDescribed, spFlags: DISPFlagLocalToUnit | DISPFlagDefinition | DISPFlagOptimized, unit: !0, retainedNodes: !2, keyInstructions: true)
  !6 = distinct !DISubroutineType(types: !7)
  !7 = !{null}
...
---
name:            foo
alignment:       16
tracksRegLiveness: true
noPhis:          true
isSSA:           false
noVRegs:         true
hasFakeUses:     false
debugInstrRef:   true
tracksDebugUserValues: true
liveins:
  - { reg: '$rdi' }
frameInfo:
  maxAlignment:    1
  maxCallFrameSize: 0
  hasTailCall:     true
  isCalleeSavedInfoValid: true
machineFunctionInfo:
  amxProgModel:    None
body:             |
  bb.0.entry:
    liveins: $rdi

    $rax = MOV64rr $rdi
    dead $edi = XOR32rr undef $edi, undef $edi, implicit-def dead $eflags, implicit-def $rdi
    TAILJMPr64 killed renamable $rax, csr_64, implicit $rsp, implicit $ssp, implicit $rsp, implicit $ssp, implicit $rdi
...
