# RUN: llc -mtriple=amdgcn-- -mcpu=gfx1300 -run-pass=print-machine-uniformity -o - %s 2>&1 | FileCheck %s

---
name:            test_swc_reorder
tracksRegLiveness: true
body:             |
  bb.0:
    %0:_(s64) = IMPLICIT_DEF
    ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.swc.reorder)
    %1:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.swc.reorder), %0:_(s64)
    $vgpr0 = COPY %1
    SI_RETURN_TO_EPILOG implicit $vgpr0
...

---
name:            test_swc_reorder_swap
tracksRegLiveness: true
body:             |
  bb.0:
    %0:_(s64) = IMPLICIT_DEF
    ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.swc.reorder.swap)
    %1:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.swc.reorder.swap), %0:_(s64)
    $vgpr0 = COPY %1
    SI_RETURN_TO_EPILOG implicit $vgpr0
...

---
name:            test_swc_reorder_swap_resume
tracksRegLiveness: true
body:             |
  bb.0:
    ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.swc.reorder.swap.resume)
    %1:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.swc.reorder.swap.resume)
    $vgpr0 = COPY %1
    SI_RETURN_TO_EPILOG implicit $vgpr0
...

---
name:            test_rts_read_result_all_stop
tracksRegLiveness: true
body:             |
  bb.0:
    ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s64) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.result.all.stop)
    %1:_(s64) =  G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.result.all.stop)
    $vgpr0_vgpr1 = COPY %1
    SI_RETURN_TO_EPILOG implicit $vgpr0_vgpr1
...

---
name:            test_rts_read_result_ongoing
tracksRegLiveness: true
body:             |
  bb.0:
  ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s64) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.result.ongoing)
    %1:_(s64) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.result.ongoing)
    $vgpr0_vgpr1 = COPY %1
    SI_RETURN_TO_EPILOG implicit $vgpr0_vgpr1
...

---
name:             test_rts_ray_save
tracksRegLiveness: true
body:             |
  bb.0:
  ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.ray.save)
    %1:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.ray.save)
    $vgpr0 = COPY %1
    SI_RETURN_TO_EPILOG implicit $vgpr0
...

---
name:            test_rts_update_ray
tracksRegLiveness: true
body:             |
  bb.0:
    %0:_(s64) = IMPLICIT_DEF
    ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.update.ray)
    %1:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.update.ray), %0:_(s64)
    $vgpr0 = COPY %1
    SI_RETURN_TO_EPILOG implicit $vgpr0
...

---
name:            test_rts_trace_ray_nonblock
tracksRegLiveness: true
body:             |
  bb.0:
    %0:_(s32) = IMPLICIT_DEF
    %1:_(s96) = IMPLICIT_DEF
    %2:_(s32) = IMPLICIT_DEF
    %3:_(s96) = IMPLICIT_DEF
    %4:_(s96) = IMPLICIT_DEF
    %6:_(s128) = IMPLICIT_DEF
    ; CHECK: {{^}} %{{[0-9]*}}: %{{[0-9]*}}:_(s32) =  G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.trace.ray.nonblock)
    %5:_(s32) =  G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.trace.ray.nonblock), %0:_(s32), %1:_(s96), %2:_(s32), %3:_(s96), %4:_(s96), %6:_(s128)
    $vgpr0 = COPY %5
    SI_RETURN_TO_EPILOG implicit $vgpr0
...

---
name:            test_rts_read_vertex
tracksRegLiveness: true
body:             |
  bb.0:
    %0:_(s32) = IMPLICIT_DEF
    %1:_(s32) = IMPLICIT_DEF
    %2:_(s32) = IMPLICIT_DEF
    ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s288) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.vertex)
    %5:_(s288) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.vertex), %0:_(s32), %1:_(s32), %2:_(s32)
    $vgpr0_vgpr1_vgpr2_vgpr3_vgpr4_vgpr5_vgpr6_vgpr7_vgpr8 = COPY %5
    SI_RETURN_TO_EPILOG implicit $vgpr0_vgpr1_vgpr2_vgpr3_vgpr4_vgpr5_vgpr6_vgpr7_vgpr8
...

---
name:            test_rts_read_vertex_coords
tracksRegLiveness: true
body:             |
  bb.0:
    %0:_(s32) = IMPLICIT_DEF
    %1:_(s32) = IMPLICIT_DEF
    %2:_(s32) = IMPLICIT_DEF
    ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s96) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.vertex.coords)
    %5:_(s96) =  G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.vertex.coords), %0:_(s32), %1:_(s32), %2:_(s32)
    $vgpr0_vgpr1_vgpr2 = COPY %5
    SI_RETURN_TO_EPILOG implicit $vgpr0_vgpr1_vgpr2
...

---
name:            test_rts_read_packet_info
tracksRegLiveness: true
body:             |
  bb.0:
    %0:_(s32) = IMPLICIT_DEF
    %1:_(s32) = IMPLICIT_DEF
    ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.packet.info)
    %2:_(s32) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.packet.info), %0:_(s32), %1:_(s32)
    $vgpr0 = COPY %2
    SI_RETURN_TO_EPILOG implicit $vgpr0
...

---
name:            test_rts_read_prim_info
tracksRegLiveness: true
body:             |
  bb.0:
    %0:_(s32) = IMPLICIT_DEF
    %1:_(s32) = IMPLICIT_DEF
    ; CHECK: DIVERGENT: %{{[0-9]*}}: %{{[0-9]*}}:_(s96) =  G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.prim.info)
    %2:_(s96) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.rts.read.prim.info), %0:_(s32), %1:_(s32)
    $vgpr0_vgpr1_vgpr2 = COPY %2
    SI_RETURN_TO_EPILOG implicit $vgpr0_vgpr1_vgpr2
...
