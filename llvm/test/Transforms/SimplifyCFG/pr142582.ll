; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; RUN: opt < %s -passes=simplifycfg -simplifycfg-require-and-preserve-domtree=1 -S | FileCheck %s

define i1 @a_and_b(i1 %a) {
; CHECK-LABEL: define i1 @a_and_b(
; CHECK-SAME: i1 [[A:%.*]]) {
; CHECK-NEXT:  [[START:.*]]:
; CHECK-NEXT:    br i1 [[A]], label %[[A_IS_TRUE:.*]], label %[[END:.*]]
; CHECK:       [[A_IS_TRUE]]:
; CHECK-NEXT:    [[B:%.*]] = call i1 @get_b()
; CHECK-NEXT:    [[SPEC_SELECT:%.*]] = select i1 [[B]], i1 true, i1 false
; CHECK-NEXT:    br label %[[END]]
; CHECK:       [[END]]:
; CHECK-NEXT:    [[RETVAL:%.*]] = phi i1 [ false, %[[START]] ], [ [[SPEC_SELECT]], %[[A_IS_TRUE]] ]
; CHECK-NEXT:    ret i1 [[RETVAL]]
;
start:
  br i1 %a, label %a_is_true, label %a_or_b_is_false

a_is_true:
  %b = call i1 @get_b()
  br i1 %b, label %end, label %a_or_b_is_false

a_or_b_is_false:
  br label %end

end:
  %retval = phi i1 [ true, %a_is_true ], [ false, %a_or_b_is_false ]
  ret i1 %retval
}

declare i1 @get_b()
