; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --check-globals all --version 5
; Test merging of blocks that only have PHI nodes in them
;
; RUN: opt < %s -passes=simplifycfg -simplifycfg-require-and-preserve-domtree=1 -S | FileCheck %s
;

define i32 @test(i1 %a, i1 %b) {
; CHECK-LABEL: define i32 @test(
; CHECK-SAME: i1 [[A:%.*]], i1 [[B:%.*]]) {
; CHECK-NEXT:  [[M:.*:]]
; CHECK-NEXT:    [[SPEC_SELECT:%.*]] = select i1 [[B]], i32 0, i32 1, !prof [[PROF0:![0-9]+]]
; CHECK-NEXT:    [[W:%.*]] = select i1 [[A]], i32 2, i32 [[SPEC_SELECT]], !prof [[PROF1:![0-9]+]]
; CHECK-NEXT:    [[R:%.*]] = add i32 [[W]], 1
; CHECK-NEXT:    ret i32 [[R]]
;
  br i1 %a, label %M, label %O, !prof !0
O:              ; preds = %0
  br i1 %b, label %N, label %Q, !prof !1
Q:              ; preds = %O
  br label %N
N:              ; preds = %Q, %O
  ; This block should be foldable into M
  %Wp = phi i32 [ 0, %O ], [ 1, %Q ]              ; <i32> [#uses=1]
  br label %M
M:              ; preds = %N, %0
  %W = phi i32 [ %Wp, %N ], [ 2, %0 ]             ; <i32> [#uses=1]
  %R = add i32 %W, 1              ; <i32> [#uses=1]
  ret i32 %R
}

!0 = !{!"branch_weights", i32 11, i32 7}
!1 = !{!"branch_weights", i32 3, i32 5}
;.
; CHECK: [[PROF0]] = !{!"branch_weights", i32 3, i32 5}
; CHECK: [[PROF1]] = !{!"branch_weights", i32 11, i32 7}
;.
