; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; RUN: opt -S --passes=slp-vectorizer -mtriple=x86_64-unknown-linux-gnu -mcpu=icelake-server -slp-threshold=-5 < %s | FileCheck %s

@st = external global [4 x [4 x i32]]

define i32 @test(i32 %0, i32 %1) {
; CHECK-LABEL: define i32 @test(
; CHECK-SAME: i32 [[TMP0:%.*]], i32 [[TMP1:%.*]]) #[[ATTR0:[0-9]+]] {
; CHECK-NEXT:  [[ENTRY:.*:]]
; CHECK-NEXT:    [[ADD110:%.*]] = add i32 [[TMP0]], [[TMP1]]
; CHECK-NEXT:    [[DOTNEG_NEG:%.*]] = shl i32 [[TMP0]], 1
; CHECK-NEXT:    [[TMP2:%.*]] = insertelement <2 x i32> poison, i32 [[TMP0]], i32 0
; CHECK-NEXT:    [[TMP3:%.*]] = shufflevector <2 x i32> [[TMP2]], <2 x i32> poison, <2 x i32> zeroinitializer
; CHECK-NEXT:    [[TMP4:%.*]] = shl <2 x i32> [[TMP3]], <i32 0, i32 1>
; CHECK-NEXT:    [[TMP5:%.*]] = load i32, ptr getelementptr inbounds nuw (i8, ptr @st, i64 12), align 4
; CHECK-NEXT:    [[TMP6:%.*]] = load <2 x i32>, ptr getelementptr inbounds nuw (i8, ptr @st, i64 8), align 8
; CHECK-NEXT:    [[TMP7:%.*]] = sub <2 x i32> [[TMP6]], [[TMP4]]
; CHECK-NEXT:    [[TMP8:%.*]] = add <2 x i32> [[TMP6]], [[TMP4]]
; CHECK-NEXT:    [[TMP9:%.*]] = shufflevector <2 x i32> [[TMP7]], <2 x i32> [[TMP8]], <2 x i32> <i32 0, i32 3>
; CHECK-NEXT:    store <2 x i32> [[TMP9]], ptr getelementptr inbounds nuw (i8, ptr @st, i64 8), align 8
; CHECK-NEXT:    [[SUB120_3:%.*]] = or i32 [[TMP5]], [[DOTNEG_NEG]]
; CHECK-NEXT:    [[TMP10:%.*]] = insertelement <4 x i32> <i32 1, i32 poison, i32 1, i32 1>, i32 [[TMP0]], i32 1
; CHECK-NEXT:    [[TMP11:%.*]] = shl <4 x i32> [[TMP10]], <i32 0, i32 1, i32 0, i32 0>
; CHECK-NEXT:    [[TMP12:%.*]] = insertelement <2 x i32> poison, i32 [[ADD110]], i32 0
; CHECK-NEXT:    [[TMP13:%.*]] = insertelement <2 x i32> [[TMP12]], i32 [[DOTNEG_NEG]], i32 1
; CHECK-NEXT:    [[TMP14:%.*]] = sub <2 x i32> zeroinitializer, [[TMP13]]
; CHECK-NEXT:    store <2 x i32> [[TMP14]], ptr getelementptr inbounds nuw (i8, ptr @st, i64 32), align 16
; CHECK-NEXT:    [[TMP15:%.*]] = shufflevector <4 x i32> [[TMP10]], <4 x i32> <i32 poison, i32 0, i32 poison, i32 poison>, <4 x i32> <i32 1, i32 5, i32 1, i32 poison>
; CHECK-NEXT:    [[TMP16:%.*]] = insertelement <4 x i32> [[TMP15]], i32 [[SUB120_3]], i32 3
; CHECK-NEXT:    [[TMP17:%.*]] = shl <4 x i32> [[TMP16]], [[TMP11]]
; CHECK-NEXT:    [[TMP18:%.*]] = sub <4 x i32> [[TMP16]], [[TMP11]]
; CHECK-NEXT:    [[TMP19:%.*]] = shufflevector <4 x i32> [[TMP17]], <4 x i32> [[TMP18]], <4 x i32> <i32 0, i32 5, i32 2, i32 3>
; CHECK-NEXT:    store <4 x i32> [[TMP19]], ptr getelementptr inbounds nuw (i8, ptr @st, i64 16), align 16
; CHECK-NEXT:    ret i32 0
;
entry:
  %add110 = add i32 %0, %1
  %sub124 = sub i32 0, %add110
  store i32 %sub124, ptr getelementptr inbounds nuw (i8, ptr @st, i64 32), align 16
  %shl127 = shl i32 %0, 1
  store i32 %shl127, ptr getelementptr inbounds nuw (i8, ptr @st, i64 16), align 16
  %shl.2 = shl i32 %0, 1
  %sub124.1 = sub i32 0, %shl.2
  store i32 %sub124.1, ptr getelementptr inbounds nuw (i8, ptr @st, i64 36), align 4
  %sub115.1 = sub i32 0, %shl.2
  store i32 %sub115.1, ptr getelementptr inbounds nuw (i8, ptr @st, i64 20), align 4
  %2 = load i32, ptr getelementptr inbounds nuw (i8, ptr @st, i64 8), align 8
  %add105.2 = sub i32 %2, %0
  store i32 %add105.2, ptr getelementptr inbounds nuw (i8, ptr @st, i64 8), align 8
  %shl127.2 = shl i32 %0, 1
  store i32 %shl127.2, ptr getelementptr inbounds nuw (i8, ptr @st, i64 24), align 8
  %.neg.neg = shl i32 %0, 1
  %3 = load i32, ptr getelementptr inbounds nuw (i8, ptr @st, i64 12), align 4
  %add105.3 = add i32 %.neg.neg, %3
  store i32 %add105.3, ptr getelementptr inbounds nuw (i8, ptr @st, i64 12), align 4
  %sub120.3 = or i32 %3, %.neg.neg
  %shl127.3 = shl i32 %sub120.3, 1
  store i32 %shl127.3, ptr getelementptr inbounds nuw (i8, ptr @st, i64 28), align 4
  ret i32 0
}
