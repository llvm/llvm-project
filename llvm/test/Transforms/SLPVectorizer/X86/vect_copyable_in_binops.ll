; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -passes=slp-vectorizer -slp-vectorize-non-power-of-2 -S -mtriple=x86_64-unknown-linux-gnu -mcpu=bdver2 < %s | FileCheck --check-prefixes=CHECK,NON-POW2 %s
; RUN: opt -passes=slp-vectorizer -slp-vectorize-non-power-of-2=false -S -mtriple=x86_64-unknown-linux-gnu -mcpu=bdver2 < %s | FileCheck --check-prefixes=CHECK,POW2-ONLY %s
; RUN: opt -passes=slp-vectorizer -slp-vectorize-non-power-of-2=false -slp-vectorize-copyable=true -S -mtriple=x86_64-unknown-linux-gnu -mcpu=bdver2 < %s | FileCheck --check-prefixes=CHECK,COPYABLE %s

define void @add0(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @add0(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x i32>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = add nsw <4 x i32> [[TMP0]], <i32 1, i32 1, i32 2, i32 3>
; CHECK-NEXT:    store <4 x i32> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %add = add nsw i32 %0, 1
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %add, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %add3 = add nsw i32 %1, 1
  %incdec.ptr4 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %add3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %add6 = add nsw i32 %2, 2
  %incdec.ptr7 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %add6, ptr %incdec.ptr4, align 4
  %3 = load i32, ptr %incdec.ptr5, align 4
  %add9 = add nsw i32 %3, 3
  store i32 %add9, ptr %incdec.ptr7, align 4
  ret void
}

define void @add1(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @add1(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 1
; NON-POW2-NEXT:    [[TMP0:%.*]] = load i32, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 1
; NON-POW2-NEXT:    store i32 [[TMP0]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[TMP1:%.*]] = load <3 x i32>, ptr [[INCDEC_PTR]], align 4
; NON-POW2-NEXT:    [[TMP2:%.*]] = add nsw <3 x i32> [[TMP1]], <i32 1, i32 2, i32 3>
; NON-POW2-NEXT:    store <3 x i32> [[TMP2]], ptr [[INCDEC_PTR1]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @add1(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 1
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load i32, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 1
; POW2-ONLY-NEXT:    store i32 [[TMP0]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 3
; POW2-ONLY-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 3
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = load <2 x i32>, ptr [[INCDEC_PTR]], align 4
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = add nsw <2 x i32> [[TMP1]], <i32 1, i32 2>
; POW2-ONLY-NEXT:    store <2 x i32> [[TMP2]], ptr [[INCDEC_PTR1]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = load i32, ptr [[INCDEC_PTR5]], align 4
; POW2-ONLY-NEXT:    [[ADD9:%.*]] = add nsw i32 [[TMP3]], 3
; POW2-ONLY-NEXT:    store i32 [[ADD9]], ptr [[INCDEC_PTR7]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @add1(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <4 x i32>, ptr [[SRC:%.*]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = add nsw <4 x i32> [[TMP0]], <i32 0, i32 1, i32 2, i32 3>
; COPYABLE-NEXT:    store <4 x i32> [[TMP1]], ptr [[DST:%.*]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %0, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %add3 = add nsw i32 %1, 1
  %incdec.ptr4 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %add3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %add6 = add nsw i32 %2, 2
  %incdec.ptr7 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %add6, ptr %incdec.ptr4, align 4
  %3 = load i32, ptr %incdec.ptr5, align 4
  %add9 = add nsw i32 %3, 3
  store i32 %add9, ptr %incdec.ptr7, align 4
  ret void
}

define void @sub0(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @sub0(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 1
; NON-POW2-NEXT:    [[TMP0:%.*]] = load i32, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[SUB:%.*]] = add nsw i32 [[TMP0]], -1
; NON-POW2-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 1
; NON-POW2-NEXT:    store i32 [[SUB]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 2
; NON-POW2-NEXT:    [[TMP1:%.*]] = load i32, ptr [[INCDEC_PTR]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 2
; NON-POW2-NEXT:    store i32 [[TMP1]], ptr [[INCDEC_PTR1]], align 4
; NON-POW2-NEXT:    [[TMP2:%.*]] = load <2 x i32>, ptr [[INCDEC_PTR2]], align 4
; NON-POW2-NEXT:    [[TMP3:%.*]] = add nsw <2 x i32> [[TMP2]], <i32 -2, i32 -3>
; NON-POW2-NEXT:    store <2 x i32> [[TMP3]], ptr [[INCDEC_PTR3]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @sub0(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 1
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load i32, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[SUB:%.*]] = add nsw i32 [[TMP0]], -1
; POW2-ONLY-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 1
; POW2-ONLY-NEXT:    store i32 [[SUB]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 2
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = load i32, ptr [[INCDEC_PTR]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 2
; POW2-ONLY-NEXT:    store i32 [[TMP1]], ptr [[INCDEC_PTR1]], align 4
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = load <2 x i32>, ptr [[INCDEC_PTR2]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = add nsw <2 x i32> [[TMP2]], <i32 -2, i32 -3>
; POW2-ONLY-NEXT:    store <2 x i32> [[TMP3]], ptr [[INCDEC_PTR3]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @sub0(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <4 x i32>, ptr [[SRC:%.*]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = add nsw <4 x i32> [[TMP0]], <i32 -1, i32 0, i32 -2, i32 -3>
; COPYABLE-NEXT:    store <4 x i32> [[TMP1]], ptr [[DST:%.*]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %sub = add nsw i32 %0, -1
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %incdec.ptr3 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %1, ptr %incdec.ptr1, align 4
  %incdec.ptr4 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %sub5 = add nsw i32 %2, -2
  %incdec.ptr6 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %sub5, ptr %incdec.ptr3, align 4
  %3 = load i32, ptr %incdec.ptr4, align 4
  %sub8 = add nsw i32 %3, -3
  store i32 %sub8, ptr %incdec.ptr6, align 4
  ret void
}

define void @sub1(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @sub1(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x i32>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = add nsw <4 x i32> [[TMP0]], <i32 4, i32 -1, i32 -2, i32 -3>
; CHECK-NEXT:    store <4 x i32> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %add = add nsw i32 %0, 4
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %add, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %sub = add nsw i32 %1, -1
  %incdec.ptr3 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %sub, ptr %incdec.ptr1, align 4
  %incdec.ptr4 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %sub5 = add nsw i32 %2, -2
  %incdec.ptr6 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %sub5, ptr %incdec.ptr3, align 4
  %3 = load i32, ptr %incdec.ptr4, align 4
  %sub8 = add nsw i32 %3, -3
  store i32 %sub8, ptr %incdec.ptr6, align 4
  ret void
}

define void @sub2(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @sub2(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x i32>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = add nsw <4 x i32> [[TMP0]], <i32 -1, i32 -1, i32 -2, i32 -3>
; CHECK-NEXT:    store <4 x i32> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %sub = add nsw i32 %0, -1
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %sub3 = add nsw i32 %1, -1
  %incdec.ptr4 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %sub3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %sub6 = add nsw i32 %2, -2
  %incdec.ptr7 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %sub6, ptr %incdec.ptr4, align 4
  %3 = load i32, ptr %incdec.ptr5, align 4
  %sub9 = add nsw i32 %3, -3
  store i32 %sub9, ptr %incdec.ptr7, align 4
  ret void
}

define void @addsub0(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @addsub0(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 1
; NON-POW2-NEXT:    [[TMP0:%.*]] = load i32, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[SUB:%.*]] = add nsw i32 [[TMP0]], -1
; NON-POW2-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 1
; NON-POW2-NEXT:    store i32 [[SUB]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 2
; NON-POW2-NEXT:    [[TMP1:%.*]] = load i32, ptr [[INCDEC_PTR]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 2
; NON-POW2-NEXT:    store i32 [[TMP1]], ptr [[INCDEC_PTR1]], align 4
; NON-POW2-NEXT:    [[TMP2:%.*]] = load <2 x i32>, ptr [[INCDEC_PTR2]], align 4
; NON-POW2-NEXT:    [[TMP3:%.*]] = add nsw <2 x i32> [[TMP2]], <i32 -2, i32 -3>
; NON-POW2-NEXT:    [[TMP4:%.*]] = sub nsw <2 x i32> [[TMP2]], <i32 -2, i32 -3>
; NON-POW2-NEXT:    [[TMP5:%.*]] = shufflevector <2 x i32> [[TMP3]], <2 x i32> [[TMP4]], <2 x i32> <i32 0, i32 3>
; NON-POW2-NEXT:    store <2 x i32> [[TMP5]], ptr [[INCDEC_PTR3]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @addsub0(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 1
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load i32, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[SUB:%.*]] = add nsw i32 [[TMP0]], -1
; POW2-ONLY-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 1
; POW2-ONLY-NEXT:    store i32 [[SUB]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 2
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = load i32, ptr [[INCDEC_PTR]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 2
; POW2-ONLY-NEXT:    store i32 [[TMP1]], ptr [[INCDEC_PTR1]], align 4
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = load <2 x i32>, ptr [[INCDEC_PTR2]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = add nsw <2 x i32> [[TMP2]], <i32 -2, i32 -3>
; POW2-ONLY-NEXT:    [[TMP4:%.*]] = sub nsw <2 x i32> [[TMP2]], <i32 -2, i32 -3>
; POW2-ONLY-NEXT:    [[TMP5:%.*]] = shufflevector <2 x i32> [[TMP3]], <2 x i32> [[TMP4]], <2 x i32> <i32 0, i32 3>
; POW2-ONLY-NEXT:    store <2 x i32> [[TMP5]], ptr [[INCDEC_PTR3]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @addsub0(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 2
; COPYABLE-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 2
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <2 x i32>, ptr [[SRC]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = add nsw <2 x i32> [[TMP0]], <i32 -1, i32 0>
; COPYABLE-NEXT:    store <2 x i32> [[TMP1]], ptr [[DST]], align 4
; COPYABLE-NEXT:    [[TMP2:%.*]] = load <2 x i32>, ptr [[INCDEC_PTR2]], align 4
; COPYABLE-NEXT:    [[TMP3:%.*]] = add nsw <2 x i32> [[TMP2]], <i32 -2, i32 -3>
; COPYABLE-NEXT:    [[TMP4:%.*]] = sub nsw <2 x i32> [[TMP2]], <i32 -2, i32 -3>
; COPYABLE-NEXT:    [[TMP5:%.*]] = shufflevector <2 x i32> [[TMP3]], <2 x i32> [[TMP4]], <2 x i32> <i32 0, i32 3>
; COPYABLE-NEXT:    store <2 x i32> [[TMP5]], ptr [[INCDEC_PTR3]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %sub = add nsw i32 %0, -1
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %incdec.ptr3 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %1, ptr %incdec.ptr1, align 4
  %incdec.ptr4 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %sub5 = add nsw i32 %2, -2
  %incdec.ptr6 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %sub5, ptr %incdec.ptr3, align 4
  %3 = load i32, ptr %incdec.ptr4, align 4
  %sub8 = sub nsw i32 %3, -3
  store i32 %sub8, ptr %incdec.ptr6, align 4
  ret void
}

define void @addsub1(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @addsub1(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 2
; NON-POW2-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 2
; NON-POW2-NEXT:    [[TMP0:%.*]] = load <2 x i32>, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[TMP1:%.*]] = add nsw <2 x i32> [[TMP0]], splat (i32 -1)
; NON-POW2-NEXT:    [[TMP2:%.*]] = sub nsw <2 x i32> [[TMP0]], splat (i32 -1)
; NON-POW2-NEXT:    [[TMP3:%.*]] = shufflevector <2 x i32> [[TMP1]], <2 x i32> [[TMP2]], <2 x i32> <i32 0, i32 3>
; NON-POW2-NEXT:    store <2 x i32> [[TMP3]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 3
; NON-POW2-NEXT:    [[TMP4:%.*]] = load i32, ptr [[INCDEC_PTR2]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR6:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 3
; NON-POW2-NEXT:    store i32 [[TMP4]], ptr [[INCDEC_PTR3]], align 4
; NON-POW2-NEXT:    [[TMP5:%.*]] = load i32, ptr [[INCDEC_PTR4]], align 4
; NON-POW2-NEXT:    [[SUB8:%.*]] = sub nsw i32 [[TMP5]], -3
; NON-POW2-NEXT:    store i32 [[SUB8]], ptr [[INCDEC_PTR6]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @addsub1(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 2
; POW2-ONLY-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 2
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load <2 x i32>, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = add nsw <2 x i32> [[TMP0]], splat (i32 -1)
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = sub nsw <2 x i32> [[TMP0]], splat (i32 -1)
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = shufflevector <2 x i32> [[TMP1]], <2 x i32> [[TMP2]], <2 x i32> <i32 0, i32 3>
; POW2-ONLY-NEXT:    store <2 x i32> [[TMP3]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 3
; POW2-ONLY-NEXT:    [[TMP4:%.*]] = load i32, ptr [[INCDEC_PTR2]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR6:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 3
; POW2-ONLY-NEXT:    store i32 [[TMP4]], ptr [[INCDEC_PTR3]], align 4
; POW2-ONLY-NEXT:    [[TMP5:%.*]] = load i32, ptr [[INCDEC_PTR4]], align 4
; POW2-ONLY-NEXT:    [[SUB8:%.*]] = sub nsw i32 [[TMP5]], -3
; POW2-ONLY-NEXT:    store i32 [[SUB8]], ptr [[INCDEC_PTR6]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @addsub1(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 2
; COPYABLE-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 2
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <2 x i32>, ptr [[SRC]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = add nsw <2 x i32> [[TMP0]], splat (i32 -1)
; COPYABLE-NEXT:    [[TMP2:%.*]] = sub nsw <2 x i32> [[TMP0]], splat (i32 -1)
; COPYABLE-NEXT:    [[TMP3:%.*]] = shufflevector <2 x i32> [[TMP1]], <2 x i32> [[TMP2]], <2 x i32> <i32 0, i32 3>
; COPYABLE-NEXT:    store <2 x i32> [[TMP3]], ptr [[DST]], align 4
; COPYABLE-NEXT:    [[TMP4:%.*]] = load <2 x i32>, ptr [[INCDEC_PTR2]], align 4
; COPYABLE-NEXT:    [[TMP5:%.*]] = sub nsw <2 x i32> [[TMP4]], <i32 0, i32 -3>
; COPYABLE-NEXT:    store <2 x i32> [[TMP5]], ptr [[INCDEC_PTR3]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %sub = add nsw i32 %0, -1
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %sub1 = sub nsw i32 %1, -1
  %incdec.ptr3 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %sub1, ptr %incdec.ptr1, align 4
  %incdec.ptr4 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %incdec.ptr6 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %2, ptr %incdec.ptr3, align 4
  %3 = load i32, ptr %incdec.ptr4, align 4
  %sub8 = sub nsw i32 %3, -3
  store i32 %sub8, ptr %incdec.ptr6, align 4
  ret void
}

define void @mul(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @mul(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 2
; NON-POW2-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 2
; NON-POW2-NEXT:    [[TMP0:%.*]] = load <2 x i32>, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[TMP1:%.*]] = mul nsw <2 x i32> [[TMP0]], <i32 257, i32 -3>
; NON-POW2-NEXT:    store <2 x i32> [[TMP1]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 3
; NON-POW2-NEXT:    [[TMP2:%.*]] = load i32, ptr [[INCDEC_PTR2]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 3
; NON-POW2-NEXT:    store i32 [[TMP2]], ptr [[INCDEC_PTR4]], align 4
; NON-POW2-NEXT:    [[TMP3:%.*]] = load i32, ptr [[INCDEC_PTR5]], align 4
; NON-POW2-NEXT:    [[MUL9:%.*]] = mul nsw i32 [[TMP3]], -9
; NON-POW2-NEXT:    store i32 [[MUL9]], ptr [[INCDEC_PTR7]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @mul(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 2
; POW2-ONLY-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 2
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load <2 x i32>, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = mul nsw <2 x i32> [[TMP0]], <i32 257, i32 -3>
; POW2-ONLY-NEXT:    store <2 x i32> [[TMP1]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 3
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = load i32, ptr [[INCDEC_PTR2]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 3
; POW2-ONLY-NEXT:    store i32 [[TMP2]], ptr [[INCDEC_PTR4]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = load i32, ptr [[INCDEC_PTR5]], align 4
; POW2-ONLY-NEXT:    [[MUL9:%.*]] = mul nsw i32 [[TMP3]], -9
; POW2-ONLY-NEXT:    store i32 [[MUL9]], ptr [[INCDEC_PTR7]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @mul(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <4 x i32>, ptr [[SRC:%.*]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = mul nsw <4 x i32> [[TMP0]], <i32 257, i32 -3, i32 1, i32 -9>
; COPYABLE-NEXT:    store <4 x i32> [[TMP1]], ptr [[DST:%.*]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %mul = mul nsw i32 %0, 257
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %mul, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %mul3 = mul nsw i32 %1, -3
  %incdec.ptr4 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %mul3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %incdec.ptr7 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %2, ptr %incdec.ptr4, align 4
  %3 = load i32, ptr %incdec.ptr5, align 4
  %mul9 = mul nsw i32 %3, -9
  store i32 %mul9, ptr %incdec.ptr7, align 4
  ret void
}

define void @shl0(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @shl0(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 1
; NON-POW2-NEXT:    [[TMP0:%.*]] = load i32, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 1
; NON-POW2-NEXT:    store i32 [[TMP0]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[TMP1:%.*]] = load <3 x i32>, ptr [[INCDEC_PTR]], align 4
; NON-POW2-NEXT:    [[TMP2:%.*]] = shl <3 x i32> [[TMP1]], <i32 1, i32 2, i32 3>
; NON-POW2-NEXT:    store <3 x i32> [[TMP2]], ptr [[INCDEC_PTR1]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @shl0(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds i32, ptr [[SRC:%.*]], i64 1
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load i32, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds i32, ptr [[DST:%.*]], i64 1
; POW2-ONLY-NEXT:    store i32 [[TMP0]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds i32, ptr [[SRC]], i64 3
; POW2-ONLY-NEXT:    [[INCDEC_PTR6:%.*]] = getelementptr inbounds i32, ptr [[DST]], i64 3
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = load <2 x i32>, ptr [[INCDEC_PTR]], align 4
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = shl <2 x i32> [[TMP1]], <i32 1, i32 2>
; POW2-ONLY-NEXT:    store <2 x i32> [[TMP2]], ptr [[INCDEC_PTR1]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = load i32, ptr [[INCDEC_PTR4]], align 4
; POW2-ONLY-NEXT:    [[SHL8:%.*]] = shl i32 [[TMP3]], 3
; POW2-ONLY-NEXT:    store i32 [[SHL8]], ptr [[INCDEC_PTR6]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @shl0(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <4 x i32>, ptr [[SRC:%.*]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = shl <4 x i32> [[TMP0]], <i32 0, i32 1, i32 2, i32 3>
; COPYABLE-NEXT:    store <4 x i32> [[TMP1]], ptr [[DST:%.*]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %0, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %shl = shl i32 %1, 1
  %incdec.ptr3 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %shl, ptr %incdec.ptr1, align 4
  %incdec.ptr4 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %shl5 = shl i32 %2, 2
  %incdec.ptr6 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %shl5, ptr %incdec.ptr3, align 4
  %3 = load i32, ptr %incdec.ptr4, align 4
  %shl8 = shl i32 %3, 3
  store i32 %shl8, ptr %incdec.ptr6, align 4
  ret void
}

define void @shl1(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @shl1(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x i32>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = shl <4 x i32> [[TMP0]], <i32 7, i32 1, i32 2, i32 3>
; CHECK-NEXT:    store <4 x i32> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds i32, ptr %src, i64 1
  %0 = load i32, ptr %src, align 4
  %shl = shl i32 %0, 7
  %incdec.ptr1 = getelementptr inbounds i32, ptr %dst, i64 1
  store i32 %shl, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds i32, ptr %src, i64 2
  %1 = load i32, ptr %incdec.ptr, align 4
  %shl3 = shl i32 %1, 1
  %incdec.ptr4 = getelementptr inbounds i32, ptr %dst, i64 2
  store i32 %shl3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds i32, ptr %src, i64 3
  %2 = load i32, ptr %incdec.ptr2, align 4
  %shl6 = shl i32 %2, 2
  %incdec.ptr7 = getelementptr inbounds i32, ptr %dst, i64 3
  store i32 %shl6, ptr %incdec.ptr4, align 4
  %3 = load i32, ptr %incdec.ptr5, align 4
  %shl9 = shl i32 %3, 3
  store i32 %shl9, ptr %incdec.ptr7, align 4
  ret void
}

define void @add0f(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @add0f(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x float>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = fadd fast <4 x float> [[TMP0]], <float 1.000000e+00, float 1.000000e+00, float 2.000000e+00, float 3.000000e+00>
; CHECK-NEXT:    store <4 x float> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %add = fadd fast float %0, 1.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %add, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %add3 = fadd fast float %1, 1.000000e+00
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %add3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %add6 = fadd fast float %2, 2.000000e+00
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %add6, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %add9 = fadd fast float %3, 3.000000e+00
  store float %add9, ptr %incdec.ptr7, align 4
  ret void
}

define void @add1f(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @add1f(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; NON-POW2-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; NON-POW2-NEXT:    store float [[TMP0]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[TMP1:%.*]] = load <3 x float>, ptr [[INCDEC_PTR]], align 4
; NON-POW2-NEXT:    [[TMP2:%.*]] = fadd fast <3 x float> [[TMP1]], <float 1.000000e+00, float 2.000000e+00, float 3.000000e+00>
; NON-POW2-NEXT:    store <3 x float> [[TMP2]], ptr [[INCDEC_PTR1]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @add1f(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; POW2-ONLY-NEXT:    store float [[TMP0]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 3
; POW2-ONLY-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 3
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = load <2 x float>, ptr [[INCDEC_PTR]], align 4
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = fadd fast <2 x float> [[TMP1]], <float 1.000000e+00, float 2.000000e+00>
; POW2-ONLY-NEXT:    store <2 x float> [[TMP2]], ptr [[INCDEC_PTR1]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = load float, ptr [[INCDEC_PTR5]], align 4
; POW2-ONLY-NEXT:    [[ADD9:%.*]] = fadd fast float [[TMP3]], 3.000000e+00
; POW2-ONLY-NEXT:    store float [[ADD9]], ptr [[INCDEC_PTR7]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @add1f(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <4 x float>, ptr [[SRC:%.*]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = fadd fast <4 x float> [[TMP0]], <float -0.000000e+00, float 1.000000e+00, float 2.000000e+00, float 3.000000e+00>
; COPYABLE-NEXT:    store <4 x float> [[TMP1]], ptr [[DST:%.*]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %0, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %add3 = fadd fast float %1, 1.000000e+00
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %add3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %add6 = fadd fast float %2, 2.000000e+00
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %add6, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %add9 = fadd fast float %3, 3.000000e+00
  store float %add9, ptr %incdec.ptr7, align 4
  ret void
}

define void @sub0f(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @sub0f(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; NON-POW2-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[ADD:%.*]] = fadd fast float [[TMP0]], -1.000000e+00
; NON-POW2-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; NON-POW2-NEXT:    store float [[ADD]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 2
; NON-POW2-NEXT:    [[TMP1:%.*]] = load float, ptr [[INCDEC_PTR]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 2
; NON-POW2-NEXT:    store float [[TMP1]], ptr [[INCDEC_PTR1]], align 4
; NON-POW2-NEXT:    [[TMP2:%.*]] = load <2 x float>, ptr [[INCDEC_PTR2]], align 4
; NON-POW2-NEXT:    [[TMP3:%.*]] = fadd fast <2 x float> [[TMP2]], <float -2.000000e+00, float -3.000000e+00>
; NON-POW2-NEXT:    store <2 x float> [[TMP3]], ptr [[INCDEC_PTR4]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @sub0f(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[ADD:%.*]] = fadd fast float [[TMP0]], -1.000000e+00
; POW2-ONLY-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; POW2-ONLY-NEXT:    store float [[ADD]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 2
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = load float, ptr [[INCDEC_PTR]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 2
; POW2-ONLY-NEXT:    store float [[TMP1]], ptr [[INCDEC_PTR1]], align 4
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = load <2 x float>, ptr [[INCDEC_PTR2]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = fadd fast <2 x float> [[TMP2]], <float -2.000000e+00, float -3.000000e+00>
; POW2-ONLY-NEXT:    store <2 x float> [[TMP3]], ptr [[INCDEC_PTR4]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @sub0f(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <4 x float>, ptr [[SRC:%.*]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = fadd fast <4 x float> [[TMP0]], <float -1.000000e+00, float -0.000000e+00, float -2.000000e+00, float -3.000000e+00>
; COPYABLE-NEXT:    store <4 x float> [[TMP1]], ptr [[DST:%.*]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %add = fadd fast float %0, -1.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %add, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %1, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %add6 = fadd fast float %2, -2.000000e+00
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %add6, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %add9 = fadd fast float %3, -3.000000e+00
  store float %add9, ptr %incdec.ptr7, align 4
  ret void
}

define void @sub1f(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @sub1f(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x float>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = fadd fast <4 x float> [[TMP0]], <float 4.000000e+00, float -1.000000e+00, float -2.000000e+00, float -3.000000e+00>
; CHECK-NEXT:    store <4 x float> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %add = fadd fast float %0, 4.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %add, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %sub = fadd fast float %1, -1.000000e+00
  %incdec.ptr3 = getelementptr inbounds float, ptr %dst, i64 2
  store float %sub, ptr %incdec.ptr1, align 4
  %incdec.ptr4 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %sub5 = fadd fast float %2, -2.000000e+00
  %incdec.ptr6 = getelementptr inbounds float, ptr %dst, i64 3
  store float %sub5, ptr %incdec.ptr3, align 4
  %3 = load float, ptr %incdec.ptr4, align 4
  %sub8 = fadd fast float %3, -3.000000e+00
  store float %sub8, ptr %incdec.ptr6, align 4
  ret void
}

define void @sub2f(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @sub2f(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x float>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = fadd fast <4 x float> [[TMP0]], <float -1.000000e+00, float -1.000000e+00, float -2.000000e+00, float -3.000000e+00>
; CHECK-NEXT:    store <4 x float> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %sub = fadd fast float %0, -1.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %sub3 = fadd fast float %1, -1.000000e+00
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %sub3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %sub6 = fadd fast float %2, -2.000000e+00
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %sub6, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %sub9 = fadd fast float %3, -3.000000e+00
  store float %sub9, ptr %incdec.ptr7, align 4
  ret void
}

define void @addsub0f(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @addsub0f(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; NON-POW2-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[SUB:%.*]] = fadd fast float [[TMP0]], -1.000000e+00
; NON-POW2-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; NON-POW2-NEXT:    store float [[SUB]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 2
; NON-POW2-NEXT:    [[TMP1:%.*]] = load float, ptr [[INCDEC_PTR]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 2
; NON-POW2-NEXT:    store float [[TMP1]], ptr [[INCDEC_PTR1]], align 4
; NON-POW2-NEXT:    [[TMP2:%.*]] = load <2 x float>, ptr [[INCDEC_PTR2]], align 4
; NON-POW2-NEXT:    [[TMP3:%.*]] = fadd fast <2 x float> [[TMP2]], <float -2.000000e+00, float -3.000000e+00>
; NON-POW2-NEXT:    [[TMP4:%.*]] = fsub fast <2 x float> [[TMP2]], <float -2.000000e+00, float -3.000000e+00>
; NON-POW2-NEXT:    [[TMP5:%.*]] = shufflevector <2 x float> [[TMP3]], <2 x float> [[TMP4]], <2 x i32> <i32 0, i32 3>
; NON-POW2-NEXT:    store <2 x float> [[TMP5]], ptr [[INCDEC_PTR3]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @addsub0f(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[SUB:%.*]] = fadd fast float [[TMP0]], -1.000000e+00
; POW2-ONLY-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; POW2-ONLY-NEXT:    store float [[SUB]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 2
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = load float, ptr [[INCDEC_PTR]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 2
; POW2-ONLY-NEXT:    store float [[TMP1]], ptr [[INCDEC_PTR1]], align 4
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = load <2 x float>, ptr [[INCDEC_PTR2]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = fadd fast <2 x float> [[TMP2]], <float -2.000000e+00, float -3.000000e+00>
; POW2-ONLY-NEXT:    [[TMP4:%.*]] = fsub fast <2 x float> [[TMP2]], <float -2.000000e+00, float -3.000000e+00>
; POW2-ONLY-NEXT:    [[TMP5:%.*]] = shufflevector <2 x float> [[TMP3]], <2 x float> [[TMP4]], <2 x i32> <i32 0, i32 3>
; POW2-ONLY-NEXT:    store <2 x float> [[TMP5]], ptr [[INCDEC_PTR3]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @addsub0f(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 2
; COPYABLE-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 2
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <2 x float>, ptr [[SRC]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = fadd fast <2 x float> [[TMP0]], <float -1.000000e+00, float -0.000000e+00>
; COPYABLE-NEXT:    store <2 x float> [[TMP1]], ptr [[DST]], align 4
; COPYABLE-NEXT:    [[TMP2:%.*]] = load <2 x float>, ptr [[INCDEC_PTR2]], align 4
; COPYABLE-NEXT:    [[TMP3:%.*]] = fadd fast <2 x float> [[TMP2]], <float -2.000000e+00, float -3.000000e+00>
; COPYABLE-NEXT:    [[TMP4:%.*]] = fsub fast <2 x float> [[TMP2]], <float -2.000000e+00, float -3.000000e+00>
; COPYABLE-NEXT:    [[TMP5:%.*]] = shufflevector <2 x float> [[TMP3]], <2 x float> [[TMP4]], <2 x i32> <i32 0, i32 3>
; COPYABLE-NEXT:    store <2 x float> [[TMP5]], ptr [[INCDEC_PTR3]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %sub = fadd fast float %0, -1.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %incdec.ptr3 = getelementptr inbounds float, ptr %dst, i64 2
  store float %1, ptr %incdec.ptr1, align 4
  %incdec.ptr4 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %sub5 = fadd fast float %2, -2.000000e+00
  %incdec.ptr6 = getelementptr inbounds float, ptr %dst, i64 3
  store float %sub5, ptr %incdec.ptr3, align 4
  %3 = load float, ptr %incdec.ptr4, align 4
  %sub8 = fsub fast float %3, -3.000000e+00
  store float %sub8, ptr %incdec.ptr6, align 4
  ret void
}

define void @addsub1f(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @addsub1f(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 2
; NON-POW2-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 2
; NON-POW2-NEXT:    [[TMP0:%.*]] = load <2 x float>, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[TMP1:%.*]] = fadd fast <2 x float> [[TMP0]], splat (float -1.000000e+00)
; NON-POW2-NEXT:    [[TMP2:%.*]] = fsub fast <2 x float> [[TMP0]], splat (float -1.000000e+00)
; NON-POW2-NEXT:    [[TMP3:%.*]] = shufflevector <2 x float> [[TMP1]], <2 x float> [[TMP2]], <2 x i32> <i32 0, i32 3>
; NON-POW2-NEXT:    store <2 x float> [[TMP3]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 3
; NON-POW2-NEXT:    [[TMP4:%.*]] = load float, ptr [[INCDEC_PTR2]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR6:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 3
; NON-POW2-NEXT:    store float [[TMP4]], ptr [[INCDEC_PTR3]], align 4
; NON-POW2-NEXT:    [[TMP5:%.*]] = load float, ptr [[INCDEC_PTR4]], align 4
; NON-POW2-NEXT:    [[SUB8:%.*]] = fsub fast float [[TMP5]], -3.000000e+00
; NON-POW2-NEXT:    store float [[SUB8]], ptr [[INCDEC_PTR6]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @addsub1f(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 2
; POW2-ONLY-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 2
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load <2 x float>, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = fadd fast <2 x float> [[TMP0]], splat (float -1.000000e+00)
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = fsub fast <2 x float> [[TMP0]], splat (float -1.000000e+00)
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = shufflevector <2 x float> [[TMP1]], <2 x float> [[TMP2]], <2 x i32> <i32 0, i32 3>
; POW2-ONLY-NEXT:    store <2 x float> [[TMP3]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 3
; POW2-ONLY-NEXT:    [[TMP4:%.*]] = load float, ptr [[INCDEC_PTR2]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR6:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 3
; POW2-ONLY-NEXT:    store float [[TMP4]], ptr [[INCDEC_PTR3]], align 4
; POW2-ONLY-NEXT:    [[TMP5:%.*]] = load float, ptr [[INCDEC_PTR4]], align 4
; POW2-ONLY-NEXT:    [[SUB8:%.*]] = fsub fast float [[TMP5]], -3.000000e+00
; POW2-ONLY-NEXT:    store float [[SUB8]], ptr [[INCDEC_PTR6]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @addsub1f(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 2
; COPYABLE-NEXT:    [[INCDEC_PTR3:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 2
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <2 x float>, ptr [[SRC]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = fadd fast <2 x float> [[TMP0]], splat (float -1.000000e+00)
; COPYABLE-NEXT:    [[TMP2:%.*]] = fsub fast <2 x float> [[TMP0]], splat (float -1.000000e+00)
; COPYABLE-NEXT:    [[TMP3:%.*]] = shufflevector <2 x float> [[TMP1]], <2 x float> [[TMP2]], <2 x i32> <i32 0, i32 3>
; COPYABLE-NEXT:    store <2 x float> [[TMP3]], ptr [[DST]], align 4
; COPYABLE-NEXT:    [[TMP4:%.*]] = load <2 x float>, ptr [[INCDEC_PTR2]], align 4
; COPYABLE-NEXT:    [[TMP5:%.*]] = fsub fast <2 x float> [[TMP4]], <float 0.000000e+00, float -3.000000e+00>
; COPYABLE-NEXT:    store <2 x float> [[TMP5]], ptr [[INCDEC_PTR3]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %sub = fadd fast float %0, -1.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %sub1 = fsub fast float %1, -1.000000e+00
  %incdec.ptr3 = getelementptr inbounds float, ptr %dst, i64 2
  store float %sub1, ptr %incdec.ptr1, align 4
  %incdec.ptr4 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %incdec.ptr6 = getelementptr inbounds float, ptr %dst, i64 3
  store float %2, ptr %incdec.ptr3, align 4
  %3 = load float, ptr %incdec.ptr4, align 4
  %sub8 = fsub fast float %3, -3.000000e+00
  store float %sub8, ptr %incdec.ptr6, align 4
  ret void
}

define void @mulf(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @mulf(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 2
; NON-POW2-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 2
; NON-POW2-NEXT:    [[TMP0:%.*]] = load <2 x float>, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[TMP1:%.*]] = fmul fast <2 x float> [[TMP0]], <float 2.570000e+02, float -3.000000e+00>
; NON-POW2-NEXT:    store <2 x float> [[TMP1]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 3
; NON-POW2-NEXT:    [[TMP2:%.*]] = load float, ptr [[INCDEC_PTR2]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 3
; NON-POW2-NEXT:    store float [[TMP2]], ptr [[INCDEC_PTR4]], align 4
; NON-POW2-NEXT:    [[TMP3:%.*]] = load float, ptr [[INCDEC_PTR5]], align 4
; NON-POW2-NEXT:    [[SUB9:%.*]] = fmul fast float [[TMP3]], -9.000000e+00
; NON-POW2-NEXT:    store float [[SUB9]], ptr [[INCDEC_PTR7]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @mulf(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 2
; POW2-ONLY-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 2
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load <2 x float>, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = fmul fast <2 x float> [[TMP0]], <float 2.570000e+02, float -3.000000e+00>
; POW2-ONLY-NEXT:    store <2 x float> [[TMP1]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 3
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = load float, ptr [[INCDEC_PTR2]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 3
; POW2-ONLY-NEXT:    store float [[TMP2]], ptr [[INCDEC_PTR4]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = load float, ptr [[INCDEC_PTR5]], align 4
; POW2-ONLY-NEXT:    [[SUB9:%.*]] = fmul fast float [[TMP3]], -9.000000e+00
; POW2-ONLY-NEXT:    store float [[SUB9]], ptr [[INCDEC_PTR7]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @mulf(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <4 x float>, ptr [[SRC:%.*]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = fmul fast <4 x float> [[TMP0]], <float 2.570000e+02, float -3.000000e+00, float 1.000000e+00, float -9.000000e+00>
; COPYABLE-NEXT:    store <4 x float> [[TMP1]], ptr [[DST:%.*]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %sub = fmul fast float %0, 2.570000e+02
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %sub3 = fmul fast float %1, -3.000000e+00
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %sub3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %2, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %sub9 = fmul fast float %3, -9.000000e+00
  store float %sub9, ptr %incdec.ptr7, align 4
  ret void
}

define void @add0fn(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @add0fn(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x float>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = fadd <4 x float> [[TMP0]], <float 1.000000e+00, float 1.000000e+00, float 2.000000e+00, float 3.000000e+00>
; CHECK-NEXT:    store <4 x float> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %add = fadd float %0, 1.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %add, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %add3 = fadd float %1, 1.000000e+00
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %add3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %add6 = fadd float %2, 2.000000e+00
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %add6, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %add9 = fadd float %3, 3.000000e+00
  store float %add9, ptr %incdec.ptr7, align 4
  ret void
}

define void @add1fn(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @add1fn(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; NON-POW2-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; NON-POW2-NEXT:    store float [[TMP0]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[TMP1:%.*]] = load <3 x float>, ptr [[INCDEC_PTR]], align 4
; NON-POW2-NEXT:    [[TMP2:%.*]] = fadd <3 x float> [[TMP1]], <float 1.000000e+00, float 2.000000e+00, float 3.000000e+00>
; NON-POW2-NEXT:    store <3 x float> [[TMP2]], ptr [[INCDEC_PTR1]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @add1fn(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; POW2-ONLY-NEXT:    store float [[TMP0]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 3
; POW2-ONLY-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 3
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = load <2 x float>, ptr [[INCDEC_PTR]], align 4
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = fadd <2 x float> [[TMP1]], <float 1.000000e+00, float 2.000000e+00>
; POW2-ONLY-NEXT:    store <2 x float> [[TMP2]], ptr [[INCDEC_PTR1]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = load float, ptr [[INCDEC_PTR5]], align 4
; POW2-ONLY-NEXT:    [[ADD9:%.*]] = fadd float [[TMP3]], 3.000000e+00
; POW2-ONLY-NEXT:    store float [[ADD9]], ptr [[INCDEC_PTR7]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @add1fn(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; COPYABLE-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; COPYABLE-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; COPYABLE-NEXT:    store float [[TMP0]], ptr [[DST]], align 4
; COPYABLE-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 3
; COPYABLE-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 3
; COPYABLE-NEXT:    [[TMP1:%.*]] = load <2 x float>, ptr [[INCDEC_PTR]], align 4
; COPYABLE-NEXT:    [[TMP2:%.*]] = fadd <2 x float> [[TMP1]], <float 1.000000e+00, float 2.000000e+00>
; COPYABLE-NEXT:    store <2 x float> [[TMP2]], ptr [[INCDEC_PTR1]], align 4
; COPYABLE-NEXT:    [[TMP3:%.*]] = load float, ptr [[INCDEC_PTR5]], align 4
; COPYABLE-NEXT:    [[ADD9:%.*]] = fadd float [[TMP3]], 3.000000e+00
; COPYABLE-NEXT:    store float [[ADD9]], ptr [[INCDEC_PTR7]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %0, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %add3 = fadd float %1, 1.000000e+00
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %add3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %add6 = fadd float %2, 2.000000e+00
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %add6, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %add9 = fadd float %3, 3.000000e+00
  store float %add9, ptr %incdec.ptr7, align 4
  ret void
}

define void @sub0fn(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @sub0fn(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[INCDEC_PTR:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 1
; CHECK-NEXT:    [[TMP0:%.*]] = load float, ptr [[SRC]], align 4
; CHECK-NEXT:    [[ADD:%.*]] = fadd fast float [[TMP0]], -1.000000e+00
; CHECK-NEXT:    [[INCDEC_PTR1:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 1
; CHECK-NEXT:    store float [[ADD]], ptr [[DST]], align 4
; CHECK-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 2
; CHECK-NEXT:    [[TMP1:%.*]] = load float, ptr [[INCDEC_PTR]], align 4
; CHECK-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 2
; CHECK-NEXT:    store float [[TMP1]], ptr [[INCDEC_PTR1]], align 4
; CHECK-NEXT:    [[TMP2:%.*]] = load <2 x float>, ptr [[INCDEC_PTR2]], align 4
; CHECK-NEXT:    [[TMP3:%.*]] = fadd <2 x float> [[TMP2]], <float -2.000000e+00, float -3.000000e+00>
; CHECK-NEXT:    store <2 x float> [[TMP3]], ptr [[INCDEC_PTR4]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %add = fadd fast float %0, -1.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %add, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %1, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %add6 = fadd float %2, -2.000000e+00
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %add6, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %add9 = fadd float %3, -3.000000e+00
  store float %add9, ptr %incdec.ptr7, align 4
  ret void
}

define void @sub1fn(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @sub1fn(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x float>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = fadd <4 x float> [[TMP0]], <float 4.000000e+00, float -1.000000e+00, float -2.000000e+00, float -3.000000e+00>
; CHECK-NEXT:    store <4 x float> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %add = fadd float %0, 4.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %add, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %sub = fadd float %1, -1.000000e+00
  %incdec.ptr3 = getelementptr inbounds float, ptr %dst, i64 2
  store float %sub, ptr %incdec.ptr1, align 4
  %incdec.ptr4 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %sub5 = fadd float %2, -2.000000e+00
  %incdec.ptr6 = getelementptr inbounds float, ptr %dst, i64 3
  store float %sub5, ptr %incdec.ptr3, align 4
  %3 = load float, ptr %incdec.ptr4, align 4
  %sub8 = fadd float %3, -3.000000e+00
  store float %sub8, ptr %incdec.ptr6, align 4
  ret void
}

define void @sub2fn(ptr noalias %dst, ptr noalias %src) {
; CHECK-LABEL: @sub2fn(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = load <4 x float>, ptr [[SRC:%.*]], align 4
; CHECK-NEXT:    [[TMP1:%.*]] = fadd <4 x float> [[TMP0]], <float -1.000000e+00, float -1.000000e+00, float -2.000000e+00, float -3.000000e+00>
; CHECK-NEXT:    store <4 x float> [[TMP1]], ptr [[DST:%.*]], align 4
; CHECK-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %sub = fadd float %0, -1.000000e+00
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %sub3 = fadd float %1, -1.000000e+00
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %sub3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %sub6 = fadd float %2, -2.000000e+00
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %sub6, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %sub9 = fadd float %3, -3.000000e+00
  store float %sub9, ptr %incdec.ptr7, align 4
  ret void
}

define void @mulfn(ptr noalias %dst, ptr noalias %src) {
; NON-POW2-LABEL: @mulfn(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 2
; NON-POW2-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 2
; NON-POW2-NEXT:    [[TMP0:%.*]] = load <2 x float>, ptr [[SRC]], align 4
; NON-POW2-NEXT:    [[TMP1:%.*]] = fmul <2 x float> [[TMP0]], <float 2.570000e+02, float -3.000000e+00>
; NON-POW2-NEXT:    store <2 x float> [[TMP1]], ptr [[DST]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 3
; NON-POW2-NEXT:    [[TMP2:%.*]] = load float, ptr [[INCDEC_PTR2]], align 4
; NON-POW2-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 3
; NON-POW2-NEXT:    store float [[TMP2]], ptr [[INCDEC_PTR4]], align 4
; NON-POW2-NEXT:    [[TMP3:%.*]] = load float, ptr [[INCDEC_PTR5]], align 4
; NON-POW2-NEXT:    [[SUB9:%.*]] = fmul fast float [[TMP3]], -9.000000e+00
; NON-POW2-NEXT:    store float [[SUB9]], ptr [[INCDEC_PTR7]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @mulfn(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 2
; POW2-ONLY-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 2
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = load <2 x float>, ptr [[SRC]], align 4
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = fmul <2 x float> [[TMP0]], <float 2.570000e+02, float -3.000000e+00>
; POW2-ONLY-NEXT:    store <2 x float> [[TMP1]], ptr [[DST]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR5:%.*]] = getelementptr inbounds float, ptr [[SRC]], i64 3
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = load float, ptr [[INCDEC_PTR2]], align 4
; POW2-ONLY-NEXT:    [[INCDEC_PTR7:%.*]] = getelementptr inbounds float, ptr [[DST]], i64 3
; POW2-ONLY-NEXT:    store float [[TMP2]], ptr [[INCDEC_PTR4]], align 4
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = load float, ptr [[INCDEC_PTR5]], align 4
; POW2-ONLY-NEXT:    [[SUB9:%.*]] = fmul fast float [[TMP3]], -9.000000e+00
; POW2-ONLY-NEXT:    store float [[SUB9]], ptr [[INCDEC_PTR7]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @mulfn(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[INCDEC_PTR2:%.*]] = getelementptr inbounds float, ptr [[SRC:%.*]], i64 2
; COPYABLE-NEXT:    [[INCDEC_PTR4:%.*]] = getelementptr inbounds float, ptr [[DST:%.*]], i64 2
; COPYABLE-NEXT:    [[TMP0:%.*]] = load <2 x float>, ptr [[SRC]], align 4
; COPYABLE-NEXT:    [[TMP1:%.*]] = fmul <2 x float> [[TMP0]], <float 2.570000e+02, float -3.000000e+00>
; COPYABLE-NEXT:    store <2 x float> [[TMP1]], ptr [[DST]], align 4
; COPYABLE-NEXT:    [[TMP2:%.*]] = load <2 x float>, ptr [[INCDEC_PTR2]], align 4
; COPYABLE-NEXT:    [[TMP3:%.*]] = fmul fast <2 x float> [[TMP2]], <float 1.000000e+00, float -9.000000e+00>
; COPYABLE-NEXT:    store <2 x float> [[TMP3]], ptr [[INCDEC_PTR4]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %incdec.ptr = getelementptr inbounds float, ptr %src, i64 1
  %0 = load float, ptr %src, align 4
  %sub = fmul float %0, 2.570000e+02
  %incdec.ptr1 = getelementptr inbounds float, ptr %dst, i64 1
  store float %sub, ptr %dst, align 4
  %incdec.ptr2 = getelementptr inbounds float, ptr %src, i64 2
  %1 = load float, ptr %incdec.ptr, align 4
  %sub3 = fmul float %1, -3.000000e+00
  %incdec.ptr4 = getelementptr inbounds float, ptr %dst, i64 2
  store float %sub3, ptr %incdec.ptr1, align 4
  %incdec.ptr5 = getelementptr inbounds float, ptr %src, i64 3
  %2 = load float, ptr %incdec.ptr2, align 4
  %incdec.ptr7 = getelementptr inbounds float, ptr %dst, i64 3
  store float %2, ptr %incdec.ptr4, align 4
  %3 = load float, ptr %incdec.ptr5, align 4
  %sub9 = fmul fast float %3, -9.000000e+00
  store float %sub9, ptr %incdec.ptr7, align 4
  ret void
}

define void @and_lshr(ptr %0, ptr %1, float %2, float %3) {
; NON-POW2-LABEL: @and_lshr(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[TMP4:%.*]] = load i8, ptr [[TMP1:%.*]], align 1
; NON-POW2-NEXT:    [[TMP5:%.*]] = zext i8 [[TMP4]] to i32
; NON-POW2-NEXT:    [[TMP6:%.*]] = lshr i32 [[TMP5]], 2
; NON-POW2-NEXT:    [[TMP7:%.*]] = lshr i32 [[TMP5]], 4
; NON-POW2-NEXT:    [[TMP8:%.*]] = insertelement <4 x i32> poison, i32 [[TMP5]], i32 0
; NON-POW2-NEXT:    [[TMP9:%.*]] = insertelement <4 x i32> [[TMP8]], i32 [[TMP6]], i32 1
; NON-POW2-NEXT:    [[TMP10:%.*]] = insertelement <4 x i32> [[TMP9]], i32 [[TMP7]], i32 2
; NON-POW2-NEXT:    [[TMP11:%.*]] = shufflevector <4 x i32> [[TMP10]], <4 x i32> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 0>
; NON-POW2-NEXT:    [[TMP12:%.*]] = and <4 x i32> [[TMP11]], <i32 3, i32 3, i32 3, i32 6>
; NON-POW2-NEXT:    [[TMP13:%.*]] = lshr <4 x i32> [[TMP11]], <i32 3, i32 3, i32 3, i32 6>
; NON-POW2-NEXT:    [[TMP14:%.*]] = shufflevector <4 x i32> [[TMP12]], <4 x i32> [[TMP13]], <4 x i32> <i32 0, i32 1, i32 2, i32 7>
; NON-POW2-NEXT:    [[TMP15:%.*]] = sitofp <4 x i32> [[TMP14]] to <4 x float>
; NON-POW2-NEXT:    [[TMP16:%.*]] = load <4 x float>, ptr [[TMP0:%.*]], align 4
; NON-POW2-NEXT:    [[TMP17:%.*]] = insertelement <4 x float> poison, float [[TMP3:%.*]], i32 0
; NON-POW2-NEXT:    [[TMP18:%.*]] = shufflevector <4 x float> [[TMP17]], <4 x float> poison, <4 x i32> zeroinitializer
; NON-POW2-NEXT:    [[TMP19:%.*]] = fadd <4 x float> [[TMP16]], [[TMP18]]
; NON-POW2-NEXT:    [[TMP20:%.*]] = insertelement <4 x float> poison, float [[TMP2:%.*]], i32 0
; NON-POW2-NEXT:    [[TMP21:%.*]] = shufflevector <4 x float> [[TMP20]], <4 x float> poison, <4 x i32> zeroinitializer
; NON-POW2-NEXT:    [[TMP22:%.*]] = call <4 x float> @llvm.fma.v4f32(<4 x float> [[TMP21]], <4 x float> [[TMP15]], <4 x float> [[TMP19]])
; NON-POW2-NEXT:    store <4 x float> [[TMP22]], ptr [[TMP0]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @and_lshr(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[TMP4:%.*]] = load i8, ptr [[TMP1:%.*]], align 1
; POW2-ONLY-NEXT:    [[TMP5:%.*]] = zext i8 [[TMP4]] to i32
; POW2-ONLY-NEXT:    [[TMP6:%.*]] = lshr i32 [[TMP5]], 2
; POW2-ONLY-NEXT:    [[TMP7:%.*]] = lshr i32 [[TMP5]], 4
; POW2-ONLY-NEXT:    [[TMP8:%.*]] = insertelement <4 x i32> poison, i32 [[TMP5]], i32 0
; POW2-ONLY-NEXT:    [[TMP9:%.*]] = insertelement <4 x i32> [[TMP8]], i32 [[TMP6]], i32 1
; POW2-ONLY-NEXT:    [[TMP10:%.*]] = insertelement <4 x i32> [[TMP9]], i32 [[TMP7]], i32 2
; POW2-ONLY-NEXT:    [[TMP11:%.*]] = shufflevector <4 x i32> [[TMP10]], <4 x i32> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 0>
; POW2-ONLY-NEXT:    [[TMP12:%.*]] = and <4 x i32> [[TMP11]], <i32 3, i32 3, i32 3, i32 6>
; POW2-ONLY-NEXT:    [[TMP13:%.*]] = lshr <4 x i32> [[TMP11]], <i32 3, i32 3, i32 3, i32 6>
; POW2-ONLY-NEXT:    [[TMP14:%.*]] = shufflevector <4 x i32> [[TMP12]], <4 x i32> [[TMP13]], <4 x i32> <i32 0, i32 1, i32 2, i32 7>
; POW2-ONLY-NEXT:    [[TMP15:%.*]] = sitofp <4 x i32> [[TMP14]] to <4 x float>
; POW2-ONLY-NEXT:    [[TMP16:%.*]] = load <4 x float>, ptr [[TMP0:%.*]], align 4
; POW2-ONLY-NEXT:    [[TMP17:%.*]] = insertelement <4 x float> poison, float [[TMP3:%.*]], i32 0
; POW2-ONLY-NEXT:    [[TMP18:%.*]] = shufflevector <4 x float> [[TMP17]], <4 x float> poison, <4 x i32> zeroinitializer
; POW2-ONLY-NEXT:    [[TMP19:%.*]] = fadd <4 x float> [[TMP16]], [[TMP18]]
; POW2-ONLY-NEXT:    [[TMP20:%.*]] = insertelement <4 x float> poison, float [[TMP2:%.*]], i32 0
; POW2-ONLY-NEXT:    [[TMP21:%.*]] = shufflevector <4 x float> [[TMP20]], <4 x float> poison, <4 x i32> zeroinitializer
; POW2-ONLY-NEXT:    [[TMP22:%.*]] = call <4 x float> @llvm.fma.v4f32(<4 x float> [[TMP21]], <4 x float> [[TMP15]], <4 x float> [[TMP19]])
; POW2-ONLY-NEXT:    store <4 x float> [[TMP22]], ptr [[TMP0]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @and_lshr(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[TMP4:%.*]] = load i8, ptr [[TMP1:%.*]], align 1
; COPYABLE-NEXT:    [[TMP5:%.*]] = zext i8 [[TMP4]] to i32
; COPYABLE-NEXT:    [[TMP6:%.*]] = insertelement <4 x i32> poison, i32 [[TMP5]], i32 0
; COPYABLE-NEXT:    [[TMP7:%.*]] = shufflevector <4 x i32> [[TMP6]], <4 x i32> poison, <4 x i32> zeroinitializer
; COPYABLE-NEXT:    [[TMP8:%.*]] = lshr <4 x i32> [[TMP7]], <i32 0, i32 2, i32 4, i32 6>
; COPYABLE-NEXT:    [[TMP9:%.*]] = and <4 x i32> [[TMP8]], <i32 3, i32 3, i32 3, i32 -1>
; COPYABLE-NEXT:    [[TMP10:%.*]] = sitofp <4 x i32> [[TMP9]] to <4 x float>
; COPYABLE-NEXT:    [[TMP11:%.*]] = load <4 x float>, ptr [[TMP0:%.*]], align 4
; COPYABLE-NEXT:    [[TMP12:%.*]] = insertelement <4 x float> poison, float [[TMP3:%.*]], i32 0
; COPYABLE-NEXT:    [[TMP13:%.*]] = shufflevector <4 x float> [[TMP12]], <4 x float> poison, <4 x i32> zeroinitializer
; COPYABLE-NEXT:    [[TMP14:%.*]] = fadd <4 x float> [[TMP11]], [[TMP13]]
; COPYABLE-NEXT:    [[TMP15:%.*]] = insertelement <4 x float> poison, float [[TMP2:%.*]], i32 0
; COPYABLE-NEXT:    [[TMP16:%.*]] = shufflevector <4 x float> [[TMP15]], <4 x float> poison, <4 x i32> zeroinitializer
; COPYABLE-NEXT:    [[TMP17:%.*]] = call <4 x float> @llvm.fma.v4f32(<4 x float> [[TMP16]], <4 x float> [[TMP10]], <4 x float> [[TMP14]])
; COPYABLE-NEXT:    store <4 x float> [[TMP17]], ptr [[TMP0]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %5 = getelementptr inbounds float, ptr %0, i64 1
  %6 = getelementptr inbounds float, ptr %0, i64 2
  %7 = getelementptr inbounds float, ptr %0, i64 3
  %8 = load i8, ptr %1, align 1
  %9 = zext i8 %8 to i32
  %10 = and i32 %9, 3
  %11 = sitofp i32 %10 to float
  %12 = lshr i32 %9, 2
  %13 = and i32 %12, 3
  %14 = sitofp i32 %13 to float
  %15 = lshr i32 %9, 4
  %16 = and i32 %15, 3
  %17 = sitofp i32 %16 to float
  %18 = lshr i32 %9, 6
  %19 = sitofp i32 %18 to float
  %20 = load float, ptr %0, align 4
  %21 = fadd float %20, %3
  %22 = tail call noundef float @llvm.fma.f32(float %2, float %11, float %21)
  store float %22, ptr %0, align 4
  %23 = load float, ptr %5, align 4
  %24 = fadd float %23, %3
  %25 = tail call noundef float @llvm.fma.f32(float %2, float %14, float %24)
  store float %25, ptr %5, align 4
  %26 = load float, ptr %6, align 4
  %27 = fadd float %26, %3
  %28 = tail call noundef float @llvm.fma.f32(float %2, float %17, float %27)
  store float %28, ptr %6, align 4
  %29 = load float, ptr %7, align 4
  %30 = fadd float %29, %3
  %31 = tail call noundef float @llvm.fma.f32(float %2, float %19, float %30)
  store float %31, ptr %7, align 4
  ret void
}

define void @add_shl(ptr %sinfo) {
; NON-POW2-LABEL: @add_shl(
; NON-POW2-NEXT:  entry:
; NON-POW2-NEXT:    [[SHL_I:%.*]] = shl i32 0, 0
; NON-POW2-NEXT:    [[END_CODE_I:%.*]] = getelementptr i8, ptr [[SINFO:%.*]], i64 348
; NON-POW2-NEXT:    [[TMP0:%.*]] = insertelement <4 x i32> <i32 0, i32 0, i32 0, i32 poison>, i32 [[SHL_I]], i32 3
; NON-POW2-NEXT:    [[TMP1:%.*]] = add <4 x i32> zeroinitializer, [[TMP0]]
; NON-POW2-NEXT:    [[TMP2:%.*]] = shl <4 x i32> zeroinitializer, [[TMP0]]
; NON-POW2-NEXT:    [[TMP3:%.*]] = shufflevector <4 x i32> [[TMP1]], <4 x i32> [[TMP2]], <4 x i32> <i32 0, i32 1, i32 6, i32 3>
; NON-POW2-NEXT:    store <4 x i32> [[TMP3]], ptr [[END_CODE_I]], align 4
; NON-POW2-NEXT:    ret void
;
; POW2-ONLY-LABEL: @add_shl(
; POW2-ONLY-NEXT:  entry:
; POW2-ONLY-NEXT:    [[SHL_I:%.*]] = shl i32 0, 0
; POW2-ONLY-NEXT:    [[END_CODE_I:%.*]] = getelementptr i8, ptr [[SINFO:%.*]], i64 348
; POW2-ONLY-NEXT:    [[TMP0:%.*]] = insertelement <4 x i32> <i32 0, i32 0, i32 0, i32 poison>, i32 [[SHL_I]], i32 3
; POW2-ONLY-NEXT:    [[TMP1:%.*]] = add <4 x i32> zeroinitializer, [[TMP0]]
; POW2-ONLY-NEXT:    [[TMP2:%.*]] = shl <4 x i32> zeroinitializer, [[TMP0]]
; POW2-ONLY-NEXT:    [[TMP3:%.*]] = shufflevector <4 x i32> [[TMP1]], <4 x i32> [[TMP2]], <4 x i32> <i32 0, i32 1, i32 6, i32 3>
; POW2-ONLY-NEXT:    store <4 x i32> [[TMP3]], ptr [[END_CODE_I]], align 4
; POW2-ONLY-NEXT:    ret void
;
; COPYABLE-LABEL: @add_shl(
; COPYABLE-NEXT:  entry:
; COPYABLE-NEXT:    [[END_CODE_I:%.*]] = getelementptr i8, ptr [[SINFO:%.*]], i64 348
; COPYABLE-NEXT:    [[TMP0:%.*]] = call <4 x i32> @llvm.vector.insert.v4i32.v2i32(<4 x i32> <i32 0, i32 0, i32 poison, i32 poison>, <2 x i32> zeroinitializer, i64 2)
; COPYABLE-NEXT:    [[TMP1:%.*]] = add <4 x i32> [[TMP0]], zeroinitializer
; COPYABLE-NEXT:    store <4 x i32> [[TMP1]], ptr [[END_CODE_I]], align 4
; COPYABLE-NEXT:    ret void
;
entry:
  %shl.i = shl i32 0, 0
  %add.i = add i32 0, 0
  %end_code.i = getelementptr i8, ptr %sinfo, i64 348
  store i32 %add.i, ptr %end_code.i, align 4
  %add.i.i = add i32 0, 0
  %code_size.i.i = getelementptr i8, ptr %sinfo, i64 352
  store i32 %add.i.i, ptr %code_size.i.i, align 8
  %shl.i.i = shl i32 0, 0
  %limit_code.i.i = getelementptr i8, ptr %sinfo, i64 356
  store i32 %shl.i.i, ptr %limit_code.i.i, align 4
  %add2.i.i = add i32 %shl.i, 0
  %max_code.i.i = getelementptr i8, ptr %sinfo, i64 360
  store i32 %add2.i.i, ptr %max_code.i.i, align 8
  ret void
}
