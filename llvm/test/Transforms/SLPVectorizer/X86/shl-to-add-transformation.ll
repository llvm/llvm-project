; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; RUN: opt -S --passes=slp-vectorizer -mtriple=x86_64-unknown-linux-gnu -mcpu=icelake-server < %s | FileCheck %s

define void @test(ptr %src, i8 %0, i32 %conv2) {
; CHECK-LABEL: define void @test(
; CHECK-SAME: ptr [[SRC:%.*]], i8 [[TMP0:%.*]], i32 [[CONV2:%.*]]) #[[ATTR0:[0-9]+]] {
; CHECK-NEXT:  [[ENTRY:.*:]]
; CHECK-NEXT:    [[ARRAYIDX41:%.*]] = getelementptr i8, ptr [[SRC]], i64 1
; CHECK-NEXT:    [[TMP1:%.*]] = load i8, ptr [[SRC]], align 1
; CHECK-NEXT:    [[TMP2:%.*]] = insertelement <4 x i8> poison, i8 [[TMP0]], i32 0
; CHECK-NEXT:    [[TMP3:%.*]] = insertelement <4 x i8> [[TMP2]], i8 [[TMP1]], i32 1
; CHECK-NEXT:    [[TMP4:%.*]] = shufflevector <4 x i8> [[TMP3]], <4 x i8> poison, <4 x i32> <i32 0, i32 0, i32 1, i32 1>
; CHECK-NEXT:    [[TMP5:%.*]] = zext <4 x i8> [[TMP4]] to <4 x i32>
; CHECK-NEXT:    [[TMP6:%.*]] = shufflevector <4 x i8> [[TMP3]], <4 x i8> poison, <4 x i32> <i32 0, i32 1, i32 0, i32 0>
; CHECK-NEXT:    [[TMP7:%.*]] = zext <4 x i8> [[TMP6]] to <4 x i32>
; CHECK-NEXT:    [[TMP8:%.*]] = shufflevector <4 x i32> [[TMP5]], <4 x i32> <i32 1, i32 1, i32 poison, i32 0>, <4 x i32> <i32 4, i32 5, i32 2, i32 7>
; CHECK-NEXT:    [[TMP9:%.*]] = add <4 x i32> [[TMP5]], [[TMP8]]
; CHECK-NEXT:    [[TMP10:%.*]] = insertelement <4 x i32> <i32 poison, i32 poison, i32 1, i32 1>, i32 [[CONV2]], i32 0
; CHECK-NEXT:    [[TMP11:%.*]] = shufflevector <4 x i32> [[TMP10]], <4 x i32> poison, <4 x i32> <i32 0, i32 0, i32 2, i32 3>
; CHECK-NEXT:    [[TMP12:%.*]] = or <4 x i32> [[TMP9]], [[TMP11]]
; CHECK-NEXT:    [[TMP13:%.*]] = add <4 x i32> [[TMP9]], [[TMP11]]
; CHECK-NEXT:    [[TMP14:%.*]] = shufflevector <4 x i32> [[TMP12]], <4 x i32> [[TMP13]], <4 x i32> <i32 0, i32 1, i32 2, i32 7>
; CHECK-NEXT:    [[TMP15:%.*]] = or <4 x i32> [[TMP14]], [[TMP7]]
; CHECK-NEXT:    [[TMP16:%.*]] = add <4 x i32> [[TMP14]], [[TMP7]]
; CHECK-NEXT:    [[TMP17:%.*]] = shufflevector <4 x i32> [[TMP15]], <4 x i32> [[TMP16]], <4 x i32> <i32 0, i32 1, i32 6, i32 3>
; CHECK-NEXT:    [[TMP18:%.*]] = lshr <4 x i32> [[TMP17]], splat (i32 1)
; CHECK-NEXT:    [[TMP19:%.*]] = trunc <4 x i32> [[TMP18]] to <4 x i8>
; CHECK-NEXT:    store <4 x i8> [[TMP19]], ptr [[ARRAYIDX41]], align 1
; CHECK-NEXT:    ret void
;
entry:
  %conv65 = zext i8 %0 to i32
  %add36 = add i32 %conv65, 1
  %add37 = or i32 %add36, %conv2
  %conv4 = zext i8 %0 to i32
  %add38 = or i32 %add37, %conv4
  %shr39 = lshr i32 %add38, 1
  %conv40 = trunc i32 %shr39 to i8
  %arrayidx41 = getelementptr i8, ptr %src, i64 1
  store i8 %conv40, ptr %arrayidx41, align 1
  %add = add i32 %conv4, 1
  %add45 = or i32 %add, %conv2
  %1 = load i8, ptr %src, align 1
  %conv8 = zext i8 %1 to i32
  %add46 = or i32 %add45, %conv8
  %shr47 = lshr i32 %add46, 1
  %conv48 = trunc i32 %shr47 to i8
  %arrayidx49 = getelementptr i8, ptr %src, i64 2
  store i8 %conv48, ptr %arrayidx49, align 1
  %mul52 = shl i32 %conv8, 1
  %add54 = or i32 %mul52, 1
  %conv10 = zext i8 %0 to i32
  %add55 = add i32 %add54, %conv10
  %shr56 = lshr i32 %add55, 1
  %conv57 = trunc i32 %shr56 to i8
  %arrayidx58 = getelementptr i8, ptr %src, i64 3
  store i8 %conv57, ptr %arrayidx58, align 1
  %add63 = add i32 %conv8, 1
  %add64 = or i32 %add63, %conv10
  %shr66 = lshr i32 %add64, 1
  %conv67 = trunc i32 %shr66 to i8
  %arrayidx68 = getelementptr i8, ptr %src, i64 4
  store i8 %conv67, ptr %arrayidx68, align 1
  ret void
}
