; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; RUN: opt -S -passes='separate-const-offset-from-gep<lower-gep>' < %s | FileCheck %s
target datalayout = "p:32:32"

define ptr @test(ptr %p, i32 %a) {
; CHECK-LABEL: define ptr @test(
; CHECK-SAME: ptr [[P:%.*]], i32 [[A:%.*]]) {
; CHECK-NEXT:    [[TMP1:%.*]] = shl i32 [[A]], 2
; CHECK-NEXT:    [[UGLYGEP:%.*]] = getelementptr i8, ptr [[P]], i32 [[TMP1]]
; CHECK-NEXT:    [[UGLYGEP2:%.*]] = getelementptr i8, ptr [[UGLYGEP]], i32 -4
; CHECK-NEXT:    ret ptr [[UGLYGEP2]]
;
  %add = add i32 %a, -1
  %gep = getelementptr i32, ptr %p, i32 %add
  ret ptr %gep
}
