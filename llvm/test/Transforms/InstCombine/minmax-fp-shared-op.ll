; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; NOTE: Regression test for a foldMinimumMaximumSharedOp crash.
; RUN: opt -passes=instcombine,instnamer -S %s -o - | FileCheck %s

declare float @llvm.minnum.f32(float, float)
declare float @llvm.fma.f32(float, float, float)

define float @minnum_shared_op_mixed(float %x) {
; CHECK-LABEL: define float @minnum_shared_op_mixed(
; CHECK-SAME: float [[X:%.*]]) {
; CHECK-NEXT:  [[ENTRY:.*:]]
; CHECK-NEXT:    [[M0:%.*]] = call float @llvm.minnum.f32(float [[X]], float 0.000000e+00)
; CHECK-NEXT:    [[F:%.*]] = call float @llvm.fma.f32(float [[X]], float 0.000000e+00, float [[X]])
; CHECK-NEXT:    [[M2:%.*]] = call float @llvm.minnum.f32(float [[F]], float [[M0]])
; CHECK-NEXT:    ret float [[M2]]
;
entry:
  %m0 = call float @llvm.minnum.f32(float %x, float 0.000000e+00)
  %f = call float @llvm.fma.f32(float %x, float 0.000000e+00, float %x)
  %m2 = call float @llvm.minnum.f32(float %f, float %m0)
  ret float %m2
}
