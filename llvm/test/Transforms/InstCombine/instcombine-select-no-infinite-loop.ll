; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; NOTE: Regression test for an InstCombine infinite loop.
; RUN: opt -passes=instcombine,instnamer -S < %s | FileCheck %s

define i1 @f(i2 %arg0, i2 %arg1, i1 %arg2, i2 %arg3) {
; CHECK-LABEL: define i1 @f(
; CHECK-SAME: i2 [[ARG0:%.*]], i2 [[ARG1:%.*]], i1 [[ARG2:%.*]], i2 [[ARG3:%.*]]) {
; CHECK-NEXT:  [[ENTRY:.*:]]
; CHECK-NEXT:    [[DOTFR:%.*]] = freeze i2 [[ARG3]]
; CHECK-NEXT:    [[I:%.*]] = icmp ne i2 [[DOTFR]], -1
; CHECK-NEXT:    ret i1 [[I]]
;
entry:
  %4 = icmp sgt i2 0, %arg0
  %5 = zext i1 %arg2 to i2
  %6 = select i1 %4, i2 0, i2 %5
  %7 = trunc i2 %6 to i1
  %8 = select i1 %7, i2 %arg1, i2 0
  %9 = icmp sle i1 %4, %7
  %10 = select i1 %9, i2 0, i2 %arg1
  %11 = and i2 %5, %10
  %12 = select i1 %arg2, i2 0, i2 %arg3
  %13 = sdiv i2 1, %12
  %14 = icmp uge i2 %8, %11
  %15 = sext i1 %14 to i2
  %16 = icmp sgt i2 %13, %15
  %17 = icmp sgt i2 %6, 0
  %18 = lshr i1 %16, %17
  ret i1 %18
}
