; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -S -instcombine -expensive-combines=0 < %s | FileCheck %s --check-prefixes=CHECK,EXPENSIVE-OFF
; RUN: opt -S -instcombine -expensive-combines=1 < %s | FileCheck %s --check-prefixes=CHECK,EXPENSIVE-ON

; OSS Fuzz: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=15217
define i64 @fuzz15217(i1 %cond, i8* %Ptr, i64 %Val) {
; EXPENSIVE-OFF-LABEL: @fuzz15217(
; EXPENSIVE-OFF-NEXT:  entry:
; EXPENSIVE-OFF-NEXT:    br i1 [[COND:%.*]], label [[END:%.*]], label [[TWO:%.*]]
; EXPENSIVE-OFF:       two:
; EXPENSIVE-OFF-NEXT:    br label [[END]]
; EXPENSIVE-OFF:       end:
; EXPENSIVE-OFF-NEXT:    ret i64 undef
;
; EXPENSIVE-ON-LABEL: @fuzz15217(
; EXPENSIVE-ON-NEXT:  entry:
; EXPENSIVE-ON-NEXT:    br i1 [[COND:%.*]], label [[END:%.*]], label [[TWO:%.*]]
; EXPENSIVE-ON:       two:
; EXPENSIVE-ON-NEXT:    br label [[END]]
; EXPENSIVE-ON:       end:
; EXPENSIVE-ON-NEXT:    ret i64 0
;
entry:
  br i1 %cond, label %end, label %two

two:
  br label %end

end:
  %tmp869.0 = phi i128 [ 0, %entry ], [ 18446744073709551616, %two ]
  %tmp29 = lshr i128 %tmp869.0, 64
  %B1 = lshr i128 %tmp29, 170141183460469231731687303715884105727
  %tmp30 = trunc i128 %B1 to i64
  ret i64 %tmp30
}
