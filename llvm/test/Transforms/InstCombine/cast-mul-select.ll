; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --check-globals smart
; RUN: opt < %s -passes=instcombine -S | FileCheck %s
; RUN: opt -passes=debugify,instcombine -S < %s | FileCheck %s -check-prefix DBGINFO


target datalayout = "e-p:64:64:64-i1:8:8-i8:8:8-i16:16:16-i32:32:32-i64:64:64-f32:32:32-f64:64:64-v64:64:64-v128:128:128-a0:0:64-s0:64:64-f80:128:128-n8:16:32"

define i32 @mul(i32 %x, i32 %y) {
; CHECK-LABEL: @mul(
; CHECK-NEXT:    [[C:%.*]] = mul i32 [[X:%.*]], [[Y:%.*]]
; CHECK-NEXT:    [[D:%.*]] = and i32 [[C]], 255
; CHECK-NEXT:    ret i32 [[D]]
;
; DBGINFO-LABEL: @mul(
; DBGINFO-NEXT:      #dbg_value(i32 [[X:%.*]], [[META9:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_stack_value), [[META15:![0-9]+]])
; DBGINFO-NEXT:      #dbg_value(i32 [[Y:%.*]], [[META11:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_stack_value), [[META16:![0-9]+]])
; DBGINFO-NEXT:    [[C:%.*]] = mul i32 [[X]], [[Y]], !dbg [[DBG17:![0-9]+]]
; DBGINFO-NEXT:    [[D:%.*]] = and i32 [[C]], 255, !dbg [[DBG18:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i32 [[C]], [[META12:![0-9]+]], !DIExpression(), [[DBG17]])
; DBGINFO-NEXT:      #dbg_value(i32 [[D]], [[META13:![0-9]+]], !DIExpression(), [[DBG18]])
; DBGINFO-NEXT:    ret i32 [[D]], !dbg [[DBG19:![0-9]+]]
;

; Test that when zext is evaluated in different type
; we preserve the debug information in the resulting
; instruction.

  %A = trunc i32 %x to i8
  %B = trunc i32 %y to i8
  %C = mul i8 %A, %B
  %D = zext i8 %C to i32
  ret i32 %D
}

define i32 @select1(i1 %cond, i32 %x, i32 %y, i32 %z) !prof !0 {
; CHECK-LABEL: @select1(
; CHECK-NEXT:    [[D:%.*]] = add i32 [[X:%.*]], [[Y:%.*]]
; CHECK-NEXT:    [[E:%.*]] = select i1 [[COND:%.*]], i32 [[Z:%.*]], i32 [[D]]
; CHECK-NEXT:    [[F:%.*]] = and i32 [[E]], 255
; CHECK-NEXT:    ret i32 [[F]]
;
; DBGINFO-LABEL: @select1(
; DBGINFO-NEXT:      #dbg_value(i32 [[X:%.*]], [[META22:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_stack_value), [[META29:![0-9]+]])
; DBGINFO-NEXT:      #dbg_value(i32 [[Y:%.*]], [[META23:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_stack_value), [[META30:![0-9]+]])
; DBGINFO-NEXT:      #dbg_value(i32 [[Z:%.*]], [[META24:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_stack_value), [[META31:![0-9]+]])
; DBGINFO-NEXT:    [[D:%.*]] = add i32 [[X]], [[Y]], !dbg [[DBG32:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(!DIArgList(i32 [[X]], i32 [[Y]]), [[META25:![0-9]+]], !DIExpression(DW_OP_LLVM_arg, 0, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_LLVM_arg, 1, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_plus, DW_OP_stack_value), [[DBG32]])
; DBGINFO-NEXT:    [[E:%.*]] = select i1 [[COND:%.*]], i32 [[Z]], i32 [[D]], !dbg [[DBG33:![0-9]+]]
; DBGINFO-NEXT:    [[F:%.*]] = and i32 [[E]], 255, !dbg [[DBG34:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i32 [[E]], [[META26:![0-9]+]], !DIExpression(), [[DBG33]])
; DBGINFO-NEXT:      #dbg_value(i32 [[F]], [[META27:![0-9]+]], !DIExpression(), [[DBG34]])
; DBGINFO-NEXT:    ret i32 [[F]], !dbg [[DBG35:![0-9]+]]
;
  %A = trunc i32 %x to i8
  %B = trunc i32 %y to i8
  %C = trunc i32 %z to i8
  %D = add i8 %A, %B
  %E = select i1 %cond, i8 %C, i8 %D, !prof !1
  %F = zext i8 %E to i32
  ret i32 %F
}

define i8 @select2(i1 %cond, i8 %x, i8 %y, i8 %z) {
; CHECK-LABEL: @select2(
; CHECK-NEXT:    [[D:%.*]] = add i8 [[X:%.*]], [[Y:%.*]]
; CHECK-NEXT:    [[E:%.*]] = select i1 [[COND:%.*]], i8 [[Z:%.*]], i8 [[D]]
; CHECK-NEXT:    ret i8 [[E]]
;
; DBGINFO-LABEL: @select2(
; DBGINFO-NEXT:      #dbg_value(i8 [[X:%.*]], [[META38:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_stack_value), [[META44:![0-9]+]])
; DBGINFO-NEXT:      #dbg_value(i8 [[Y:%.*]], [[META39:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_stack_value), [[META45:![0-9]+]])
; DBGINFO-NEXT:      #dbg_value(i8 [[Z:%.*]], [[META40:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_stack_value), [[META46:![0-9]+]])
; DBGINFO-NEXT:    [[D:%.*]] = add i8 [[X]], [[Y]], !dbg [[DBG47:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(!DIArgList(i8 [[X]], i8 [[Y]]), [[META41:![0-9]+]], !DIExpression(DW_OP_LLVM_arg, 0, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_arg, 1, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_plus, DW_OP_stack_value), [[DBG47]])
; DBGINFO-NEXT:      #dbg_value(i32 poison, [[META42:![0-9]+]], !DIExpression(), [[META48:![0-9]+]])
; DBGINFO-NEXT:    [[F:%.*]] = select i1 [[COND:%.*]], i8 [[Z]], i8 [[D]], !dbg [[META48]]
; DBGINFO-NEXT:      #dbg_value(i8 [[F]], [[META43:![0-9]+]], !DIExpression(), [[META49:![0-9]+]])
; DBGINFO-NEXT:    ret i8 [[F]], !dbg [[DBG50:![0-9]+]]
;
  %A = zext i8 %x to i32
  %B = zext i8 %y to i32
  %C = zext i8 %z to i32
  %D = add i32 %A, %B
  %E = select i1 %cond, i32 %C, i32 %D
  %F = trunc i32 %E to i8
  ret i8 %F
}

; The next 3 tests could be handled in instcombine, but evaluating values
; with multiple uses may be very slow. Let some other pass deal with it.

define i32 @eval_trunc_multi_use_in_one_inst(i32 %x) {
; CHECK-LABEL: @eval_trunc_multi_use_in_one_inst(
; CHECK-NEXT:    [[A:%.*]] = add i32 [[X:%.*]], 15
; CHECK-NEXT:    [[T:%.*]] = mul i32 [[A]], [[A]]
; CHECK-NEXT:    ret i32 [[T]]
;
; DBGINFO-LABEL: @eval_trunc_multi_use_in_one_inst(
; DBGINFO-NEXT:      #dbg_value(i32 [[X:%.*]], [[META53:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 64, DW_ATE_unsigned, DW_OP_stack_value), [[META58:![0-9]+]])
; DBGINFO-NEXT:    [[A:%.*]] = add i32 [[X]], 15, !dbg [[DBG59:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i32 [[X]], [[META55:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 64, DW_ATE_unsigned, DW_OP_plus_uconst, 15, DW_OP_stack_value), [[DBG59]])
; DBGINFO-NEXT:    [[M:%.*]] = mul i32 [[A]], [[A]], !dbg [[DBG60:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(!DIArgList(i32 [[X]], i32 [[X]]), [[META56:![0-9]+]], !DIExpression(DW_OP_LLVM_arg, 0, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 64, DW_ATE_unsigned, DW_OP_plus_uconst, 15, DW_OP_LLVM_arg, 1, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 64, DW_ATE_unsigned, DW_OP_plus_uconst, 15, DW_OP_mul, DW_OP_stack_value), [[DBG60]])
; DBGINFO-NEXT:      #dbg_value(i32 [[M]], [[META57:![0-9]+]], !DIExpression(), [[META61:![0-9]+]])
; DBGINFO-NEXT:    ret i32 [[M]], !dbg [[DBG62:![0-9]+]]
;
  %z = zext i32 %x to i64
  %a = add nsw nuw i64 %z, 15
  %m = mul i64 %a, %a
  %t = trunc i64 %m to i32
  ret i32 %t
}

define i32 @eval_zext_multi_use_in_one_inst(i32 %x) {
; CHECK-LABEL: @eval_zext_multi_use_in_one_inst(
; CHECK-NEXT:    [[T:%.*]] = trunc i32 [[X:%.*]] to i16
; CHECK-NEXT:    [[A:%.*]] = and i16 [[T]], 5
; CHECK-NEXT:    [[M:%.*]] = mul nuw nsw i16 [[A]], [[A]]
; CHECK-NEXT:    [[R:%.*]] = zext nneg i16 [[M]] to i32
; CHECK-NEXT:    ret i32 [[R]]
;
; DBGINFO-LABEL: @eval_zext_multi_use_in_one_inst(
; DBGINFO-NEXT:    [[T:%.*]] = trunc i32 [[X:%.*]] to i16, !dbg [[DBG70:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i16 [[T]], [[META65:![0-9]+]], !DIExpression(), [[DBG70]])
; DBGINFO-NEXT:    [[A:%.*]] = and i16 [[T]], 5, !dbg [[DBG71:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i16 [[A]], [[META67:![0-9]+]], !DIExpression(), [[DBG71]])
; DBGINFO-NEXT:    [[M:%.*]] = mul nuw nsw i16 [[A]], [[A]], !dbg [[DBG72:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i16 [[M]], [[META68:![0-9]+]], !DIExpression(), [[DBG72]])
; DBGINFO-NEXT:    [[R:%.*]] = zext nneg i16 [[M]] to i32, !dbg [[DBG73:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i32 [[R]], [[META69:![0-9]+]], !DIExpression(), [[DBG73]])
; DBGINFO-NEXT:    ret i32 [[R]], !dbg [[DBG74:![0-9]+]]
;
  %t = trunc i32 %x to i16
  %a = and i16 %t, 5
  %m = mul nuw nsw i16 %a, %a
  %r = zext i16 %m to i32
  ret i32 %r
}

define i32 @eval_sext_multi_use_in_one_inst(i32 %x) {
; CHECK-LABEL: @eval_sext_multi_use_in_one_inst(
; CHECK-NEXT:    [[A:%.*]] = and i32 [[X:%.*]], 14
; CHECK-NEXT:    [[M:%.*]] = mul nuw nsw i32 [[A]], [[A]]
; CHECK-NEXT:    [[R:%.*]] = or disjoint i32 [[M]], -32768
; CHECK-NEXT:    ret i32 [[R]]
;
; DBGINFO-LABEL: @eval_sext_multi_use_in_one_inst(
; DBGINFO-NEXT:      #dbg_value(i32 [[X:%.*]], [[META77:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 16, DW_ATE_unsigned, DW_OP_stack_value), [[META82:![0-9]+]])
; DBGINFO-NEXT:    [[A:%.*]] = and i32 [[X]], 14, !dbg [[DBG83:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i32 [[X]], [[META78:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 16, DW_ATE_unsigned, DW_OP_constu, 14, DW_OP_and, DW_OP_stack_value), [[DBG83]])
; DBGINFO-NEXT:    [[M:%.*]] = mul nuw nsw i32 [[A]], [[A]], !dbg [[DBG84:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(!DIArgList(i32 [[X]], i32 [[X]]), [[META79:![0-9]+]], !DIExpression(DW_OP_LLVM_arg, 0, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 16, DW_ATE_unsigned, DW_OP_constu, 14, DW_OP_and, DW_OP_LLVM_arg, 1, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 16, DW_ATE_unsigned, DW_OP_constu, 14, DW_OP_and, DW_OP_mul, DW_OP_stack_value), [[DBG84]])
; DBGINFO-NEXT:    [[O:%.*]] = or disjoint i32 [[M]], -32768, !dbg [[DBG85:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(!DIArgList(i32 [[X]], i32 [[X]]), [[META80:![0-9]+]], !DIExpression(DW_OP_LLVM_arg, 0, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 16, DW_ATE_unsigned, DW_OP_constu, 14, DW_OP_and, DW_OP_LLVM_arg, 1, DW_OP_LLVM_convert, 32, DW_ATE_unsigned, DW_OP_LLVM_convert, 16, DW_ATE_unsigned, DW_OP_constu, 14, DW_OP_and, DW_OP_mul, DW_OP_constu, 18446744073709518848, DW_OP_or, DW_OP_stack_value), [[DBG85]])
; DBGINFO-NEXT:      #dbg_value(i32 [[O]], [[META81:![0-9]+]], !DIExpression(), [[META86:![0-9]+]])
; DBGINFO-NEXT:    ret i32 [[O]], !dbg [[DBG87:![0-9]+]]
;
  %t = trunc i32 %x to i16
  %a = and i16 %t, 14
  %m = mul nuw nsw i16 %a, %a
  %o = or i16 %m, 32768
  %r = sext i16 %o to i32
  ret i32 %r
}

; If we have a transform to shrink the above 3 cases, make sure it's not
; also trying to look through multiple uses in this test and crashing.

define void @PR36225(i32 %a, i32 %b, i1 %c1, i3 %v1, i3 %v2) {
; CHECK-LABEL: @PR36225(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    br label [[WHILE_BODY:%.*]]
; CHECK:       while.body:
; CHECK-NEXT:    br i1 [[C1:%.*]], label [[FOR_BODY3_US:%.*]], label [[FOR_BODY3:%.*]]
; CHECK:       for.body3.us:
; CHECK-NEXT:    [[TOBOOL:%.*]] = icmp eq i32 [[B:%.*]], 0
; CHECK-NEXT:    [[SPEC_SELECT:%.*]] = select i1 [[TOBOOL]], i8 0, i8 4
; CHECK-NEXT:    switch i3 [[V1:%.*]], label [[EXIT:%.*]] [
; CHECK-NEXT:      i3 0, label [[FOR_END:%.*]]
; CHECK-NEXT:      i3 -1, label [[FOR_END]]
; CHECK-NEXT:    ]
; CHECK:       for.body3:
; CHECK-NEXT:    switch i3 [[V2:%.*]], label [[EXIT]] [
; CHECK-NEXT:      i3 0, label [[FOR_END]]
; CHECK-NEXT:      i3 -1, label [[FOR_END]]
; CHECK-NEXT:    ]
; CHECK:       for.end:
; CHECK-NEXT:    [[H:%.*]] = phi i8 [ [[SPEC_SELECT]], [[FOR_BODY3_US]] ], [ [[SPEC_SELECT]], [[FOR_BODY3_US]] ], [ 0, [[FOR_BODY3]] ], [ 0, [[FOR_BODY3]] ]
; CHECK-NEXT:    [[CONV:%.*]] = zext nneg i8 [[H]] to i32
; CHECK-NEXT:    [[CMP:%.*]] = icmp sgt i32 [[A:%.*]], [[CONV]]
; CHECK-NEXT:    br i1 [[CMP]], label [[EXIT]], label [[EXIT2:%.*]]
; CHECK:       exit2:
; CHECK-NEXT:    unreachable
; CHECK:       exit:
; CHECK-NEXT:    unreachable
;
; DBGINFO-LABEL: @PR36225(
; DBGINFO-NEXT:  entry:
; DBGINFO-NEXT:    br label [[WHILE_BODY:%.*]], !dbg [[DBG95:![0-9]+]]
; DBGINFO:       while.body:
; DBGINFO-NEXT:      #dbg_value(i32 [[B:%.*]], [[META90:![0-9]+]], !DIExpression(DW_OP_lit0, DW_OP_eq, DW_OP_stack_value), [[META96:![0-9]+]])
; DBGINFO-NEXT:    br i1 [[C1:%.*]], label [[FOR_BODY3_US:%.*]], label [[FOR_BODY3:%.*]], !dbg [[DBG97:![0-9]+]]
; DBGINFO:       for.body3.us:
; DBGINFO-NEXT:    [[TOBOOL:%.*]] = icmp eq i32 [[B]], 0, !dbg [[META96]]
; DBGINFO-NEXT:      #dbg_value(i1 [[TOBOOL]], [[META90]], !DIExpression(), [[META96]])
; DBGINFO-NEXT:    [[SPEC_SELECT:%.*]] = select i1 [[TOBOOL]], i8 0, i8 4, !dbg [[DBG98:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i8 [[SPEC_SELECT]], [[META91:![0-9]+]], !DIExpression(), [[DBG98]])
; DBGINFO-NEXT:    switch i3 [[V1:%.*]], label [[EXIT:%.*]] [
; DBGINFO-NEXT:      i3 0, label [[FOR_END:%.*]]
; DBGINFO-NEXT:      i3 -1, label [[FOR_END]]
; DBGINFO-NEXT:    ], !dbg [[DBG99:![0-9]+]]
; DBGINFO:       for.body3:
; DBGINFO-NEXT:    switch i3 [[V2:%.*]], label [[EXIT]] [
; DBGINFO-NEXT:      i3 0, label [[FOR_END]]
; DBGINFO-NEXT:      i3 -1, label [[FOR_END]]
; DBGINFO-NEXT:    ], !dbg [[DBG100:![0-9]+]]
; DBGINFO:       for.end:
; DBGINFO-NEXT:    [[H:%.*]] = phi i8 [ [[SPEC_SELECT]], [[FOR_BODY3_US]] ], [ [[SPEC_SELECT]], [[FOR_BODY3_US]] ], [ 0, [[FOR_BODY3]] ], [ 0, [[FOR_BODY3]] ], !dbg [[DBG101:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i8 [[H]], [[META92:![0-9]+]], !DIExpression(), [[DBG101]])
; DBGINFO-NEXT:    [[CONV:%.*]] = zext nneg i8 [[H]] to i32, !dbg [[DBG102:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i32 [[CONV]], [[META93:![0-9]+]], !DIExpression(), [[DBG102]])
; DBGINFO-NEXT:    [[CMP:%.*]] = icmp sgt i32 [[A:%.*]], [[CONV]], !dbg [[DBG103:![0-9]+]]
; DBGINFO-NEXT:      #dbg_value(i1 [[CMP]], [[META94:![0-9]+]], !DIExpression(), [[DBG103]])
; DBGINFO-NEXT:    br i1 [[CMP]], label [[EXIT]], label [[EXIT2:%.*]], !dbg [[DBG104:![0-9]+]]
; DBGINFO:       exit2:
; DBGINFO-NEXT:    unreachable, !dbg [[DBG105:![0-9]+]]
; DBGINFO:       exit:
; DBGINFO-NEXT:    unreachable, !dbg [[DBG106:![0-9]+]]
;
entry:
  br label %while.body

while.body:
  %tobool = icmp eq i32 %b, 0
  br i1 %c1, label %for.body3.us, label %for.body3

for.body3.us:
  %spec.select = select i1 %tobool, i8 0, i8 4
  switch i3 %v1, label %exit [
  i3 0, label %for.end
  i3 -1, label %for.end
  ]

for.body3:
  switch i3 %v2, label %exit [
  i3 0, label %for.end
  i3 -1, label %for.end
  ]

for.end:
  %h = phi i8 [ %spec.select, %for.body3.us ], [ %spec.select, %for.body3.us ], [ 0, %for.body3 ], [ 0, %for.body3 ]
  %conv = sext i8 %h to i32
  %cmp = icmp sgt i32 %a, %conv
  br i1 %cmp, label %exit, label %exit2

exit2:
  unreachable

exit:
  unreachable
}

; Check that we don't drop debug info when a zext is removed.
define i1 @foo(i1 zeroext %b) {
; CHECK-LABEL: @foo(
; CHECK-NEXT:    ret i1 [[B:%.*]]
;
; DBGINFO-LABEL: @foo(
; DBGINFO-NEXT:      #dbg_value(i1 [[B:%.*]], [[META109:![0-9]+]], !DIExpression(DW_OP_LLVM_convert, 1, DW_ATE_unsigned, DW_OP_LLVM_convert, 8, DW_ATE_unsigned, DW_OP_stack_value), [[META110:![0-9]+]])
; DBGINFO-NEXT:    ret i1 [[B]], !dbg [[DBG111:![0-9]+]]
;

  %frombool = zext i1 %b to i8
  ret i1 %b
}

!0 = !{!"function_entry_count", i64 1000}
!1 = !{!"branch_weights", i32 10, i32 20}

;.
; DBGINFO: [[META0:![0-9]+]] = distinct !DICompileUnit(language: DW_LANG_C, file: [[META1:![0-9]+]], producer: "debugify", isOptimized: true, runtimeVersion: 0, emissionKind: FullDebug)
; DBGINFO: [[META1]] = !DIFile(filename: "{{.*}}<stdin>", directory: {{.*}})
; DBGINFO: [[META5:![0-9]+]] = distinct !DISubprogram(name: "mul", linkageName: "mul", scope: null, file: [[META1]], line: 1, type: [[META6:![0-9]+]], scopeLine: 1, spFlags: DISPFlagDefinition | DISPFlagOptimized, unit: [[META0]], retainedNodes: [[META8:![0-9]+]])
; DBGINFO: [[META6]] = !DISubroutineType(types: [[META7:![0-9]+]])
; DBGINFO: [[META7]] = !{}
; DBGINFO: [[META8]] = !{[[META9]], [[META11]], [[META12]], [[META13]]}
; DBGINFO: [[META9]] = !DILocalVariable(name: "1", scope: [[META5]], file: [[META1]], line: 1, type: [[META10:![0-9]+]])
; DBGINFO: [[META10]] = !DIBasicType(name: "ty8", size: 8, encoding: DW_ATE_unsigned)
; DBGINFO: [[META11]] = !DILocalVariable(name: "2", scope: [[META5]], file: [[META1]], line: 2, type: [[META10]])
; DBGINFO: [[META12]] = !DILocalVariable(name: "3", scope: [[META5]], file: [[META1]], line: 3, type: [[META10]])
; DBGINFO: [[META13]] = !DILocalVariable(name: "4", scope: [[META5]], file: [[META1]], line: 4, type: [[META14:![0-9]+]])
; DBGINFO: [[META14]] = !DIBasicType(name: "ty32", size: 32, encoding: DW_ATE_unsigned)
; DBGINFO: [[META15]] = !DILocation(line: 1, column: 1, scope: [[META5]])
; DBGINFO: [[META16]] = !DILocation(line: 2, column: 1, scope: [[META5]])
; DBGINFO: [[DBG17]] = !DILocation(line: 3, column: 1, scope: [[META5]])
; DBGINFO: [[DBG18]] = !DILocation(line: 4, column: 1, scope: [[META5]])
; DBGINFO: [[DBG19]] = !DILocation(line: 5, column: 1, scope: [[META5]])
; DBGINFO: [[META20:![0-9]+]] = distinct !DISubprogram(name: "select1", linkageName: "select1", scope: null, file: [[META1]], line: 6, type: [[META6]], scopeLine: 6, spFlags: DISPFlagDefinition | DISPFlagOptimized, unit: [[META0]], retainedNodes: [[META21:![0-9]+]])
; DBGINFO: [[META21]] = !{[[META22]], [[META23]], [[META24]], [[META25]], [[META26]], [[META27]]}
; DBGINFO: [[META22]] = !DILocalVariable(name: "5", scope: [[META20]], file: [[META1]], line: 6, type: [[META10]])
; DBGINFO: [[META23]] = !DILocalVariable(name: "6", scope: [[META20]], file: [[META1]], line: 7, type: [[META10]])
; DBGINFO: [[META24]] = !DILocalVariable(name: "7", scope: [[META20]], file: [[META1]], line: 8, type: [[META10]])
; DBGINFO: [[META25]] = !DILocalVariable(name: "8", scope: [[META20]], file: [[META1]], line: 9, type: [[META10]])
; DBGINFO: [[META26]] = !DILocalVariable(name: "9", scope: [[META20]], file: [[META1]], line: 10, type: [[META10]])
; DBGINFO: [[META27]] = !DILocalVariable(name: "10", scope: [[META20]], file: [[META1]], line: 11, type: [[META14]])
; DBGINFO: [[META29]] = !DILocation(line: 6, column: 1, scope: [[META20]])
; DBGINFO: [[META30]] = !DILocation(line: 7, column: 1, scope: [[META20]])
; DBGINFO: [[META31]] = !DILocation(line: 8, column: 1, scope: [[META20]])
; DBGINFO: [[DBG32]] = !DILocation(line: 9, column: 1, scope: [[META20]])
; DBGINFO: [[DBG33]] = !DILocation(line: 10, column: 1, scope: [[META20]])
; DBGINFO: [[DBG34]] = !DILocation(line: 11, column: 1, scope: [[META20]])
; DBGINFO: [[DBG35]] = !DILocation(line: 12, column: 1, scope: [[META20]])
; DBGINFO: [[META36:![0-9]+]] = distinct !DISubprogram(name: "select2", linkageName: "select2", scope: null, file: [[META1]], line: 13, type: [[META6]], scopeLine: 13, spFlags: DISPFlagDefinition | DISPFlagOptimized, unit: [[META0]], retainedNodes: [[META37:![0-9]+]])
; DBGINFO: [[META37]] = !{[[META38]], [[META39]], [[META40]], [[META41]], [[META42]], [[META43]]}
; DBGINFO: [[META38]] = !DILocalVariable(name: "11", scope: [[META36]], file: [[META1]], line: 13, type: [[META14]])
; DBGINFO: [[META39]] = !DILocalVariable(name: "12", scope: [[META36]], file: [[META1]], line: 14, type: [[META14]])
; DBGINFO: [[META40]] = !DILocalVariable(name: "13", scope: [[META36]], file: [[META1]], line: 15, type: [[META14]])
; DBGINFO: [[META41]] = !DILocalVariable(name: "14", scope: [[META36]], file: [[META1]], line: 16, type: [[META14]])
; DBGINFO: [[META42]] = !DILocalVariable(name: "15", scope: [[META36]], file: [[META1]], line: 17, type: [[META14]])
; DBGINFO: [[META43]] = !DILocalVariable(name: "16", scope: [[META36]], file: [[META1]], line: 18, type: [[META10]])
; DBGINFO: [[META44]] = !DILocation(line: 13, column: 1, scope: [[META36]])
; DBGINFO: [[META45]] = !DILocation(line: 14, column: 1, scope: [[META36]])
; DBGINFO: [[META46]] = !DILocation(line: 15, column: 1, scope: [[META36]])
; DBGINFO: [[DBG47]] = !DILocation(line: 16, column: 1, scope: [[META36]])
; DBGINFO: [[META48]] = !DILocation(line: 17, column: 1, scope: [[META36]])
; DBGINFO: [[META49]] = !DILocation(line: 18, column: 1, scope: [[META36]])
; DBGINFO: [[DBG50]] = !DILocation(line: 19, column: 1, scope: [[META36]])
; DBGINFO: [[META51:![0-9]+]] = distinct !DISubprogram(name: "eval_trunc_multi_use_in_one_inst", linkageName: "eval_trunc_multi_use_in_one_inst", scope: null, file: [[META1]], line: 20, type: [[META6]], scopeLine: 20, spFlags: DISPFlagDefinition | DISPFlagOptimized, unit: [[META0]], retainedNodes: [[META52:![0-9]+]])
; DBGINFO: [[META52]] = !{[[META53]], [[META55]], [[META56]], [[META57]]}
; DBGINFO: [[META53]] = !DILocalVariable(name: "17", scope: [[META51]], file: [[META1]], line: 20, type: [[META54:![0-9]+]])
; DBGINFO: [[META54]] = !DIBasicType(name: "ty64", size: 64, encoding: DW_ATE_unsigned)
; DBGINFO: [[META55]] = !DILocalVariable(name: "18", scope: [[META51]], file: [[META1]], line: 21, type: [[META54]])
; DBGINFO: [[META56]] = !DILocalVariable(name: "19", scope: [[META51]], file: [[META1]], line: 22, type: [[META54]])
; DBGINFO: [[META57]] = !DILocalVariable(name: "20", scope: [[META51]], file: [[META1]], line: 23, type: [[META14]])
; DBGINFO: [[META58]] = !DILocation(line: 20, column: 1, scope: [[META51]])
; DBGINFO: [[DBG59]] = !DILocation(line: 21, column: 1, scope: [[META51]])
; DBGINFO: [[DBG60]] = !DILocation(line: 22, column: 1, scope: [[META51]])
; DBGINFO: [[META61]] = !DILocation(line: 23, column: 1, scope: [[META51]])
; DBGINFO: [[DBG62]] = !DILocation(line: 24, column: 1, scope: [[META51]])
; DBGINFO: [[META63:![0-9]+]] = distinct !DISubprogram(name: "eval_zext_multi_use_in_one_inst", linkageName: "eval_zext_multi_use_in_one_inst", scope: null, file: [[META1]], line: 25, type: [[META6]], scopeLine: 25, spFlags: DISPFlagDefinition | DISPFlagOptimized, unit: [[META0]], retainedNodes: [[META64:![0-9]+]])
; DBGINFO: [[META64]] = !{[[META65]], [[META67]], [[META68]], [[META69]]}
; DBGINFO: [[META65]] = !DILocalVariable(name: "21", scope: [[META63]], file: [[META1]], line: 25, type: [[META66:![0-9]+]])
; DBGINFO: [[META66]] = !DIBasicType(name: "ty16", size: 16, encoding: DW_ATE_unsigned)
; DBGINFO: [[META67]] = !DILocalVariable(name: "22", scope: [[META63]], file: [[META1]], line: 26, type: [[META66]])
; DBGINFO: [[META68]] = !DILocalVariable(name: "23", scope: [[META63]], file: [[META1]], line: 27, type: [[META66]])
; DBGINFO: [[META69]] = !DILocalVariable(name: "24", scope: [[META63]], file: [[META1]], line: 28, type: [[META14]])
; DBGINFO: [[DBG70]] = !DILocation(line: 25, column: 1, scope: [[META63]])
; DBGINFO: [[DBG71]] = !DILocation(line: 26, column: 1, scope: [[META63]])
; DBGINFO: [[DBG72]] = !DILocation(line: 27, column: 1, scope: [[META63]])
; DBGINFO: [[DBG73]] = !DILocation(line: 28, column: 1, scope: [[META63]])
; DBGINFO: [[DBG74]] = !DILocation(line: 29, column: 1, scope: [[META63]])
; DBGINFO: [[META75:![0-9]+]] = distinct !DISubprogram(name: "eval_sext_multi_use_in_one_inst", linkageName: "eval_sext_multi_use_in_one_inst", scope: null, file: [[META1]], line: 30, type: [[META6]], scopeLine: 30, spFlags: DISPFlagDefinition | DISPFlagOptimized, unit: [[META0]], retainedNodes: [[META76:![0-9]+]])
; DBGINFO: [[META76]] = !{[[META77]], [[META78]], [[META79]], [[META80]], [[META81]]}
; DBGINFO: [[META77]] = !DILocalVariable(name: "25", scope: [[META75]], file: [[META1]], line: 30, type: [[META66]])
; DBGINFO: [[META78]] = !DILocalVariable(name: "26", scope: [[META75]], file: [[META1]], line: 31, type: [[META66]])
; DBGINFO: [[META79]] = !DILocalVariable(name: "27", scope: [[META75]], file: [[META1]], line: 32, type: [[META66]])
; DBGINFO: [[META80]] = !DILocalVariable(name: "28", scope: [[META75]], file: [[META1]], line: 33, type: [[META66]])
; DBGINFO: [[META81]] = !DILocalVariable(name: "29", scope: [[META75]], file: [[META1]], line: 34, type: [[META14]])
; DBGINFO: [[META82]] = !DILocation(line: 30, column: 1, scope: [[META75]])
; DBGINFO: [[DBG83]] = !DILocation(line: 31, column: 1, scope: [[META75]])
; DBGINFO: [[DBG84]] = !DILocation(line: 32, column: 1, scope: [[META75]])
; DBGINFO: [[DBG85]] = !DILocation(line: 33, column: 1, scope: [[META75]])
; DBGINFO: [[META86]] = !DILocation(line: 34, column: 1, scope: [[META75]])
; DBGINFO: [[DBG87]] = !DILocation(line: 35, column: 1, scope: [[META75]])
; DBGINFO: [[META88:![0-9]+]] = distinct !DISubprogram(name: "PR36225", linkageName: "PR36225", scope: null, file: [[META1]], line: 36, type: [[META6]], scopeLine: 36, spFlags: DISPFlagDefinition | DISPFlagOptimized, unit: [[META0]], retainedNodes: [[META89:![0-9]+]])
; DBGINFO: [[META89]] = !{[[META90]], [[META91]], [[META92]], [[META93]], [[META94]]}
; DBGINFO: [[META90]] = !DILocalVariable(name: "30", scope: [[META88]], file: [[META1]], line: 37, type: [[META10]])
; DBGINFO: [[META91]] = !DILocalVariable(name: "31", scope: [[META88]], file: [[META1]], line: 39, type: [[META10]])
; DBGINFO: [[META92]] = !DILocalVariable(name: "32", scope: [[META88]], file: [[META1]], line: 42, type: [[META10]])
; DBGINFO: [[META93]] = !DILocalVariable(name: "33", scope: [[META88]], file: [[META1]], line: 43, type: [[META14]])
; DBGINFO: [[META94]] = !DILocalVariable(name: "34", scope: [[META88]], file: [[META1]], line: 44, type: [[META10]])
; DBGINFO: [[DBG95]] = !DILocation(line: 36, column: 1, scope: [[META88]])
; DBGINFO: [[META96]] = !DILocation(line: 37, column: 1, scope: [[META88]])
; DBGINFO: [[DBG97]] = !DILocation(line: 38, column: 1, scope: [[META88]])
; DBGINFO: [[DBG98]] = !DILocation(line: 39, column: 1, scope: [[META88]])
; DBGINFO: [[DBG99]] = !DILocation(line: 40, column: 1, scope: [[META88]])
; DBGINFO: [[DBG100]] = !DILocation(line: 41, column: 1, scope: [[META88]])
; DBGINFO: [[DBG101]] = !DILocation(line: 42, column: 1, scope: [[META88]])
; DBGINFO: [[DBG102]] = !DILocation(line: 43, column: 1, scope: [[META88]])
; DBGINFO: [[DBG103]] = !DILocation(line: 44, column: 1, scope: [[META88]])
; DBGINFO: [[DBG104]] = !DILocation(line: 45, column: 1, scope: [[META88]])
; DBGINFO: [[DBG105]] = !DILocation(line: 46, column: 1, scope: [[META88]])
; DBGINFO: [[DBG106]] = !DILocation(line: 47, column: 1, scope: [[META88]])
; DBGINFO: [[META107:![0-9]+]] = distinct !DISubprogram(name: "foo", linkageName: "foo", scope: null, file: [[META1]], line: 48, type: [[META6]], scopeLine: 48, spFlags: DISPFlagDefinition | DISPFlagOptimized, unit: [[META0]], retainedNodes: [[META108:![0-9]+]])
; DBGINFO: [[META108]] = !{[[META109]]}
; DBGINFO: [[META109]] = !DILocalVariable(name: "35", scope: [[META107]], file: [[META1]], line: 48, type: [[META10]])
; DBGINFO: [[META110]] = !DILocation(line: 48, column: 1, scope: [[META107]])
; DBGINFO: [[DBG111]] = !DILocation(line: 49, column: 1, scope: [[META107]])
;.
