; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --scrub-attributes
; RUN: opt -S -passes=instcombine < %s | FileCheck %s

define dso_local void @_Z3fooPv(ptr nocapture %0) local_unnamed_addr #0 {
; CHECK-LABEL: @_Z3fooPv(
; CHECK-NEXT:    tail call void @free(ptr [[TMP0:%.*]])
; CHECK-NEXT:    ret void
;
  %2 = tail call align 16 dereferenceable_or_null(6) ptr @realloc(ptr %0, i64 6) #3
  tail call void @free(ptr %2) #3
  ret void
}

declare dso_local noalias noundef ptr @realloc(ptr allocptr nocapture, i64 noundef) local_unnamed_addr #1
declare dso_local void @free(ptr allocptr nocapture noundef) local_unnamed_addr #2

attributes #0 = { mustprogress nounwind uwtable willreturn }
attributes #1 = { inaccessiblemem_or_argmemonly mustprogress nounwind willreturn allockind("realloc") }
attributes #2 = { inaccessiblemem_or_argmemonly mustprogress nounwind willreturn allockind("free") }
attributes #3 = { nounwind }
