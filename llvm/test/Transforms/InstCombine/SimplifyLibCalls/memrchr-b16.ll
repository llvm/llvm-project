; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; RUN: opt -p instcombine -S %s | FileCheck %s

target datalayout = "b:16-p:32:32-n64"

declare ptr @memrchr(ptr, i32, i32)

; memrchr(str, c, 1) -> (unsigned char)*str == (unsigned char)c ? str : null
define ptr @test_n_1(ptr %str, i32 %c) {
; CHECK-LABEL: define ptr @test_n_1(
; CHECK-SAME: ptr [[STR:%.*]], i32 [[C:%.*]]) {
; CHECK-NEXT:    [[MEMRCHR_CHAR0:%.*]] = load i16, ptr [[STR]], align 1
; CHECK-NEXT:    [[TMP1:%.*]] = trunc i32 [[C]] to i16
; CHECK-NEXT:    [[MEMRCHR_CHAR0CMP:%.*]] = icmp eq i16 [[MEMRCHR_CHAR0]], [[TMP1]]
; CHECK-NEXT:    [[MEMRCHR_SEL:%.*]] = select i1 [[MEMRCHR_CHAR0CMP]], ptr [[STR]], ptr null
; CHECK-NEXT:    ret ptr [[MEMRCHR_SEL]]
;
  %call = call ptr @memrchr(ptr %str, i32 %c, i32 1)
  ret ptr %call
}
