; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; RUN: opt -p instcombine -S %s | FileCheck %s

target datalayout = "b:16-p:32:32"

declare i32 @fwrite(ptr, i32, i32, ptr)

; fwrite(str, 1, 1, stream) -> fputc(*str, stream)
define void @test(ptr %str, ptr %stream) {
; CHECK-LABEL: define void @test(
; CHECK-SAME: ptr [[STR:%.*]], ptr [[STREAM:%.*]]) {
; CHECK-NEXT:    [[CHAR:%.*]] = load i16, ptr [[STR]], align 1
; CHECK-NEXT:    [[CHARI:%.*]] = sext i16 [[CHAR]] to i32
; CHECK-NEXT:    [[FPUTC:%.*]] = call i32 @fputc(i32 [[CHARI]], ptr [[STREAM]])
; CHECK-NEXT:    ret void
;
  call i32 @fwrite(ptr %str, i32 1, i32 1, ptr %stream)
  ret void
}
