; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; RUN: opt -S -passes=instcombine < %s | FileCheck %s

define double @bitcast_v2i32_select_to_double_const_rhs(double %i, <2 x i32> %i41) {
; CHECK-LABEL: define double @bitcast_v2i32_select_to_double_const_rhs(
; CHECK-SAME: double [[I:%.*]], <2 x i32> [[I41:%.*]]) {
; CHECK-NEXT:    [[I42:%.*]] = fcmp one double [[I]], 0x7FF0000000000000
; CHECK-NEXT:    [[TMP1:%.*]] = bitcast <2 x i32> [[I41]] to double
; CHECK-NEXT:    [[ASTYPE13_I_I:%.*]] = select i1 [[I42]], double [[TMP1]], double 0x7FF8000000000000
; CHECK-NEXT:    ret double [[ASTYPE13_I_I]]
;
  %i42 = fcmp one double %i, 0x7FF0000000000000
  %s.0.i.i = select i1 %i42, <2 x i32> %i41, <2 x i32> <i32 0, i32 2146959360>
  %astype13.i.i = bitcast <2 x i32> %s.0.i.i to double
  ret double %astype13.i.i
}

define double @bitcast_v2i32_select_to_double_const_lhs(double %i, <2 x i32> %i41) {
; CHECK-LABEL: define double @bitcast_v2i32_select_to_double_const_lhs(
; CHECK-SAME: double [[I:%.*]], <2 x i32> [[I41:%.*]]) {
; CHECK-NEXT:    [[I42:%.*]] = fcmp one double [[I]], 0x7FF0000000000000
; CHECK-NEXT:    [[TMP1:%.*]] = bitcast <2 x i32> [[I41]] to double
; CHECK-NEXT:    [[ASTYPE13_I_I:%.*]] = select i1 [[I42]], double 0x7FF8000000000000, double [[TMP1]]
; CHECK-NEXT:    ret double [[ASTYPE13_I_I]]
;
  %i42 = fcmp one double %i, 0x7FF0000000000000
  %s.0.i.i = select i1 %i42, <2 x i32> <i32 0, i32 2146959360>, <2 x i32> %i41
  %astype13.i.i = bitcast <2 x i32> %s.0.i.i to double
  ret double %astype13.i.i
}

define <2 x i32> @bitcast_select_double_to_v2i32_const_rhs(i64 %i, double %i41) {
; CHECK-LABEL: define <2 x i32> @bitcast_select_double_to_v2i32_const_rhs(
; CHECK-SAME: i64 [[I:%.*]], double [[I41:%.*]]) {
; CHECK-NEXT:    [[I42_NOT:%.*]] = icmp eq i64 [[I]], 0
; CHECK-NEXT:    [[TMP1:%.*]] = bitcast double [[I41]] to <2 x i32>
; CHECK-NEXT:    [[ASTYPE13_I_I:%.*]] = select i1 [[I42_NOT]], <2 x i32> <i32 0, i32 1072693248>, <2 x i32> [[TMP1]]
; CHECK-NEXT:    ret <2 x i32> [[ASTYPE13_I_I]]
;
  %i42 = icmp ne i64 %i, 0
  %s.0.i.i = select nnan i1 %i42, double %i41, double 1.0
  %astype13.i.i = bitcast double %s.0.i.i to <2 x i32>
  ret <2 x i32> %astype13.i.i
}

define <2 x i32> @bitcast_select_double_to_v2i32_const_lhs(i64 %i, double %i41) {
; CHECK-LABEL: define <2 x i32> @bitcast_select_double_to_v2i32_const_lhs(
; CHECK-SAME: i64 [[I:%.*]], double [[I41:%.*]]) {
; CHECK-NEXT:    [[I42_NOT:%.*]] = icmp eq i64 [[I]], 0
; CHECK-NEXT:    [[TMP1:%.*]] = bitcast double [[I41]] to <2 x i32>
; CHECK-NEXT:    [[ASTYPE13_I_I:%.*]] = select i1 [[I42_NOT]], <2 x i32> [[TMP1]], <2 x i32> <i32 0, i32 1072693248>
; CHECK-NEXT:    ret <2 x i32> [[ASTYPE13_I_I]]
;
  %i42 = icmp ne i64 %i, 0
  %s.0.i.i = select nnan i1 %i42, double 1.0, double %i41
  %astype13.i.i = bitcast double %s.0.i.i to <2 x i32>
  ret <2 x i32> %astype13.i.i
}
