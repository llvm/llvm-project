; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; RUN: opt -S -mtriple=aarch64-linux-gnu -passes=instcombine < %s | FileCheck %s

@errno = external global i32

; non-tls errno global variable does not alias errno when known to be a thread-local variable,
; can do constant store-to-load forwarding.
define i32 @does_not_alias_errno_global_known_tls(float %f) {
; CHECK-LABEL: define i32 @does_not_alias_errno_global_known_tls(
; CHECK-SAME: float [[F:%.*]]) {
; CHECK-NEXT:  [[ENTRY:.*:]]
; CHECK-NEXT:    store i32 42, ptr @errno, align 4
; CHECK-NEXT:    [[CALL:%.*]] = call float @sinf(float [[F]])
; CHECK-NEXT:    ret i32 42
;
entry:
  store i32 42, ptr @errno, align 4
  %call = call float @sinf(float %f)
  %v = load i32, ptr @errno, align 4
  ret i32 %v
}

declare float @sinf(float) memory(errnomem: write)
