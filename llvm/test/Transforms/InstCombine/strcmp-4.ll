; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; TODO: Test that ...
; RUN: opt < %s -passes=instcombine -S | FileCheck %s

declare i32 @strcmp(ptr, ptr)

@s9 = constant [10 x i8] c"123456789\00"


; Fold strcmp(C ? s3 : s5, s3) to C ? 0 : 1.

define i32 @fold_strcmp_s3_x_s4_s3(i1 %C) {
; CHECK-LABEL: @fold_strcmp_s3_x_s4_s3(
; CHECK-NEXT:    [[PTR:%.*]] = select i1 [[C:%.*]], ptr getelementptr inbounds nuw (i8, ptr @s9, i64 6), ptr getelementptr inbounds nuw (i8, ptr @s9, i64 5)
; CHECK-NEXT:    [[CMP:%.*]] = call i32 @strcmp(ptr noundef nonnull dereferenceable(1) [[PTR]], ptr noundef nonnull dereferenceable(4) getelementptr inbounds nuw (i8, ptr @s9, i64 6))
; CHECK-NEXT:    ret i32 [[CMP]]
;

  %ps3 = getelementptr [10 x i8], ptr @s9, i64 0, i64 6
  %ps4 = getelementptr [10 x i8], ptr @s9, i64 0, i64 5

  %ptr = select i1 %C, ptr %ps3, ptr %ps4
  %cmp = call i32 @strcmp(ptr %ptr, ptr %ps3)
  ret i32 %cmp
}
