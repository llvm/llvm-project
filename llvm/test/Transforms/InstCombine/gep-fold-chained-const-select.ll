; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt < %s -S -passes=instcombine | FileCheck %s

define ptr @fold(i32 %arg0, ptr %arg1) {
; CHECK-LABEL: @fold(
; CHECK-NEXT:    [[V1:%.*]] = icmp sgt i32 [[ARG0:%.*]], 3
; CHECK-NEXT:    [[V2:%.*]] = select i1 [[V1]], i64 63252, i64 29452
; CHECK-NEXT:    [[V3:%.*]] = getelementptr i8, ptr [[V0:%.*]], i64 [[V2]]
; CHECK-NEXT:    ret ptr [[V3]]
;
  %v0 = getelementptr inbounds nuw i8, ptr %arg1, i64 8148
  %v1 = icmp sgt i32 %arg0, 3
  %v2 = select i1 %v1, i64 55104, i64 21304
  %v3 = getelementptr i8, ptr %v0, i64 %v2
  ret ptr %v3
}

define ptr @no_fold_0(i32 %arg0, ptr %arg1) {
; CHECK-LABEL: @no_fold_0(
; CHECK-NEXT:    [[V0:%.*]] = getelementptr inbounds nuw i8, ptr [[ARG1:%.*]], i64 8148
; CHECK-NEXT:    [[V1:%.*]] = icmp sgt i32 [[ARG0:%.*]], 3
; CHECK-NEXT:    [[V2:%.*]] = select i1 [[V1]], i64 55104, i64 21304
; CHECK-NEXT:    [[V3:%.*]] = getelementptr i16, ptr [[V0]], i64 [[V2]]
; CHECK-NEXT:    ret ptr [[V3]]
;
  %v0 = getelementptr inbounds nuw i8, ptr %arg1, i64 8148
  %v1 = icmp sgt i32 %arg0, 3
  %v2 = select i1 %v1, i64 55104, i64 21304
  %v3 = getelementptr i16, ptr %v0, i64 %v2
  ret ptr %v3
}

define ptr @no_fold_1(i32 %arg0, ptr %arg1, i64 %arg2) {
; CHECK-LABEL: @no_fold_1(
; CHECK-NEXT:    [[V0:%.*]] = getelementptr inbounds nuw i8, ptr [[ARG1:%.*]], i64 [[ARG2:%.*]]
; CHECK-NEXT:    [[V1:%.*]] = icmp sgt i32 [[ARG0:%.*]], 3
; CHECK-NEXT:    [[V2:%.*]] = select i1 [[V1]], i64 55104, i64 21304
; CHECK-NEXT:    [[V3:%.*]] = getelementptr i8, ptr [[V0]], i64 [[V2]]
; CHECK-NEXT:    ret ptr [[V3]]
;
  %v0 = getelementptr inbounds nuw i8, ptr %arg1, i64 %arg2
  %v1 = icmp sgt i32 %arg0, 3
  %v2 = select i1 %v1, i64 55104, i64 21304
  %v3 = getelementptr i8, ptr %v0, i64 %v2
  ret ptr %v3
}
