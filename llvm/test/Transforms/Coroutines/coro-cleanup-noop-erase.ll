; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; Tests that resume or destroy a no-op coroutine can be erased; Finally, erase coro.noop if it has no users.
; RUN: opt < %s -S -passes='coro-cleanup' | FileCheck %s

define void @fn() personality i32 0 {
; CHECK-LABEL: define void @fn() personality i32 0 {
; CHECK-NEXT:  [[DONE:.*:]]
; CHECK-NEXT:    ret void
;
  %frame = call noundef ptr @llvm.coro.noop()
  %resume = call ptr @llvm.coro.subfn.addr(ptr %frame, i8 0)
  call fastcc void %resume(ptr %frame)
  %destroy = call ptr @llvm.coro.subfn.addr(ptr %frame, i8 1)
  invoke fastcc void %destroy(ptr %frame)
  to label %done unwind label %unwind

done:
  ret void

unwind:
  %pad = landingpad { ptr, i32 }
  catch ptr null
  unreachable
}
