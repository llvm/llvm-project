; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; RUN: opt -S -passes=indvars -indvars-predicate-loops=0  < %s | FileCheck %s

target datalayout = "e-m:o-i64:64-f80:128-n8:16:32:64-S128"
target triple = "x86_64-apple-macosx10.10.0"

@a = common global i32 0, align 4

; Function Attrs: nounwind ssp uwtable
define void @fn1() {
; CHECK-LABEL: define void @fn1() {
; CHECK-NEXT:  [[BB:.*]]:
; CHECK-NEXT:    br label %[[BB4_PREHEADER:.*]]
; CHECK:       [[BB4_PREHEADER]]:
; CHECK-NEXT:    [[B_03:%.*]] = phi i8 [ 0, %[[BB]] ], [ [[TMP17:%.*]], %[[BB16:.*]] ]
; CHECK-NEXT:    [[TMP9:%.*]] = icmp ne i8 [[B_03]], 0
; CHECK-NEXT:    br i1 [[TMP9]], label %[[BB4_PREHEADER_BB18_LOOPEXIT_SPLIT_CRIT_EDGE:.*]], label %[[BB4_PREHEADER_BB4_PREHEADER_SPLIT_CRIT_EDGE:.*]]
; CHECK:       [[BB4_PREHEADER_BB4_PREHEADER_SPLIT_CRIT_EDGE]]:
; CHECK-NEXT:    br label %[[BB4_PREHEADER_SPLIT:.*]]
; CHECK:       [[BB4_PREHEADER_BB18_LOOPEXIT_SPLIT_CRIT_EDGE]]:
; CHECK-NEXT:    store i32 0, ptr @a, align 4
; CHECK-NEXT:    br label %[[BB18_LOOPEXIT_SPLIT:.*]]
; CHECK:       [[BB4_PREHEADER_SPLIT]]:
; CHECK-NEXT:    br label %[[BB7:.*]]
; CHECK:       [[BB4:.*]]:
; CHECK-NEXT:    br i1 false, label %[[BB7]], label %[[BB16]]
; CHECK:       [[BB7]]:
; CHECK-NEXT:    br i1 false, label %[[BB18_LOOPEXIT:.*]], label %[[BB4]]
; CHECK:       [[BB16]]:
; CHECK-NEXT:    [[TMP17]] = add nuw nsw i8 [[B_03]], -1
; CHECK-NEXT:    br i1 false, label %[[BB18_LOOPEXIT1:.*]], label %[[BB4_PREHEADER]]
; CHECK:       [[BB18_LOOPEXIT]]:
; CHECK-NEXT:    br label %[[BB18_LOOPEXIT_SPLIT]]
; CHECK:       [[BB18_LOOPEXIT_SPLIT]]:
; CHECK-NEXT:    br label %[[BB18:.*]]
; CHECK:       [[BB18_LOOPEXIT1]]:
; CHECK-NEXT:    [[TMP14_LCSSA5_LCSSA:%.*]] = phi i32 [ 1, %[[BB16]] ]
; CHECK-NEXT:    store i32 [[TMP14_LCSSA5_LCSSA]], ptr @a, align 4
; CHECK-NEXT:    br label %[[BB18]]
; CHECK:       [[BB18]]:
; CHECK-NEXT:    ret void
;
bb:
  br label %bb4.preheader

bb4.preheader:                                    ; preds = %bb, %bb16
  %b.03 = phi i8 [ 0, %bb ], [ %tmp17, %bb16 ]

  %tmp9 = icmp ugt i8 %b.03, 1
  br i1 %tmp9, label %bb4.preheader.bb18.loopexit.split_crit_edge, label %bb4.preheader.bb4.preheader.split_crit_edge

bb4.preheader.bb4.preheader.split_crit_edge:      ; preds = %bb4.preheader
  br label %bb4.preheader.split

bb4.preheader.bb18.loopexit.split_crit_edge:      ; preds = %bb4.preheader
  store i32 0, ptr @a, align 4
  br label %bb18.loopexit.split

bb4.preheader.split:                              ; preds = %bb4.preheader.bb4.preheader.split_crit_edge
  br label %bb7

bb4:                                              ; preds = %bb7
  %tmp6 = icmp slt i32 %storemerge2, 0
  br i1 %tmp6, label %bb7, label %bb16

bb7:                                              ; preds = %bb4.preheader.split, %bb4
  %storemerge2 = phi i32 [ 0, %bb4.preheader.split ], [ %tmp14, %bb4 ]
  %tmp14 = add nsw i32 %storemerge2, 1
  br i1 false, label %bb18.loopexit, label %bb4

bb16:                                             ; preds = %bb4
  %tmp14.lcssa5 = phi i32 [ %tmp14, %bb4 ]
  %tmp17 = add i8 %b.03, -1
  %tmp2 = icmp eq i8 %tmp17, -2
  br i1 %tmp2, label %bb18.loopexit1, label %bb4.preheader

bb18.loopexit:                                    ; preds = %bb7
  br label %bb18.loopexit.split

bb18.loopexit.split:                              ; preds = %bb4.preheader.bb18.loopexit.split_crit_edge, %bb18.loopexit
  br label %bb18

bb18.loopexit1:                                   ; preds = %bb16
  %tmp14.lcssa5.lcssa = phi i32 [ %tmp14.lcssa5, %bb16 ]
  store i32 %tmp14.lcssa5.lcssa, ptr @a, align 4
  br label %bb18

bb18:                                             ; preds = %bb18.loopexit1, %bb18.loopexit.split
  ret void
}

declare void @abort()
