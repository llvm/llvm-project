; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; RUN: opt -passes=lcssa -S < %s | FileCheck %s

; Previously crashing in the verifier, due to LCSSA inserting a phi between
; the alloca and the lifetime intrinsic.
; We can instead remove the problematic intrinsic and its corresponding start.

declare void @llvm.lifetime.end.p0(ptr captures(none))
declare void @llvm.lifetime.start.p0(i64, ptr captures(none))

define fastcc i32 @test() {
; CHECK-LABEL: define fastcc i32 @test() {
; CHECK-NEXT:    br label %[[BB1:.*]]
; CHECK:       [[BB1]]:
; CHECK-NEXT:    [[A:%.*]] = alloca i32, align 4
; CHECK-NEXT:    br i1 false, label %[[BB2:.*]], label %[[BB1]]
; CHECK:       [[BB2]]:
; CHECK-NEXT:    ret i32 0
;
  br label %1

1:                                                ; preds = %1, %0
  %a = alloca i32, align 4
  call void @llvm.lifetime.start.p0(i64 4, ptr %a)
  br i1 false, label %3, label %1

3:                                                ; preds = %1
  call void @llvm.lifetime.end.p0(ptr %a)
  ret i32 0
}
