; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --check-globals
; RUN: opt -S -passes=globalopt < %s | FileCheck %s

; Make sure that the load from uniform value @g1 succeeds during evaluation.

@g1 = global [2 x ptr] zeroinitializer
@g2 = global ptr inttoptr(i64 1 to ptr)

@llvm.global_ctors = appending global [1 x { i32, ptr, ptr }] [{ i32, ptr, ptr } { i32 65535, ptr @ctor, ptr null }]

;.
; CHECK: @[[G1:[a-zA-Z0-9_$"\\.-]+]] = local_unnamed_addr global [2 x ptr] zeroinitializer
; CHECK: @[[G2:[a-zA-Z0-9_$"\\.-]+]] = local_unnamed_addr global ptr null
; CHECK: @[[LLVM_GLOBAL_CTORS:[a-zA-Z0-9_$"\\.-]+]] = appending global [0 x { i32, ptr, ptr }] zeroinitializer
;.
define internal void @ctor() {
  %v = load ptr, ptr getelementptr ([2 x ptr], ptr @g1, i64 0, i64 1)
  store ptr %v, ptr @g2
  ret void
}
