; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt < %s -mattr=+avx512f -mattr=+next32-vectorization -x86-enable-gather-scatter=false -passes=loop-vectorize,instcombine,simplifycfg -S 2>&1 | FileCheck %s

target triple = "x86_64-unknown-linux-gnu"

; Function Attrs: nofree norecurse nosync nounwind memory(argmem: readwrite) uwtable
define dso_local void @foo(ptr noalias nocapture noundef writeonly %0, ptr noalias nocapture noundef readonly %1, i32 noundef %2) {
; CHECK-LABEL: @foo(
; CHECK-NOT: llvm.masked.gather
; CHECK-NOT: llvm.masked.scatter
  %4 = icmp sgt i32 %2, 0
  br i1 %4, label %5, label %7

5:                                                ; preds = %3
  %6 = zext i32 %2 to i64
  br label %8

7:                                                ; preds = %8, %3
  ret void

8:                                                ; preds = %5, %8
  %9 = phi i64 [ 0, %5 ], [ %13, %8 ]
  %10 = getelementptr inbounds i32, ptr %1, i64 %9
  %11 = load i32, ptr %10, align 4
  %12 = getelementptr inbounds i32, ptr %0, i64 %9
  store i32 %11, ptr %12, align 4
  %13 = add nuw nsw i64 %9, 16
  %14 = icmp ult i64 %13, %6
  br i1 %14, label %8, label %7
}
