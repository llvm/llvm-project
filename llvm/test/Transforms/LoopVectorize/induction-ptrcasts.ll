; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -passes=loop-vectorize -force-vector-width=1 -force-vector-interleave=2 -S %s | FileCheck --check-prefix=VF1 %s
; RUN: opt -passes=loop-vectorize -force-vector-width=2 -force-vector-interleave=1 -S %s | FileCheck --check-prefix=VF2 %s

@f = external dso_local global i32, align 4

define void @int_iv_based_on_pointer_iv(ptr %A) {
; VF1-LABEL: @int_iv_based_on_pointer_iv(
; VF1-NEXT:  entry:
; VF1-NEXT:    br label [[LOOP:%.*]]
; VF1:       loop:
; VF1-NEXT:    [[INDUCTION3:%.*]] = phi i64 [ 0, [[ENTRY:%.*]] ], [ [[IV_INT_NEXT:%.*]], [[LOOP]] ]
; VF1-NEXT:    [[IV_PTR:%.*]] = phi ptr [ null, [[ENTRY]] ], [ [[IV_PTR_NEXT:%.*]], [[LOOP]] ]
; VF1-NEXT:    [[IV_PTR_NEXT]] = getelementptr inbounds i32, ptr [[IV_PTR]], i64 1
; VF1-NEXT:    [[TMP8:%.*]] = getelementptr inbounds i8, ptr [[A:%.*]], i64 [[INDUCTION3]]
; VF1-NEXT:    store i8 0, ptr [[TMP8]], align 1
; VF1-NEXT:    [[IV_INT_NEXT]] = ptrtoint ptr [[IV_PTR_NEXT]] to i64
; VF1-NEXT:    [[SUB_PTR_SUB:%.*]] = sub i64 ptrtoint (ptr @f to i64), [[IV_INT_NEXT]]
; VF1-NEXT:    [[CMP:%.*]] = icmp sgt i64 [[SUB_PTR_SUB]], 0
; VF1-NEXT:    br i1 [[CMP]], label [[LOOP]], label [[EXIT:%.*]]
; VF1:       exit:
; VF1-NEXT:    ret void
;
; VF2-LABEL: @int_iv_based_on_pointer_iv(
; VF2-NEXT:  entry:
; VF2-NEXT:    br label [[LOOP:%.*]]
; VF2:       loop:
; VF2-NEXT:    [[TMP4:%.*]] = phi i64 [ 0, [[ENTRY:%.*]] ], [ [[IV_INT_NEXT:%.*]], [[LOOP]] ]
; VF2-NEXT:    [[IV_PTR:%.*]] = phi ptr [ null, [[ENTRY]] ], [ [[IV_PTR_NEXT:%.*]], [[LOOP]] ]
; VF2-NEXT:    [[IV_PTR_NEXT]] = getelementptr inbounds i32, ptr [[IV_PTR]], i64 1
; VF2-NEXT:    [[TMP10:%.*]] = getelementptr inbounds i8, ptr [[A:%.*]], i64 [[TMP4]]
; VF2-NEXT:    store i8 0, ptr [[TMP10]], align 1
; VF2-NEXT:    [[IV_INT_NEXT]] = ptrtoint ptr [[IV_PTR_NEXT]] to i64
; VF2-NEXT:    [[SUB_PTR_SUB:%.*]] = sub i64 ptrtoint (ptr @f to i64), [[IV_INT_NEXT]]
; VF2-NEXT:    [[CMP:%.*]] = icmp sgt i64 [[SUB_PTR_SUB]], 0
; VF2-NEXT:    br i1 [[CMP]], label [[LOOP]], label [[EXIT:%.*]]
; VF2:       exit:
; VF2-NEXT:    ret void
;
entry:
  br label %loop

loop:
  %iv.int = phi i64 [ 0, %entry ], [ %iv.int.next, %loop ]
  %iv.ptr = phi ptr [ null, %entry ], [ %iv.ptr.next, %loop ]
  %iv.ptr.next = getelementptr inbounds i32, ptr %iv.ptr, i64 1
  %gep.A = getelementptr inbounds i8, ptr %A, i64 %iv.int
  store i8 0, ptr %gep.A
  %iv.int.next = ptrtoint ptr %iv.ptr.next to i64
  %sub.ptr.sub = sub i64 ptrtoint (ptr @f to i64), %iv.int.next
  %cmp = icmp sgt i64 %sub.ptr.sub, 0
  br i1 %cmp, label %loop, label %exit

exit:
  ret void
}
