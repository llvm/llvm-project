; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
target datalayout = "e-m:e-i64:64-f80:128-n8:16:32:64-S128"

; RUN: opt < %s -S -loop-vectorize -debug-only=loop-vectorize 2>&1 | FileCheck %s
; REQUIRES: asserts
; CHECK: LV: Can't vectorize due to memory conflicts

define void @test_loop_novect(double** %arr, i64 %n) {
; CHECK-LABEL: @test_loop_novect(
; CHECK-NEXT:  for.body.lr.ph:
; CHECK-NEXT:    [[T:%.*]] = load double*, double** [[ARR:%.*]], align 8
; CHECK-NEXT:    br label [[FOR_BODY:%.*]]
; CHECK:       for.body:
; CHECK-NEXT:    [[I:%.*]] = phi i64 [ 0, [[FOR_BODY_LR_PH:%.*]] ], [ [[I_NEXT:%.*]], [[FOR_BODY]] ]
; CHECK-NEXT:    [[A:%.*]] = getelementptr inbounds double, double* [[T]], i64 [[I]]
; CHECK-NEXT:    [[I_NEXT]] = add nuw nsw i64 [[I]], 1
; CHECK-NEXT:    [[A_NEXT:%.*]] = getelementptr inbounds double, double* [[T]], i64 [[I_NEXT]]
; CHECK-NEXT:    [[T1:%.*]] = load double, double* [[A]], align 8
; CHECK-NEXT:    [[T2:%.*]] = load double, double* [[A_NEXT]], align 8
; CHECK-NEXT:    store double [[T1]], double* [[A_NEXT]], align 8
; CHECK-NEXT:    store double [[T2]], double* [[A]], align 8
; CHECK-NEXT:    [[C:%.*]] = icmp eq i64 [[I]], [[N:%.*]]
; CHECK-NEXT:    br i1 [[C]], label [[FINAL:%.*]], label [[FOR_BODY]]
; CHECK:       final:
; CHECK-NEXT:    ret void
;
for.body.lr.ph:
  %t = load double*, double** %arr, align 8
  br label %for.body

for.body:                                      ; preds = %for.body, %for.body.lr.ph
  %i = phi i64 [ 0, %for.body.lr.ph ], [ %i.next, %for.body ]
  %a = getelementptr inbounds double, double* %t, i64 %i
  %i.next = add nuw nsw i64 %i, 1
  %a.next = getelementptr inbounds double, double* %t, i64 %i.next
  %t1 = load double, double* %a, align 8
  %t2 = load double, double* %a.next, align 8
  store double %t1, double* %a.next, align 8
  store double %t2, double* %a, align 8
  %c = icmp eq i64 %i, %n
  br i1 %c, label %final, label %for.body

final:                                   ; preds = %for.body
  ret void
}
