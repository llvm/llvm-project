; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt < %s -passes=instsimplify -S | FileCheck %s
; RUN: opt < %s -passes=instsimplify -data-layout=z0:1-z2:neg1-z3:neg1-z5:neg1 -S | FileCheck -check-prefixes=CHECK-DL %s

declare void @usei8ptr(ptr %ptr)

define i1 @load_ptr_null_valid(ptr %p) null_pointer_is_valid {
; CHECK-LABEL: @load_ptr_null_valid(
; CHECK-NEXT:    [[LOAD_P:%.*]] = load ptr, ptr [[P:%.*]], align 8, !dereferenceable [[META0:![0-9]+]]
; CHECK-NEXT:    [[R:%.*]] = icmp ne ptr [[LOAD_P]], null
; CHECK-NEXT:    ret i1 [[R]]
;
; CHECK-DL-LABEL: @load_ptr_null_valid(
; CHECK-DL-NEXT:    ret i1 true
;
; ASM-LABEL: @load_ptr_null_valid(
; ASM-NEXT:    [[LOAD_P:%.*]] = load ptr, ptr [[P:%.*]], align 8, !dereferenceable [[META0:![0-9]+]]
; ASM-NEXT:    [[R:%.*]] = icmp ne ptr [[LOAD_P]], null
; ASM-NEXT:    ret i1 [[R]]
  %load_p = load ptr, ptr %p, !dereferenceable !{i64 8}
  %r = icmp ne ptr %load_p, null
  ret i1 %r
}
