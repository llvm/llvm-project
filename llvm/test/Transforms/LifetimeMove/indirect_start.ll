; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; Test that lifetime-move knows the operand of lifetime.start intrinsic may be GEP as well.
; RUN: opt < %s -passes=lifetime-move -S | FileCheck %s

define void @indirect() presplitcoroutine {
; CHECK-LABEL: define void @indirect(
; CHECK-SAME: ) #[[ATTR0:[0-9]+]] {
; CHECK-NEXT:  [[ENTRY:.*:]]
; CHECK-NEXT:    [[ARR:%.*]] = alloca [500 x i8], align 16
; CHECK-NEXT:    [[P:%.*]] = getelementptr inbounds nuw i8, ptr [[ARR]], i64 0
; CHECK-NEXT:    [[UNUSED:%.*]] = call i8 @llvm.coro.suspend(token none, i1 false)
; CHECK-NEXT:    call void @llvm.lifetime.start.p0(i64 500, ptr [[ARR]])
; CHECK-NEXT:    [[VALUE:%.*]] = load i8, ptr [[ARR]], align 1
; CHECK-NEXT:    ret void
;
entry:
  %arr = alloca [500 x i8], align 16
  %p = getelementptr inbounds nuw i8, ptr %arr, i64 0
  call void @llvm.lifetime.start.p0(i64 500, ptr %p)
  %unused = call i8 @llvm.coro.suspend(token none, i1 false)
  %value = load i8, ptr %arr, align 1
  ret void
}
