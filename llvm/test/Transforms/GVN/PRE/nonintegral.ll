; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -passes=gvn -S < %s | FileCheck %s

target datalayout = "e-m:e-i64:64-f80:128-n8:16:32:64-S128-ni:4"
target triple = "x86_64-unknown-linux-gnu"

define void @nipre(ptr noalias %p, ptr noalias %p2, i8 %jmp) {

; CHECK-LABEL: @nipre(
; CHECK:       a:
; CHECK:    [[L1:%.*]] = load ptr addrspace(4), ptr [[P:%.*]]
; CHECK:       b:
; CHECK:    [[L2:%.*]] = load ptr addrspace(4), ptr [[P]]
; CHECK:       c:
; CHECK-NEXT:    [[L3_PRE:%.*]] = load ptr addrspace(4), ptr %p

entry:
  switch i8 %jmp, label %c [ i8 0, label %a
  i8 1, label %b]
a:
  %l1 = load ptr addrspace(4), ptr %p
  store ptr addrspace(4) %l1, ptr %p2
  br label %tail
b:
  %l2 = load ptr addrspace(4), ptr %p
  store ptr addrspace(4) %l2, ptr %p2
  br label %tail
c:
  br label %tail
tail:
  %l3 = load ptr addrspace(4), ptr %p
  store ptr addrspace(4) %l3, ptr %p2
  ret void
}
