; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -passes='print<scalar-evolution>,loop-mssa(licm)' -verify-scev  < %s -S | FileCheck %s

; This is to verify scalar-evolution update after sinking from preheader
define i32 @main(i1 %cond) {
; CHECK-LABEL: @main(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    br label [[LOOP0:%.*]]
; CHECK:       loop0:
; CHECK-NEXT:    [[IV0:%.*]] = phi i32 [ 0, [[ENTRY:%.*]] ], [ [[IV0_NEXT:%.*]], [[LOOP0]] ]
; CHECK-NEXT:    [[IV0_NEXT]] = add i32 [[IV0]], 1
; CHECK-NEXT:    br i1 [[COND:%.*]], label [[MID:%.*]], label [[LOOP0]]
; CHECK:       mid:
; CHECK-NEXT:    [[IV0_LCSSA:%.*]] = phi i32 [ [[IV0]], [[LOOP0]] ]
; CHECK-NEXT:    [[A:%.*]] = load i32, ptr addrspace(1) null, align 8
; CHECK-NEXT:    [[ADD:%.*]] = add i32 [[A]], [[IV0_LCSSA]]
; CHECK-NEXT:    ret i32 [[ADD]]
;
entry:
  %a = load i32, ptr addrspace(1) null, align 8
  br label %loop0

loop0:
  %iv0 = phi i32 [ 0, %entry ], [ %iv0.next, %loop0 ]
  %iv0.next = add i32 %iv0, 1
  br i1 %cond, label %mid, label %loop0

mid:
  %add = add i32 %a, %iv0
  ret i32 %add
}