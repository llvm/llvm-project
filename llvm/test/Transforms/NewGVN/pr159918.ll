; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; RUN: opt -S -passes=newgvn < %s | FileCheck %s

; Don't use returned argument in memory defining intrinsics.
define void @wombat(ptr %arg) {
; CHECK-LABEL: define void @wombat(
; CHECK-SAME: ptr [[ARG:%.*]]) {
; CHECK-NEXT:    [[LOAD:%.*]] = load ptr, ptr [[ARG]], align 8
; CHECK-NEXT:    [[CALL:%.*]] = call ptr @llvm.objc.retain(ptr [[LOAD]])
; CHECK-NEXT:    store ptr [[CALL]], ptr [[ARG]], align 8
; CHECK-NEXT:    ret void
;
  %load = load ptr, ptr %arg, align 8
  %call = call ptr @llvm.objc.retain(ptr %load)
  store ptr %call, ptr %arg, align 8
  ret void
}

declare ptr @llvm.objc.retain(ptr returned) #0

attributes #0 = { nounwind }
