; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -passes=reassociate -S < %s | FileCheck %s

; Verify that distribution doesn't happen when add has multiple uses
; Instead, reassociate factors the common add operand
define i16 @test_no_distribute_multiuse(i16 %x, i16 %y) {
; CHECK-LABEL: @test_no_distribute_multiuse(
; CHECK-NEXT:    [[ADD:%.*]] = add i16 [[Y:%.*]], [[X:%.*]]
; CHECK-NEXT:    [[REASS_MUL:%.*]] = mul i16 [[ADD]], 30
; CHECK-NEXT:    ret i16 [[REASS_MUL]]
;
  %add = add i16 %x, %y
  %mul1 = mul i16 %add, 10
  %mul2 = mul i16 %add, 20
  %result = add i16 %mul1, %mul2
  ret i16 %result
}
