; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt < %s -passes=load-store-vectorizer -S -mtriple=x86_64-unknown-linux-gnu | FileCheck %s
; RUN: opt < %s -aa-pipeline=basic-aa -passes='function(load-store-vectorizer)' -S -mtriple=x86_64-unknown-linux-gnu | FileCheck %s

%rec = type { i32, i28 }

; We currently do not optimize this scenario.
; But we verify that we no longer crash when compiling this.
define void @test1(ptr %out, ptr %in) {
; CHECK-LABEL: @test1(
; CHECK-NEXT:    [[IN2:%.*]] = getelementptr [[REC:%.*]], ptr [[IN:%.*]], i16 0, i32 1
; CHECK-NEXT:    [[VAL1:%.*]] = load i32, ptr [[IN]], align 8
; CHECK-NEXT:    [[VAL2:%.*]] = load i28, ptr [[IN2]], align 4
; CHECK-NEXT:    [[OUT2:%.*]] = getelementptr [[REC]], ptr [[OUT:%.*]], i16 0, i32 1
; CHECK-NEXT:    store i32 [[VAL1]], ptr [[OUT]], align 8
; CHECK-NEXT:    store i28 [[VAL2]], ptr [[OUT2]], align 4
; CHECK-NEXT:    ret void
;
  %in2 = getelementptr %rec, ptr %in, i16 0, i32 1
  %val1 = load i32, ptr %in, align 8
  %val2 = load i28, ptr %in2
  %out2 = getelementptr %rec, ptr %out, i16 0, i32 1
  store i32 %val1, ptr %out, align 8
  store i28 %val2, ptr %out2
  ret void
}

