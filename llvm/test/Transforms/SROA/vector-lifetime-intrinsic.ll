; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -passes='sroa<preserve-cfg>' -S < %s | FileCheck %s --check-prefixes=CHECK,CHECK-PRESERVE-CFG
; RUN: opt -passes='sroa<modify-cfg>' -S < %s | FileCheck %s --check-prefixes=CHECK,CHECK-MODIFY-CFG

target datalayout = "e-p:64:32-i64:32-v32:32-n32-S64"

; Function Attrs: nounwind
declare void @llvm.lifetime.start.p0(i64, ptr nocapture) #0

; Function Attrs: nounwind
declare void @llvm.lifetime.end.p0(i64, ptr nocapture) #0

define void @wombat(<4 x float> %arg1) {
; CHECK-LABEL: @wombat(
; CHECK-NEXT:  bb:
; CHECK-NEXT:    [[TMP_0_VEC_EXTRACT:%.*]] = shufflevector <4 x float> [[ARG1:%.*]], <4 x float> poison, <3 x i32> <i32 0, i32 1, i32 2>
; CHECK-NEXT:    call void @wombat3(<3 x float> [[TMP_0_VEC_EXTRACT]])
; CHECK-NEXT:    ret void
;
bb:
  %tmp = alloca <4 x float>, align 16
  call void @llvm.lifetime.start.p0(i64 16, ptr %tmp)
  store <4 x float> %arg1, ptr %tmp, align 16
  %tmp18 = load <3 x float>, ptr %tmp
  call void @llvm.lifetime.end.p0(i64 16, ptr %tmp)
  call void @wombat3(<3 x float> %tmp18)
  ret void
}

; Function Attrs: nounwind
declare void @wombat3(<3 x float>) #0

attributes #0 = { nounwind }
;; NOTE: These prefixes are unused and the list is autogenerated. Do not add tests below this line:
; CHECK-MODIFY-CFG: {{.*}}
; CHECK-PRESERVE-CFG: {{.*}}
