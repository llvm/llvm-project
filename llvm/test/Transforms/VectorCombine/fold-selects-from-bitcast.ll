; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; RUN: opt -passes=vector-combine -S %s | FileCheck %s

define i8 @fold_selects_from_bitcast_dominance() {
; CHECK-LABEL: define i8 @fold_selects_from_bitcast_dominance() {
; CHECK-NEXT:  [[ENTRY:.*:]]
; CHECK-NEXT:    [[BC:%.*]] = bitcast <2 x i32> splat (i32 1) to <8 x i8>
; CHECK-NEXT:    [[E0:%.*]] = extractelement <8 x i8> [[BC]], i64 0
; CHECK-NEXT:    [[COND:%.*]] = icmp eq i8 0, 0
; CHECK-NEXT:    [[E1:%.*]] = extractelement <8 x i8> [[BC]], i64 1
; CHECK-NEXT:    [[E2:%.*]] = extractelement <8 x i8> [[BC]], i64 2
; CHECK-NEXT:    [[E3:%.*]] = extractelement <8 x i8> [[BC]], i64 3
; CHECK-NEXT:    [[E4:%.*]] = extractelement <8 x i8> [[BC]], i64 4
; CHECK-NEXT:    [[E5:%.*]] = extractelement <8 x i8> [[BC]], i64 5
; CHECK-NEXT:    [[E6:%.*]] = extractelement <8 x i8> [[BC]], i64 6
; CHECK-NEXT:    [[E7:%.*]] = extractelement <8 x i8> [[BC]], i64 7
; CHECK-NEXT:    [[S0:%.*]] = select i1 [[COND]], i8 [[E0]], i8 0
; CHECK-NEXT:    [[S1:%.*]] = select i1 [[COND]], i8 [[E1]], i8 0
; CHECK-NEXT:    [[S2:%.*]] = select i1 [[COND]], i8 [[E2]], i8 0
; CHECK-NEXT:    [[S3:%.*]] = select i1 [[COND]], i8 [[E3]], i8 0
; CHECK-NEXT:    [[S4:%.*]] = select i1 [[COND]], i8 [[E4]], i8 0
; CHECK-NEXT:    [[S5:%.*]] = select i1 [[COND]], i8 [[E5]], i8 0
; CHECK-NEXT:    [[S6:%.*]] = select i1 [[COND]], i8 [[E6]], i8 0
; CHECK-NEXT:    [[S7:%.*]] = select i1 [[COND]], i8 [[E7]], i8 0
; CHECK-NEXT:    [[SUM0:%.*]] = add i8 [[S0]], [[S1]]
; CHECK-NEXT:    [[SUM1:%.*]] = add i8 [[SUM0]], [[S2]]
; CHECK-NEXT:    [[SUM2:%.*]] = add i8 [[SUM1]], [[S3]]
; CHECK-NEXT:    [[SUM3:%.*]] = add i8 [[SUM2]], [[S4]]
; CHECK-NEXT:    [[SUM4:%.*]] = add i8 [[SUM3]], [[S5]]
; CHECK-NEXT:    [[SUM5:%.*]] = add i8 [[SUM4]], [[S6]]
; CHECK-NEXT:    [[SUM6:%.*]] = add i8 [[SUM5]], [[S7]]
; CHECK-NEXT:    ret i8 [[SUM6]]
;
entry:
  %bc = bitcast <2 x i32> splat (i32 1) to <8 x i8>
  %e0 = extractelement <8 x i8> %bc, i64 0
  %cond = icmp eq i8 0, 0
  %e1 = extractelement <8 x i8> %bc, i64 1
  %e2 = extractelement <8 x i8> %bc, i64 2
  %e3 = extractelement <8 x i8> %bc, i64 3
  %e4 = extractelement <8 x i8> %bc, i64 4
  %e5 = extractelement <8 x i8> %bc, i64 5
  %e6 = extractelement <8 x i8> %bc, i64 6
  %e7 = extractelement <8 x i8> %bc, i64 7
  %s0 = select i1 %cond, i8 %e0, i8 0
  %s1 = select i1 %cond, i8 %e1, i8 0
  %s2 = select i1 %cond, i8 %e2, i8 0
  %s3 = select i1 %cond, i8 %e3, i8 0
  %s4 = select i1 %cond, i8 %e4, i8 0
  %s5 = select i1 %cond, i8 %e5, i8 0
  %s6 = select i1 %cond, i8 %e6, i8 0
  %s7 = select i1 %cond, i8 %e7, i8 0
  %sum0 = add i8 %s0, %s1
  %sum1 = add i8 %sum0, %s2
  %sum2 = add i8 %sum1, %s3
  %sum3 = add i8 %sum2, %s4
  %sum4 = add i8 %sum3, %s5
  %sum5 = add i8 %sum4, %s6
  %sum6 = add i8 %sum5, %s7
  ret i8 %sum6
}
