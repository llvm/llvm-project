; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 6
; RUN: opt -S -passes='early-cse<memssa>' < %s | FileCheck %s

define void @foo(){
; CHECK-LABEL: define void @foo() {
; CHECK-NEXT:    call void @fn_write_target1()
; CHECK-NEXT:    call void @fn_readwrite_target0_read_target1()
; CHECK-NEXT:    call void @fn_readwrite_target0_read_target1()
; CHECK-NEXT:    ret void
;
  call void @fn_write_target1()
  call void @fn_readwrite_target0_read_target1()
  call void @fn_write_target1()
  call void @fn_readwrite_target0_read_target1()
  ret void
}

define void @goo(){
; CHECK-LABEL: define void @goo() {
; CHECK-NEXT:    call void @fn_read_target0_read_target1()
; CHECK-NEXT:    call void @fn_read_target0()
; CHECK-NEXT:    call void @fn_read_target0_read_target1()
; CHECK-NEXT:    call void @fn_read_target0_read_target1()
; CHECK-NEXT:    ret void
;
  call void @fn_read_target0_read_target1()
  call void @fn_read_target0()
  call void @fn_read_target0_read_target1()
  call void @fn_read_target0()
  call void @fn_read_target0_read_target1()
  ret void
}

;; In this case the clobber function is not even called
define void @neg_foo(){
; CHECK-LABEL: define void @neg_foo() {
; CHECK-NEXT:    call void @fn_readwrite_target0_read_target1()
; CHECK-NEXT:    call void @fn_read_target0_readwrite_target1()
; CHECK-NEXT:    call void @fn_readwrite_target0_read_target1()
; CHECK-NEXT:    call void @fn_read_target0_readwrite_target1()
; CHECK-NEXT:    ret void
;
  call void @fn_readwrite_target0_read_target1()
  call void @fn_read_target0_readwrite_target1()
  call void @fn_readwrite_target0_read_target1()
  call void @fn_read_target0_readwrite_target1()
  ret void
}

define void @foo_neg_foo(){
; CHECK-LABEL: define void @foo_neg_foo() {
; CHECK-NEXT:    call void @fn_write_target1()
; CHECK-NEXT:    call void @fn_readwrite_target0_read_target1()
; CHECK-NEXT:    call void @neg_foo()
; CHECK-NEXT:    call void @fn_write_target1()
; CHECK-NEXT:    call void @fn_readwrite_target0_read_target1()
; CHECK-NEXT:    ret void
;
  call void @fn_write_target1()
  call void @fn_readwrite_target0_read_target1()
  call void @neg_foo()
  call void @fn_write_target1()
  call void @fn_readwrite_target0_read_target1()
  ret void
}

declare void @fn_write_target1()
  memory(target_mem1:  write)

declare void @fn_read_target0_read_target1()
  memory(target_mem0: readwrite, target_mem1: read)

declare void @fn_read_target0()
  memory( target_mem0: read)

declare void @fn_read_target0_readwrite_target1()
  memory(target_mem0: read, target_mem1: readwrite)

declare void @fn_readwrite_target0_read_target1()
  memory(target_mem0: readwrite, target_mem1: read)
