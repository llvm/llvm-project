; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc -mtriple=amdgcn-- -mcpu=gfx1300 -verify-machineinstrs -o - %s | FileCheck %s

; Test the searching of the constantexpr gep and subsequent sub-dword access to laneshare

target datalayout = "A5"

@vx = external local_unnamed_addr addrspace(10) global [400 x i8], align 16

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(readwrite, argmem: none, inaccessiblemem: none)
define dso_local amdgpu_kernel void @_Z3foov() local_unnamed_addr {
; CHECK-LABEL: _Z3foov:
; CHECK:       _Z3foov$local:
; CHECK-NEXT:    .type _Z3foov$local,@function
; CHECK-NEXT:  ; %bb.0: ; %entry
; CHECK-NEXT:    s_mov_b32 s0, 20
; CHECK-NEXT:    scratch_load_u16 v0, off, s0
; CHECK-NEXT:    s_mov_b32 s0, 12
; CHECK-NEXT:    s_wait_loadcnt 0x0
; CHECK-NEXT:    scratch_store_b16 off, v0, s0
; CHECK-NEXT:    s_endpgm
entry:
  %1 = load <2 x i8>, ptr addrspace(10) getelementptr inbounds (i8, ptr addrspace(10) @vx, i32 20), align 4, !tbaa !4
  store <2 x i8> %1, ptr addrspace(10) getelementptr inbounds (i8, ptr addrspace(10) @vx, i32 12), align 4, !tbaa !4
  ret void
}

!llvm.module.flags = !{!0, !1, !2}

!0 = !{i32 1, !"amdhsa_code_object_version", i32 500}
!1 = !{i32 1, !"amdgpu_printf_kind", !"hostcall"}
!2 = !{i32 1, !"wchar_size", i32 4}
!4 = !{!5, !5, i64 0}
!5 = !{!"float", !6, i64 0}
!6 = !{!"omnipotent char", !7, i64 0}
!7 = !{!"Simple C++ TBAA"}
