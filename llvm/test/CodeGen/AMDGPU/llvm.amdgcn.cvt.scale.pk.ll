; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 4
; RUN: llc -global-isel=0 -mtriple=amdgcn -mcpu=gfx1210 -verify-machineinstrs < %s | FileCheck -check-prefixes=GFX1210,GFX1210-SDAG %s
; RUN: llc -global-isel=1 -mtriple=amdgcn -mcpu=gfx1210 -verify-machineinstrs < %s | FileCheck -check-prefixes=GFX1210,GFX1210-GISEL %s

declare <16 x half> @llvm.amdgcn.cvt.scale.pk.f16.fp6(<3 x i32> %src, float %scale)
declare <16 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.fp6(<3 x i32> %src, float %scale)
declare <16 x half> @llvm.amdgcn.cvt.scale.pk.f16.bf6(<3 x i32> %src, float %scale)
declare <16 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.bf6(<3 x i32> %src, float %scale)
declare <4 x half> @llvm.amdgcn.cvt.scale.pk.f16.fp8(i32 %src, float %scale)
declare <4 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.fp8(i32 %src, float %scale)
declare <4 x half> @llvm.amdgcn.cvt.scale.pk.f16.bf8(i32 %src, float %scale)
declare <4 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.bf8(i32 %src, float %scale)

define amdgpu_ps void @test_cvt_scale_pk_f16_fp6_vv(<3 x i32> %src, float %scale, ptr addrspace(1) %out) {
; GFX1210-SDAG-LABEL: test_cvt_scale_pk_f16_fp6_vv:
; GFX1210-SDAG:       ; %bb.0:
; GFX1210-SDAG-NEXT:    v_cvt_scale_pk_f16_fp6 v[6:13], v[0:2], v3
; GFX1210-SDAG-NEXT:    s_clause 0x1
; GFX1210-SDAG-NEXT:    global_store_b128 v[4:5], v[10:13], off offset:16
; GFX1210-SDAG-NEXT:    global_store_b128 v[4:5], v[6:9], off
; GFX1210-SDAG-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-SDAG-NEXT:    s_endpgm
;
; GFX1210-GISEL-LABEL: test_cvt_scale_pk_f16_fp6_vv:
; GFX1210-GISEL:       ; %bb.0:
; GFX1210-GISEL-NEXT:    v_cvt_scale_pk_f16_fp6 v[6:13], v[0:2], v3
; GFX1210-GISEL-NEXT:    s_clause 0x1
; GFX1210-GISEL-NEXT:    global_store_b128 v[4:5], v[6:9], off
; GFX1210-GISEL-NEXT:    global_store_b128 v[4:5], v[10:13], off offset:16
; GFX1210-GISEL-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-GISEL-NEXT:    s_endpgm
  %cvt = tail call <16 x half> @llvm.amdgcn.cvt.scale.pk.f16.fp6(<3 x i32> %src, float %scale)
  store <16 x half> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_f16_fp6_sl(<3 x i32> inreg %src, ptr addrspace(1) %out) {
; GFX1210-SDAG-LABEL: test_cvt_scale_pk_f16_fp6_sl:
; GFX1210-SDAG:       ; %bb.0:
; GFX1210-SDAG-NEXT:    v_dual_mov_b32 v2, s0 :: v_dual_mov_b32 v3, s1
; GFX1210-SDAG-NEXT:    v_mov_b32_e32 v4, s2
; GFX1210-SDAG-NEXT:    s_delay_alu instid0(VALU_DEP_1)
; GFX1210-SDAG-NEXT:    v_cvt_scale_pk_f16_fp6 v[2:9], v[2:4], 0x42c80000
; GFX1210-SDAG-NEXT:    s_clause 0x1
; GFX1210-SDAG-NEXT:    global_store_b128 v[0:1], v[6:9], off offset:16
; GFX1210-SDAG-NEXT:    global_store_b128 v[0:1], v[2:5], off
; GFX1210-SDAG-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-SDAG-NEXT:    s_endpgm
;
; GFX1210-GISEL-LABEL: test_cvt_scale_pk_f16_fp6_sl:
; GFX1210-GISEL:       ; %bb.0:
; GFX1210-GISEL-NEXT:    v_dual_mov_b32 v4, s2 :: v_dual_mov_b32 v3, s1
; GFX1210-GISEL-NEXT:    v_mov_b32_e32 v2, s0
; GFX1210-GISEL-NEXT:    s_delay_alu instid0(VALU_DEP_1)
; GFX1210-GISEL-NEXT:    v_cvt_scale_pk_f16_fp6 v[2:9], v[2:4], 0x42c80000
; GFX1210-GISEL-NEXT:    s_clause 0x1
; GFX1210-GISEL-NEXT:    global_store_b128 v[0:1], v[2:5], off
; GFX1210-GISEL-NEXT:    global_store_b128 v[0:1], v[6:9], off offset:16
; GFX1210-GISEL-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-GISEL-NEXT:    s_endpgm
  %cvt = tail call <16 x half> @llvm.amdgcn.cvt.scale.pk.f16.fp6(<3 x i32> %src, float 100.0)
  store <16 x half> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_bf16_fp6_vv(<3 x i32> %src, float %scale, ptr addrspace(1) %out) {
; GFX1210-SDAG-LABEL: test_cvt_scale_pk_bf16_fp6_vv:
; GFX1210-SDAG:       ; %bb.0:
; GFX1210-SDAG-NEXT:    v_cvt_scale_pk_bf16_fp6 v[6:13], v[0:2], v3
; GFX1210-SDAG-NEXT:    s_clause 0x1
; GFX1210-SDAG-NEXT:    global_store_b128 v[4:5], v[10:13], off offset:16
; GFX1210-SDAG-NEXT:    global_store_b128 v[4:5], v[6:9], off
; GFX1210-SDAG-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-SDAG-NEXT:    s_endpgm
;
; GFX1210-GISEL-LABEL: test_cvt_scale_pk_bf16_fp6_vv:
; GFX1210-GISEL:       ; %bb.0:
; GFX1210-GISEL-NEXT:    v_cvt_scale_pk_bf16_fp6 v[6:13], v[0:2], v3
; GFX1210-GISEL-NEXT:    s_clause 0x1
; GFX1210-GISEL-NEXT:    global_store_b128 v[4:5], v[6:9], off
; GFX1210-GISEL-NEXT:    global_store_b128 v[4:5], v[10:13], off offset:16
; GFX1210-GISEL-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-GISEL-NEXT:    s_endpgm
  %cvt = tail call <16 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.fp6(<3 x i32> %src, float %scale)
  store <16 x bfloat> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_bf16_fp6_sl(<3 x i32> inreg %src, ptr addrspace(1) %out) {
; GFX1210-SDAG-LABEL: test_cvt_scale_pk_bf16_fp6_sl:
; GFX1210-SDAG:       ; %bb.0:
; GFX1210-SDAG-NEXT:    v_dual_mov_b32 v2, s0 :: v_dual_mov_b32 v3, s1
; GFX1210-SDAG-NEXT:    v_mov_b32_e32 v4, s2
; GFX1210-SDAG-NEXT:    s_delay_alu instid0(VALU_DEP_1)
; GFX1210-SDAG-NEXT:    v_cvt_scale_pk_bf16_fp6 v[2:9], v[2:4], 0x42c80000
; GFX1210-SDAG-NEXT:    s_clause 0x1
; GFX1210-SDAG-NEXT:    global_store_b128 v[0:1], v[6:9], off offset:16
; GFX1210-SDAG-NEXT:    global_store_b128 v[0:1], v[2:5], off
; GFX1210-SDAG-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-SDAG-NEXT:    s_endpgm
;
; GFX1210-GISEL-LABEL: test_cvt_scale_pk_bf16_fp6_sl:
; GFX1210-GISEL:       ; %bb.0:
; GFX1210-GISEL-NEXT:    v_dual_mov_b32 v4, s2 :: v_dual_mov_b32 v3, s1
; GFX1210-GISEL-NEXT:    v_mov_b32_e32 v2, s0
; GFX1210-GISEL-NEXT:    s_delay_alu instid0(VALU_DEP_1)
; GFX1210-GISEL-NEXT:    v_cvt_scale_pk_bf16_fp6 v[2:9], v[2:4], 0x42c80000
; GFX1210-GISEL-NEXT:    s_clause 0x1
; GFX1210-GISEL-NEXT:    global_store_b128 v[0:1], v[2:5], off
; GFX1210-GISEL-NEXT:    global_store_b128 v[0:1], v[6:9], off offset:16
; GFX1210-GISEL-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-GISEL-NEXT:    s_endpgm
  %cvt = tail call <16 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.fp6(<3 x i32> %src, float 100.0)
  store <16 x bfloat> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_f16_bf6_vv(<3 x i32> %src, float %scale, ptr addrspace(1) %out) {
; GFX1210-SDAG-LABEL: test_cvt_scale_pk_f16_bf6_vv:
; GFX1210-SDAG:       ; %bb.0:
; GFX1210-SDAG-NEXT:    v_cvt_scale_pk_f16_bf6 v[6:13], v[0:2], v3
; GFX1210-SDAG-NEXT:    s_clause 0x1
; GFX1210-SDAG-NEXT:    global_store_b128 v[4:5], v[10:13], off offset:16
; GFX1210-SDAG-NEXT:    global_store_b128 v[4:5], v[6:9], off
; GFX1210-SDAG-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-SDAG-NEXT:    s_endpgm
;
; GFX1210-GISEL-LABEL: test_cvt_scale_pk_f16_bf6_vv:
; GFX1210-GISEL:       ; %bb.0:
; GFX1210-GISEL-NEXT:    v_cvt_scale_pk_f16_bf6 v[6:13], v[0:2], v3
; GFX1210-GISEL-NEXT:    s_clause 0x1
; GFX1210-GISEL-NEXT:    global_store_b128 v[4:5], v[6:9], off
; GFX1210-GISEL-NEXT:    global_store_b128 v[4:5], v[10:13], off offset:16
; GFX1210-GISEL-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-GISEL-NEXT:    s_endpgm
  %cvt = tail call <16 x half> @llvm.amdgcn.cvt.scale.pk.f16.bf6(<3 x i32> %src, float %scale)
  store <16 x half> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_f16_bf6_sl(<3 x i32> inreg %src, ptr addrspace(1) %out) {
; GFX1210-SDAG-LABEL: test_cvt_scale_pk_f16_bf6_sl:
; GFX1210-SDAG:       ; %bb.0:
; GFX1210-SDAG-NEXT:    v_dual_mov_b32 v2, s0 :: v_dual_mov_b32 v3, s1
; GFX1210-SDAG-NEXT:    v_mov_b32_e32 v4, s2
; GFX1210-SDAG-NEXT:    s_delay_alu instid0(VALU_DEP_1)
; GFX1210-SDAG-NEXT:    v_cvt_scale_pk_f16_bf6 v[2:9], v[2:4], 0x42c80000
; GFX1210-SDAG-NEXT:    s_clause 0x1
; GFX1210-SDAG-NEXT:    global_store_b128 v[0:1], v[6:9], off offset:16
; GFX1210-SDAG-NEXT:    global_store_b128 v[0:1], v[2:5], off
; GFX1210-SDAG-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-SDAG-NEXT:    s_endpgm
;
; GFX1210-GISEL-LABEL: test_cvt_scale_pk_f16_bf6_sl:
; GFX1210-GISEL:       ; %bb.0:
; GFX1210-GISEL-NEXT:    v_dual_mov_b32 v4, s2 :: v_dual_mov_b32 v3, s1
; GFX1210-GISEL-NEXT:    v_mov_b32_e32 v2, s0
; GFX1210-GISEL-NEXT:    s_delay_alu instid0(VALU_DEP_1)
; GFX1210-GISEL-NEXT:    v_cvt_scale_pk_f16_bf6 v[2:9], v[2:4], 0x42c80000
; GFX1210-GISEL-NEXT:    s_clause 0x1
; GFX1210-GISEL-NEXT:    global_store_b128 v[0:1], v[2:5], off
; GFX1210-GISEL-NEXT:    global_store_b128 v[0:1], v[6:9], off offset:16
; GFX1210-GISEL-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-GISEL-NEXT:    s_endpgm
  %cvt = tail call <16 x half> @llvm.amdgcn.cvt.scale.pk.f16.bf6(<3 x i32> %src, float 100.0)
  store <16 x half> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_bf16_bf6_vv(<3 x i32> %src, float %scale, ptr addrspace(1) %out) {
; GFX1210-SDAG-LABEL: test_cvt_scale_pk_bf16_bf6_vv:
; GFX1210-SDAG:       ; %bb.0:
; GFX1210-SDAG-NEXT:    v_cvt_scale_pk_bf16_bf6 v[6:13], v[0:2], v3
; GFX1210-SDAG-NEXT:    s_clause 0x1
; GFX1210-SDAG-NEXT:    global_store_b128 v[4:5], v[10:13], off offset:16
; GFX1210-SDAG-NEXT:    global_store_b128 v[4:5], v[6:9], off
; GFX1210-SDAG-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-SDAG-NEXT:    s_endpgm
;
; GFX1210-GISEL-LABEL: test_cvt_scale_pk_bf16_bf6_vv:
; GFX1210-GISEL:       ; %bb.0:
; GFX1210-GISEL-NEXT:    v_cvt_scale_pk_bf16_bf6 v[6:13], v[0:2], v3
; GFX1210-GISEL-NEXT:    s_clause 0x1
; GFX1210-GISEL-NEXT:    global_store_b128 v[4:5], v[6:9], off
; GFX1210-GISEL-NEXT:    global_store_b128 v[4:5], v[10:13], off offset:16
; GFX1210-GISEL-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-GISEL-NEXT:    s_endpgm
  %cvt = tail call <16 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.bf6(<3 x i32> %src, float %scale)
  store <16 x bfloat> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_bf16_bf6_sl(<3 x i32> inreg %src, ptr addrspace(1) %out) {
; GFX1210-SDAG-LABEL: test_cvt_scale_pk_bf16_bf6_sl:
; GFX1210-SDAG:       ; %bb.0:
; GFX1210-SDAG-NEXT:    v_dual_mov_b32 v2, s0 :: v_dual_mov_b32 v3, s1
; GFX1210-SDAG-NEXT:    v_mov_b32_e32 v4, s2
; GFX1210-SDAG-NEXT:    s_delay_alu instid0(VALU_DEP_1)
; GFX1210-SDAG-NEXT:    v_cvt_scale_pk_bf16_bf6 v[2:9], v[2:4], 0x42c80000
; GFX1210-SDAG-NEXT:    s_clause 0x1
; GFX1210-SDAG-NEXT:    global_store_b128 v[0:1], v[6:9], off offset:16
; GFX1210-SDAG-NEXT:    global_store_b128 v[0:1], v[2:5], off
; GFX1210-SDAG-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-SDAG-NEXT:    s_endpgm
;
; GFX1210-GISEL-LABEL: test_cvt_scale_pk_bf16_bf6_sl:
; GFX1210-GISEL:       ; %bb.0:
; GFX1210-GISEL-NEXT:    v_dual_mov_b32 v4, s2 :: v_dual_mov_b32 v3, s1
; GFX1210-GISEL-NEXT:    v_mov_b32_e32 v2, s0
; GFX1210-GISEL-NEXT:    s_delay_alu instid0(VALU_DEP_1)
; GFX1210-GISEL-NEXT:    v_cvt_scale_pk_bf16_bf6 v[2:9], v[2:4], 0x42c80000
; GFX1210-GISEL-NEXT:    s_clause 0x1
; GFX1210-GISEL-NEXT:    global_store_b128 v[0:1], v[2:5], off
; GFX1210-GISEL-NEXT:    global_store_b128 v[0:1], v[6:9], off offset:16
; GFX1210-GISEL-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-GISEL-NEXT:    s_endpgm
  %cvt = tail call <16 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.bf6(<3 x i32> %src, float 100.0)
  store <16 x bfloat> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_f16_fp8_vv(i32 %src, float %scale, ptr addrspace(1) %out) {
; GFX1210-LABEL: test_cvt_scale_pk_f16_fp8_vv:
; GFX1210:       ; %bb.0:
; GFX1210-NEXT:    v_cvt_scale_pk_f16_fp8 v[0:1], v0, v1
; GFX1210-NEXT:    global_store_b64 v[2:3], v[0:1], off
; GFX1210-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-NEXT:    s_endpgm
  %cvt = tail call <4 x half> @llvm.amdgcn.cvt.scale.pk.f16.fp8(i32 %src, float %scale)
  store <4 x half> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_f16_bf8_vv(i32 %src, float %scale, ptr addrspace(1) %out) {
; GFX1210-LABEL: test_cvt_scale_pk_f16_bf8_vv:
; GFX1210:       ; %bb.0:
; GFX1210-NEXT:    v_cvt_scale_pk_f16_bf8 v[0:1], v0, v1
; GFX1210-NEXT:    global_store_b64 v[2:3], v[0:1], off
; GFX1210-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-NEXT:    s_endpgm
  %cvt = tail call <4 x half> @llvm.amdgcn.cvt.scale.pk.f16.bf8(i32 %src, float %scale)
  store <4 x half> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_bf16_fp8_vv(i32 %src, float %scale, ptr addrspace(1) %out) {
; GFX1210-LABEL: test_cvt_scale_pk_bf16_fp8_vv:
; GFX1210:       ; %bb.0:
; GFX1210-NEXT:    v_cvt_scale_pk_bf16_fp8 v[0:1], v0, v1
; GFX1210-NEXT:    global_store_b64 v[2:3], v[0:1], off
; GFX1210-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-NEXT:    s_endpgm
  %cvt = tail call <4 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.fp8(i32 %src, float %scale)
  store <4 x bfloat> %cvt, ptr addrspace(1) %out, align 8
  ret void
}

define amdgpu_ps void @test_cvt_scale_pk_bf16_bf8_vv(i32 %src, float %scale, ptr addrspace(1) %out) {
; GFX1210-LABEL: test_cvt_scale_pk_bf16_bf8_vv:
; GFX1210:       ; %bb.0:
; GFX1210-NEXT:    v_cvt_scale_pk_bf16_bf8 v[0:1], v0, v1
; GFX1210-NEXT:    global_store_b64 v[2:3], v[0:1], off
; GFX1210-NEXT:    s_sendmsg sendmsg(MSG_DEALLOC_VGPRS)
; GFX1210-NEXT:    s_endpgm
  %cvt = tail call <4 x bfloat> @llvm.amdgcn.cvt.scale.pk.bf16.bf8(i32 %src, float %scale)
  store <4 x bfloat> %cvt, ptr addrspace(1) %out, align 8
  ret void
}
