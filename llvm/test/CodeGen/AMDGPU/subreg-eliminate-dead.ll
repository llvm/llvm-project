; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc -mtriple=amdgcn-- -mcpu=tahiti < %s | FileCheck %s
; LiveRangeEdit::eliminateDeadDef did not update LiveInterval sub ranges
; properly.

; Just make sure this test doesn't crash.
define amdgpu_kernel void @foobar() {
; CHECK-LABEL: foobar:
; CHECK:       ; %bb.0:
; CHECK-NEXT:    s_endpgm
  %v0 = icmp eq <4 x i32> poison, <i32 0, i32 1, i32 2, i32 3>
  %v3 = sext <4 x i1> %v0 to <4 x i32>
  %v4 = extractelement <4 x i32> %v3, i32 1
  %v5 = icmp ne i32 %v4, 0
  %undef = freeze i32 poison
  %v6 = select i1 %v5, i32 %undef, i32 0
  %v15 = insertelement <2 x i32> poison, i32 %v6, i32 1
  store <2 x i32> %v15, ptr addrspace(1) poison, align 8
  ret void
}

declare double @llvm.fma.f64(double, double, double)
