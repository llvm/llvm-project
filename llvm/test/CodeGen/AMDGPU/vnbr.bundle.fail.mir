# RUN: not --crash llc -march=amdgcn -mcpu=gfx1300 -verify-machineinstrs -run-pass=bundle-indexed-load-store -o /dev/null %s 2>&1 | FileCheck %s

# CHECK: LLVM ERROR: Failed to bundle instruction that must have laneshared
---
name:            v_send_vgpr_next
machineFunctionInfo:
  laneSharedVGPRSize: 1000
  stackPtrOffsetReg: '$sgpr32'
  frameOffsetReg: '$sgpr33'
tracksRegLiveness: true
body:             |

  bb.0:
    liveins: $vgpr0, $vgpr1, $vgpr2
    %2:vgpr_32 = COPY $vgpr2
    %1:vgpr_32 = COPY $vgpr1
    %0:vgpr_32 = COPY $vgpr0
    %3:sreg_32_xexec_hi = S_MOV_B32 0
    %4:vgpr_32, %5:vgpr_32 = V_SEND_VGPR_NEXT_B32 %2, 0, 0, 0, 0, 0, implicit $mode, implicit $exec
    V_STORE_IDX killed %4, %3, 0, implicit $exec :: (store (s32), addrspace 10)
    %20:vreg_64_align2 = REG_SEQUENCE %0:vgpr_32, %subreg.sub0, %1:vgpr_32, %subreg.sub1
    ; Block bundling STORE_IDX with V_SEND_VGPR_NEXT
    GLOBAL_STORE_DWORD %20:vreg_64_align2, %2, 16, 0, implicit $exec
    %6:sgpr_32 = S_MOV_B32 0
    V_STORE_IDX killed %5, %6, 1, implicit $exec :: (store (s32), addrspace 10)
    S_ENDPGM 0
...

