# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 4
# RUN: llc -global-isel -mtriple=amdgcn-mesa-amdpal -mcpu=gfx1010 -run-pass=amdgpu-global-isel-divergence-lowering -verify-machineinstrs %s -o - | FileCheck -check-prefix=GFX10 %s

---
name: temporal_divergent_i32
legalized: true
tracksRegLiveness: true
body: |
  ; GFX10-LABEL: name: temporal_divergent_i32
  ; GFX10: bb.0:
  ; GFX10-NEXT:   successors: %bb.1(0x80000000)
  ; GFX10-NEXT:   liveins: $vgpr0, $vgpr1, $vgpr2
  ; GFX10-NEXT: {{  $}}
  ; GFX10-NEXT:   [[COPY:%[0-9]+]]:_(i32) = COPY $vgpr0
  ; GFX10-NEXT:   [[COPY1:%[0-9]+]]:_(i32) = COPY $vgpr1
  ; GFX10-NEXT:   [[COPY2:%[0-9]+]]:_(i32) = COPY $vgpr2
  ; GFX10-NEXT:   [[MV:%[0-9]+]]:_(p0) = G_MERGE_VALUES [[COPY1]](i32), [[COPY2]](i32)
  ; GFX10-NEXT:   [[C:%[0-9]+]]:_(i32) = G_CONSTANT i32 0
  ; GFX10-NEXT:   [[C1:%[0-9]+]]:_(i32) = G_CONSTANT i32 -1
  ; GFX10-NEXT: {{  $}}
  ; GFX10-NEXT: bb.1:
  ; GFX10-NEXT:   successors: %bb.2(0x04000000), %bb.1(0x7c000000)
  ; GFX10-NEXT: {{  $}}
  ; GFX10-NEXT:   [[PHI:%[0-9]+]]:_(i32) = G_PHI %7(i32), %bb.1, [[C]](i32), %bb.0
  ; GFX10-NEXT:   [[PHI1:%[0-9]+]]:_(i32) = G_PHI [[C1]](i32), %bb.0, %9(i32), %bb.1
  ; GFX10-NEXT:   [[C2:%[0-9]+]]:_(i32) = G_CONSTANT i32 1
  ; GFX10-NEXT:   [[ADD:%[0-9]+]]:_(i32) = G_ADD [[PHI1]], [[C2]]
  ; GFX10-NEXT:   [[UITOFP:%[0-9]+]]:_(f32) = G_UITOFP [[ADD]](i32)
  ; GFX10-NEXT:   [[BITCAST:%[0-9]+]]:_(f32) = G_BITCAST [[COPY]](i32)
  ; GFX10-NEXT:   [[FCMP:%[0-9]+]]:_(i1) = G_FCMP floatpred(ogt), [[UITOFP]](f32), [[BITCAST]]
  ; GFX10-NEXT:   [[INT:%[0-9]+]]:sreg_32_xm0_xexec(i32) = G_INTRINSIC intrinsic(@llvm.amdgcn.if.break), [[FCMP]](i1), [[PHI]](i32)
  ; GFX10-NEXT:   SI_LOOP [[INT]](i32), %bb.1, implicit-def $exec, implicit-def $scc, implicit $exec
  ; GFX10-NEXT:   G_BR %bb.2
  ; GFX10-NEXT: {{  $}}
  ; GFX10-NEXT: bb.2:
  ; GFX10-NEXT:   [[PHI2:%[0-9]+]]:_(i32) = G_PHI [[ADD]](i32), %bb.1
  ; GFX10-NEXT:   [[PHI3:%[0-9]+]]:_(i32) = G_PHI [[INT]](i32), %bb.1
  ; GFX10-NEXT:   G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.end.cf), [[PHI3]](i32)
  ; GFX10-NEXT:   G_STORE [[PHI2]](i32), [[MV]](p0) :: (store (i32))
  ; GFX10-NEXT:   SI_RETURN
  bb.0:
    successors: %bb.1(0x80000000)
    liveins: $vgpr0, $vgpr1, $vgpr2

    %0:_(i32) = COPY $vgpr0
    %1:_(i32) = COPY $vgpr1
    %2:_(i32) = COPY $vgpr2
    %3:_(p0) = G_MERGE_VALUES %1(i32), %2(i32)
    %4:_(i32) = G_CONSTANT i32 0
    %5:_(i32) = G_CONSTANT i32 -1

  bb.1:
    successors: %bb.2(0x04000000), %bb.1(0x7c000000)

    %6:_(i32) = G_PHI %7(i32), %bb.1, %4(i32), %bb.0
    %8:_(i32) = G_PHI %5(i32), %bb.0, %9(i32), %bb.1
    %10:_(i32) = G_CONSTANT i32 1
    %9:_(i32) = G_ADD %8, %10
    %11:_(f32) = G_UITOFP %9(i32)
    %12:_(f32) = G_BITCAST %0(i32)
    %13:_(i1) = G_FCMP floatpred(ogt), %11(f32), %12
    %7:sreg_32_xm0_xexec(i32) = G_INTRINSIC intrinsic(@llvm.amdgcn.if.break), %13(i1), %6(i32)
    SI_LOOP %7(i32), %bb.1, implicit-def $exec, implicit-def $scc, implicit $exec
    G_BR %bb.2

  bb.2:
    %14:_(i32) = G_PHI %9(i32), %bb.1
    %15:_(i32) = G_PHI %7(i32), %bb.1
    G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.amdgcn.end.cf), %15(i32)
    G_STORE %14(i32), %3(p0) :: (store (i32))
    SI_RETURN




...
