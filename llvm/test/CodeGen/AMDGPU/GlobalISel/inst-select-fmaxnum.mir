# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
# RUN: llc -mtriple=amdgcn-amd-amdhsa -mcpu=hawaii -run-pass=instruction-select -verify-machineinstrs -o - %s  | FileCheck -check-prefix=GFX7 %s

# FIXME: Ideally this would fail to select with ieee mode enabled.
---

name: fmaxnum_f32_f64_ieee_mode_on
legalized:       true
regBankSelected: true
machineFunctionInfo:
  mode:
    ieee: true

body: |
  bb.0:
    liveins: $sgpr0, $vgpr0, $vgpr1, $vgpr3_vgpr4, $sgpr10_sgpr11, $vgpr10_vgpr11, $vgpr12_vgpr13
    ; GFX7-LABEL: name: fmaxnum_f32_f64_ieee_mode_on
    ; GFX7: liveins: $sgpr0, $vgpr0, $vgpr1, $vgpr3_vgpr4, $sgpr10_sgpr11, $vgpr10_vgpr11, $vgpr12_vgpr13
    ; GFX7-NEXT: {{  $}}
    ; GFX7-NEXT: [[COPY:%[0-9]+]]:sreg_32 = COPY $sgpr0
    ; GFX7-NEXT: [[COPY1:%[0-9]+]]:vgpr_32 = COPY $vgpr0
    ; GFX7-NEXT: [[COPY2:%[0-9]+]]:vgpr_32 = COPY $vgpr1
    ; GFX7-NEXT: [[COPY3:%[0-9]+]]:vreg_64 = COPY $vgpr3_vgpr4
    ; GFX7-NEXT: [[COPY4:%[0-9]+]]:sreg_64 = COPY $sgpr10_sgpr11
    ; GFX7-NEXT: [[COPY5:%[0-9]+]]:vreg_64 = COPY $vgpr10_vgpr11
    ; GFX7-NEXT: [[COPY6:%[0-9]+]]:vreg_64 = COPY $vgpr12_vgpr13
    ; GFX7-NEXT: [[V_MAX_F32_e64_:%[0-9]+]]:vgpr_32 = nofpexcept V_MAX_F32_e64 0, [[COPY1]], 0, [[COPY]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: [[V_MAX_F32_e64_1:%[0-9]+]]:vgpr_32 = nofpexcept V_MAX_F32_e64 0, [[COPY]], 0, [[COPY1]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: [[V_MAX_F32_e64_2:%[0-9]+]]:vgpr_32 = nofpexcept V_MAX_F32_e64 0, [[COPY1]], 0, [[COPY2]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: FLAT_STORE_DWORD [[COPY3]], [[V_MAX_F32_e64_]], 0, 0, implicit $exec, implicit $flat_scr :: (store (f32), addrspace 1)
    ; GFX7-NEXT: FLAT_STORE_DWORD [[COPY3]], [[V_MAX_F32_e64_1]], 0, 0, implicit $exec, implicit $flat_scr :: (store (f32), addrspace 1)
    ; GFX7-NEXT: FLAT_STORE_DWORD [[COPY3]], [[V_MAX_F32_e64_2]], 0, 0, implicit $exec, implicit $flat_scr :: (store (f32), addrspace 1)
    ; GFX7-NEXT: [[V_MAX_F64_e64_:%[0-9]+]]:vreg_64 = nofpexcept V_MAX_F64_e64 0, [[COPY4]], 0, [[COPY5]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: [[V_MAX_F64_e64_1:%[0-9]+]]:vreg_64 = nofpexcept V_MAX_F64_e64 0, [[COPY5]], 0, [[COPY4]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: [[V_MAX_F64_e64_2:%[0-9]+]]:vreg_64 = nofpexcept V_MAX_F64_e64 0, [[COPY5]], 0, [[COPY6]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: S_ENDPGM 0, implicit [[V_MAX_F64_e64_]], implicit [[V_MAX_F64_e64_1]], implicit [[V_MAX_F64_e64_2]]
    %0:sgpr(i32) = COPY $sgpr0
    %1:vgpr(i32) = COPY $vgpr0
    %2:vgpr(i32) = COPY $vgpr1
    %3:vgpr(p1) = COPY $vgpr3_vgpr4
    %4:sgpr(i64) = COPY $sgpr10_sgpr11
    %5:vgpr(i64) = COPY $vgpr10_vgpr11
    %6:vgpr(i64) = COPY $vgpr12_vgpr13
    %7:vgpr(f32) = G_BITCAST %1(i32)
    %8:sgpr(f32) = G_BITCAST %0(i32)
    %9:vgpr(f32) = G_FMAXNUM %7, %8
    %10:sgpr(f32) = G_BITCAST %0(i32)
    %11:vgpr(f32) = G_BITCAST %1(i32)
    %12:vgpr(f32) = G_FMAXNUM %10, %11
    %13:vgpr(f32) = G_BITCAST %1(i32)
    %14:vgpr(f32) = G_BITCAST %2(i32)
    %15:vgpr(f32) = G_FMAXNUM %13, %14
    G_STORE %9(f32), %3(p1) :: (store (f32), addrspace 1)
    G_STORE %12(f32), %3(p1) :: (store (f32), addrspace 1)
    G_STORE %15(f32), %3(p1) :: (store (f32), addrspace 1)
    %16:sgpr(f64) = G_BITCAST %4(i64)
    %17:vgpr(f64) = G_BITCAST %5(i64)
    %18:vgpr(f64) = G_FMAXNUM %16, %17
    %19:vgpr(f64) = G_BITCAST %5(i64)
    %20:sgpr(f64) = G_BITCAST %4(i64)
    %21:vgpr(f64) = G_FMAXNUM %19, %20
    %22:vgpr(f64) = G_BITCAST %5(i64)
    %23:vgpr(f64) = G_BITCAST %6(i64)
    %24:vgpr(f64) = G_FMAXNUM %22, %23
    %25:vgpr(i64) = G_BITCAST %18(f64)
    %26:vgpr(i64) = G_BITCAST %21(f64)
    %27:vgpr(i64) = G_BITCAST %24(f64)
    S_ENDPGM 0, implicit %25(i64), implicit %26(i64), implicit %27(i64)










...

---

name: fmaxnum_f32_f64_ieee_mode_off
legalized:       true
regBankSelected: true
machineFunctionInfo:
  mode:
    ieee: false

body: |
  bb.0:
    liveins: $sgpr0, $vgpr0, $vgpr1, $vgpr3_vgpr4, $sgpr10_sgpr11, $vgpr10_vgpr11, $vgpr12_vgpr13
    ; GFX7-LABEL: name: fmaxnum_f32_f64_ieee_mode_off
    ; GFX7: liveins: $sgpr0, $vgpr0, $vgpr1, $vgpr3_vgpr4, $sgpr10_sgpr11, $vgpr10_vgpr11, $vgpr12_vgpr13
    ; GFX7-NEXT: {{  $}}
    ; GFX7-NEXT: [[COPY:%[0-9]+]]:sreg_32 = COPY $sgpr0
    ; GFX7-NEXT: [[COPY1:%[0-9]+]]:vgpr_32 = COPY $vgpr0
    ; GFX7-NEXT: [[COPY2:%[0-9]+]]:vgpr_32 = COPY $vgpr1
    ; GFX7-NEXT: [[COPY3:%[0-9]+]]:vreg_64 = COPY $vgpr3_vgpr4
    ; GFX7-NEXT: [[COPY4:%[0-9]+]]:sreg_64 = COPY $sgpr10_sgpr11
    ; GFX7-NEXT: [[COPY5:%[0-9]+]]:vreg_64 = COPY $vgpr10_vgpr11
    ; GFX7-NEXT: [[COPY6:%[0-9]+]]:vreg_64 = COPY $vgpr12_vgpr13
    ; GFX7-NEXT: [[V_MAX_F32_e64_:%[0-9]+]]:vgpr_32 = nofpexcept V_MAX_F32_e64 0, [[COPY1]], 0, [[COPY]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: [[V_MAX_F32_e64_1:%[0-9]+]]:vgpr_32 = nofpexcept V_MAX_F32_e64 0, [[COPY]], 0, [[COPY1]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: [[V_MAX_F32_e64_2:%[0-9]+]]:vgpr_32 = nofpexcept V_MAX_F32_e64 0, [[COPY1]], 0, [[COPY2]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: FLAT_STORE_DWORD [[COPY3]], [[V_MAX_F32_e64_]], 0, 0, implicit $exec, implicit $flat_scr :: (store (f32), addrspace 1)
    ; GFX7-NEXT: FLAT_STORE_DWORD [[COPY3]], [[V_MAX_F32_e64_1]], 0, 0, implicit $exec, implicit $flat_scr :: (store (f32), addrspace 1)
    ; GFX7-NEXT: FLAT_STORE_DWORD [[COPY3]], [[V_MAX_F32_e64_2]], 0, 0, implicit $exec, implicit $flat_scr :: (store (f32), addrspace 1)
    ; GFX7-NEXT: [[V_MAX_F64_e64_:%[0-9]+]]:vreg_64 = nofpexcept V_MAX_F64_e64 0, [[COPY4]], 0, [[COPY5]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: [[V_MAX_F64_e64_1:%[0-9]+]]:vreg_64 = nofpexcept V_MAX_F64_e64 0, [[COPY5]], 0, [[COPY4]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: [[V_MAX_F64_e64_2:%[0-9]+]]:vreg_64 = nofpexcept V_MAX_F64_e64 0, [[COPY5]], 0, [[COPY6]], 0, 0, implicit $mode, implicit $exec
    ; GFX7-NEXT: S_ENDPGM 0, implicit [[V_MAX_F64_e64_]], implicit [[V_MAX_F64_e64_1]], implicit [[V_MAX_F64_e64_2]]
    %0:sgpr(i32) = COPY $sgpr0
    %1:vgpr(i32) = COPY $vgpr0
    %2:vgpr(i32) = COPY $vgpr1
    %3:vgpr(p1) = COPY $vgpr3_vgpr4
    %4:sgpr(i64) = COPY $sgpr10_sgpr11
    %5:vgpr(i64) = COPY $vgpr10_vgpr11
    %6:vgpr(i64) = COPY $vgpr12_vgpr13
    %7:vgpr(f32) = G_BITCAST %1(i32)
    %8:sgpr(f32) = G_BITCAST %0(i32)
    %9:vgpr(f32) = G_FMAXNUM %7, %8
    %10:sgpr(f32) = G_BITCAST %0(i32)
    %11:vgpr(f32) = G_BITCAST %1(i32)
    %12:vgpr(f32) = G_FMAXNUM %10, %11
    %13:vgpr(f32) = G_BITCAST %1(i32)
    %14:vgpr(f32) = G_BITCAST %2(i32)
    %15:vgpr(f32) = G_FMAXNUM %13, %14
    G_STORE %9(f32), %3(p1) :: (store (f32), addrspace 1)
    G_STORE %12(f32), %3(p1) :: (store (f32), addrspace 1)
    G_STORE %15(f32), %3(p1) :: (store (f32), addrspace 1)
    %16:sgpr(f64) = G_BITCAST %4(i64)
    %17:vgpr(f64) = G_BITCAST %5(i64)
    %18:vgpr(f64) = G_FMAXNUM %16, %17
    %19:vgpr(f64) = G_BITCAST %5(i64)
    %20:sgpr(f64) = G_BITCAST %4(i64)
    %21:vgpr(f64) = G_FMAXNUM %19, %20
    %22:vgpr(f64) = G_BITCAST %5(i64)
    %23:vgpr(f64) = G_BITCAST %6(i64)
    %24:vgpr(f64) = G_FMAXNUM %22, %23
    %25:vgpr(i64) = G_BITCAST %18(f64)
    %26:vgpr(i64) = G_BITCAST %21(f64)
    %27:vgpr(i64) = G_BITCAST %24(f64)
    S_ENDPGM 0, implicit %25(i64), implicit %26(i64), implicit %27(i64)










...
