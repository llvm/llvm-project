; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc -mtriple=amdgcn -mcpu=gfx1100 -verify-machineinstrs < %s | FileCheck %s -check-prefix GFX11

define float @fma_from_freeze_mul_add_left(float %x, float %y) {
; GFX11-LABEL: fma_from_freeze_mul_add_left:
; GFX11:       ; %bb.0: ; %bb
; GFX11-NEXT:    s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)
; GFX11-NEXT:    v_fma_f32 v0, v0, v1, 1.0
; GFX11-NEXT:    s_setpc_b64 s[30:31]
bb:
  %mul = fmul contract float %x, %y
  %mul.fr = freeze float %mul
  %add = fadd contract float %mul.fr, 1.000000e+00
  ret float %add
}

define float @fma_from_freeze_mul_add_right(float %x, float %y) {
; GFX11-LABEL: fma_from_freeze_mul_add_right:
; GFX11:       ; %bb.0: ; %bb
; GFX11-NEXT:    s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)
; GFX11-NEXT:    v_fma_f32 v0, v0, v1, 1.0
; GFX11-NEXT:    s_setpc_b64 s[30:31]
bb:
  %mul = fmul contract float %x, %y
  %mul.fr = freeze float %mul
  %add = fadd contract float 1.000000e+00, %mul.fr
  ret float %add
}

define float @fma_from_freeze_mul_sub_left(float %x, float %y) {
; GFX11-LABEL: fma_from_freeze_mul_sub_left:
; GFX11:       ; %bb.0: ; %bb
; GFX11-NEXT:    s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)
; GFX11-NEXT:    v_fma_f32 v0, v0, v1, -1.0
; GFX11-NEXT:    s_setpc_b64 s[30:31]
bb:
  %mul = fmul contract float %x, %y
  %mul.fr = freeze float %mul
  %sub = fsub contract float %mul.fr, 1.000000e+00
  ret float %sub
}

define float @fma_from_freeze_mul_sub_right(float %x, float %y) {
; GFX11-LABEL: fma_from_freeze_mul_sub_right:
; GFX11:       ; %bb.0: ; %bb
; GFX11-NEXT:    s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)
; GFX11-NEXT:    v_fma_f32 v0, -v0, v1, 1.0
; GFX11-NEXT:    s_setpc_b64 s[30:31]
bb:
  %mul = fmul contract float %x, %y
  %mul.fr = freeze float %mul
  %sub = fsub contract float 1.000000e+00, %mul.fr
  ret float %sub
}
