; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc -march=amdgcn -mcpu=gfx900 -verify-machineinstrs < %s | FileCheck -check-prefix=GCN %s

declare i32 @llvm.amdgcn.workitem.id.x()


define amdgpu_kernel void @test_isel_single_lane(ptr addrspace(1) %in, ptr addrspace(1) %out) #0 {
; GCN-LABEL: test_isel_single_lane:
; GCN:       ; %bb.0:
; GCN-NEXT:    s_load_dwordx4 s[0:3], s[4:5], 0x24
; GCN-NEXT:    v_mov_b32_e32 v0, 0
; GCN-NEXT:    s_waitcnt lgkmcnt(0)
; GCN-NEXT:    s_load_dword s0, s[0:1], 0x58
; GCN-NEXT:    s_waitcnt lgkmcnt(0)
; GCN-NEXT:    s_lshl_b32 s0, s0, 4
; GCN-NEXT:    v_mov_b32_e32 v1, s0
; GCN-NEXT:    global_store_dword v0, v1, s[2:3]
; GCN-NEXT:    s_endpgm
	%tid = call i32 @llvm.amdgcn.workitem.id.x()
	%gep = getelementptr i32, ptr addrspace(1) %in, i32 22
	%val = load i32, ptr addrspace(1) %gep, align 4
	%res0 = add i32 %val, %tid
	%res1 = shl i32 %res0, 4
	store i32 %res1, ptr addrspace(1) %out
	ret void
}

attributes #0 = {
  "amdgpu-flat-work-group-size"="1,1"
  "amdgpu-waves-per-eu"="1,1"
  "uniform-work-group-size"="true"
}
