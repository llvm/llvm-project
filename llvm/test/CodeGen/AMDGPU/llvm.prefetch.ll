; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -march=amdgcn -mcpu=gfx1200 -verify-machineinstrs < %s | FileCheck --check-prefixes=GCN,GFX12-SDAG %s
; RUN: llc -march=amdgcn -mcpu=gfx1100 -verify-machineinstrs < %s | FileCheck --check-prefixes=GCN,GFX11 %s
; RUN: llc -global-isel -march=amdgcn -mcpu=gfx1200 -verify-machineinstrs < %s | FileCheck --check-prefixes=GCN,GFX12-GISEL %s
; RUN: llc -global-isel -march=amdgcn -mcpu=gfx1100 -verify-machineinstrs < %s | FileCheck --check-prefixes=GCN,GFX11 %s

; Scalar data prefetch

define amdgpu_ps void @prefetch_data_sgpr(float addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_data_sgpr:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data s[0:1], 0x0, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_sgpr:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_sgpr:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.p4f(float addrspace(4)* %ptr, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_sgpr_offset(float addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_data_sgpr_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data s[0:1], 0x200, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_sgpr_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_sgpr_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr float, float addrspace(4)* %ptr, i32 128
  tail call void @llvm.prefetch.p4f(float addrspace(4)* %gep, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_pc_rel() {
; GFX12-SDAG-LABEL: prefetch_data_pc_rel:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data_pc_rel 0x0, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_pc_rel:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_pc_rel:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.p4f(float addrspace(4)* null, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_pc_rel_offset() {
; GFX12-SDAG-LABEL: prefetch_data_pc_rel_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data_pc_rel 0x200, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_pc_rel_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_pc_rel_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr float, float addrspace(4)* null, i32 128
  tail call void @llvm.prefetch.p4f(float addrspace(4)* %gep, i32 0, i32 0, i32 1)
  ret void
}

; Check large offsets

define amdgpu_ps void @prefetch_data_sgpr_max_offset(i8 addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_data_sgpr_max_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data s[0:1], 0x7fffff, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_sgpr_max_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_sgpr_max_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* %ptr, i32 8388607
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_sgpr_min_offset(i8 addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_data_sgpr_min_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data s[0:1], -0x800000, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_sgpr_min_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_sgpr_min_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* %ptr, i32 -8388608
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_sgpr_too_large_offset(i8 addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_data_sgpr_too_large_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_add_u32 s0, s0, 0x800000
; GFX12-SDAG-NEXT:    s_addc_u32 s1, s1, 0
; GFX12-SDAG-NEXT:    s_prefetch_data s[0:1], 0x0, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_sgpr_too_large_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_sgpr_too_large_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* %ptr, i32 8388608
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_pc_rel_max_offset() {
; GFX12-SDAG-LABEL: prefetch_data_pc_rel_max_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data_pc_rel 0x7fffff, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_pc_rel_max_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_pc_rel_max_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* null, i32 8388607
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_pc_rel_min_offset() {
; GFX12-SDAG-LABEL: prefetch_data_pc_rel_min_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data_pc_rel -0x800000, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_pc_rel_min_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_pc_rel_min_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* null, i32 -8388608
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_pc_rel_too_large_offset() {
; GFX12-SDAG-LABEL: prefetch_data_pc_rel_too_large_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_getpc_b64 s[0:1]
; GFX12-SDAG-NEXT:    s_delay_alu instid0(SALU_CYCLE_1)
; GFX12-SDAG-NEXT:    s_add_u32 s0, s0, 0x800000
; GFX12-SDAG-NEXT:    s_addc_u32 s1, s1, 0
; GFX12-SDAG-NEXT:    s_prefetch_data s[0:1], 0x14, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_pc_rel_too_large_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_pc_rel_too_large_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* null, i32 8388608
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 1)
  ret void
}

; Check divergent address

define amdgpu_ps void @prefetch_data_vgpr(float addrspace(1)* %ptr) {
; GCN-LABEL: prefetch_data_vgpr:
; GCN:       ; %bb.0: ; %entry
; GCN-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.p1f(float addrspace(1)* %ptr, i32 0, i32 0, i32 1)
  ret void
}

; Check LDS and Scratch, we cannot prefetch it

define amdgpu_ps void @prefetch_data_lds(float addrspace(3)* inreg %ptr) {
; GCN-LABEL: prefetch_data_lds:
; GCN:       ; %bb.0: ; %entry
; GCN-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.p3f(float addrspace(3)* %ptr, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_scratch(float addrspace(5)* inreg %ptr) {
; GCN-LABEL: prefetch_data_scratch:
; GCN:       ; %bb.0: ; %entry
; GCN-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.p5f(float addrspace(5)* %ptr, i32 0, i32 0, i32 1)
  ret void
}

; Check supported address spaces

define amdgpu_ps void @prefetch_data_sgpr_flat(float* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_data_sgpr_flat:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data s[0:1], 0x0, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_sgpr_flat:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_sgpr_flat:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.pf(float* %ptr, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_sgpr_global(float addrspace(1)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_data_sgpr_global:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_data s[0:1], 0x0, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_sgpr_global:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_sgpr_global:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.p1f(float addrspace(1)* %ptr, i32 0, i32 0, i32 1)
  ret void
}

define amdgpu_ps void @prefetch_data_sgpr_constant_32bit(float addrspace(6)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_data_sgpr_constant_32bit:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_mov_b32 s1, 0
; GFX12-SDAG-NEXT:    s_prefetch_data s[0:1], 0x0, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_data_sgpr_constant_32bit:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_data_sgpr_constant_32bit:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.p6f(float addrspace(6)* %ptr, i32 0, i32 0, i32 1)
  ret void
}

; I$ prefetch

define amdgpu_ps void @prefetch_inst_sgpr(i8 addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_inst_sgpr:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_inst s[0:1], 0x0, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_sgpr:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_sgpr:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %ptr, i32 0, i32 0, i32 0)
  ret void
}

define amdgpu_ps void @prefetch_inst_sgpr_offset(i8 addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_inst_sgpr_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_inst s[0:1], 0x80, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_sgpr_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_sgpr_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* %ptr, i32 128
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 0)
  ret void
}

define amdgpu_ps void @prefetch_inst_pc_rel() {
; GFX12-SDAG-LABEL: prefetch_inst_pc_rel:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_inst_pc_rel 0x0, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_pc_rel:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_pc_rel:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* null, i32 0, i32 0, i32 0)
  ret void
}

define amdgpu_ps void @prefetch_inst_pc_rel_offset() {
; GFX12-SDAG-LABEL: prefetch_inst_pc_rel_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_inst_pc_rel 0x80, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_pc_rel_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_pc_rel_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* null, i32 128
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 0)
  ret void
}

; Check large offsets

define amdgpu_ps void @prefetch_inst_sgpr_max_offset(i8 addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_inst_sgpr_max_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_inst s[0:1], 0x7fffff, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_sgpr_max_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_sgpr_max_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* %ptr, i32 8388607
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 0)
  ret void
}

define amdgpu_ps void @prefetch_inst_sgpr_min_offset(i8 addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_inst_sgpr_min_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_inst s[0:1], -0x800000, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_sgpr_min_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_sgpr_min_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* %ptr, i32 -8388608
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 0)
  ret void
}

define amdgpu_ps void @prefetch_inst_sgpr_too_large_offset(i8 addrspace(4)* inreg %ptr) {
; GFX12-SDAG-LABEL: prefetch_inst_sgpr_too_large_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_add_u32 s0, s0, 0x800000
; GFX12-SDAG-NEXT:    s_addc_u32 s1, s1, 0
; GFX12-SDAG-NEXT:    s_prefetch_inst s[0:1], 0x0, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_sgpr_too_large_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_sgpr_too_large_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* %ptr, i32 8388608
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 0)
  ret void
}

define amdgpu_ps void @prefetch_inst_pc_rel_max_offset() {
; GFX12-SDAG-LABEL: prefetch_inst_pc_rel_max_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_inst_pc_rel 0x7fffff, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_pc_rel_max_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_pc_rel_max_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* null, i32 8388607
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 0)
  ret void
}

define amdgpu_ps void @prefetch_inst_pc_rel_min_offset() {
; GFX12-SDAG-LABEL: prefetch_inst_pc_rel_min_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_prefetch_inst_pc_rel -0x800000, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_pc_rel_min_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_pc_rel_min_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* null, i32 -8388608
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 0)
  ret void
}

define amdgpu_ps void @prefetch_inst_pc_rel_too_large_offset() {
; GFX12-SDAG-LABEL: prefetch_inst_pc_rel_too_large_offset:
; GFX12-SDAG:       ; %bb.0: ; %entry
; GFX12-SDAG-NEXT:    s_getpc_b64 s[0:1]
; GFX12-SDAG-NEXT:    s_delay_alu instid0(SALU_CYCLE_1)
; GFX12-SDAG-NEXT:    s_add_u32 s0, s0, 0x800000
; GFX12-SDAG-NEXT:    s_addc_u32 s1, s1, 0
; GFX12-SDAG-NEXT:    s_prefetch_inst s[0:1], 0x14, null, 0
; GFX12-SDAG-NEXT:    s_endpgm
;
; GFX11-LABEL: prefetch_inst_pc_rel_too_large_offset:
; GFX11:       ; %bb.0: ; %entry
; GFX11-NEXT:    s_endpgm
;
; GFX12-GISEL-LABEL: prefetch_inst_pc_rel_too_large_offset:
; GFX12-GISEL:       ; %bb.0: ; %entry
; GFX12-GISEL-NEXT:    s_endpgm
entry:
  %gep = getelementptr i8, i8 addrspace(4)* null, i32 8388608
  tail call void @llvm.prefetch.p4c(i8 addrspace(4)* %gep, i32 0, i32 0, i32 0)
  ret void
}

declare void @llvm.prefetch.pf(float* nocapture readonly, i32, i32, i32)
declare void @llvm.prefetch.p1f(float addrspace(1)* nocapture readonly, i32, i32, i32)
declare void @llvm.prefetch.p3f(float addrspace(3)* nocapture readonly, i32, i32, i32)
declare void @llvm.prefetch.p4f(float addrspace(4)* nocapture readonly, i32, i32, i32)
declare void @llvm.prefetch.p5f(float addrspace(5)* nocapture readonly, i32, i32, i32)
declare void @llvm.prefetch.p6f(float addrspace(6)* nocapture readonly, i32, i32, i32)
declare void @llvm.prefetch.p4c(i8 addrspace(4)* nocapture readonly, i32, i32, i32)
