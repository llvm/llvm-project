# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 4
# RUN:  llc -march=amdgcn -mcpu=gfx900 %s -o - -run-pass machine-cp -verify-machineinstrs | FileCheck %s

# The MachineCopyPropagation Pass should not treat the subsequent
# instruction "$sgpr2_sgpr3 = COPY $sgpr6_sgpr7" as a NopCopy.
# For detailed information, please refer to issue 73512.
---
name:            foo
body:             |
  bb.0.entry:
    liveins: $sgpr4_sgpr5, $sgpr6_sgpr7

    ; CHECK-LABEL: name: foo
    ; CHECK: liveins: $sgpr4_sgpr5, $sgpr6_sgpr7
    ; CHECK-NEXT: {{  $}}
    ; CHECK-NEXT: $sgpr2_sgpr3 = COPY $sgpr6_sgpr7
    ; CHECK-NEXT: S_NOP 0, implicit-def $sgpr0
    ; CHECK-NEXT: $sgpr2_sgpr3 = COPY $sgpr6_sgpr7
    ; CHECK-NEXT: S_NOP 0, implicit $sgpr2_sgpr3
    $sgpr2_sgpr3 = COPY $sgpr6_sgpr7
    $sgpr0 = COPY $sgpr3
    S_NOP 0, implicit-def $sgpr0
    $sgpr3 = COPY killed $sgpr5
    $sgpr2_sgpr3 = COPY $sgpr6_sgpr7
    S_NOP 0, implicit $sgpr2_sgpr3
...
