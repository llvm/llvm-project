# NOTE: Multi-block next-use distance calculation test
# RUN: llc -mtriple=amdgcn -mcpu=gfx900 -run-pass=amdgpu-next-use -debug-only=amdgpu-next-use %s -o /dev/null 2>&1 | FileCheck %s

---
name:            multiblock_distances
alignment:       1
tracksRegLiveness: true
registers:
  - { id: 0, class: vgpr_32 }
  - { id: 1, class: vgpr_32 }
  - { id: 2, class: vgpr_32 }
  - { id: 3, class: sreg_32 }
body: |
  bb.0:
    %0:vgpr_32 = V_MOV_B32_e32 42, implicit $exec
    %3:sreg_32 = S_MOV_B32 1
    S_CMP_EQ_U32 %3, 0, implicit-def $scc
    S_CBRANCH_SCC1 %bb.2, implicit $scc
    S_BRANCH %bb.1

  bb.1:
    %1:vgpr_32 = V_ADD_F32_e32 %0, %0, implicit $exec, implicit $mode
    S_BRANCH %bb.2

  bb.2:
    %2:vgpr_32 = V_MOV_B32_e32 %0, implicit $exec
    S_ENDPGM 0

# CHECK: === NextUseAnalysis Results for multiblock_distances ===

# Check that we get analysis for all blocks
# CHECK: --- MBB_0 ---
# CHECK: --- MBB_1 ---  
# CHECK: --- MBB_2 ---

# CHECK: === End NextUseAnalysis Results ===
...
