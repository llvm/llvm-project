# RUN: llc -mtriple=amdgcn -mcpu=gfx900 -run-pass machine-scheduler %s -o - | FileCheck -check-prefix=GCN %s
# RUN: llc -mtriple=amdgcn -mcpu=gfx900 -passes=machine-scheduler %s -o - | FileCheck -check-prefix=GCN %s

# GCN-LABEL: name: cluster_flat_loads
# GCN:      FLAT_LOAD_DWORD %0, 0
# GCN-NEXT: FLAT_LOAD_DWORD %0, 4
# GCN-NEXT: V_ADD_F32_e64
name: cluster_flat_loads
tracksRegLiveness: true
body:             |
  bb.0:
    %0:vreg_64 = IMPLICIT_DEF
    %1:vgpr_32 = FLAT_LOAD_DWORD %0:vreg_64, 0, 0, implicit $exec, implicit $flat_scr :: (load (s32))
    %2:vgpr_32 = V_ADD_F32_e64 0, killed %1:vgpr_32, 0, 1, 0, 0, implicit $mode, implicit $exec
    %3:vgpr_32 = FLAT_LOAD_DWORD %0:vreg_64, 4, 0, implicit $exec, implicit $flat_scr :: (load (s32))
...
---
# GCN-LABEL: name: cluster_flat_loads_iglp_opt
# GCN:      FLAT_LOAD_DWORD %0, 0
# GCN-NEXT: FLAT_LOAD_DWORD %0, 4
# GCN-NEXT: V_ADD_F32_e64
name: cluster_flat_loads_iglp_opt
tracksRegLiveness: true
body:             |
  bb.0:
    %0:vreg_64 = IMPLICIT_DEF
    %1:vgpr_32 = FLAT_LOAD_DWORD %0:vreg_64, 0, 0, implicit $exec, implicit $flat_scr :: (load (s32))
    %2:vgpr_32 = V_ADD_F32_e64 0, killed %1:vgpr_32, 0, 1, 0, 0, implicit $mode, implicit $exec
    %3:vgpr_32 = FLAT_LOAD_DWORD %0:vreg_64, 4, 0, implicit $exec, implicit $flat_scr :: (load (s32))
    IGLP_OPT 2
...
