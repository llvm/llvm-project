; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc -global-isel=0 -march=amdgcn -mcpu=gfx1300 -verify-machineinstrs < %s | FileCheck -check-prefixes=GFX13 %s
; RUN: llc -global-isel=1 -march=amdgcn -mcpu=gfx1300 -verify-machineinstrs < %s | FileCheck -check-prefixes=GFX13 %s

define amdgpu_cs  void @test_rts_read_result(){
; GFX13-LABEL: test_rts_read_result:
; GFX13:       ; %bb.0:
; GFX13-NEXT:    rts_read_result_all_stop v[0:1]
; GFX13-NEXT:    rts_read_result_ongoing v[2:3]
; GFX13-NEXT:    s_wait_loadcnt 0x0
; GFX13-NEXT:    export prim v0, off, off, off done
; GFX13-NEXT:    s_endpgm
  %ret1 = call i64 @llvm.amdgcn.rts.read.result.all.stop()
  %ret2 = call i64 @llvm.amdgcn.rts.read.result.ongoing()
  %vdst1.v2i32 = bitcast i64 %ret1 to <2 x i32>
  %vdst1.lo = extractelement <2 x i32> %vdst1.v2i32, i32 0
  %vdst1.hi = extractelement <2 x i32> %vdst1.v2i32, i32 1
  %vdst2.v2i32 = bitcast i64 %ret2 to <2 x i32>
  %vdst2.lo = extractelement <2 x i32> %vdst2.v2i32, i32 0
  %vdst2.hi = extractelement <2 x i32> %vdst2.v2i32, i32 1
  call void @llvm.amdgcn.exp.i32(i32 20, i32 1, i32 %vdst1.lo, i32 %vdst1.hi, i32 %vdst2.lo, i32 %vdst2.hi, i1 true, i1 false)
  ret void
}

define amdgpu_cs void @test_rts_flush(){
; GFX13-LABEL: test_rts_flush:
; GFX13:       ; %bb.0:
; GFX13-NEXT:    global_wb scope:SCOPE_SYS
; GFX13-NEXT:    rts_flush scope:SCOPE_SYS
; GFX13-NEXT:    global_inv scope:SCOPE_SYS
; GFX13-NEXT:    s_endpgm
  call void @llvm.amdgcn.rts.flush()
  ret void
}

define amdgpu_cs void @test_rts_restore(i32 %arg){
; GFX13-LABEL: test_rts_restore:
; GFX13:       ; %bb.0:
; GFX13-NEXT:    rts_ray_restore v0
; GFX13-NEXT:    s_endpgm
  call void @llvm.amdgcn.rts.ray.restore(i32 %arg)
  ret void
}

define amdgpu_cs void @test_rts_save(){
; GFX13-LABEL: test_rts_save:
; GFX13:       ; %bb.0:
; GFX13-NEXT:    rts_ray_save v0
; GFX13-NEXT:    s_wait_loadcnt 0x0
; GFX13-NEXT:    export prim v0, off, off, off done
; GFX13-NEXT:    s_endpgm
  %ret_two = call i32 @llvm.amdgcn.rts.ray.save()
  call void @llvm.amdgcn.exp.i32(i32 20, i32 1, i32 %ret_two, i32 undef, i32 undef, i32 undef, i1 true, i1 false)
  ret void
}

define amdgpu_cs void @test_rts_update_ray(i64 %arg){
; GFX13-LABEL: test_rts_update_ray:
; GFX13:       ; %bb.0:
; GFX13-NEXT:    rts_update_ray v0, v[0:1]
; GFX13-NEXT:    s_wait_loadcnt 0x0
; GFX13-NEXT:    export prim v0, off, off, off done
; GFX13-NEXT:    s_endpgm
  %ret = call i32 @llvm.amdgcn.rts.update.ray(i64 %arg)
  call void @llvm.amdgcn.exp.i32(i32 20, i32 1, i32 %ret, i32 undef, i32 undef, i32 undef, i1 true, i1 false)
  ret void
}
