; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 6
; RUN: llc -mtriple=amdgcn-amd-amdhsa -mcpu=gfx900 < %s | FileCheck -check-prefix=GCN %s

; Test that size-aware stack slot coloring (best-fit, size ordering) reduces
; ScratchSize. With 36 VGPRs we get 256 bytes; baseline (first-fit)
; would use 280.

define amdgpu_kernel void @spill_multiple_slots_size_aware(ptr addrspace(1) %p) #0 {
; GCN-LABEL: spill_multiple_slots_size_aware:
; GCN:       ; %bb.0:
; GCN-NEXT:    s_mov_b64 s[22:23], s[2:3]
; GCN-NEXT:    s_mov_b64 s[20:21], s[0:1]
; GCN-NEXT:    s_load_dwordx2 s[0:1], s[8:9], 0x0
; GCN-NEXT:    v_lshlrev_b32_e32 v23, 6, v0
; GCN-NEXT:    s_add_u32 s20, s20, s17
; GCN-NEXT:    s_addc_u32 s21, s21, 0
; GCN-NEXT:    s_waitcnt lgkmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[0:3], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[4:7], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[8:11], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[13:16], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[24:27], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[19:22], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[28:31], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[32:35], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v0, v0, v24
; GCN-NEXT:    v_add_f32_e32 v4, v4, v19
; GCN-NEXT:    v_add_f32_e32 v8, v8, v28
; GCN-NEXT:    v_add_f32_e32 v12, v13, v32
; GCN-NEXT:    buffer_store_dword v12, off, s[20:23], 0 offset:16 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v12, v14, v33
; GCN-NEXT:    buffer_store_dword v8, off, s[20:23], 0 offset:32 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v8, v9, v29
; GCN-NEXT:    buffer_store_dword v12, off, s[20:23], 0 offset:20 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v12, v15, v34
; GCN-NEXT:    buffer_store_dword v8, off, s[20:23], 0 offset:40 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v8, v10, v30
; GCN-NEXT:    buffer_store_dword v12, off, s[20:23], 0 offset:24 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v12, v16, v35
; GCN-NEXT:    buffer_store_dword v8, off, s[20:23], 0 offset:48 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v8, v11, v31
; GCN-NEXT:    buffer_store_dword v12, off, s[20:23], 0 offset:28 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_store_dword v8, off, s[20:23], 0 offset:52 ; 4-byte Folded Spill
; GCN-NEXT:    global_load_dwordx4 v[32:35], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    buffer_store_dword v4, off, s[20:23], 0 offset:76 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v4, v5, v20
; GCN-NEXT:    buffer_store_dword v4, off, s[20:23], 0 offset:84 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v4, v6, v21
; GCN-NEXT:    buffer_store_dword v4, off, s[20:23], 0 offset:108 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v4, v7, v22
; GCN-NEXT:    buffer_store_dword v4, off, s[20:23], 0 offset:116 ; 4-byte Folded Spill
; GCN-NEXT:    global_load_dwordx4 v[28:31], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:132 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v1, v25
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:144 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v2, v26
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:248 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v3, v27
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:240 ; 4-byte Folded Spill
; GCN-NEXT:    global_load_dwordx4 v[24:27], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[4:7], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[19:22], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[12:15], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[8:11], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[0:3], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v35, v35, v22
; GCN-NEXT:    v_add_f32_e32 v0, v4, v0
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:36 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v5, v1
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:44 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v6, v2
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:56 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v7, v3
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:60 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v24, v8
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:68 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v25, v9
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:80 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v26, v10
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:92 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v27, v11
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:100 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v28, v12
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:120 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v29, v13
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:136 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v30, v14
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:156 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v31, v15
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:164 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v32, v19
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:176 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v33, v20
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:188 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v34, v21
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:244 ; 4-byte Folded Spill
; GCN-NEXT:    global_load_dwordx4 v[0:3], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 ; 4-byte Folded Spill
; GCN-NEXT:    s_nop 0
; GCN-NEXT:    buffer_store_dword v1, off, s[20:23], 0 offset:4 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_store_dword v2, off, s[20:23], 0 offset:8 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_store_dword v3, off, s[20:23], 0 offset:12 ; 4-byte Folded Spill
; GCN-NEXT:    global_load_dwordx4 v[24:27], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[12:15], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[19:22], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[30:33], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[8:11], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[4:7], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[0:3], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v0, v19, v0
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:64 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v20, v1
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:72 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v21, v2
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:88 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v22, v3
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:96 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v12, v4
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:112 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v13, v5
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:128 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v14, v6
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:152 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v15, v7
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:160 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v24, v8
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:172 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v25, v9
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:184 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v26, v10
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:204 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v27, v11
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:208 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_load_dword v0, off, s[20:23], 0 ; 4-byte Folded Reload
; GCN-NEXT:    s_nop 0
; GCN-NEXT:    buffer_load_dword v1, off, s[20:23], 0 offset:4 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v2, off, s[20:23], 0 offset:8 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v3, off, s[20:23], 0 offset:12 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(3)
; GCN-NEXT:    v_add_f32_e32 v0, v0, v30
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:216 ; 4-byte Folded Spill
; GCN-NEXT:    s_waitcnt vmcnt(3)
; GCN-NEXT:    v_add_f32_e32 v0, v1, v31
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:224 ; 4-byte Folded Spill
; GCN-NEXT:    s_waitcnt vmcnt(3)
; GCN-NEXT:    v_add_f32_e32 v29, v2, v32
; GCN-NEXT:    s_waitcnt vmcnt(2)
; GCN-NEXT:    v_add_f32_e32 v28, v3, v33
; GCN-NEXT:    global_load_dwordx4 v[0:3], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 ; 4-byte Folded Spill
; GCN-NEXT:    s_nop 0
; GCN-NEXT:    buffer_store_dword v1, off, s[20:23], 0 offset:4 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_store_dword v2, off, s[20:23], 0 offset:8 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_store_dword v3, off, s[20:23], 0 offset:12 ; 4-byte Folded Spill
; GCN-NEXT:    global_load_dwordx4 v[19:22], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[10:13], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[30:33], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[24:27], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[14:17], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[4:7], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[0:3], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v0, v30, v0
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:104 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v31, v1
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:124 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v32, v2
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:140 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v33, v3
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:148 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v10, v4
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:168 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v11, v5
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:180 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v12, v6
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:196 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v13, v7
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:200 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v19, v14
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:212 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v20, v15
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:220 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v21, v16
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:228 ; 4-byte Folded Spill
; GCN-NEXT:    v_add_f32_e32 v0, v22, v17
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:232 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_load_dword v0, off, s[20:23], 0 ; 4-byte Folded Reload
; GCN-NEXT:    s_nop 0
; GCN-NEXT:    buffer_load_dword v1, off, s[20:23], 0 offset:4 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v2, off, s[20:23], 0 offset:8 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v3, off, s[20:23], 0 offset:12 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(3)
; GCN-NEXT:    v_add_f32_e32 v0, v0, v24
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:236 ; 4-byte Folded Spill
; GCN-NEXT:    s_waitcnt vmcnt(3)
; GCN-NEXT:    v_add_f32_e32 v22, v1, v25
; GCN-NEXT:    s_waitcnt vmcnt(2)
; GCN-NEXT:    v_add_f32_e32 v13, v2, v26
; GCN-NEXT:    s_waitcnt vmcnt(1)
; GCN-NEXT:    v_add_f32_e32 v12, v3, v27
; GCN-NEXT:    global_load_dwordx4 v[0:3], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 ; 4-byte Folded Spill
; GCN-NEXT:    s_nop 0
; GCN-NEXT:    buffer_store_dword v1, off, s[20:23], 0 offset:4 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_store_dword v2, off, s[20:23], 0 offset:8 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_store_dword v3, off, s[20:23], 0 offset:12 ; 4-byte Folded Spill
; GCN-NEXT:    global_load_dwordx4 v[18:21], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[14:17], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[24:27], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[30:33], v23, s[0:1] offset:16 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[8:11], v23, s[0:1] glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[4:7], v23, s[0:1] offset:48 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_load_dwordx4 v[0:3], v23, s[0:1] offset:32 glc
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v8, v18, v8
; GCN-NEXT:    v_add_f32_e32 v14, v14, v4
; GCN-NEXT:    v_add_f32_e32 v24, v24, v0
; GCN-NEXT:    v_add_f32_e32 v0, v27, v3
; GCN-NEXT:    v_add_f32_e32 v25, v25, v1
; GCN-NEXT:    v_add_f32_e32 v26, v26, v2
; GCN-NEXT:    buffer_store_dword v0, off, s[20:23], 0 offset:192 ; 4-byte Folded Spill
; GCN-NEXT:    buffer_load_dword v0, off, s[20:23], 0 ; 4-byte Folded Reload
; GCN-NEXT:    s_nop 0
; GCN-NEXT:    buffer_load_dword v1, off, s[20:23], 0 offset:4 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v2, off, s[20:23], 0 offset:8 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v3, off, s[20:23], 0 offset:12 ; 4-byte Folded Reload
; GCN-NEXT:    v_add_f32_e32 v27, v15, v5
; GCN-NEXT:    v_add_f32_e32 v15, v16, v6
; GCN-NEXT:    v_add_f32_e32 v6, v20, v10
; GCN-NEXT:    buffer_load_dword v10, off, s[20:23], 0 offset:240 ; 4-byte Folded Reload
; GCN-NEXT:    v_add_f32_e32 v16, v19, v9
; GCN-NEXT:    v_add_f32_e32 v5, v21, v11
; GCN-NEXT:    v_add_f32_e32 v17, v17, v7
; GCN-NEXT:    v_add_f32_e32 v7, v29, v13
; GCN-NEXT:    s_waitcnt vmcnt(4)
; GCN-NEXT:    v_add_f32_e32 v4, v0, v30
; GCN-NEXT:    s_waitcnt vmcnt(3)
; GCN-NEXT:    v_add_f32_e32 v0, v1, v31
; GCN-NEXT:    s_waitcnt vmcnt(2)
; GCN-NEXT:    v_add_f32_e32 v1, v2, v32
; GCN-NEXT:    s_waitcnt vmcnt(1)
; GCN-NEXT:    v_add_f32_e32 v2, v3, v33
; GCN-NEXT:    v_add_f32_e32 v3, v28, v12
; GCN-NEXT:    buffer_load_dword v13, off, s[20:23], 0 offset:48 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v12, off, s[20:23], 0 offset:92 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(2)
; GCN-NEXT:    v_add_f32_e32 v9, v10, v35
; GCN-NEXT:    v_add_f32_e32 v2, v2, v10
; GCN-NEXT:    buffer_load_dword v10, off, s[20:23], 0 offset:244 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v11, off, s[20:23], 0 offset:248 ; 4-byte Folded Reload
; GCN-NEXT:    v_add_f32_e32 v3, v9, v3
; GCN-NEXT:    v_add_f32_e32 v2, v2, v9
; GCN-NEXT:    v_add_f32_e32 v3, v3, v2
; GCN-NEXT:    s_waitcnt vmcnt(2)
; GCN-NEXT:    v_add_f32_e32 v12, v13, v12
; GCN-NEXT:    v_add_f32_e32 v13, v15, v13
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v10, v11, v10
; GCN-NEXT:    v_add_f32_e32 v1, v1, v11
; GCN-NEXT:    v_add_f32_e32 v7, v10, v7
; GCN-NEXT:    v_add_f32_e32 v1, v1, v10
; GCN-NEXT:    v_add_f32_e32 v2, v7, v1
; GCN-NEXT:    buffer_load_dword v1, off, s[20:23], 0 offset:224 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:144 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v7, off, s[20:23], 0 offset:188 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(1)
; GCN-NEXT:    v_add_f32_e32 v0, v0, v9
; GCN-NEXT:    v_add_f32_e32 v1, v1, v22
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v7, v9, v7
; GCN-NEXT:    v_add_f32_e32 v1, v7, v1
; GCN-NEXT:    v_add_f32_e32 v0, v0, v7
; GCN-NEXT:    v_add_f32_e32 v1, v1, v0
; GCN-NEXT:    buffer_load_dword v0, off, s[20:23], 0 offset:216 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v7, off, s[20:23], 0 offset:236 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v0, v0, v7
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:132 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v7, off, s[20:23], 0 offset:176 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(1)
; GCN-NEXT:    v_add_f32_e32 v4, v4, v9
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v7, v9, v7
; GCN-NEXT:    v_add_f32_e32 v0, v7, v0
; GCN-NEXT:    v_add_f32_e32 v4, v4, v7
; GCN-NEXT:    v_add_f32_e32 v0, v0, v4
; GCN-NEXT:    buffer_load_dword v4, off, s[20:23], 0 offset:208 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v7, off, s[20:23], 0 offset:232 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v4, v4, v7
; GCN-NEXT:    buffer_load_dword v7, off, s[20:23], 0 offset:204 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:228 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v7, v7, v9
; GCN-NEXT:    buffer_load_dword v10, off, s[20:23], 0 offset:116 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:164 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(1)
; GCN-NEXT:    v_add_f32_e32 v5, v5, v10
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v9, v10, v9
; GCN-NEXT:    buffer_load_dword v11, off, s[20:23], 0 offset:108 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v10, off, s[20:23], 0 offset:156 ; 4-byte Folded Reload
; GCN-NEXT:    v_add_f32_e32 v4, v9, v4
; GCN-NEXT:    v_add_f32_e32 v5, v5, v9
; GCN-NEXT:    s_waitcnt vmcnt(1)
; GCN-NEXT:    v_add_f32_e32 v6, v6, v11
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v10, v11, v10
; GCN-NEXT:    v_add_f32_e32 v11, v10, v7
; GCN-NEXT:    v_add_f32_e32 v7, v4, v5
; GCN-NEXT:    buffer_load_dword v4, off, s[20:23], 0 offset:184 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v5, off, s[20:23], 0 offset:220 ; 4-byte Folded Reload
; GCN-NEXT:    v_add_f32_e32 v6, v6, v10
; GCN-NEXT:    v_add_f32_e32 v6, v11, v6
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v4, v4, v5
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:84 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v5, off, s[20:23], 0 offset:136 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v5, v9, v5
; GCN-NEXT:    v_add_f32_e32 v9, v16, v9
; GCN-NEXT:    v_add_f32_e32 v4, v5, v4
; GCN-NEXT:    v_add_f32_e32 v5, v9, v5
; GCN-NEXT:    v_add_f32_e32 v5, v4, v5
; GCN-NEXT:    buffer_load_dword v4, off, s[20:23], 0 offset:172 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:212 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v16, off, s[20:23], 0 offset:192 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(1)
; GCN-NEXT:    v_add_f32_e32 v4, v4, v9
; GCN-NEXT:    buffer_load_dword v10, off, s[20:23], 0 offset:76 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:120 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(1)
; GCN-NEXT:    v_add_f32_e32 v8, v8, v10
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v9, v10, v9
; GCN-NEXT:    v_add_f32_e32 v4, v9, v4
; GCN-NEXT:    v_add_f32_e32 v8, v8, v9
; GCN-NEXT:    v_add_f32_e32 v4, v4, v8
; GCN-NEXT:    buffer_load_dword v8, off, s[20:23], 0 offset:160 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:200 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v8, v8, v9
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:152 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v10, off, s[20:23], 0 offset:196 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v9, v9, v10
; GCN-NEXT:    buffer_load_dword v11, off, s[20:23], 0 offset:52 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v10, off, s[20:23], 0 offset:100 ; 4-byte Folded Reload
; GCN-NEXT:    v_add_f32_e32 v9, v12, v9
; GCN-NEXT:    v_add_f32_e32 v12, v13, v12
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v10, v11, v10
; GCN-NEXT:    v_add_f32_e32 v11, v17, v11
; GCN-NEXT:    v_add_f32_e32 v8, v10, v8
; GCN-NEXT:    v_add_f32_e32 v10, v11, v10
; GCN-NEXT:    v_add_f32_e32 v11, v8, v10
; GCN-NEXT:    v_add_f32_e32 v10, v9, v12
; GCN-NEXT:    buffer_load_dword v8, off, s[20:23], 0 offset:128 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:180 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v8, v8, v9
; GCN-NEXT:    buffer_load_dword v12, off, s[20:23], 0 offset:40 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v9, off, s[20:23], 0 offset:80 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v9, v12, v9
; GCN-NEXT:    v_add_f32_e32 v12, v27, v12
; GCN-NEXT:    v_add_f32_e32 v8, v9, v8
; GCN-NEXT:    v_add_f32_e32 v9, v12, v9
; GCN-NEXT:    v_add_f32_e32 v9, v8, v9
; GCN-NEXT:    buffer_load_dword v8, off, s[20:23], 0 offset:112 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v12, off, s[20:23], 0 offset:168 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v8, v8, v12
; GCN-NEXT:    buffer_load_dword v13, off, s[20:23], 0 offset:32 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v12, off, s[20:23], 0 offset:68 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v12, v13, v12
; GCN-NEXT:    v_add_f32_e32 v13, v14, v13
; GCN-NEXT:    v_add_f32_e32 v8, v12, v8
; GCN-NEXT:    v_add_f32_e32 v12, v13, v12
; GCN-NEXT:    v_add_f32_e32 v8, v8, v12
; GCN-NEXT:    buffer_load_dword v12, off, s[20:23], 0 offset:96 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v13, off, s[20:23], 0 offset:148 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v12, v12, v13
; GCN-NEXT:    buffer_load_dword v13, off, s[20:23], 0 offset:88 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v14, off, s[20:23], 0 offset:140 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v13, v13, v14
; GCN-NEXT:    buffer_load_dword v15, off, s[20:23], 0 offset:28 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v14, off, s[20:23], 0 offset:60 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v14, v15, v14
; GCN-NEXT:    v_add_f32_e32 v15, v16, v15
; GCN-NEXT:    buffer_load_dword v17, off, s[20:23], 0 offset:24 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v16, off, s[20:23], 0 offset:56 ; 4-byte Folded Reload
; GCN-NEXT:    v_add_f32_e32 v12, v14, v12
; GCN-NEXT:    v_add_f32_e32 v14, v15, v14
; GCN-NEXT:    v_add_f32_e32 v15, v12, v14
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v16, v17, v16
; GCN-NEXT:    v_add_f32_e32 v17, v26, v17
; GCN-NEXT:    v_add_f32_e32 v13, v16, v13
; GCN-NEXT:    v_add_f32_e32 v16, v17, v16
; GCN-NEXT:    v_add_f32_e32 v14, v13, v16
; GCN-NEXT:    buffer_load_dword v12, off, s[20:23], 0 offset:72 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v13, off, s[20:23], 0 offset:124 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v12, v12, v13
; GCN-NEXT:    buffer_load_dword v16, off, s[20:23], 0 offset:20 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v13, off, s[20:23], 0 offset:44 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v13, v16, v13
; GCN-NEXT:    v_add_f32_e32 v16, v25, v16
; GCN-NEXT:    v_add_f32_e32 v12, v13, v12
; GCN-NEXT:    v_add_f32_e32 v13, v16, v13
; GCN-NEXT:    v_add_f32_e32 v13, v12, v13
; GCN-NEXT:    buffer_load_dword v12, off, s[20:23], 0 offset:64 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v16, off, s[20:23], 0 offset:104 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v12, v12, v16
; GCN-NEXT:    buffer_load_dword v17, off, s[20:23], 0 offset:16 ; 4-byte Folded Reload
; GCN-NEXT:    buffer_load_dword v16, off, s[20:23], 0 offset:36 ; 4-byte Folded Reload
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    v_add_f32_e32 v16, v17, v16
; GCN-NEXT:    v_add_f32_e32 v17, v24, v17
; GCN-NEXT:    v_add_f32_e32 v12, v16, v12
; GCN-NEXT:    v_add_f32_e32 v16, v17, v16
; GCN-NEXT:    v_add_f32_e32 v12, v12, v16
; GCN-NEXT:    global_store_dwordx4 v23, v[12:15], s[0:1] offset:32
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_store_dwordx4 v23, v[8:11], s[0:1] offset:48
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_store_dwordx4 v23, v[4:7], s[0:1]
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    global_store_dwordx4 v23, v[0:3], s[0:1] offset:16
; GCN-NEXT:    s_waitcnt vmcnt(0)
; GCN-NEXT:    s_endpgm
; GCN: TotalNumSgprs: 28
; GCN: NumVgprs: 36
; GCN: ScratchSize: 256
; GCN: .private_segment_fixed_size: 256
; GCN: .sgpr_count:     28
; GCN: .sgpr_spill_count: 0
; GCN: .vgpr_count:     36
; GCN: .vgpr_spill_count: 71
  %tid = call i32 @llvm.amdgcn.workitem.id.x()
  %gep = getelementptr inbounds <16 x float>, ptr addrspace(1) %p, i32 %tid
  %v0 = load volatile <16 x float>, ptr addrspace(1) %gep
  %v1 = load volatile <16 x float>, ptr addrspace(1) %gep
  %v2 = load volatile <16 x float>, ptr addrspace(1) %gep
  %v3 = load volatile <16 x float>, ptr addrspace(1) %gep
  %v4 = load volatile <16 x float>, ptr addrspace(1) %gep
  %v5 = load volatile <16 x float>, ptr addrspace(1) %gep
  %v6 = load volatile <16 x float>, ptr addrspace(1) %gep
  %v7 = load volatile <16 x float>, ptr addrspace(1) %gep
  %v8 = load volatile <16 x float>, ptr addrspace(1) %gep
  %v9 = load volatile <16 x float>, ptr addrspace(1) %gep
  %a0 = fadd <16 x float> %v0, %v1
  %a1 = fadd <16 x float> %v2, %v3
  %a2 = fadd <16 x float> %v4, %v5
  %a3 = fadd <16 x float> %v6, %v7
  %a4 = fadd <16 x float> %v8, %v9
  %b0 = fadd <16 x float> %a0, %a1
  %b1 = fadd <16 x float> %a2, %a3
  %b2 = fadd <16 x float> %a4, %a0
  %c0 = fadd <16 x float> %b0, %b1
  %c1 = fadd <16 x float> %b2, %b0
  %d0 = fadd <16 x float> %c0, %c1
  store volatile <16 x float> %d0, ptr addrspace(1) %gep
  ret void
}

declare i32 @llvm.amdgcn.workitem.id.x() #1

attributes #0 = { "amdgpu-num-vgpr"="36" }
attributes #1 = { nounwind readnone }
