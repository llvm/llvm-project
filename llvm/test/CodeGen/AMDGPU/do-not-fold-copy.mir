# RUN: llc -mtriple=amdgcn -mcpu=gfx900 -run-pass=si-fold-operands -o - %s | FileCheck %s

---
liveins:
name:            do_not_fold_copy_with_implicit_exec
tracksRegLiveness: true
body:             |
  ; CHECK: bb.0:
  ; CHECK: bb.1:
  ; CHECK: %[[A:[0-9]*]]:sreg_32 = S_ADD_I32
  ; CHECK: COPY %[[A]]
  ; CHECKL SI_LOOP
  ; CHECK: bb.2:

  bb.0:
    %0:sreg_64 = S_MOV_B64 0
    %1:sreg_64 = S_MOV_B64 0
    %2:sreg_32 = S_MOV_B32 0, implicit $exec
    S_BRANCH %bb.1

  bb.1:
    %3:sreg_64 = PHI %1, %bb.0, %4, %bb.1
    %5:sreg_32 = PHI %2, %bb.0, %6, %bb.1
    %6:sreg_32 = S_ADD_I32 %5, 1, implicit-def dead $scc
    %4:sreg_64 = SI_IF_BREAK %0, %3, implicit-def dead $scc
    %7:vgpr_32 = COPY %6, implicit $exec
    SI_LOOP %4, %bb.1, implicit-def dead $exec, implicit-def dead $scc, implicit $exec
    S_BRANCH %bb.2

  bb.2:
    SI_END_CF %4, implicit-def dead $exec, implicit-def dead $scc, implicit $exec
    %9:vgpr_32 = COPY %7
    %10:sreg_64_xexec = IMPLICIT_DEF
    %11:vgpr_32 = V_SET_INACTIVE_B32 0, %9, 0, 0, killed %10, implicit $exec
    S_ENDPGM 0
...
