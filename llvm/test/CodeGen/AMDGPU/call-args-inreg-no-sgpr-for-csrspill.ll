; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 6
; RUN: llc -mtriple=amdgcn-amd-amdhsa -mcpu=gfx900 < %s | FileCheck -enable-var-scope %s

declare hidden void @external_void_func_a15i32_inreg([15 x i32] inreg) #0
declare hidden void @external_void_func_a16i32_inreg([16 x i32] inreg) #0
declare hidden void @external_void_func_a15i32_inreg_i32_inreg([15 x i32] inreg, i32 inreg) #0

define void @test_call_external_void_func_a15i32_inreg([15 x i32] inreg %arg0) #0 {
; CHECK-LABEL: test_call_external_void_func_a15i32_inreg:
; CHECK:       ; %bb.0:
; CHECK-NEXT:    s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)
; CHECK-NEXT:    s_mov_b32 s40, s33
; CHECK-NEXT:    s_mov_b32 s33, s32
; CHECK-NEXT:    s_or_saveexec_b64 s[42:43], -1
; CHECK-NEXT:    buffer_store_dword v40, off, s[0:3], s33 ; 4-byte Folded Spill
; CHECK-NEXT:    s_mov_b64 exec, s[42:43]
; CHECK-NEXT:    v_writelane_b32 v40, s40, 2
; CHECK-NEXT:    s_addk_i32 s32, 0x400
; CHECK-NEXT:    s_mov_b32 s40, s26
; CHECK-NEXT:    v_writelane_b32 v40, s30, 0
; CHECK-NEXT:    v_readfirstlane_b32 s26, v0
; CHECK-NEXT:    s_getpc_b64 s[42:43]
; CHECK-NEXT:    s_add_u32 s42, s42, external_void_func_a15i32_inreg@rel32@lo+4
; CHECK-NEXT:    s_addc_u32 s43, s43, external_void_func_a15i32_inreg@rel32@hi+12
; CHECK-NEXT:    s_mov_b32 s3, s19
; CHECK-NEXT:    s_mov_b32 s2, s18
; CHECK-NEXT:    s_mov_b32 s1, s17
; CHECK-NEXT:    s_mov_b32 s0, s16
; CHECK-NEXT:    s_mov_b32 s16, s20
; CHECK-NEXT:    s_mov_b32 s17, s21
; CHECK-NEXT:    s_mov_b32 s18, s22
; CHECK-NEXT:    s_mov_b32 s19, s23
; CHECK-NEXT:    s_mov_b32 s20, s24
; CHECK-NEXT:    s_mov_b32 s21, s25
; CHECK-NEXT:    s_mov_b32 s22, s40
; CHECK-NEXT:    s_mov_b32 s23, s27
; CHECK-NEXT:    s_mov_b32 s24, s28
; CHECK-NEXT:    s_mov_b32 s25, s29
; CHECK-NEXT:    v_writelane_b32 v40, s31, 1
; CHECK-NEXT:    s_swappc_b64 s[30:31], s[42:43]
; CHECK-NEXT:    v_readlane_b32 s31, v40, 1
; CHECK-NEXT:    v_readlane_b32 s30, v40, 0
; CHECK-NEXT:    s_mov_b32 s32, s33
; CHECK-NEXT:    v_readlane_b32 s4, v40, 2
; CHECK-NEXT:    s_or_saveexec_b64 s[6:7], -1
; CHECK-NEXT:    buffer_load_dword v40, off, s[0:3], s33 ; 4-byte Folded Reload
; CHECK-NEXT:    s_mov_b64 exec, s[6:7]
; CHECK-NEXT:    s_mov_b32 s33, s4
; CHECK-NEXT:    s_waitcnt vmcnt(0)
; CHECK-NEXT:    s_setpc_b64 s[30:31]
  call void @external_void_func_a15i32_inreg([15 x i32] inreg %arg0)
  ret void
}

define void @test_call_external_void_func_a16i32_inreg([16 x i32] inreg %arg0) #0 {
; CHECK-LABEL: test_call_external_void_func_a16i32_inreg:
; CHECK:       ; %bb.0:
; CHECK-NEXT:    s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)
; CHECK-NEXT:    s_mov_b32 s40, s33
; CHECK-NEXT:    s_mov_b32 s33, s32
; CHECK-NEXT:    s_or_saveexec_b64 s[42:43], -1
; CHECK-NEXT:    buffer_store_dword v40, off, s[0:3], s33 ; 4-byte Folded Spill
; CHECK-NEXT:    s_mov_b64 exec, s[42:43]
; CHECK-NEXT:    v_writelane_b32 v40, s40, 2
; CHECK-NEXT:    s_addk_i32 s32, 0x400
; CHECK-NEXT:    s_mov_b32 s40, s27
; CHECK-NEXT:    s_mov_b32 s41, s26
; CHECK-NEXT:    v_writelane_b32 v40, s30, 0
; CHECK-NEXT:    v_readfirstlane_b32 s27, v1
; CHECK-NEXT:    v_readfirstlane_b32 s26, v0
; CHECK-NEXT:    s_getpc_b64 s[42:43]
; CHECK-NEXT:    s_add_u32 s42, s42, external_void_func_a16i32_inreg@rel32@lo+4
; CHECK-NEXT:    s_addc_u32 s43, s43, external_void_func_a16i32_inreg@rel32@hi+12
; CHECK-NEXT:    s_mov_b32 s3, s19
; CHECK-NEXT:    s_mov_b32 s2, s18
; CHECK-NEXT:    s_mov_b32 s1, s17
; CHECK-NEXT:    s_mov_b32 s0, s16
; CHECK-NEXT:    s_mov_b32 s16, s20
; CHECK-NEXT:    s_mov_b32 s17, s21
; CHECK-NEXT:    s_mov_b32 s18, s22
; CHECK-NEXT:    s_mov_b32 s19, s23
; CHECK-NEXT:    s_mov_b32 s20, s24
; CHECK-NEXT:    s_mov_b32 s21, s25
; CHECK-NEXT:    s_mov_b32 s22, s41
; CHECK-NEXT:    s_mov_b32 s23, s40
; CHECK-NEXT:    s_mov_b32 s24, s28
; CHECK-NEXT:    s_mov_b32 s25, s29
; CHECK-NEXT:    v_writelane_b32 v40, s31, 1
; CHECK-NEXT:    s_swappc_b64 s[30:31], s[42:43]
; CHECK-NEXT:    v_readlane_b32 s31, v40, 1
; CHECK-NEXT:    v_readlane_b32 s30, v40, 0
; CHECK-NEXT:    s_mov_b32 s32, s33
; CHECK-NEXT:    v_readlane_b32 s4, v40, 2
; CHECK-NEXT:    s_or_saveexec_b64 s[6:7], -1
; CHECK-NEXT:    buffer_load_dword v40, off, s[0:3], s33 ; 4-byte Folded Reload
; CHECK-NEXT:    s_mov_b64 exec, s[6:7]
; CHECK-NEXT:    s_mov_b32 s33, s4
; CHECK-NEXT:    s_waitcnt vmcnt(0)
; CHECK-NEXT:    s_setpc_b64 s[30:31]
  call void @external_void_func_a16i32_inreg([16 x i32] inreg %arg0)
  ret void
}

define void @test_call_external_void_func_a15i32_inreg_i32_inreg([15 x i32] inreg %arg0, i32 inreg %arg1) #0 {
; CHECK-LABEL: test_call_external_void_func_a15i32_inreg_i32_inreg:
; CHECK:       ; %bb.0:
; CHECK-NEXT:    s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)
; CHECK-NEXT:    s_mov_b32 s40, s33
; CHECK-NEXT:    s_mov_b32 s33, s32
; CHECK-NEXT:    s_or_saveexec_b64 s[42:43], -1
; CHECK-NEXT:    buffer_store_dword v40, off, s[0:3], s33 ; 4-byte Folded Spill
; CHECK-NEXT:    s_mov_b64 exec, s[42:43]
; CHECK-NEXT:    v_writelane_b32 v40, s40, 2
; CHECK-NEXT:    s_addk_i32 s32, 0x400
; CHECK-NEXT:    s_mov_b32 s40, s27
; CHECK-NEXT:    s_mov_b32 s41, s26
; CHECK-NEXT:    v_writelane_b32 v40, s30, 0
; CHECK-NEXT:    v_readfirstlane_b32 s27, v1
; CHECK-NEXT:    v_readfirstlane_b32 s26, v0
; CHECK-NEXT:    s_getpc_b64 s[42:43]
; CHECK-NEXT:    s_add_u32 s42, s42, external_void_func_a15i32_inreg_i32_inreg@rel32@lo+4
; CHECK-NEXT:    s_addc_u32 s43, s43, external_void_func_a15i32_inreg_i32_inreg@rel32@hi+12
; CHECK-NEXT:    s_mov_b32 s3, s19
; CHECK-NEXT:    s_mov_b32 s2, s18
; CHECK-NEXT:    s_mov_b32 s1, s17
; CHECK-NEXT:    s_mov_b32 s0, s16
; CHECK-NEXT:    s_mov_b32 s16, s20
; CHECK-NEXT:    s_mov_b32 s17, s21
; CHECK-NEXT:    s_mov_b32 s18, s22
; CHECK-NEXT:    s_mov_b32 s19, s23
; CHECK-NEXT:    s_mov_b32 s20, s24
; CHECK-NEXT:    s_mov_b32 s21, s25
; CHECK-NEXT:    s_mov_b32 s22, s41
; CHECK-NEXT:    s_mov_b32 s23, s40
; CHECK-NEXT:    s_mov_b32 s24, s28
; CHECK-NEXT:    s_mov_b32 s25, s29
; CHECK-NEXT:    v_writelane_b32 v40, s31, 1
; CHECK-NEXT:    s_swappc_b64 s[30:31], s[42:43]
; CHECK-NEXT:    v_readlane_b32 s31, v40, 1
; CHECK-NEXT:    v_readlane_b32 s30, v40, 0
; CHECK-NEXT:    s_mov_b32 s32, s33
; CHECK-NEXT:    v_readlane_b32 s4, v40, 2
; CHECK-NEXT:    s_or_saveexec_b64 s[6:7], -1
; CHECK-NEXT:    buffer_load_dword v40, off, s[0:3], s33 ; 4-byte Folded Reload
; CHECK-NEXT:    s_mov_b64 exec, s[6:7]
; CHECK-NEXT:    s_mov_b32 s33, s4
; CHECK-NEXT:    s_waitcnt vmcnt(0)
; CHECK-NEXT:    s_setpc_b64 s[30:31]
  call void @external_void_func_a15i32_inreg_i32_inreg([15 x i32] inreg %arg0, i32 inreg %arg1)
  ret void
}

attributes #0 = { nounwind }

!llvm.module.flags = !{!0}
!0 = !{i32 1, !"amdhsa_code_object_version", i32 400}
