# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 2
# RUN: llc -mtriple=amdgcn -mcpu=gfx1100 -verify-machineinstrs -run-pass=prologepilog -o - %s | FileCheck -check-prefix=GCN %s

# We're keeping the IR around for the callees and the CCs

--- |
  declare amdgpu_cs_chain void @callee()
  declare amdgpu_gfx void @gfx_callee()

  define amdgpu_cs_chain void @preserve_inactive_wwm() {ret void}
  define amdgpu_cs_chain void @dont_preserve_wwm_if_no_chain_calls() {ret void}
  define amdgpu_cs_chain void @dont_preserve_wwm_if_init_whole_wave() {ret void}
  define amdgpu_cs_chain void @dont_preserve_non_wwm() {ret void}
  define amdgpu_cs_chain void @dont_preserve_v0_v7() {ret void}
  define amdgpu_cs_chain void @dont_preserve_sgpr() {ret void}
...
---

# Check that we preserve the inactive lanes of registers v8+ received in the
# MachineFunctionInfo as wwmReservedRegs.

---
name:            preserve_inactive_wwm
tracksRegLiveness: true
frameInfo:
  hasTailCall:     true
machineFunctionInfo:
  stackPtrOffsetReg: '$sgpr32'
  returnsVoid:     true
  wwmReservedRegs:
    - '$vgpr8'
    - '$vgpr9'
body:             |
  bb.0:
    liveins: $sgpr0, $sgpr35, $vgpr8, $vgpr9

    ; GCN-LABEL: name: preserve_inactive_wwm
    ; GCN: liveins: $sgpr0, $sgpr35, $vgpr8, $vgpr9
    ; GCN-NEXT: {{  $}}
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION escape 0x0f, 0x09, 0x90, 0x40, 0x94, 0x04, 0x35, 0x24, 0x36, 0xe9, 0x02
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION llvm_register_pair $pc_reg, $sgpr30, 32, $sgpr31, 32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr0
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr1
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr2
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr3
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr4
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr5
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr6
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr7
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr0
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr1
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr2
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr3
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr4
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr5
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr6
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr7
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr8
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr9
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr10
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr11
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr12
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr13
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr14
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr15
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr16
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr17
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr18
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr19
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr20
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr21
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr22
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr23
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr24
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr25
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr26
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr27
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr28
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr29
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr30
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr31
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr33
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr34
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr35
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr36
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr37
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr38
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr39
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr40
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr41
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr42
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr43
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr44
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr45
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr46
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr47
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr48
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr49
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr50
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr51
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr52
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr53
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr54
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr55
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr56
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr57
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr58
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr59
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr60
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr61
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr62
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr63
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr64
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr65
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr66
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr67
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr68
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr69
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr70
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr71
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr72
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr73
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr74
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr75
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr76
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr77
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr78
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr79
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr80
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr81
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr82
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr83
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr84
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr85
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr86
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr87
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr88
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr89
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr90
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr91
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr92
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr93
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr94
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr95
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr96
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr97
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr98
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr99
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr100
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr101
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr102
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr103
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr104
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr105
    ; GCN-NEXT: $sgpr1 = S_XOR_SAVEEXEC_B32 -1, implicit-def $exec, implicit-def dead $scc, implicit $exec
    ; GCN-NEXT: SCRATCH_STORE_DWORD_ST $vgpr8, 0, 0, implicit $exec, implicit $flat_scr :: (store (s32) into %stack.0, addrspace 5)
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION offset $vgpr8, 0
    ; GCN-NEXT: SCRATCH_STORE_DWORD_ST $vgpr9, 4, 0, implicit $exec, implicit $flat_scr :: (store (s32) into %stack.1, addrspace 5)
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION offset $vgpr9, 128
    ; GCN-NEXT: $exec_lo = S_MOV_B32 killed $sgpr1
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    ; GCN-NEXT: S_NOP 0, implicit-def $vgpr0, implicit-def $vgpr1, implicit-def $vgpr2, implicit-def $vgpr3, implicit-def $vgpr4, implicit-def $vgpr5, implicit-def $vgpr6, implicit-def $vgpr7
    ; GCN-NEXT: $sgpr1 = S_XOR_SAVEEXEC_B32 -1, implicit-def $exec, implicit-def dead $scc, implicit $exec
    ; GCN-NEXT: $vgpr8 = SCRATCH_LOAD_DWORD_ST 0, 0, implicit $exec, implicit $flat_scr, implicit $vgpr8(tied-def 0) :: (load (s32) from %stack.0, addrspace 5)
    ; GCN-NEXT: $vgpr9 = SCRATCH_LOAD_DWORD_ST 4, 0, implicit $exec, implicit $flat_scr :: (load (s32) from %stack.1, addrspace 5)
    ; GCN-NEXT: $exec_lo = S_MOV_B32 killed $sgpr1
    ; GCN-NEXT: SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0, implicit $vgpr8
    renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    S_NOP 0, implicit-def $vgpr0, implicit-def $vgpr1, implicit-def $vgpr2, implicit-def $vgpr3, implicit-def $vgpr4, implicit-def $vgpr5, implicit-def $vgpr6, implicit-def $vgpr7
    SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0, implicit $vgpr8

...

---
name:            dont_preserve_wwm_if_no_chain_calls
tracksRegLiveness: true
frameInfo:
  hasTailCall:     false
machineFunctionInfo:
  stackPtrOffsetReg: '$sgpr32'
  returnsVoid:     true
  wwmReservedRegs:
    - '$vgpr9'
body:             |
  bb.0:
    liveins: $sgpr35, $vgpr8

    ; GCN-LABEL: name: dont_preserve_wwm_if_no_chain_calls
    ; GCN: liveins: $sgpr35, $vgpr8
    ; GCN-NEXT: {{  $}}
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION escape 0x0f, 0x09, 0x90, 0x40, 0x94, 0x04, 0x35, 0x24, 0x36, 0xe9, 0x02
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION llvm_register_pair $pc_reg, $sgpr30, 32, $sgpr31, 32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr0
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr1
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr2
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr3
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr4
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr5
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr6
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr7
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr8
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr35
    ; GCN-NEXT: $vgpr8 = SI_SPILL_S32_TO_VGPR $sgpr35, 0, killed $vgpr8
    ; GCN-NEXT: $sgpr35 = S_MOV_B32 5
    ; GCN-NEXT: $sgpr35 = SI_RESTORE_S32_FROM_VGPR $vgpr8, 0
    ; GCN-NEXT: renamable $vgpr8 = V_MOV_B32_e32 10, implicit $exec
    ; GCN-NEXT: S_NOP 0, implicit-def $vgpr0, implicit-def $vgpr1, implicit-def $vgpr2, implicit-def $vgpr3, implicit-def $vgpr4, implicit-def $vgpr5, implicit-def $vgpr6, implicit-def $vgpr7
    ; GCN-NEXT: S_ENDPGM 0
    renamable $vgpr8 = SI_SPILL_S32_TO_VGPR $sgpr35, 0, killed $vgpr8
    $sgpr35 = S_MOV_B32 5
    $sgpr35 = SI_RESTORE_S32_FROM_VGPR $vgpr8, 0
    renamable $vgpr8 = V_MOV_B32_e32 10, implicit $exec
    S_NOP 0, implicit-def $vgpr0, implicit-def $vgpr1, implicit-def $vgpr2, implicit-def $vgpr3, implicit-def $vgpr4, implicit-def $vgpr5, implicit-def $vgpr6, implicit-def $vgpr7
    S_ENDPGM 0
...

---
name:            dont_preserve_wwm_if_init_whole_wave
tracksRegLiveness: true
frameInfo:
  hasTailCall: true
machineFunctionInfo:
  stackPtrOffsetReg: '$sgpr32'
  returnsVoid: true
  wwmReservedRegs:
    - '$vgpr8'
    - '$vgpr9'
  hasInitWholeWave: true
body:             |
  bb.0:
    liveins: $sgpr0, $sgpr35, $vgpr8, $vgpr9

    ; GCN-LABEL: name: dont_preserve_wwm_if_init_whole_wave
    ; GCN: liveins: $sgpr0, $sgpr35
    ; GCN-NEXT: {{  $}}
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION escape 0x0f, 0x09, 0x90, 0x40, 0x94, 0x04, 0x35, 0x24, 0x36, 0xe9, 0x02
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION llvm_register_pair $pc_reg, $sgpr30, 32, $sgpr31, 32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr0
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr1
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr2
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr3
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr4
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr5
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr6
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr7
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr8
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr9
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr10
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr11
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr12
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr13
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr14
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr15
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr16
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr17
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr18
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr19
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr20
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr21
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr22
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr23
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr24
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr25
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr26
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr27
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr28
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr29
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr30
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr31
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr33
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr34
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr35
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr36
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr37
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr38
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr39
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr40
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr41
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr42
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr43
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr44
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr45
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr46
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr47
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr48
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr49
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr50
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr51
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr52
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr53
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr54
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr55
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr56
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr57
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr58
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr59
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr60
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr61
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr62
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr63
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr64
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr65
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr66
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr67
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr68
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr69
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr70
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr71
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr72
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr73
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr74
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr75
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr76
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr77
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr78
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr79
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr80
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr81
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr82
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr83
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr84
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr85
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr86
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr87
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr88
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr89
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr90
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr91
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr92
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr93
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr94
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr95
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr96
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr97
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr98
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr99
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr100
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr101
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr102
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr103
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr104
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr105
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    ; GCN-NEXT: SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0, implicit $vgpr1
    renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0, implicit $vgpr8

...

---
name:            dont_preserve_non_wwm
tracksRegLiveness: true
frameInfo:
  hasTailCall:     true
machineFunctionInfo:
  stackPtrOffsetReg: '$sgpr32'
  isChainFunction: true
  returnsVoid:     true
body:             |
  bb.0:
    liveins: $sgpr0, $sgpr35, $vgpr0, $vgpr8, $vgpr16

    ; GCN-LABEL: name: dont_preserve_non_wwm
    ; GCN: liveins: $sgpr0, $sgpr35, $vgpr0, $vgpr8, $vgpr16
    ; GCN-NEXT: {{  $}}
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION escape 0x0f, 0x09, 0x90, 0x40, 0x94, 0x04, 0x35, 0x24, 0x36, 0xe9, 0x02
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION llvm_register_pair $pc_reg, $sgpr30, 32, $sgpr31, 32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr8
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr16
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr0
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr1
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr2
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr3
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr4
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr5
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr6
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr7
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr8
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr9
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr10
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr11
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr12
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr13
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr14
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr15
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr16
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr17
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr18
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr19
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr20
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr21
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr22
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr23
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr24
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr25
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr26
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr27
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr28
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr29
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr30
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr31
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr33
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr34
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr35
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr36
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr37
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr38
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr39
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr40
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr41
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr42
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr43
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr44
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr45
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr46
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr47
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr48
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr49
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr50
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr51
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr52
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr53
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr54
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr55
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr56
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr57
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr58
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr59
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr60
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr61
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr62
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr63
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr64
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr65
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr66
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr67
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr68
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr69
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr70
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr71
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr72
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr73
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr74
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr75
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr76
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr77
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr78
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr79
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr80
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr81
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr82
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr83
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr84
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr85
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr86
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr87
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr88
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr89
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr90
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr91
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr92
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr93
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr94
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr95
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr96
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr97
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr98
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr99
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr100
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr101
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr102
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr103
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr104
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr105
    ; GCN-NEXT: renamable $vgpr16 = V_MOV_B32_e32 16, implicit $exec
    ; GCN-NEXT: renamable $vgpr8 = V_MOV_B32_e32 8, implicit $exec
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    ; GCN-NEXT: SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0, implicit $vgpr8
    renamable $vgpr16 = V_MOV_B32_e32 16, implicit $exec
    renamable $vgpr8 = V_MOV_B32_e32 8, implicit $exec
    renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0, implicit $vgpr8

...

---
name:            dont_preserve_v0_v7
tracksRegLiveness: true
frameInfo:
  hasTailCall:     true
machineFunctionInfo:
  stackPtrOffsetReg: '$sgpr32'
  isChainFunction: true
  returnsVoid:     true
  wwmReservedRegs:
    - '$vgpr1'
body:             |
  bb.0:
    liveins: $sgpr0, $sgpr35, $vgpr0, $vgpr7, $vgpr8, $vgpr9

    ; GCN-LABEL: name: dont_preserve_v0_v7
    ; GCN: liveins: $sgpr0, $sgpr35, $vgpr0, $vgpr7, $vgpr8, $vgpr9
    ; GCN-NEXT: {{  $}}
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION escape 0x0f, 0x09, 0x90, 0x40, 0x94, 0x04, 0x35, 0x24, 0x36, 0xe9, 0x02
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION llvm_register_pair $pc_reg, $sgpr30, 32, $sgpr31, 32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr0
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr7
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr8
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $vgpr9
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr0
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr1
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr2
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr3
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr4
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr5
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr6
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr7
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr8
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr9
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr10
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr11
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr12
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr13
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr14
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr15
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr16
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr17
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr18
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr19
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr20
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr21
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr22
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr23
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr24
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr25
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr26
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr27
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr28
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr29
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr30
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr31
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr33
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr34
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr35
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr36
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr37
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr38
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr39
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr40
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr41
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr42
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr43
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr44
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr45
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr46
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr47
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr48
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr49
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr50
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr51
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr52
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr53
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr54
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr55
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr56
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr57
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr58
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr59
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr60
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr61
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr62
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr63
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr64
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr65
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr66
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr67
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr68
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr69
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr70
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr71
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr72
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr73
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr74
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr75
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr76
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr77
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr78
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr79
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr80
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr81
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr82
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr83
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr84
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr85
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr86
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr87
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr88
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr89
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr90
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr91
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr92
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr93
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr94
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr95
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr96
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr97
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr98
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr99
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr100
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr101
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr102
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr103
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr104
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr105
    ; GCN-NEXT: $vgpr0 = SI_SPILL_S32_TO_VGPR $sgpr35, 0, killed $vgpr0
    ; GCN-NEXT: $sgpr35 = S_MOV_B32 5
    ; GCN-NEXT: $sgpr35 = SI_RESTORE_S32_FROM_VGPR $vgpr0, 0
    ; GCN-NEXT: renamable $vgpr0 = V_MOV_B32_e32 10, implicit $exec
    ; GCN-NEXT: renamable $vgpr7 = V_MOV_B32_e32 16, implicit $exec
    ; GCN-NEXT: renamable $vgpr8 = COPY killed renamable $vgpr0
    ; GCN-NEXT: renamable $vgpr9 = COPY killed renamable $vgpr7
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    ; GCN-NEXT: SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0, implicit $vgpr8, implicit $vgpr9
    renamable $vgpr0 = SI_SPILL_S32_TO_VGPR $sgpr35, 0, killed $vgpr0
    $sgpr35 = S_MOV_B32 5
    $sgpr35 = SI_RESTORE_S32_FROM_VGPR $vgpr0, 0
    renamable $vgpr0 = V_MOV_B32_e32 10, implicit $exec
    renamable $vgpr7 = V_MOV_B32_e32 16, implicit $exec
    renamable $vgpr8 = COPY killed renamable $vgpr0
    renamable $vgpr9 = COPY killed renamable $vgpr7
    renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0, implicit $vgpr8, implicit $vgpr9

...

---
name:            dont_preserve_sgpr
tracksRegLiveness: true
frameInfo:
  hasTailCall:     true
machineFunctionInfo:
  stackPtrOffsetReg: '$sgpr32'
  returnsVoid:     true
body:             |
  bb.0 (%ir-block.0):
    liveins: $sgpr0

    ; GCN-LABEL: name: dont_preserve_sgpr
    ; GCN: liveins: $sgpr0
    ; GCN-NEXT: {{  $}}
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION escape 0x0f, 0x09, 0x90, 0x40, 0x94, 0x04, 0x35, 0x24, 0x36, 0xe9, 0x02
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION llvm_register_pair $pc_reg, $sgpr30, 32, $sgpr31, 32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr0
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr1
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr2
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr3
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr4
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr5
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr6
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr7
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr8
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr9
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr10
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr11
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr12
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr13
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr14
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr15
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr16
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr17
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr18
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr19
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr20
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr21
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr22
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr23
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr24
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr25
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr26
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr27
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr28
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr29
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr30
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr31
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr32
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr33
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr34
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr35
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr36
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr37
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr38
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr39
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr40
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr41
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr42
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr43
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr44
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr45
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr46
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr47
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr48
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr49
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr50
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr51
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr52
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr53
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr54
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr55
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr56
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr57
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr58
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr59
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr60
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr61
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr62
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr63
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr64
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr65
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr66
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr67
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr68
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr69
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr70
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr71
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr72
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr73
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr74
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr75
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr76
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr77
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr78
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr79
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr80
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr81
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr82
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr83
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr84
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr85
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr86
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr87
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr88
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr89
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr90
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr91
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr92
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr93
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr94
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr95
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr96
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr97
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr98
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr99
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr100
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr101
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr102
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr103
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr104
    ; GCN-NEXT: frame-setup CFI_INSTRUCTION undefined $sgpr105
    ; GCN-NEXT: renamable $sgpr1 = S_ADD_I32 killed renamable $sgpr0, renamable $sgpr0, implicit-def dead $scc
    ; GCN-NEXT: $sgpr0 = COPY killed renamable $sgpr1
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    ; GCN-NEXT: renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    ; GCN-NEXT: SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0
    renamable $sgpr1 = S_ADD_I32 killed renamable $sgpr0, renamable $sgpr0, implicit-def dead $scc
    $sgpr0 = COPY killed renamable $sgpr1
    renamable $sgpr4_sgpr5 = SI_PC_ADD_REL_OFFSET target-flags(amdgpu-gotprel32-lo) @callee + 4, target-flags(amdgpu-gotprel32-hi) @callee + 12, implicit-def dead $scc
    renamable $sgpr4_sgpr5 = S_LOAD_DWORDX2_IMM killed renamable $sgpr4_sgpr5, 0, 0 :: (dereferenceable invariant load (p0) from got, addrspace 4)
    SI_CS_CHAIN_TC_W32 killed renamable $sgpr4_sgpr5, @callee, 0, -1, amdgpu_allvgprs, implicit $sgpr0

...
