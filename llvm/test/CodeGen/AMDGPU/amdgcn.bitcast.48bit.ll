; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5

; RUN: llc -mtriple=amdgcn -mcpu=tahiti < %s | FileCheck -check-prefix=SI %s
; RUN: llc -mtriple=amdgcn -mcpu=tonga < %s | FileCheck -check-prefix=VI %s
; RUN: llc -mtriple=amdgcn -mcpu=gfx900 < %s | FileCheck -check-prefix=GFX9 %s
; RUN: llc -mtriple=amdgcn -mcpu=gfx1100 -mattr=+real-true16 < %s | FileCheck -check-prefix=GFX11-TRUE16 %s
; RUN: llc -mtriple=amdgcn -mcpu=gfx1100 -mattr=-real-true16 < %s | FileCheck -check-prefix=GFX11-FAKE16 %s

define <3 x half> @bitcast_v3bf16_to_v3f16(<3 x bfloat> %a, i32 %b) {
; SI-LABEL: bitcast_v3bf16_to_v3f16:
; VI-LABEL: bitcast_v3bf16_to_v3f16:
; GFX9-LABEL: bitcast_v3bf16_to_v3f16:
; GFX11-TRUE16-LABEL: bitcast_v3bf16_to_v3f16:
; GFX11-FAKE16-LABEL: bitcast_v3bf16_to_v3f16:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = fadd <3 x bfloat> %a, splat (bfloat 0xR40C0)
  %a2 = bitcast <3 x bfloat> %a1 to <3 x half>
  br label %end

cmp.false:
  %a3 = bitcast <3 x bfloat> %a to <3 x half>
  br label %end

end:
  %phi = phi <3 x half> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x half> %phi
}

define inreg <3 x half> @bitcast_v3bf16_to_v3f16_scalar(<3 x bfloat> inreg %a, i32 inreg %b) {
; SI-LABEL: bitcast_v3bf16_to_v3f16_scalar:
; VI-LABEL: bitcast_v3bf16_to_v3f16_scalar:
; GFX9-LABEL: bitcast_v3bf16_to_v3f16_scalar:
; GFX11-TRUE16-LABEL: bitcast_v3bf16_to_v3f16_scalar:
; GFX11-FAKE16-LABEL: bitcast_v3bf16_to_v3f16_scalar:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = fadd <3 x bfloat> %a, splat (bfloat 0xR40C0)
  %a2 = bitcast <3 x bfloat> %a1 to <3 x half>
  br label %end

cmp.false:
  %a3 = bitcast <3 x bfloat> %a to <3 x half>
  br label %end

end:
  %phi = phi <3 x half> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x half> %phi
}

define <3 x bfloat> @bitcast_v3f16_to_v3bf16(<3 x half> %a, i32 %b) {
; SI-LABEL: bitcast_v3f16_to_v3bf16:
; VI-LABEL: bitcast_v3f16_to_v3bf16:
; GFX9-LABEL: bitcast_v3f16_to_v3bf16:
; GFX11-TRUE16-LABEL: bitcast_v3f16_to_v3bf16:
; GFX11-FAKE16-LABEL: bitcast_v3f16_to_v3bf16:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = fadd <3 x half> %a, splat (half 0xH0200)
  %a2 = bitcast <3 x half> %a1 to <3 x bfloat>
  br label %end

cmp.false:
  %a3 = bitcast <3 x half> %a to <3 x bfloat>
  br label %end

end:
  %phi = phi <3 x bfloat> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x bfloat> %phi
}

define inreg <3 x bfloat> @bitcast_v3f16_to_v3bf16_scalar(<3 x half> inreg %a, i32 inreg %b) {
; SI-LABEL: bitcast_v3f16_to_v3bf16_scalar:
; VI-LABEL: bitcast_v3f16_to_v3bf16_scalar:
; GFX9-LABEL: bitcast_v3f16_to_v3bf16_scalar:
; GFX11-TRUE16-LABEL: bitcast_v3f16_to_v3bf16_scalar:
; GFX11-FAKE16-LABEL: bitcast_v3f16_to_v3bf16_scalar:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = fadd <3 x half> %a, splat (half 0xH0200)
  %a2 = bitcast <3 x half> %a1 to <3 x bfloat>
  br label %end

cmp.false:
  %a3 = bitcast <3 x half> %a to <3 x bfloat>
  br label %end

end:
  %phi = phi <3 x bfloat> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x bfloat> %phi
}

define <3 x i16> @bitcast_v3bf16_to_v3i16(<3 x bfloat> %a, i32 %b) {
; SI-LABEL: bitcast_v3bf16_to_v3i16:
; VI-LABEL: bitcast_v3bf16_to_v3i16:
; GFX9-LABEL: bitcast_v3bf16_to_v3i16:
; GFX11-TRUE16-LABEL: bitcast_v3bf16_to_v3i16:
; GFX11-FAKE16-LABEL: bitcast_v3bf16_to_v3i16:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = fadd <3 x bfloat> %a, splat (bfloat 0xR40C0)
  %a2 = bitcast <3 x bfloat> %a1 to <3 x i16>
  br label %end

cmp.false:
  %a3 = bitcast <3 x bfloat> %a to <3 x i16>
  br label %end

end:
  %phi = phi <3 x i16> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x i16> %phi
}

define inreg <3 x i16> @bitcast_v3bf16_to_v3i16_scalar(<3 x bfloat> inreg %a, i32 inreg %b) {
; SI-LABEL: bitcast_v3bf16_to_v3i16_scalar:
; VI-LABEL: bitcast_v3bf16_to_v3i16_scalar:
; GFX9-LABEL: bitcast_v3bf16_to_v3i16_scalar:
; GFX11-TRUE16-LABEL: bitcast_v3bf16_to_v3i16_scalar:
; GFX11-FAKE16-LABEL: bitcast_v3bf16_to_v3i16_scalar:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = fadd <3 x bfloat> %a, splat (bfloat 0xR40C0)
  %a2 = bitcast <3 x bfloat> %a1 to <3 x i16>
  br label %end

cmp.false:
  %a3 = bitcast <3 x bfloat> %a to <3 x i16>
  br label %end

end:
  %phi = phi <3 x i16> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x i16> %phi
}

define <3 x bfloat> @bitcast_v3i16_to_v3bf16(<3 x i16> %a, i32 %b) {
; SI-LABEL: bitcast_v3i16_to_v3bf16:
; VI-LABEL: bitcast_v3i16_to_v3bf16:
; GFX9-LABEL: bitcast_v3i16_to_v3bf16:
; GFX11-TRUE16-LABEL: bitcast_v3i16_to_v3bf16:
; GFX11-FAKE16-LABEL: bitcast_v3i16_to_v3bf16:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = add <3 x i16> %a, splat (i16 3)
  %a2 = bitcast <3 x i16> %a1 to <3 x bfloat>
  br label %end

cmp.false:
  %a3 = bitcast <3 x i16> %a to <3 x bfloat>
  br label %end

end:
  %phi = phi <3 x bfloat> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x bfloat> %phi
}

define inreg <3 x bfloat> @bitcast_v3i16_to_v3bf16_scalar(<3 x i16> inreg %a, i32 inreg %b) {
; SI-LABEL: bitcast_v3i16_to_v3bf16_scalar:
; VI-LABEL: bitcast_v3i16_to_v3bf16_scalar:
; GFX9-LABEL: bitcast_v3i16_to_v3bf16_scalar:
; GFX11-TRUE16-LABEL: bitcast_v3i16_to_v3bf16_scalar:
; GFX11-FAKE16-LABEL: bitcast_v3i16_to_v3bf16_scalar:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = add <3 x i16> %a, splat (i16 3)
  %a2 = bitcast <3 x i16> %a1 to <3 x bfloat>
  br label %end

cmp.false:
  %a3 = bitcast <3 x i16> %a to <3 x bfloat>
  br label %end

end:
  %phi = phi <3 x bfloat> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x bfloat> %phi
}

define <3 x i16> @bitcast_v3f16_to_v3i16(<3 x half> %a, i32 %b) {
; SI-LABEL: bitcast_v3f16_to_v3i16:
; VI-LABEL: bitcast_v3f16_to_v3i16:
; GFX9-LABEL: bitcast_v3f16_to_v3i16:
; GFX11-TRUE16-LABEL: bitcast_v3f16_to_v3i16:
; GFX11-FAKE16-LABEL: bitcast_v3f16_to_v3i16:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = fadd <3 x half> %a, splat (half 0xH0200)
  %a2 = bitcast <3 x half> %a1 to <3 x i16>
  br label %end

cmp.false:
  %a3 = bitcast <3 x half> %a to <3 x i16>
  br label %end

end:
  %phi = phi <3 x i16> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x i16> %phi
}

define inreg <3 x i16> @bitcast_v3f16_to_v3i16_scalar(<3 x half> inreg %a, i32 inreg %b) {
; SI-LABEL: bitcast_v3f16_to_v3i16_scalar:
; VI-LABEL: bitcast_v3f16_to_v3i16_scalar:
; GFX9-LABEL: bitcast_v3f16_to_v3i16_scalar:
; GFX11-TRUE16-LABEL: bitcast_v3f16_to_v3i16_scalar:
; GFX11-FAKE16-LABEL: bitcast_v3f16_to_v3i16_scalar:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = fadd <3 x half> %a, splat (half 0xH0200)
  %a2 = bitcast <3 x half> %a1 to <3 x i16>
  br label %end

cmp.false:
  %a3 = bitcast <3 x half> %a to <3 x i16>
  br label %end

end:
  %phi = phi <3 x i16> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x i16> %phi
}

define <3 x half> @bitcast_v3i16_to_v3f16(<3 x i16> %a, i32 %b) {
; SI-LABEL: bitcast_v3i16_to_v3f16:
; VI-LABEL: bitcast_v3i16_to_v3f16:
; GFX9-LABEL: bitcast_v3i16_to_v3f16:
; GFX11-TRUE16-LABEL: bitcast_v3i16_to_v3f16:
; GFX11-FAKE16-LABEL: bitcast_v3i16_to_v3f16:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = add <3 x i16> %a, splat (i16 3)
  %a2 = bitcast <3 x i16> %a1 to <3 x half>
  br label %end

cmp.false:
  %a3 = bitcast <3 x i16> %a to <3 x half>
  br label %end

end:
  %phi = phi <3 x half> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x half> %phi
}

define inreg <3 x half> @bitcast_v3i16_to_v3f16_scalar(<3 x i16> inreg %a, i32 inreg %b) {
; SI-LABEL: bitcast_v3i16_to_v3f16_scalar:
; VI-LABEL: bitcast_v3i16_to_v3f16_scalar:
; GFX9-LABEL: bitcast_v3i16_to_v3f16_scalar:
; GFX11-TRUE16-LABEL: bitcast_v3i16_to_v3f16_scalar:
; GFX11-FAKE16-LABEL: bitcast_v3i16_to_v3f16_scalar:
  %cmp = icmp eq i32 %b, 0
  br i1 %cmp, label %cmp.true, label %cmp.false

cmp.true:
  %a1 = add <3 x i16> %a, splat (i16 3)
  %a2 = bitcast <3 x i16> %a1 to <3 x half>
  br label %end

cmp.false:
  %a3 = bitcast <3 x i16> %a to <3 x half>
  br label %end

end:
  %phi = phi <3 x half> [ %a2, %cmp.true ], [ %a3, %cmp.false ]
  ret <3 x half> %phi
}
