; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 6
; RUN: llc -march=bpfel < %s | FileCheck %s
; This test used to fail with "unable to allocate function return #1"

define i128 @foo(i64 %a, i64 %b) {
; CHECK-LABEL: foo:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    r5 = r2
; CHECK-NEXT:    r5 += r3
; CHECK-NEXT:    w4 = 1
; CHECK-NEXT:    if r5 < r2 goto LBB0_2
; CHECK-NEXT:  # %bb.1: # %entry
; CHECK-NEXT:    w4 = 0
; CHECK-NEXT:  LBB0_2: # %entry
; CHECK-NEXT:    *(u64 *)(r1 + 0) = r5
; CHECK-NEXT:    r3 s>>= 63
; CHECK-NEXT:    r2 s>>= 63
; CHECK-NEXT:    r2 += r3
; CHECK-NEXT:    r2 += r4
; CHECK-NEXT:    *(u64 *)(r1 + 8) = r2
; CHECK-NEXT:    exit
entry:
    %a1 = sext i64 %a to i128
    %b1 = sext i64 %b to i128
    %c = add i128 %a1, %b1
    ret i128 %c
}
