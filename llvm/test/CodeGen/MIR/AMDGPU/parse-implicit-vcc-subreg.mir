# RUN: llc -mtriple=amdgcn-amd-amdhsa -mcpu=gfx1250 -run-pass=none -verify-machineinstrs %s -o - | FileCheck %s

# Verify that the MIR parser accepts $vcc_lo as the implicit operand for
# S_CBRANCH_VCCNZ on wave32 targets.

# CHECK-LABEL: name: parse_implicit_vcc_lo
# CHECK:       S_CBRANCH_VCCNZ %bb.1, implicit killed $vcc_lo
---
name:            parse_implicit_vcc_lo
tracksRegLiveness: true
body:             |
  bb.0:
    liveins: $sgpr0, $exec_lo
    successors: %bb.1

    $vcc_lo = S_AND_B32 $exec_lo, $sgpr0, implicit-def dead $scc
    S_CBRANCH_VCCNZ %bb.1, implicit killed $vcc_lo

  bb.1:
    S_ENDPGM 0
...

# Also verify that S_CBRANCH_VCCZ works with $vcc_lo.
# CHECK-LABEL: name: parse_implicit_vcc_lo_vccz
# CHECK:       S_CBRANCH_VCCZ %bb.1, implicit killed $vcc_lo
---
name:            parse_implicit_vcc_lo_vccz
tracksRegLiveness: true
body:             |
  bb.0:
    liveins: $sgpr0, $exec_lo
    successors: %bb.1

    $vcc_lo = S_AND_B32 $exec_lo, $sgpr0, implicit-def dead $scc
    S_CBRANCH_VCCZ %bb.1, implicit killed $vcc_lo

  bb.1:
    S_ENDPGM 0
...

# Verify that implicit-def sub-registers are also accepted.  V_ADD_CO_U32_e32
# has 'Defs = [VCC]', but on wave32 the printer emits implicit-def $vcc_lo.
# CHECK-LABEL: name: parse_implicit_def_vcc_lo
# CHECK:       $vgpr0 = V_ADD_CO_U32_e32 $vgpr0, $vgpr1, implicit-def $vcc_lo, implicit $exec
---
name:            parse_implicit_def_vcc_lo
tracksRegLiveness: true
body:             |
  bb.0:
    liveins: $vgpr0, $vgpr1

    $vgpr0 = V_ADD_CO_U32_e32 $vgpr0, $vgpr1, implicit-def $vcc_lo, implicit $exec
    S_ENDPGM 0
...
