# RUN: llc -verify-machineinstrs -O0 -mtriple spirv-unknown-unknown -run-pass=spirv-prelegalizer-combiner %s -o - | FileCheck %s
# REQUIRES: asserts
---
name:            faceforward_instcombine_float4
tracksRegLiveness: true
legalized: true
body:             |
  bb.1.entry:
    ; CHECK-LABEL: name: faceforward_instcombine_float4
    ; CHECK-NOT: %6:_(<4 x s32>) = G_FSUB %2, %3
    ; CHECK-NOT: %7:id(s32) = G_INTRINSIC intrinsic(@llvm.spv.length), %6(<4 x s32>)
    ; CHECK: %7:id(s32) = G_INTRINSIC intrinsic(@llvm.spv.distance), %2(<4 x s32>), %3(<4 x s32>)
    %4:type(s64) = OpTypeVector %3:type(s64), 4
    %6:type(s64) = OpTypeFunction %4:type(s64), %4:type(s64), %4:type(s64), %4:type(s64)
    %3:type(s64) = OpTypeFloat 32
    OpName %0:vfid(<4 x s32>), 97
    OpName %1:vfid(<4 x s32>), 98
    OpName %2:vfid(<4 x s32>), 99
    %5:iid(s64) = OpFunction %4:type(s64), 0, %6:type(s64)
    %0:vfid(<4 x s32>) = OpFunctionParameter %4:type(s64)
    %1:vfid(<4 x s32>) = OpFunctionParameter %4:type(s64)
    %2:vfid(<4 x s32>) = OpFunctionParameter %4:type(s64)
    OpName %5:iid(s64), 1701011814, 2003988326, 1600418401, 1953721961, 1651339107, 1600482921, 1634692198, 13428
    OpDecorate %5:iid(s64), 41, 1701011814, 2003988326, 1600418401, 1953721961, 1651339107, 1600482921, 1634692198, 13428, 0
    %10:_(s32) = G_FCONSTANT float 0.000000e+00
    %9:_(s32) = G_INTRINSIC intrinsic(@llvm.spv.fdot), %1:vfid(<4 x s32>), %2:vfid(<4 x s32>)
    %11:_(s1) = G_FCMP floatpred(olt), %9:_(s32), %10:_
    %12:_(<4 x s32>) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.spv.const.composite)
    %13:_(<4 x s32>) = G_INTRINSIC_W_SIDE_EFFECTS intrinsic(@llvm.spv.track.constant), %12:_(<4 x s32>), <0x55555d14f908>
    %14:_(<4 x s32>) = G_FSUB %13:_, %0:vfid
    %15:id(<4 x s32>) = G_SELECT %11:_(s1), %0:vfid, %14:_
    OpReturnValue %15:id(<4 x s32>)
      