; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=s390x-linux-gnu -mcpu=z15 | FileCheck %s
;
; Test that the big offsets are handled by only one AGFI.

define void @fun(ptr %Src, ptr %Dst) {
; CHECK-LABEL: fun:
; CHECK:       # %bb.0:
; CHECK-NEXT:    agfi %r2, 1048576
; CHECK-NEXT:    lg %r0, 0(%r2)
; CHECK-NEXT:    stg %r0, 0(%r3)
; CHECK-NEXT:    lg %r0, 8(%r2)
; CHECK-NEXT:    stg %r0, 0(%r3)
; CHECK-NEXT:    br %r14
  %S0 = getelementptr i64, ptr %Src, i64 131072
  %V0 = load i64, ptr %S0
  store volatile i64 %V0, ptr %Dst

  %S1 = getelementptr i64, ptr %Src, i64 131073
  %V1 = load i64, ptr %S1
  store volatile i64 %V1, ptr %Dst

  ret void
}
