# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 6
# RUN: llc -mtriple=hexagon -run-pass pipeliner -window-sched=force %s -o - | FileCheck %s
# REQUIRES: asserts
# Ensure WindowScheduler copies IMPLICIT_DEF into the triple-MBB region
# so LiveIntervals no longer hits LR.verify()

--- |
  define void @foo() {
    ret void
  }
...

---
name: foo
tracksRegLiveness: true

body: |
  ; CHECK-LABEL: name: foo
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x60000000), %bb.2(0x20000000)
  ; CHECK-NEXT:   liveins: $r0, $r1, $r2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   dead [[DEF:%[0-9]+]]:intregs = IMPLICIT_DEF
  ; CHECK-NEXT:   dead [[DEF1:%[0-9]+]]:predregs = IMPLICIT_DEF
  ; CHECK-NEXT:   dead [[DEF2:%[0-9]+]]:intregslow8 = IMPLICIT_DEF
  ; CHECK-NEXT:   dead [[DEF3:%[0-9]+]]:hvxqr = IMPLICIT_DEF
  ; CHECK-NEXT:   J2_jumpf undef [[DEF1]], %bb.2, implicit-def dead $pc
  ; CHECK-NEXT:   J2_jump %bb.1, implicit-def dead $pc
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.4(0x55555555), %bb.2(0x2aaaaaab)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   J2_jumpt undef [[DEF1]], %bb.4, implicit-def dead $pc
  ; CHECK-NEXT:   J2_jump %bb.2, implicit-def dead $pc
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   successors: %bb.3(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   J2_loop0r %bb.3, undef [[DEF]], implicit-def $lc0, implicit-def $sa0, implicit-def $usr
  ; CHECK-NEXT:   J2_jump %bb.3, implicit-def $pc
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.3 (machine-block-address-taken):
  ; CHECK-NEXT:   successors: %bb.4(0x04000000), %bb.3(0x7c000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   dead [[V6_vL32Ub_ai:%[0-9]+]]:hvxvr = V6_vL32Ub_ai undef [[DEF]], 0 :: (load (s1024), align 8)
  ; CHECK-NEXT:   [[DEF4:%[0-9]+]]:hvxwr = IMPLICIT_DEF
  ; CHECK-NEXT:   dead [[V6_vlalignb:%[0-9]+]]:hvxvr = V6_vlalignb undef [[DEF4]].vsub_lo, undef [[V6_vL32Ub_ai]], undef [[DEF2]]
  ; CHECK-NEXT:   [[V6_vlalignb1:%[0-9]+]]:hvxvr = V6_vlalignb [[DEF4]].vsub_lo, undef [[DEF4]].vsub_hi, undef [[DEF2]]
  ; CHECK-NEXT:   V6_vS32b_qpred_ai undef [[DEF3]], undef [[DEF]], 0, [[V6_vlalignb1]] :: (store (s1024))
  ; CHECK-NEXT:   ENDLOOP0 %bb.3, implicit-def $pc, implicit-def $lc0, implicit $sa0, implicit $lc0
  ; CHECK-NEXT:   J2_jump %bb.4, implicit-def dead $pc
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.4:
  ; CHECK-NEXT:   PS_jmpret $r31, implicit-def dead $pc
  bb.0:
    successors: %bb.1(0x60000000), %bb.2(0x20000000)
    liveins: $r0, $r1, $r2

    %104:intregs = IMPLICIT_DEF
    %105:predregs = IMPLICIT_DEF
    %106:intregslow8 = IMPLICIT_DEF
    %107:hvxqr = IMPLICIT_DEF
    J2_jumpf undef %105, %bb.2, implicit-def dead $pc
    J2_jump %bb.1, implicit-def dead $pc

  bb.1:
    successors: %bb.4(0x55555555), %bb.2(0x2aaaaaab)

    J2_jumpt undef %105, %bb.4, implicit-def dead $pc
    J2_jump %bb.2, implicit-def dead $pc

  bb.2:
    successors: %bb.3(0x80000000)

    J2_loop0r %bb.3, undef %104, implicit-def $lc0, implicit-def $sa0, implicit-def $usr
    J2_jump %bb.3, implicit-def $pc

  bb.3 (machine-block-address-taken):
    successors: %bb.4(0x04000000), %bb.3(0x7c000000)

    %8:hvxvr = V6_vL32Ub_ai undef %104, 0 :: (load (s1024), align 8)
    %9:hvxwr = IMPLICIT_DEF
    %48:hvxvr = V6_vlalignb undef %9.vsub_lo, undef %8, undef %106
    %56:hvxvr = V6_vlalignb %9.vsub_lo, undef %9.vsub_hi, undef %106
    V6_vS32b_qpred_ai undef %107, undef %104, 0, %56 :: (store (s1024))
    ENDLOOP0 %bb.3, implicit-def $pc, implicit-def $lc0, implicit $sa0, implicit $lc0
    J2_jump %bb.4, implicit-def dead $pc

  bb.4:
    PS_jmpret $r31, implicit-def dead $pc
...
