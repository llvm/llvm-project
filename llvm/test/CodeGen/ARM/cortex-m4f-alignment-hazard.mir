# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 5
# RUN: llc -mtriple=thumbv7-apple-darwin -mcpu=cortex-m4 -verify-machineinstrs -run-pass post-RA-hazard-rec -o - %s | FileCheck %s --check-prefixes=CHECK,DEFAULT
# RUN: llc -mtriple=thumbv7-apple-darwin -mcpu=cortex-m4 -verify-machineinstrs -run-pass post-RA-hazard-rec -o - %s -cortex-m4-alignment-hazard-rec-innermost-loops-only=0 | FileCheck %s --check-prefixes=CHECK,ANY-LOOPS
# RUN: llc -mtriple=thumbv7-apple-darwin -mcpu=cortex-m4 -verify-machineinstrs -run-pass post-RA-hazard-rec -o - %s -cortex-m4-alignment-hazard-rec-loops-only=0 | FileCheck %s --check-prefixes=CHECK,ANY-BLOCK

---
name:            alignment_hazards_in_double_loop
alignment:       4
body:             |
  ; DEFAULT-LABEL: name: alignment_hazards_in_double_loop
  ; DEFAULT: bb.0 (align 4):
  ; DEFAULT-NEXT:   successors: %bb.1(0x80000000)
  ; DEFAULT-NEXT: {{  $}}
  ; DEFAULT-NEXT: bb.1 (align 4):
  ; DEFAULT-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; DEFAULT-NEXT: {{  $}}
  ; DEFAULT-NEXT:   renamable $s2 = VLDRS renamable $r3, 4, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2 = t2LSRri renamable $lr, 1, 14 /* CC::al */, $noreg, $noreg
  ; DEFAULT-NEXT:   renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; DEFAULT-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; DEFAULT-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $s6 = VLDRS renamable $r3, 6, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   tBcc %bb.1, 1 /* CC::ne */, killed $cpsr
  ; DEFAULT-NEXT: {{  $}}
  ; DEFAULT-NEXT: bb.2 (align 4):
  ; DEFAULT-NEXT:   successors: %bb.0(0x40000000), %bb.3(0x40000000)
  ; DEFAULT-NEXT: {{  $}}
  ; DEFAULT-NEXT:   renamable $s2 = VLDRS renamable $r3, 4, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2 = t2LSRri renamable $lr, 1, 14 /* CC::al */, $noreg, $noreg
  ; DEFAULT-NEXT:   renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $s6 = VLDRS renamable $r3, 6, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   tBcc %bb.0, 1 /* CC::ne */, killed $cpsr
  ; DEFAULT-NEXT: {{  $}}
  ; DEFAULT-NEXT: bb.3:
  ; DEFAULT-NEXT:   renamable $s2 = VLDRS renamable $r3, 4, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2 = t2LSRri renamable $lr, 1, 14 /* CC::al */, $noreg, $noreg
  ; DEFAULT-NEXT:   renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   renamable $s6 = VLDRS renamable $r3, 6, 14 /* CC::al */, $noreg
  ; DEFAULT-NEXT:   tPOP_RET 14 /* CC::al */, $noreg, def $r4, def $r6, def $r7, def $pc
  ;
  ; ANY-LOOPS-LABEL: name: alignment_hazards_in_double_loop
  ; ANY-LOOPS: bb.0 (align 4):
  ; ANY-LOOPS-NEXT:   successors: %bb.1(0x80000000)
  ; ANY-LOOPS-NEXT: {{  $}}
  ; ANY-LOOPS-NEXT: bb.1 (align 4):
  ; ANY-LOOPS-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; ANY-LOOPS-NEXT: {{  $}}
  ; ANY-LOOPS-NEXT:   renamable $s2 = VLDRS renamable $r3, 4, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2 = t2LSRri renamable $lr, 1, 14 /* CC::al */, $noreg, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-LOOPS-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-LOOPS-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $s6 = VLDRS renamable $r3, 6, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   tBcc %bb.1, 1 /* CC::ne */, killed $cpsr
  ; ANY-LOOPS-NEXT: {{  $}}
  ; ANY-LOOPS-NEXT: bb.2 (align 4):
  ; ANY-LOOPS-NEXT:   successors: %bb.0(0x40000000), %bb.3(0x40000000)
  ; ANY-LOOPS-NEXT: {{  $}}
  ; ANY-LOOPS-NEXT:   renamable $s2 = VLDRS renamable $r3, 4, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2 = t2LSRri renamable $lr, 1, 14 /* CC::al */, $noreg, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-LOOPS-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-LOOPS-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $s6 = VLDRS renamable $r3, 6, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   tBcc %bb.0, 1 /* CC::ne */, killed $cpsr
  ; ANY-LOOPS-NEXT: {{  $}}
  ; ANY-LOOPS-NEXT: bb.3:
  ; ANY-LOOPS-NEXT:   renamable $s2 = VLDRS renamable $r3, 4, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2 = t2LSRri renamable $lr, 1, 14 /* CC::al */, $noreg, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   renamable $s6 = VLDRS renamable $r3, 6, 14 /* CC::al */, $noreg
  ; ANY-LOOPS-NEXT:   tPOP_RET 14 /* CC::al */, $noreg, def $r4, def $r6, def $r7, def $pc
  ;
  ; ANY-BLOCK-LABEL: name: alignment_hazards_in_double_loop
  ; ANY-BLOCK: bb.0 (align 4):
  ; ANY-BLOCK-NEXT:   successors: %bb.1(0x80000000)
  ; ANY-BLOCK-NEXT: {{  $}}
  ; ANY-BLOCK-NEXT: bb.1 (align 4):
  ; ANY-BLOCK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; ANY-BLOCK-NEXT: {{  $}}
  ; ANY-BLOCK-NEXT:   renamable $s2 = VLDRS renamable $r3, 4, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2 = t2LSRri renamable $lr, 1, 14 /* CC::al */, $noreg, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-BLOCK-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-BLOCK-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $s6 = VLDRS renamable $r3, 6, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   tBcc %bb.1, 1 /* CC::ne */, killed $cpsr
  ; ANY-BLOCK-NEXT: {{  $}}
  ; ANY-BLOCK-NEXT: bb.2 (align 4):
  ; ANY-BLOCK-NEXT:   successors: %bb.0(0x40000000), %bb.3(0x40000000)
  ; ANY-BLOCK-NEXT: {{  $}}
  ; ANY-BLOCK-NEXT:   renamable $s2 = VLDRS renamable $r3, 4, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2 = t2LSRri renamable $lr, 1, 14 /* CC::al */, $noreg, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-BLOCK-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-BLOCK-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $s6 = VLDRS renamable $r3, 6, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   tBcc %bb.0, 1 /* CC::ne */, killed $cpsr
  ; ANY-BLOCK-NEXT: {{  $}}
  ; ANY-BLOCK-NEXT: bb.3:
  ; ANY-BLOCK-NEXT:   renamable $s2 = VLDRS renamable $r3, 4, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2 = t2LSRri renamable $lr, 1, 14 /* CC::al */, $noreg, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-BLOCK-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   HINT 0, 14 /* CC::al */, 0
  ; ANY-BLOCK-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   $s2 = VMOVSR $r1, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   renamable $s6 = VLDRS renamable $r3, 6, 14 /* CC::al */, $noreg
  ; ANY-BLOCK-NEXT:   tPOP_RET 14 /* CC::al */, $noreg, def $r4, def $r6, def $r7, def $pc
  bb.0 (align 4):
    successors: %bb.1

  bb.1 (align 4):
    successors: %bb.1, %bb.2

    renamable $s2 = VLDRS renamable $r3, 4, 14, $noreg
    renamable $r2 = t2LSRri renamable $lr, 1, 14, $noreg, $noreg
    renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14, $noreg
    $s2 = VMOVSR $r1, 14, $noreg
    renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14, $noreg
    $s2 = VMOVSR $r1, 14, $noreg
    renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14, $noreg
    renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14, $noreg
    $s2 = VMOVSR $r1, 14, $noreg
    renamable $s6 = VLDRS renamable $r3, 6, 14, $noreg
    tBcc %bb.1, 1, killed $cpsr

  bb.2 (align 4):
    successors: %bb.0, %bb.3

    renamable $s2 = VLDRS renamable $r3, 4, 14, $noreg
    renamable $r2 = t2LSRri renamable $lr, 1, 14, $noreg, $noreg
    renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14, $noreg
    $s2 = VMOVSR $r1, 14, $noreg
    renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14, $noreg
    $s2 = VMOVSR $r1, 14, $noreg
    renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14, $noreg
    renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14, $noreg
    $s2 = VMOVSR $r1, 14, $noreg
    renamable $s6 = VLDRS renamable $r3, 6, 14, $noreg
    tBcc %bb.0, 1, killed $cpsr

  bb.3:
    renamable $s2 = VLDRS renamable $r3, 4, 14, $noreg
    renamable $r2 = t2LSRri renamable $lr, 1, 14, $noreg, $noreg
    renamable $r1, dead $cpsr = tLSRri renamable $r2, 1, 14, $noreg
    $s2 = VMOVSR $r1, 14, $noreg
    renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14, $noreg
    $s2 = VMOVSR $r1, 14, $noreg
    renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14, $noreg
    renamable $r2, dead $cpsr = tLSRri renamable $r1, 1, 14, $noreg
    $s2 = VMOVSR $r1, 14, $noreg
    renamable $s6 = VLDRS renamable $r3, 6, 14, $noreg
    tPOP_RET 14, $noreg, def $r4, def $r6, def $r7, def $pc
...
