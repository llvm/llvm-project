; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: opt -Os -mtriple=avr-none < %s | llc -mtriple=avr-none -mcpu=attiny85 -verify-machineinstrs | FileCheck %s

@c = dso_local global i8 0, align 1
@ti = dso_local global i16 0, align 1

define dso_local void @mod(i16 noundef %0) local_unnamed_addr addrspace(1) {
; CHECK-LABEL: mod:
; CHECK:       ; %bb.0:
; CHECK-NEXT:    push r14
; CHECK-NEXT:    push r16
; CHECK-NEXT:    push r17
; CHECK-NEXT:    cpi r24, 10
; CHECK-NEXT:    cpc r25, r1
; CHECK-NEXT:    brlo .LBB0_2
; CHECK-NEXT:  ; %bb.1: ; %tailrecurse.preheader
; CHECK-NEXT:    ldi r18, 205
; CHECK-NEXT:    ldi r19, 204
; CHECK-NEXT:    ldi r20, 0
; CHECK-NEXT:    ldi r21, 0
; CHECK-NEXT:    movw r22, r24
; CHECK-NEXT:    mov r14, r24
; CHECK-NEXT:    movw r24, r20
; CHECK-NEXT:    rcall __mulsi3
; CHECK-NEXT:    movw r16, r24
; CHECK-NEXT:    lsr r17
; CHECK-NEXT:    ror r16
; CHECK-NEXT:    lsr r17
; CHECK-NEXT:    ror r16
; CHECK-NEXT:    lsr r17
; CHECK-NEXT:    ror r16
; CHECK-NEXT:    movw r24, r16
; CHECK-NEXT:    rcall mod
; CHECK-NEXT:    mov r24, r16
; CHECK-NEXT:    ldi r22, -10
; CHECK-NEXT:    rcall __mulqi3
; CHECK-NEXT:    add r24, r14
; CHECK-NEXT:  .LBB0_2: ; %tailrecurse._crit_edge
; CHECK-NEXT:    ori r24, 48
; CHECK-NEXT:    sts c, r24
; CHECK-NEXT:    pop r17
; CHECK-NEXT:    pop r16
; CHECK-NEXT:    pop r14
; CHECK-NEXT:    ret
  %2 = alloca i16, align 1
  store i16 %0, ptr %2, align 1
  %3 = load i16, ptr %2, align 1
  %4 = icmp ugt i16 %3, 9
  br i1 %4, label %5, label %10

5:                                                ; preds = %1
  %6 = load i16, ptr %2, align 1
  %7 = udiv i16 %6, 10
  call addrspace(1) void @mod(i16 noundef %7)
  %8 = load i16, ptr %2, align 1
  %9 = urem i16 %8, 10
  call addrspace(1) void @mod(i16 noundef %9)
  br label %14

10:                                               ; preds = %1
  %11 = load i16, ptr %2, align 1
  %12 = add i16 48, %11
  %13 = trunc i16 %12 to i8
  store volatile i8 %13, ptr @c, align 1
  br label %14

14:                                               ; preds = %10, %5
  ret void
}

define dso_local void @t(i16 noundef %0) addrspace(1) {
; CHECK-LABEL: t:
; CHECK:       ; %bb.0:
; CHECK-NEXT:    ldi r22, 57
; CHECK-NEXT:    rcall __mulqi3
; CHECK-NEXT:    mov r25, r24
; CHECK-NEXT:    lsl r25
; CHECK-NEXT:    sbc r25, r25
; CHECK-NEXT:    sts ti+1, r25
; CHECK-NEXT:    sts ti, r24
; CHECK-NEXT:    ret
  %2 = alloca i16, align 1
  store i16 %0, ptr %2, align 1
  %3 = load i16, ptr %2, align 1
  %4 = mul nsw i16 57, %3
  %5 = trunc i16 %4 to i8
  %6 = sext i8 %5 to i16
  store i16 %6, ptr @ti, align 1
  ret void
}
