; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=avr-none -verify-machineinstrs | FileCheck %s

@ci = dso_local global [30 x i16] zeroinitializer, align 1
declare dso_local void @foo(i16 noundef) addrspace(1)
define void @loopreduce() {
; CHECK-LABEL: loopreduce:
; CHECK:       ; %bb.0: ; %entry
; CHECK-NEXT:    push r14
; CHECK-NEXT:    push r15
; CHECK-NEXT:    push r16
; CHECK-NEXT:    push r17
; CHECK-NEXT:    ldi r26, lo8(ci)
; CHECK-NEXT:    ldi r27, hi8(ci)
; CHECK-NEXT:    ldi r16, lo8(ci+60)
; CHECK-NEXT:    ldi r17, hi8(ci+60)
; CHECK-NEXT:  .LBB0_1: ; %for.body
; CHECK-NEXT:    ; =>This Inner Loop Header: Depth=1
; CHECK-NEXT:    ld r24, X+
; CHECK-NEXT:    ld r25, X+
; CHECK-NEXT:    mov r14, r26
; CHECK-NEXT:    mov r15, r27
; CHECK-NEXT:    rcall foo
; CHECK-NEXT:    mov r26, r14
; CHECK-NEXT:    mov r27, r15
; CHECK-NEXT:    cp r26, r16
; CHECK-NEXT:    cpc r27, r17
; CHECK-NEXT:    brne .LBB0_1
; CHECK-NEXT:  ; %bb.2: ; %for.cond.cleanup
; CHECK-NEXT:    pop r17
; CHECK-NEXT:    pop r16
; CHECK-NEXT:    pop r15
; CHECK-NEXT:    pop r14
; CHECK-NEXT:    ret
entry:
  br label %for.body
for.body:                                         ; preds = %entry, %for.body
  %i.03 = phi i16 [ 0, %entry ], [ %inc, %for.body ]
  %arrayidx = getelementptr inbounds nuw [30 x i16], ptr @ci, i16 0, i16 %i.03
  %0 = load i16, ptr %arrayidx, align 1
  tail call addrspace(1) void @foo(i16 noundef %0) #3
  %inc = add nuw nsw i16 %i.03, 1
  %exitcond.not = icmp eq i16 %inc, 30
  br i1 %exitcond.not, label %for.cond.cleanup, label %for.body
; Exit blocks
for.cond.cleanup:                                 ; preds = %for.body
  ret void
}
