; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=wasm32-unknown-unknown | FileCheck %s --check-prefix=WASM32
; RUN: llc < %s -mtriple=wasm64-unknown-unknown | FileCheck %s --check-prefix=WASM64
; RUN: llc < %s -mtriple=wasm32-unknown-unknown -mattr=+component-model-thread-context | FileCheck %s --check-prefix=WASM32-CMTC

declare ptr @llvm.thread.pointer()

define ptr @thread_pointer() nounwind {
; WASM32-LABEL: thread_pointer:
; WASM32:         .functype thread_pointer () -> (i32)
; WASM32-NEXT:  # %bb.0:
; WASM32-NEXT:    global.get __tls_base
; WASM32-NEXT:    # fallthrough-return
;
; WASM64-LABEL: thread_pointer:
; WASM64:         .functype thread_pointer () -> (i64)
; WASM64-NEXT:  # %bb.0:
; WASM64-NEXT:    global.get __tls_base
; WASM64-NEXT:    # fallthrough-return
;
; WASM32-CMTC-LABEL: thread_pointer:
; WASM32-CMTC:         .functype thread_pointer () -> (i32)
; WASM32-CMTC-NEXT:  # %bb.0:
; WASM32-CMTC-NEXT:    call __wasm_component_model_builtin_context_get_1
; WASM32-CMTC-NEXT:    # fallthrough-return
;
  %1 = tail call ptr @llvm.thread.pointer()
  ret ptr %1
}
