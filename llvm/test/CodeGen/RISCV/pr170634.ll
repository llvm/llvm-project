; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 6
; RUN: llc -mtriple=riscv64 -O1 < %s | FileCheck %s

declare { i64, i1 } @llvm.usub.with.overflow.i64(i64, i64)

; Test that usub.with.overflow generates efficient code without extra mv instruction
define i64 @test_usubo_no_extra_mv(i64 %x, i64 %y) {
; CHECK-LABEL: test_usubo_no_extra_mv:
; CHECK:       # %bb.0:
; CHECK-NEXT:    bltu a1, a0, .LBB0_2
; CHECK-NEXT:  # %bb.1:
; CHECK-NEXT:    sub a0, a0, a1
; CHECK-NEXT:    ret
; CHECK-NEXT:  .LBB0_2:
; CHECK-NEXT:    li a0, 291
; CHECK-NEXT:    ret
  %res = call { i64, i1 } @llvm.usub.with.overflow.i64(i64 %x, i64 %y)
  %val = extractvalue { i64, i1 } %res, 0
  %ovf = extractvalue { i64, i1 } %res, 1
  %ret = select i1 %ovf, i64 291, i64 %val
  ret i64 %ret
}
