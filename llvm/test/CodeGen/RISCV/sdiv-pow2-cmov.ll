; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple=riscv64 -mattr=+c,+m -verify-machineinstrs < %s \
; RUN:   | FileCheck -check-prefixes=CHECK,NOSFB %s
; RUN: llc -mtriple=riscv64 -mcpu=sifive-u74 -verify-machineinstrs < %s \
; RUN:   | FileCheck -check-prefixes=CHECK,SFB %s

define signext i32 @sdiv2_32(i32 signext %0) {
; CHECK-LABEL: sdiv2_32:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srliw a1, a0, 31
; CHECK-NEXT:    add a0, a0, a1
; CHECK-NEXT:    sraiw a0, a0, 1
; CHECK-NEXT:    ret
  %res = sdiv i32 %0, 2
  ret i32 %res
}

define signext i32 @sdivneg2_32(i32 signext %0) {
; CHECK-LABEL: sdivneg2_32:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srliw a1, a0, 31
; CHECK-NEXT:    add a0, a0, a1
; CHECK-NEXT:    sraiw a0, a0, 1
; CHECK-NEXT:    neg a0, a0
; CHECK-NEXT:    ret
  %res = sdiv i32 %0, -2
  ret i32 %res
}

define i64 @sdiv2_64(i64 %0) {
; CHECK-LABEL: sdiv2_64:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srli a1, a0, 63
; CHECK-NEXT:    add a0, a0, a1
; CHECK-NEXT:    srai a0, a0, 1
; CHECK-NEXT:    ret
  %res = sdiv i64 %0, 2
  ret i64 %res
}

define i64 @sdivneg2_64(i64 %0) {
; CHECK-LABEL: sdivneg2_64:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srli a1, a0, 63
; CHECK-NEXT:    add a0, a0, a1
; CHECK-NEXT:    srai a0, a0, 1
; CHECK-NEXT:    neg a0, a0
; CHECK-NEXT:    ret
  %res = sdiv i64 %0, -2
  ret i64 %res
}

define signext i32 @srem2_32(i32 signext %0) {
; CHECK-LABEL: srem2_32:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srliw a1, a0, 31
; CHECK-NEXT:    add a1, a1, a0
; CHECK-NEXT:    andi a1, a1, -2
; CHECK-NEXT:    subw a0, a0, a1
; CHECK-NEXT:    ret
  %res = srem i32 %0, 2
  ret i32 %res
}

define signext i32 @sremneg2_32(i32 signext %0) {
; CHECK-LABEL: sremneg2_32:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srliw a1, a0, 31
; CHECK-NEXT:    add a1, a1, a0
; CHECK-NEXT:    andi a1, a1, -2
; CHECK-NEXT:    subw a0, a0, a1
; CHECK-NEXT:    ret
  %res = srem i32 %0, -2
  ret i32 %res
}

define i64 @srem2_64(i64 %0) {
; CHECK-LABEL: srem2_64:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srli a1, a0, 63
; CHECK-NEXT:    add a1, a1, a0
; CHECK-NEXT:    andi a1, a1, -2
; CHECK-NEXT:    sub a0, a0, a1
; CHECK-NEXT:    ret
  %res = srem i64 %0, 2
  ret i64 %res
}

define i64 @sremneg2_64(i64 %0) {
; CHECK-LABEL: sremneg2_64:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srli a1, a0, 63
; CHECK-NEXT:    add a1, a1, a0
; CHECK-NEXT:    andi a1, a1, -2
; CHECK-NEXT:    sub a0, a0, a1
; CHECK-NEXT:    ret
  %res = srem i64 %0, -2
  ret i64 %res
}

define signext i32 @sdiv8_32(i32 signext %0) {
; CHECK-LABEL: sdiv8_32:
; CHECK:       # %bb.0:
; CHECK-NEXT:    slli a1, a0, 1
; CHECK-NEXT:    srli a1, a1, 61
; CHECK-NEXT:    add a0, a0, a1
; CHECK-NEXT:    sraiw a0, a0, 3
; CHECK-NEXT:    ret
  %res = sdiv i32 %0, 8
  ret i32 %res
}

define signext i32 @sdivneg8_32(i32 signext %0) {
; CHECK-LABEL: sdivneg8_32:
; CHECK:       # %bb.0:
; CHECK-NEXT:    slli a1, a0, 1
; CHECK-NEXT:    srli a1, a1, 61
; CHECK-NEXT:    add a0, a0, a1
; CHECK-NEXT:    sraiw a0, a0, 3
; CHECK-NEXT:    neg a0, a0
; CHECK-NEXT:    ret
  %res = sdiv i32 %0, -8
  ret i32 %res
}

define i64 @sdiv8_64(i64 %0) {
; CHECK-LABEL: sdiv8_64:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srai a1, a0, 63
; CHECK-NEXT:    srli a1, a1, 61
; CHECK-NEXT:    add a0, a0, a1
; CHECK-NEXT:    srai a0, a0, 3
; CHECK-NEXT:    ret
  %res = sdiv i64 %0, 8
  ret i64 %res
}

define i64 @sdivneg8_64(i64 %0) {
; CHECK-LABEL: sdivneg8_64:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srai a1, a0, 63
; CHECK-NEXT:    srli a1, a1, 61
; CHECK-NEXT:    add a0, a0, a1
; CHECK-NEXT:    srai a0, a0, 3
; CHECK-NEXT:    neg a0, a0
; CHECK-NEXT:    ret
  %res = sdiv i64 %0, -8
  ret i64 %res
}

define signext i32 @srem8_32(i32 signext %0) {
; CHECK-LABEL: srem8_32:
; CHECK:       # %bb.0:
; CHECK-NEXT:    slli a1, a0, 1
; CHECK-NEXT:    srli a1, a1, 61
; CHECK-NEXT:    add a1, a1, a0
; CHECK-NEXT:    andi a1, a1, -8
; CHECK-NEXT:    subw a0, a0, a1
; CHECK-NEXT:    ret
  %res = srem i32 %0, 8
  ret i32 %res
}

define signext i32 @sremneg8_32(i32 signext %0) {
; CHECK-LABEL: sremneg8_32:
; CHECK:       # %bb.0:
; CHECK-NEXT:    slli a1, a0, 1
; CHECK-NEXT:    srli a1, a1, 61
; CHECK-NEXT:    add a1, a1, a0
; CHECK-NEXT:    andi a1, a1, -8
; CHECK-NEXT:    subw a0, a0, a1
; CHECK-NEXT:    ret
  %res = srem i32 %0, -8
  ret i32 %res
}

define i64 @srem8_64(i64 %0) {
; CHECK-LABEL: srem8_64:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srai a1, a0, 63
; CHECK-NEXT:    srli a1, a1, 61
; CHECK-NEXT:    add a1, a1, a0
; CHECK-NEXT:    andi a1, a1, -8
; CHECK-NEXT:    sub a0, a0, a1
; CHECK-NEXT:    ret
  %res = srem i64 %0, 8
  ret i64 %res
}

define i64 @sremneg8_64(i64 %0) {
; CHECK-LABEL: sremneg8_64:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srai a1, a0, 63
; CHECK-NEXT:    srli a1, a1, 61
; CHECK-NEXT:    add a1, a1, a0
; CHECK-NEXT:    andi a1, a1, -8
; CHECK-NEXT:    sub a0, a0, a1
; CHECK-NEXT:    ret
  %res = srem i64 %0, -8
  ret i64 %res
}

; Negative tests
define i64 @sdiv4096(i64 %0) {
; CHECK-LABEL: sdiv4096:
; CHECK:       # %bb.0:
; CHECK-NEXT:    srai a1, a0, 63
; CHECK-NEXT:    srli a1, a1, 52
; CHECK-NEXT:    add a0, a0, a1
; CHECK-NEXT:    srai a0, a0, 12
; CHECK-NEXT:    ret
  %res = sdiv i64 %0, 4096
  ret i64 %res
}
;; NOTE: These prefixes are unused and the list is autogenerated. Do not add tests below this line:
; NOSFB: {{.*}}
; SFB: {{.*}}
