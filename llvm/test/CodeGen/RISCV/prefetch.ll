; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple=riscv32 -verify-machineinstrs < %s | FileCheck -check-prefix=NOZICBOP %s
; RUN: llc -mtriple=riscv64 -verify-machineinstrs < %s | FileCheck -check-prefix=NOZICBOP %s
; RUN: llc -mtriple=riscv32 -mattr=+zicbop -verify-machineinstrs < %s | FileCheck -check-prefix=ZICBOP %s
; RUN: llc -mtriple=riscv64 -mattr=+zicbop -verify-machineinstrs < %s | FileCheck -check-prefix=ZICBOP %s
; RUN: llc -mtriple=riscv64 -mattr=+zicbop,+zihintntl -verify-machineinstrs < %s | FileCheck -check-prefix=ZICBOP %s

define void @test_prefetch_read_locality_0(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_read_locality_0:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_read_locality_0:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_write_locality_0(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_write_locality_0:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_write_locality_0:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.w 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 1, i32 0, i32 1)
  ret void
}

define void @test_prefetch_instruction_locality_0(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_instruction_locality_0:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_instruction_locality_0:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.i 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 0, i32 0, i32 0)
  ret void
}

define void @test_prefetch_read_locality_1(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_read_locality_1:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_read_locality_1:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.pall
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 0, i32 1, i32 1)
  ret void
}

define void @test_prefetch_write_locality_1(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_write_locality_1:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_write_locality_1:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.pall
; ZICBOP-NEXT:    prefetch.w 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 1, i32 1, i32 1)
  ret void
}

define void @test_prefetch_instruction_locality_1(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_instruction_locality_1:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_instruction_locality_1:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.pall
; ZICBOP-NEXT:    prefetch.i 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 0, i32 1, i32 0)
  ret void
}

define void @test_prefetch_read_locality_2(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_read_locality_2:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_read_locality_2:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.p1
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 0, i32 2, i32 1)
  ret void
}

define void @test_prefetch_write_locality_2(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_write_locality_2:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_write_locality_2:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.p1
; ZICBOP-NEXT:    prefetch.w 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 1, i32 2, i32 1)
  ret void
}

define void @test_prefetch_instruction_locality_2(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_instruction_locality_2:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_instruction_locality_2:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.p1
; ZICBOP-NEXT:    prefetch.i 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 0, i32 2, i32 0)
  ret void
}

define void @test_prefetch_read_locality_3(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_read_locality_3:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_read_locality_3:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 0, i32 3, i32 1)
  ret void
}

define void @test_prefetch_write_locality_3(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_write_locality_3:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_write_locality_3:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    prefetch.w 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 1, i32 3, i32 1)
  ret void
}

define void @test_prefetch_instruction_locality_3(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_instruction_locality_3:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_instruction_locality_3:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    prefetch.i 0(a0)
; ZICBOP-NEXT:    ret
  call void @llvm.prefetch(ptr %a, i32 0, i32 3, i32 0)
  ret void
}

define void @test_prefetch_offsetable_0(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_0:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_0:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 2016(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 2016
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_offsetable_1(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_1:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_1:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -2048(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 -2048
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_offsetable_2(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_2:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_2:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 32(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 32
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_offsetable_3(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_3:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_3:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -32(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 -32
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_offsetable_4(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_4:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_4:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi a0, a0, 32
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 2016(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 2048
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_offsetable_5(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_5:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_5:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi a0, a0, -1
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -2048(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 -2049
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_offsetable_6(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_6:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_6:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi a0, a0, 16
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 16
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_offsetable_7(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_7:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_7:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi a0, a0, -16
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 -16
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_offsetable_9(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_9:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_9:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a1, 1
; ZICBOP-NEXT:    add a0, a0, a1
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 64(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 4160
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_offsetable_8(ptr %a) nounwind {
; NOZICBOP-LABEL: test_prefetch_offsetable_8:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_offsetable_8:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a1, 1048575
; ZICBOP-NEXT:    add a0, a0, a1
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -64(a0)
; ZICBOP-NEXT:    ret
  %addr = getelementptr i8, ptr %a, i64 -4160
  call void @llvm.prefetch(ptr %addr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_0() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_0:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    addi sp, sp, -512
; NOZICBOP-NEXT:    addi sp, sp, 512
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_0:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi sp, sp, -512
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(sp)
; ZICBOP-NEXT:    addi sp, sp, 512
; ZICBOP-NEXT:    ret
  %data = alloca [128 x i32], align 4
  %base = bitcast ptr %data to ptr
  %ptr = getelementptr [128 x i32], ptr %base, i32 0, i32 0
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_1() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_1:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    lui a0, 1
; NOZICBOP-NEXT:    addi a0, a0, 16
; NOZICBOP-NEXT:    sub sp, sp, a0
; NOZICBOP-NEXT:    lui a0, 1
; NOZICBOP-NEXT:    addi a0, a0, 16
; NOZICBOP-NEXT:    add sp, sp, a0
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_1:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, 1
; ZICBOP-NEXT:    addi a0, a0, 16
; ZICBOP-NEXT:    sub sp, sp, a0
; ZICBOP-NEXT:    addi a0, sp, 16
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    lui a0, 1
; ZICBOP-NEXT:    addi a0, a0, 16
; ZICBOP-NEXT:    add sp, sp, a0
; ZICBOP-NEXT:    ret
  %data = alloca [1024 x i32], align 4
  %ptr = bitcast ptr %data to ptr
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_2() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_2:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    addi sp, sp, -512
; NOZICBOP-NEXT:    addi sp, sp, 512
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_2:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi sp, sp, -512
; ZICBOP-NEXT:    addi a0, sp, 16
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    addi sp, sp, 512
; ZICBOP-NEXT:    ret
  %data = alloca [128 x i32], align 4
  %base = bitcast ptr %data to ptr
  %ptr = getelementptr [128 x i32], ptr %base, i32 0, i32 4
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_3() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_3:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    addi sp, sp, -512
; NOZICBOP-NEXT:    addi sp, sp, 512
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_3:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi sp, sp, -512
; ZICBOP-NEXT:    addi a0, sp, -16
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    addi sp, sp, 512
; ZICBOP-NEXT:    ret
  %data = alloca [128 x i32], align 4
  %base = bitcast ptr %data to ptr
  %ptr = getelementptr [128 x i32], ptr %base, i32 0, i32 -4
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_4() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_4:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    addi sp, sp, -512
; NOZICBOP-NEXT:    addi sp, sp, 512
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_4:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi sp, sp, -512
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 32(sp)
; ZICBOP-NEXT:    addi sp, sp, 512
; ZICBOP-NEXT:    ret
  %data = alloca [128 x i32], align 4
  %base = bitcast ptr %data to ptr
  %ptr = getelementptr [128 x i32], ptr %base, i32 0, i32 8
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_5() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_5:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    addi sp, sp, -512
; NOZICBOP-NEXT:    addi sp, sp, 512
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_5:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi sp, sp, -512
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -32(sp)
; ZICBOP-NEXT:    addi sp, sp, 512
; ZICBOP-NEXT:    ret
  %data = alloca [128 x i32], align 4
  %base = bitcast ptr %data to ptr
  %ptr = getelementptr [128 x i32], ptr %base, i32 0, i32 -8
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_6() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_6:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    addi sp, sp, -512
; NOZICBOP-NEXT:    addi sp, sp, 512
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_6:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi sp, sp, -512
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 2016(sp)
; ZICBOP-NEXT:    addi sp, sp, 512
; ZICBOP-NEXT:    ret
  %data = alloca [128 x i32], align 4
  %base = bitcast ptr %data to ptr
  %ptr = getelementptr [128 x i32], ptr %base, i32 0, i32 504
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_7() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_7:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    addi sp, sp, -512
; NOZICBOP-NEXT:    addi sp, sp, 512
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_7:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi sp, sp, -512
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -2048(sp)
; ZICBOP-NEXT:    addi sp, sp, 512
; ZICBOP-NEXT:    ret
  %data = alloca [128 x i32], align 4
  %base = bitcast ptr %data to ptr
  %ptr = getelementptr [128 x i32], ptr %base, i32 0, i32 -512
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_8() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_8:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    addi sp, sp, -512
; NOZICBOP-NEXT:    addi sp, sp, 512
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_8:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi sp, sp, -512
; ZICBOP-NEXT:    addi a0, sp, 2020
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    addi sp, sp, 512
; ZICBOP-NEXT:    ret
  %data = alloca [128 x i32], align 4
  %base = bitcast ptr %data to ptr
  %ptr = getelementptr [128 x i32], ptr %base, i32 0, i32 505
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_frameindex_9() nounwind {
; NOZICBOP-LABEL: test_prefetch_frameindex_9:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    addi sp, sp, -512
; NOZICBOP-NEXT:    addi sp, sp, 512
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_frameindex_9:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    addi sp, sp, -512
; ZICBOP-NEXT:    mv a0, sp
; ZICBOP-NEXT:    addi a0, a0, -4
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -2048(a0)
; ZICBOP-NEXT:    addi sp, sp, 512
; ZICBOP-NEXT:    ret
  %data = alloca [128 x i32], align 4
  %base = bitcast ptr %data to ptr
  %ptr = getelementptr [128 x i32], ptr %base, i32 0, i32 -513
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_constant_address_0() nounwind {
; NOZICBOP-LABEL: test_prefetch_constant_address_0:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_constant_address_0:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, 1
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 32(a0)
; ZICBOP-NEXT:    ret
  %ptr = inttoptr i64 4128 to ptr
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_constant_address_1() nounwind {
; NOZICBOP-LABEL: test_prefetch_constant_address_1:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_constant_address_1:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, 1
; ZICBOP-NEXT:    addi a0, a0, 31
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  %ptr = inttoptr i64 4127 to ptr
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_constant_address_2() nounwind {
; NOZICBOP-LABEL: test_prefetch_constant_address_2:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_constant_address_2:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, 1048561
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 32(a0)
; ZICBOP-NEXT:    ret
  %ptr = inttoptr i64 18446744073709490208 to ptr
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_constant_address_3() nounwind {
; NOZICBOP-LABEL: test_prefetch_constant_address_3:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_constant_address_3:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, 1048561
; ZICBOP-NEXT:    addi a0, a0, 31
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  %ptr = inttoptr i64 18446744073709490207 to ptr
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

@g = external global [1024 x i32], align 4

define void @test_prefetch_global_0() nounwind {
; NOZICBOP-LABEL: test_prefetch_global_0:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_global_0:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, %hi(g)
; ZICBOP-NEXT:    addi a0, a0, %lo(g)
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  %ptr = getelementptr [1024 x i32], ptr @g, i32 0, i32 0
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_global_1() nounwind {
; NOZICBOP-LABEL: test_prefetch_global_1:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_global_1:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, %hi(g+16)
; ZICBOP-NEXT:    addi a0, a0, %lo(g+16)
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  %ptr = getelementptr [1024 x i32], ptr @g, i32 0, i32 4
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_global_2() nounwind {
; NOZICBOP-LABEL: test_prefetch_global_2:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_global_2:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, %hi(g-16)
; ZICBOP-NEXT:    addi a0, a0, %lo(g-16)
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  %ptr = getelementptr [1024 x i32], ptr @g, i32 0, i32 -4
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_global_3() nounwind {
; NOZICBOP-LABEL: test_prefetch_global_3:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_global_3:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, %hi(g)
; ZICBOP-NEXT:    addi a0, a0, %lo(g)
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 32(a0)
; ZICBOP-NEXT:    ret
  %ptr = getelementptr [1024 x i32], ptr @g, i32 0, i32 8
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_global_4() nounwind {
; NOZICBOP-LABEL: test_prefetch_global_4:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_global_4:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, %hi(g)
; ZICBOP-NEXT:    addi a0, a0, %lo(g)
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -32(a0)
; ZICBOP-NEXT:    ret
  %ptr = getelementptr [1024 x i32], ptr @g, i32 0, i32 -8
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_global_5() nounwind {
; NOZICBOP-LABEL: test_prefetch_global_5:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_global_5:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, %hi(g)
; ZICBOP-NEXT:    addi a0, a0, %lo(g)
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 2016(a0)
; ZICBOP-NEXT:    ret
  %ptr = getelementptr [1024 x i32], ptr @g, i32 0, i32 504
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_global_6() nounwind {
; NOZICBOP-LABEL: test_prefetch_global_6:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_global_6:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, %hi(g)
; ZICBOP-NEXT:    addi a0, a0, %lo(g)
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -2048(a0)
; ZICBOP-NEXT:    ret
  %ptr = getelementptr [1024 x i32], ptr @g, i32 0, i32 -512
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_global_7() nounwind {
; NOZICBOP-LABEL: test_prefetch_global_7:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_global_7:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, %hi(g+2020)
; ZICBOP-NEXT:    addi a0, a0, %lo(g+2020)
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r 0(a0)
; ZICBOP-NEXT:    ret
  %ptr = getelementptr [1024 x i32], ptr @g, i32 0, i32 505
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}

define void @test_prefetch_global_8() nounwind {
; NOZICBOP-LABEL: test_prefetch_global_8:
; NOZICBOP:       # %bb.0:
; NOZICBOP-NEXT:    ret
; ZICBOP-LABEL: test_prefetch_global_8:
; ZICBOP:       # %bb.0:
; ZICBOP-NEXT:    lui a0, %hi(g-4)
; ZICBOP-NEXT:    addi a0, a0, %lo(g-4)
; ZICBOP-NEXT:    ntl.all
; ZICBOP-NEXT:    prefetch.r -2048(a0)
; ZICBOP-NEXT:    ret
  %ptr = getelementptr [1024 x i32], ptr @g, i32 0, i32 -513
  call void @llvm.prefetch(ptr %ptr, i32 0, i32 0, i32 1)
  ret void
}
