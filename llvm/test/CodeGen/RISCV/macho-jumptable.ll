; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc -mtriple=riscv32-apple-none-macho -verify-machineinstrs < %s | FileCheck %s

; Test that jump tables are placed in the function section for Mach-O targets.
; The shouldPutJumpTableInFunctionSection override should return true, meaning
; the jump table is emitted inline with the function code rather than in a
; separate data section.

define i32 @jumptable_test(i32 %in) nounwind {
; CHECK-LABEL: jumptable_test:
; CHECK:       ; %bb.0: ; %entry
; CHECK-NEXT:    addi a0, a0, -1
; CHECK-NEXT:    li a1, 5
; CHECK-NEXT:    bltu a1, a0, LBB0_8
; CHECK-NEXT:  ; %bb.1: ; %entry
; CHECK-NEXT:    slli a0, a0, 2
; CHECK-NEXT:  Lpcrel_hi0:
; CHECK-NEXT:    auipc a1, %pcrel_hi(LJTI0_0)
; CHECK-NEXT:    addi a1, a1, %pcrel_lo(Lpcrel_hi0)
; CHECK-NEXT:    add a0, a1, a0
; CHECK-NEXT:    lw a0, 0(a0)
; CHECK-NEXT:    add a0, a1, a0
; CHECK-NEXT:    jr a0
; CHECK-NEXT:  LBB0_2: ; %bb1
; CHECK-NEXT:    li a0, 10
; CHECK-NEXT:    ret
; CHECK-NEXT:  LBB0_3: ; %bb5
; CHECK-NEXT:    li a0, 50
; CHECK-NEXT:    ret
; CHECK-NEXT:  LBB0_4: ; %bb3
; CHECK-NEXT:    li a0, 30
; CHECK-NEXT:    ret
; CHECK-NEXT:  LBB0_5: ; %bb4
; CHECK-NEXT:    li a0, 40
; CHECK-NEXT:    ret
; CHECK-NEXT:  LBB0_6: ; %bb2
; CHECK-NEXT:    li a0, 20
; CHECK-NEXT:    ret
; CHECK-NEXT:  LBB0_7: ; %bb6
; CHECK-NEXT:    li a0, 60
; CHECK-NEXT:    ret
; CHECK-NEXT:  LBB0_8: ; %default
; CHECK-NEXT:    li a0, 0
; CHECK-NEXT:    ret
; CHECK-NEXT:    .p2align 2
; CHECK-NEXT:    .data_region jt32
; CHECK-NEXT:  L0_0_set_2 = LBB0_2-LJTI0_0
; CHECK-NEXT:  L0_0_set_6 = LBB0_6-LJTI0_0
; CHECK-NEXT:  L0_0_set_4 = LBB0_4-LJTI0_0
; CHECK-NEXT:  L0_0_set_5 = LBB0_5-LJTI0_0
; CHECK-NEXT:  L0_0_set_3 = LBB0_3-LJTI0_0
; CHECK-NEXT:  L0_0_set_7 = LBB0_7-LJTI0_0
; CHECK-NEXT:  LJTI0_0:
; CHECK-NEXT:    .word L0_0_set_2
; CHECK-NEXT:    .word L0_0_set_6
; CHECK-NEXT:    .word L0_0_set_4
; CHECK-NEXT:    .word L0_0_set_5
; CHECK-NEXT:    .word L0_0_set_3
; CHECK-NEXT:    .word L0_0_set_7
; CHECK-NEXT:    .end_data_region
entry:
  switch i32 %in, label %default [
    i32 1, label %bb1
    i32 2, label %bb2
    i32 3, label %bb3
    i32 4, label %bb4
    i32 5, label %bb5
    i32 6, label %bb6
  ]
bb1:
  ret i32 10
bb2:
  ret i32 20
bb3:
  ret i32 30
bb4:
  ret i32 40
bb5:
  ret i32 50
bb6:
  ret i32 60
default:
  ret i32 0
}
