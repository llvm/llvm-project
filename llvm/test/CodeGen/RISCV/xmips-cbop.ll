; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple=riscv32 -mattr=+xmipscbop -mattr=+m -verify-machineinstrs < %s \
; RUN:   | FileCheck %s -check-prefix=RV32XMIPSPREFETCH
; RUN: llc -mtriple=riscv64 -mattr=+xmipscbop -mattr=+m -verify-machineinstrs < %s \
; RUN:   | FileCheck %s -check-prefix=RV64XMIPSPREFETCH

define dso_local void @prefetch_read(ptr noundef %a) {
; RV32XMIPSPREFETCH-LABEL: prefetch_read:
; RV32XMIPSPREFETCH:    mips.perf       8, 511(a0)
;
; RV64XMIPSPREFETCH-LABEL: prefetch_read:
; RV64XMIPSPREFETCH:    mips.perf       8, 511(a0)
entry:
  %a.addr = alloca ptr, align 8
  store ptr %a, ptr %a.addr, align 8
  %0 = load ptr, ptr %a.addr, align 8
  %arrayidx = getelementptr inbounds i8, ptr %0, i64 511
  call void @llvm.prefetch.p0(ptr %arrayidx, i32 0, i32 0, i32 1)
  ret void
}

declare void @llvm.prefetch.p0(ptr readonly captures(none), i32 immarg, i32 immarg, i32 immarg) 

define dso_local void @prefetch_write(ptr noundef %a)  {
entry:
; RV32XMIPSPREFETCH-LABEL: prefetch_write:
; RV32XMIPSPREFETCH:         addi    a1, a0, 512  
; RV32XMIPSPREFETCH-NEXT:    mips.perf       9, 0(a1)
;
; RV64XMIPSPREFETCH-LABEL: prefetch_write:
; RV64XMIPSPREFETCH:         addi    a1, a0, 512 
; RV64XMIPSPREFETCH-NEXT:    mips.perf       9, 0(a1)
  %a.addr = alloca ptr, align 8
  store ptr %a, ptr %a.addr, align 8
  %0 = load ptr, ptr %a.addr, align 8
  %arrayidx = getelementptr inbounds i8, ptr %0, i64 512
  call void @llvm.prefetch.p0(ptr %arrayidx, i32 1, i32 0, i32 1)
  ret void
}

