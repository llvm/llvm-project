; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc -mtriple=aarch64-none-elf < %s | FileCheck %s

define <4 x i32> @arm_mult_q31(ptr %0, ptr %1){
; CHECK-LABEL: arm_mult_q31:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldr q0, [x0]
; CHECK-NEXT:    ldr q1, [x1]
; CHECK-NEXT:    sqdmulh v0.4s, v1.4s, v0.4s
; CHECK-NEXT:    sshr v0.4s, v0.4s, #1
; CHECK-NEXT:    add v0.4s, v0.4s, v0.4s
; CHECK-NEXT:    ret
  %7 = getelementptr i8, ptr %0, i64 0
  %9 = getelementptr i8, ptr %1, i64 0
  %12 = load <4 x i32>, ptr %7, align 4
  %13 = sext <4 x i32> %12 to <4 x i64>
  %14 = load <4 x i32>, ptr %9, align 4
  %15 = sext <4 x i32> %14 to <4 x i64>
  %16 = mul nsw <4 x i64> %15, %13
  %17 = lshr <4 x i64> %16, splat (i64 32)
  %18 = trunc nuw <4 x i64> %17 to <4 x i32>
  %19 = tail call <4 x i32> @llvm.smin.v4i32(<4 x i32> %18, <4 x i32> splat (i32 1073741823))
  %20 = shl <4 x i32> %19, splat (i32 1)
  ret <4 x i32> %20
}
