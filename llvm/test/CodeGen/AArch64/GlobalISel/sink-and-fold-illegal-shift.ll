; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 3
; RUN: llc -global-isel --aarch64-enable-sink-fold=true < %s | FileCheck %s

target triple = "aarch64-linux"

; Test a non-LSL shift cannot be folded into the addressing mode.
define void @f(ptr %p, i64 %i) optsize {
; CHECK-LABEL: f:
; CHECK:       // %bb.0:
; CHECK-NEXT:    add x8, x0, x1, asr #32
; CHECK-NEXT:    strb wzr, [x8]
; CHECK-NEXT:    ret
	%d = ashr i64 %i, 32
	%a = getelementptr i8, ptr %p, i64 %d
	store i8 0, ptr %a
	ret void
}
