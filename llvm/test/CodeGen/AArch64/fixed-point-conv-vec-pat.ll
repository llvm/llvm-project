; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc < %s | FileCheck %s

target triple = "aarch64"

; First some corner cases
define <4 x float> @f_v4_s0(<4 x i32> %u) {
; CHECK-LABEL: f_v4_s0:
; CHECK:       // %bb.0:
; CHECK-NEXT:    scvtf v0.4s, v0.4s
; CHECK-NEXT:    ret
  %s = ashr exact <4 x i32> %u, <i32 0, i32 0, i32 0, i32 0>
  %v = sitofp <4 x i32> %s to <4 x float>
  ret <4 x float> %v
}

define <4 x float> @f_v4_s1(<4 x i32> %u) {
; CHECK-LABEL: f_v4_s1:
; CHECK:       // %bb.0:
; CHECK-NEXT:    scvtf v0.4s, v0.4s, #1
; CHECK-NEXT:    ret
  %s = ashr exact <4 x i32> %u, <i32 1, i32 1, i32 1, i32 1>
  %v = sitofp <4 x i32> %s to <4 x float>
  ret <4 x float> %v
}

define <4 x float> @f_v4_s24_inexact(<4 x i32> %u) {
; CHECK-LABEL: f_v4_s24_inexact:
; CHECK:       // %bb.0:
; CHECK-NEXT:    sshr v0.4s, v0.4s, #24
; CHECK-NEXT:    scvtf v0.4s, v0.4s
; CHECK-NEXT:    ret
  %s = ashr <4 x i32> %u, <i32 24, i32 24, i32 24, i32 24>
  %v = sitofp <4 x i32> %s to <4 x float>
  ret <4 x float> %v
}

define <4 x float> @f_v4_s31(<4 x i32> %u) {
; CHECK-LABEL: f_v4_s31:
; CHECK:       // %bb.0:
; CHECK-NEXT:    cmlt v0.4s, v0.4s, #0
; CHECK-NEXT:    scvtf v0.4s, v0.4s
; CHECK-NEXT:    ret
  %s = ashr <4 x i32> %u, <i32 31, i32 31, i32 31, i32 31>
  %v = sitofp <4 x i32> %s to <4 x float>
  ret <4 x float> %v
}

; Common cases for conversion from signed integer to floating point types
define <2 x float> @f_v2_s24(<2 x i32> %u) {
; CHECK-LABEL: f_v2_s24:
; CHECK:       // %bb.0:
; CHECK-NEXT:    scvtf v0.2s, v0.2s, #24
; CHECK-NEXT:    ret
  %s = ashr exact <2 x i32> %u, <i32 24, i32 24>
  %v = sitofp <2 x i32> %s to <2 x float>
  ret <2 x float> %v
}

define <4 x float> @f_v4_s24(<4 x i32> %u) {
; CHECK-LABEL: f_v4_s24:
; CHECK:       // %bb.0:
; CHECK-NEXT:    scvtf v0.4s, v0.4s, #24
; CHECK-NEXT:    ret
  %s = ashr exact <4 x i32> %u, <i32 24, i32 24, i32 24, i32 24>
  %v = sitofp <4 x i32> %s to <4 x float>
  ret <4 x float> %v
}

; Check legalisation to <2 x f64> does not get in the way
define <8 x double> @d_v8_s64(<8 x i64> %u) {
; CHECK-LABEL: d_v8_s64:
; CHECK:       // %bb.0:
; CHECK-NEXT:    scvtf v0.2d, v0.2d, #56
; CHECK-NEXT:    scvtf v1.2d, v1.2d, #56
; CHECK-NEXT:    scvtf v2.2d, v2.2d, #56
; CHECK-NEXT:    scvtf v3.2d, v3.2d, #56
; CHECK-NEXT:    ret
  %s = ashr exact <8 x i64> %u, <i64 56, i64 56, i64 56, i64 56, i64 56, i64 56, i64 56, i64 56>
  %v = sitofp <8 x i64> %s to <8 x double>
  ret <8 x double> %v
}

define <4 x half> @h_v4_s8(<4 x i16> %u) #0 {
; CHECK-LABEL: h_v4_s8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    scvtf v0.4h, v0.4h, #8
; CHECK-NEXT:    ret
  %s = ashr exact <4 x i16> %u, <i16 8, i16 8, i16 8, i16 8>
  %v = sitofp <4 x i16> %s to <4 x half>
  ret <4 x half> %v
}

define <8 x half> @h_v8_s8(<8 x i16> %u) #0 {
; CHECK-LABEL: h_v8_s8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    scvtf v0.8h, v0.8h, #8
; CHECK-NEXT:    ret
  %s = ashr exact <8 x i16> %u, <i16 8, i16 8, i16 8, i16 8, i16 8, i16 8, i16 8, i16 8>
  %v = sitofp <8 x i16> %s to <8 x half>
  ret <8 x half> %v
}

attributes #0 = { "target-features"="+fullfp16"}
