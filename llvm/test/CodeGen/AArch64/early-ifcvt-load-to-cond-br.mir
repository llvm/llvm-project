# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 6
# RUN: llc -mtriple=aarch64 -mcpu=apple-m1 -run-pass=early-ifcvt -o - %s | FileCheck %s

--- |
  define i32 @arg_to_cond_branch(i32 %val, i32 %x, i32 %y) {
    ret i32 0
  }
  define i32 @load_from_constant_pool_to_cond_branch(ptr %p, i32 %x, i32 %y) {
    ret i32 0
  }
  define i32 @load_from_constant_pool_to_cond_branch_with_cbz(ptr %p, i32 %x, i32 %y) {
    ret i32 0
  }
  define i32 @load_to_cond_branch(ptr %p, i32 %x, i32 %y) {
    ret i32 0
  }
  define i32 @cbz_arg_to_cond_branch(i32 %val, i32 %x, i32 %y) {
    ret i32 0
  }
  define i32 @cbz_load_to_cond_branch(ptr %p, i32 %x, i32 %y) {
    ret i32 0
  }
  define i32 @tbz_arg_to_cond_branch(i32 %val, i32 %x, i32 %y) {
    ret i32 0
  }
  define i32 @tbz_load_to_cond_branch(ptr %p, i32 %x, i32 %y) {
    ret i32 0
  }
  define i32 @mixed_cp_and_mem_load_to_cond_branch(ptr %p, i32 %x, i32 %y) {
    ret i32 0
  }
  define i32 @hot_branch_load_to_cond_branch(ptr %p, i32 %x, i32 %y) {
    ret i32 0
  }
...
---
name:            arg_to_cond_branch
alignment:       4
tracksRegLiveness: true
body:             |
  ; CHECK-LABEL: name: arg_to_cond_branch
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; CHECK-NEXT:   liveins: $w0, $w1, $w2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr32common = COPY $w0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   [[COPY2:%[0-9]+]]:gpr32 = COPY $w2
  ; CHECK-NEXT:   [[SUBSWri:%[0-9]+]]:gpr32 = SUBSWri [[COPY]], 100, 0, implicit-def $nzcv
  ; CHECK-NEXT:   Bcc 12, %bb.2, implicit $nzcv
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY1]], [[COPY2]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY1]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY1]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0

  bb.1:
    successors: %bb.2(0x40000000), %bb.3(0x40000000)
    liveins: $w0, $w1, $w2

    %0:gpr32common = COPY $w0
    %1:gpr32 = COPY $w1
    %2:gpr32 = COPY $w2
    %11:gpr32 = SUBSWri %0, 100, 0, implicit-def $nzcv
    Bcc 12, %bb.3, implicit $nzcv
    B %bb.2

  bb.2:
    successors: %bb.3(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.3:
    %100:gpr32 = PHI %1, %bb.1, %21, %bb.2
    $w0 = COPY %100
    RET_ReallyLR implicit $w0
...
---
name:            load_from_constant_pool_to_cond_branch
alignment:       4
tracksRegLiveness: true
constants:
  - id:          0
    value:       i32 100
    alignment:   4
body:             |
  ; CHECK-LABEL: name: load_from_constant_pool_to_cond_branch
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; CHECK-NEXT:   liveins: $w0, $w1, $w2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr32 = COPY $w0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   [[COPY2:%[0-9]+]]:gpr32 = COPY $w2
  ; CHECK-NEXT:   renamable $x8 = ADRP target-flags(aarch64-page) %const.0
  ; CHECK-NEXT:   [[LDRWui:%[0-9]+]]:gpr32common = LDRWui killed renamable $x8, target-flags(aarch64-pageoff, aarch64-nc) %const.0 :: (load (s32) from constant-pool)
  ; CHECK-NEXT:   [[SUBSWrr:%[0-9]+]]:gpr32 = SUBSWrr [[COPY]], [[LDRWui]], implicit-def $nzcv
  ; CHECK-NEXT:   Bcc 12, %bb.2, implicit $nzcv
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY1]], [[COPY2]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY1]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY1]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0
  bb.0:
    successors: %bb.1(0x40000000), %bb.2(0x40000000)
    liveins: $w0, $w1, $w2

    %0:gpr32 = COPY $w0
    %1:gpr32 = COPY $w1
    %2:gpr32 = COPY $w2
    renamable $x8 = ADRP target-flags(aarch64-page) %const.0
    %10:gpr32common = LDRWui killed renamable $x8, target-flags(aarch64-pageoff, aarch64-nc) %const.0 :: (load (s32) from constant-pool)
    %11:gpr32 = SUBSWrr %0, %10, implicit-def $nzcv
    Bcc 12, %bb.2, implicit $nzcv
    B %bb.1

  bb.1:
    successors: %bb.2(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.2:
    %100:gpr32 = PHI %1, %bb.0, %21, %bb.1
    $w0 = COPY %100
    RET_ReallyLR implicit $w0
...
---
name:            load_from_constant_pool_to_cond_branch_with_cbz
alignment:       4
tracksRegLiveness: true
constants:
  - id:          0
    value:       i32 100
    alignment:   4
body:             |
  ; CHECK-LABEL: name: load_from_constant_pool_to_cond_branch_with_cbz
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; CHECK-NEXT:   liveins: $w0, $w1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr32 = COPY $w0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   renamable $x8 = ADRP target-flags(aarch64-page) %const.0
  ; CHECK-NEXT:   [[LDRWui:%[0-9]+]]:gpr32common = LDRWui killed renamable $x8, target-flags(aarch64-pageoff, aarch64-nc) %const.0 :: (load (s32) from constant-pool)
  ; CHECK-NEXT:   CBZW [[LDRWui]], %bb.2
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY]], [[COPY1]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0
  bb.0:
    successors: %bb.1(0x40000000), %bb.2(0x40000000)
    liveins: $w0, $w1

    %1:gpr32 = COPY $w0
    %2:gpr32 = COPY $w1
    renamable $x8 = ADRP target-flags(aarch64-page) %const.0
    %10:gpr32common = LDRWui killed renamable $x8, target-flags(aarch64-pageoff, aarch64-nc) %const.0 :: (load (s32) from constant-pool)
    CBZW %10, %bb.2
    B %bb.1

  bb.1:
    successors: %bb.2(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.2:
    %100:gpr32 = PHI %1, %bb.0, %21, %bb.1
    $w0 = COPY %100
    RET_ReallyLR implicit $w0
...
---
name:            load_to_cond_branch
alignment:       4
tracksRegLiveness: true
body:             |
  ; CHECK-LABEL: name: load_to_cond_branch
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; CHECK-NEXT:   liveins: $x0, $w1, $w2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr64common = COPY $x0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   [[COPY2:%[0-9]+]]:gpr32 = COPY $w2
  ; CHECK-NEXT:   [[LDRWui:%[0-9]+]]:gpr32common = LDRWui [[COPY]], 0 :: (load (s32))
  ; CHECK-NEXT:   [[SUBSWri:%[0-9]+]]:gpr32 = SUBSWri [[LDRWui]], 100, 0, implicit-def $nzcv
  ; CHECK-NEXT:   Bcc 12, %bb.2, implicit $nzcv
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY1]], [[COPY2]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY1]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY1]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0
  bb.1:
    successors: %bb.2(0x40000000), %bb.3(0x40000000)
    liveins: $x0, $w1, $w2

    %0:gpr64common = COPY $x0
    %1:gpr32 = COPY $w1
    %2:gpr32 = COPY $w2
    %10:gpr32common = LDRWui %0, 0 :: (load (s32))
    %11:gpr32 = SUBSWri %10, 100, 0, implicit-def $nzcv
    Bcc 12, %bb.3, implicit $nzcv
    B %bb.2

  bb.2:
    successors: %bb.3(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.3:
    %100:gpr32 = PHI %1, %bb.1, %21, %bb.2
    $w0 = COPY %100
    RET_ReallyLR implicit $w0
...
---
name:            cbz_arg_to_cond_branch
alignment:       4
tracksRegLiveness: true
body:             |
  ; CHECK-LABEL: name: cbz_arg_to_cond_branch
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; CHECK-NEXT:   liveins: $w0, $w1, $w2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr32 = COPY $w0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   [[COPY2:%[0-9]+]]:gpr32 = COPY $w2
  ; CHECK-NEXT:   CBZW [[COPY]], %bb.2
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY1]], [[COPY2]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY1]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY1]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0

  bb.0:
    successors: %bb.1(0x40000000), %bb.2(0x40000000)
    liveins: $w0, $w1, $w2

    %0:gpr32 = COPY $w0
    %1:gpr32 = COPY $w1
    %2:gpr32 = COPY $w2
    CBZW %0, %bb.2
    B %bb.1

  bb.1:
    successors: %bb.2(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.2:
    %100:gpr32 = PHI %1, %bb.0, %21, %bb.1
    $w0 = COPY %100
    RET_ReallyLR implicit $w0
...
---
name:            cbz_load_to_cond_branch
alignment:       4
tracksRegLiveness: true
body:             |
  ; CHECK-LABEL: name: cbz_load_to_cond_branch
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; CHECK-NEXT:   liveins: $x0, $w1, $w2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr64common = COPY $x0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   [[COPY2:%[0-9]+]]:gpr32 = COPY $w2
  ; CHECK-NEXT:   [[LDRWui:%[0-9]+]]:gpr32 = LDRWui [[COPY]], 0 :: (load (s32))
  ; CHECK-NEXT:   CBZW [[LDRWui]], %bb.2
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY1]], [[COPY2]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY1]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY1]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0

  bb.0:
    successors: %bb.1(0x40000000), %bb.2(0x40000000)
    liveins: $x0, $w1, $w2

    %0:gpr64common = COPY $x0
    %1:gpr32 = COPY $w1
    %2:gpr32 = COPY $w2
    %10:gpr32 = LDRWui %0, 0 :: (load (s32))
    CBZW %10, %bb.2
    B %bb.1

  bb.1:
    successors: %bb.2(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.2:
    %100:gpr32 = PHI %1, %bb.0, %21, %bb.1
    $w0 = COPY %100
    RET_ReallyLR implicit $w0

...
---
name:            tbz_arg_to_cond_branch
alignment:       4
tracksRegLiveness: true
body:             |
  ; CHECK-LABEL: name: tbz_arg_to_cond_branch
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; CHECK-NEXT:   liveins: $w0, $w1, $w2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr32 = COPY $w0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   [[COPY2:%[0-9]+]]:gpr32 = COPY $w2
  ; CHECK-NEXT:   TBZW [[COPY]], 0, %bb.2
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY1]], [[COPY2]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY1]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY1]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0

  bb.0:
    successors: %bb.1(0x40000000), %bb.2(0x40000000)
    liveins: $w0, $w1, $w2

    %0:gpr32 = COPY $w0
    %1:gpr32 = COPY $w1
    %2:gpr32 = COPY $w2
    TBZW %0, 0, %bb.2
    B %bb.1

  bb.1:
    successors: %bb.2(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.2:
    %100:gpr32 = PHI %1, %bb.0, %21, %bb.1
    $w0 = COPY %100
    RET_ReallyLR implicit $w0
...
---
name:            tbz_load_to_cond_branch
alignment:       4
tracksRegLiveness: true
body:             |
  ; CHECK-LABEL: name: tbz_load_to_cond_branch
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; CHECK-NEXT:   liveins: $x0, $w1, $w2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr64common = COPY $x0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   [[COPY2:%[0-9]+]]:gpr32 = COPY $w2
  ; CHECK-NEXT:   [[LDRWui:%[0-9]+]]:gpr32 = LDRWui [[COPY]], 0 :: (load (s32))
  ; CHECK-NEXT:   TBZW [[LDRWui]], 0, %bb.2
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY1]], [[COPY2]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY1]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY1]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0

  bb.0:
    successors: %bb.1(0x40000000), %bb.2(0x40000000)
    liveins: $x0, $w1, $w2

    %0:gpr64common = COPY $x0
    %1:gpr32 = COPY $w1
    %2:gpr32 = COPY $w2
    %10:gpr32 = LDRWui %0, 0 :: (load (s32))
    TBZW %10, 0, %bb.2
    B %bb.1

  bb.1:
    successors: %bb.2(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.2:
    %100:gpr32 = PHI %1, %bb.0, %21, %bb.1
    $w0 = COPY %100
    RET_ReallyLR implicit $w0
...
---
name:            mixed_cp_and_mem_load_to_cond_branch
alignment:       4
tracksRegLiveness: true
constants:
  - id:          0
    value:       i32 100
    alignment:   4
body:             |
  ; CHECK-LABEL: name: mixed_cp_and_mem_load_to_cond_branch
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x40000000), %bb.2(0x40000000)
  ; CHECK-NEXT:   liveins: $x0, $w1, $w2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr64common = COPY $x0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   [[COPY2:%[0-9]+]]:gpr32 = COPY $w2
  ; CHECK-NEXT:   [[LDRWui:%[0-9]+]]:gpr32 = LDRWui [[COPY]], 0 :: (load (s32))
  ; CHECK-NEXT:   renamable $x8 = ADRP target-flags(aarch64-page) %const.0
  ; CHECK-NEXT:   [[LDRWui1:%[0-9]+]]:gpr32common = LDRWui killed renamable $x8, target-flags(aarch64-pageoff, aarch64-nc) %const.0 :: (load (s32) from constant-pool)
  ; CHECK-NEXT:   [[SUBSWrr:%[0-9]+]]:gpr32 = SUBSWrr [[LDRWui]], [[LDRWui1]], implicit-def $nzcv
  ; CHECK-NEXT:   Bcc 12, %bb.2, implicit $nzcv
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY1]], [[COPY2]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY1]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY1]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0
  bb.0:
    successors: %bb.1(0x40000000), %bb.2(0x40000000)
    liveins: $x0, $w1, $w2

    %0:gpr64common = COPY $x0
    %1:gpr32 = COPY $w1
    %2:gpr32 = COPY $w2
    %10:gpr32 = LDRWui %0, 0 :: (load (s32))
    renamable $x8 = ADRP target-flags(aarch64-page) %const.0
    %11:gpr32common = LDRWui killed renamable $x8, target-flags(aarch64-pageoff, aarch64-nc) %const.0 :: (load (s32) from constant-pool)
    %12:gpr32 = SUBSWrr %10, %11, implicit-def $nzcv
    Bcc 12, %bb.2, implicit $nzcv
    B %bb.1

  bb.1:
    successors: %bb.2(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.2:
    %100:gpr32 = PHI %1, %bb.0, %21, %bb.1
    $w0 = COPY %100
    RET_ReallyLR implicit $w0
...
---
name:            hot_branch_load_to_cond_branch
alignment:       4
tracksRegLiveness: true
body:             |
  ; CHECK-LABEL: name: hot_branch_load_to_cond_branch
  ; CHECK: bb.0:
  ; CHECK-NEXT:   successors: %bb.1(0x10000000), %bb.2(0x70000000)
  ; CHECK-NEXT:   liveins: $x0, $w1, $w2
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[COPY:%[0-9]+]]:gpr64common = COPY $x0
  ; CHECK-NEXT:   [[COPY1:%[0-9]+]]:gpr32 = COPY $w1
  ; CHECK-NEXT:   [[COPY2:%[0-9]+]]:gpr32 = COPY $w2
  ; CHECK-NEXT:   [[LDRWui:%[0-9]+]]:gpr32common = LDRWui [[COPY]], 0 :: (load (s32))
  ; CHECK-NEXT:   [[SUBSWri:%[0-9]+]]:gpr32 = SUBSWri [[LDRWui]], 100, 0, implicit-def $nzcv
  ; CHECK-NEXT:   Bcc 12, %bb.2, implicit $nzcv
  ; CHECK-NEXT:   B %bb.1
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.1:
  ; CHECK-NEXT:   successors: %bb.2(0x80000000)
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT:   [[MADDWrrr:%[0-9]+]]:gpr32 = MADDWrrr [[COPY1]], [[COPY2]], $wzr
  ; CHECK-NEXT:   [[MADDWrrr1:%[0-9]+]]:gpr32 = MADDWrrr [[MADDWrrr]], [[COPY1]], $wzr
  ; CHECK-NEXT: {{  $}}
  ; CHECK-NEXT: bb.2:
  ; CHECK-NEXT:   [[PHI:%[0-9]+]]:gpr32 = PHI [[COPY1]], %bb.0, [[MADDWrrr1]], %bb.1
  ; CHECK-NEXT:   $w0 = COPY [[PHI]]
  ; CHECK-NEXT:   RET_ReallyLR implicit $w0
  bb.0:
    successors: %bb.1(0x10000000), %bb.2(0x70000000)
    liveins: $x0, $w1, $w2

    %0:gpr64common = COPY $x0
    %1:gpr32 = COPY $w1
    %2:gpr32 = COPY $w2
    %10:gpr32common = LDRWui %0, 0 :: (load (s32))
    %11:gpr32 = SUBSWri %10, 100, 0, implicit-def $nzcv
    Bcc 12, %bb.2, implicit $nzcv
    B %bb.1

  bb.1:
    successors: %bb.2(0x80000000)

    %20:gpr32 = MADDWrrr %1, %2, $wzr
    %21:gpr32 = MADDWrrr %20, %1, $wzr

  bb.2:
    %100:gpr32 = PHI %1, %bb.0, %21, %bb.1
    $w0 = COPY %100
    RET_ReallyLR implicit $w0
