# RUN: llc -mtriple=aarch64-none-linux-gnu -run-pass aarch64-mi-peephole-opt -verify-machineinstrs -o - %s | FileCheck %s
---
# CHECK-LABEL: name: test_zext
# CHECK: UMADDLrrr
name: test_zext
tracksRegLiveness: true
body:             |
  bb.0:
    liveins: $x0, $x1

    %0:gpr64common = COPY $x1
    %1:gpr64common = ANDXri %0, 4127
    %2:gpr32 = MOVi32imm 10129
    %3:gpr64 = SUBREG_TO_REG 0, %2:gpr32, %subreg.sub_32
    %4:gpr64 = nuw nsw MADDXrrr %1:gpr64common, %3:gpr64, $xzr
    RET_ReallyLR implicit $x0

...
---
# CHECK-LABEL: name: test_sext
# CHECK: SMADDLrrr
name: test_sext
tracksRegLiveness: true
body:             |
  bb.0:
    liveins: $x0, $x1

    %0:gpr64common = COPY $x1
    %1:gpr64common = SBFMXri %0, 0, 31
    %2:gpr64 = MOVi64imm 56
    %3:gpr64 = nuw nsw MADDXrrr %1:gpr64common, %2:gpr64, $xzr
    RET_ReallyLR implicit $x0

...
---
# CHECK-LABEL: name: test_csel
# CHECK: SMADDLrrr
name: test_csel
tracksRegLiveness: true
body:             |
  bb.0:
    liveins: $x0, $x1

    %0:gpr64common = COPY $x1
    %1:gpr64common = SBFMXri %0, 0, 31
    %2:gpr64 = SUBSXrr %0:gpr64common, %1:gpr64common, implicit-def $nzcv
    %3:gpr64 = MOVi64imm 56
    %4:gpr64common = CSELXr %1:gpr64common, %3:gpr64, 0, implicit $nzcv
    %5:gpr64 = MOVi64imm 56
    %6:gpr64 = nuw nsw MADDXrrr %4:gpr64common, %5:gpr64, $xzr
    RET_ReallyLR implicit $x0

...
