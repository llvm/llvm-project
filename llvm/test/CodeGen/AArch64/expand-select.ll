; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple=aarch64-unknown-linux-gnu -O3 %s -o - | FileCheck %s

define void @foo(i32 %In1, <2 x i128> %In2, <2 x i128> %In3, ptr %Out) {
; CHECK-LABEL: foo:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp x8, x9, [sp, #8]
; CHECK-NEXT:    tst w0, #0x1
; CHECK-NEXT:    ldr x10, [sp]
; CHECK-NEXT:    csel x8, x5, x8, eq
; CHECK-NEXT:    csel x10, x4, x10, eq
; CHECK-NEXT:    stp x10, x8, [x9, #16]
; CHECK-NEXT:    csel x8, x3, x7, eq
; CHECK-NEXT:    csel x10, x2, x6, eq
; CHECK-NEXT:    stp x10, x8, [x9]
; CHECK-NEXT:    ret
  %cond = and i32 %In1, 1
  %cbool = icmp eq i32 %cond, 0
  %res = select i1 %cbool, <2 x i128> %In2, <2 x i128> %In3
  store <2 x i128> %res, ptr %Out

  ret void
}

; Check case when scalar size is not power of 2.
define void @bar(i32 %In1, <2 x i96> %In2, <2 x i96> %In3, ptr %Out) {
; CHECK-LABEL: bar:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp x8, x10, [sp]
; CHECK-NEXT:    tst w0, #0x1
; CHECK-NEXT:    ldr x9, [sp, #16]
; CHECK-NEXT:    csel x11, x2, x6, eq
; CHECK-NEXT:    csel x8, x4, x8, eq
; CHECK-NEXT:    str x11, [x9]
; CHECK-NEXT:    stur x8, [x9, #12]
; CHECK-NEXT:    csel x8, x5, x10, eq
; CHECK-NEXT:    csel x10, x3, x7, eq
; CHECK-NEXT:    str w8, [x9, #20]
; CHECK-NEXT:    str w10, [x9, #8]
; CHECK-NEXT:    ret
  %cond = and i32 %In1, 1
  %cbool = icmp eq i32 %cond, 0
  %res = select i1 %cbool, <2 x i96> %In2, <2 x i96> %In3
  store <2 x i96> %res, ptr %Out

  ret void
}
