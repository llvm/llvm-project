# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 6
# RUN: llc -mtriple=x86_64-linux-gnu -mattr=sse2    -run-pass=legalizer -global-isel-abort=2 -pass-remarks-missed='gisel*' %s -o -  | FileCheck %s --check-prefixes=SSE2
# RUN: llc -mtriple=x86_64-linux-gnu -mattr=avx2    -run-pass=legalizer -global-isel-abort=2 -pass-remarks-missed='gisel*' %s -o -  | FileCheck %s --check-prefixes=AVX2
# RUN: llc -mtriple=x86_64-linux-gnu -mattr=avx512f -run-pass=legalizer -global-isel-abort=2 -pass-remarks-missed='gisel*' %s -o -  | FileCheck %s --check-prefixes=AVX512F


---
name: test_basic_g_implicit_def_v8i64
body: |
  bb.0:
    ; SSE2-LABEL: name: test_basic_g_implicit_def_v8i64
    ; SSE2: [[DEF:%[0-9]+]]:_(<2 x s64>) = G_IMPLICIT_DEF
    ; SSE2-NEXT: [[CONCAT_VECTORS:%[0-9]+]]:_(<8 x s64>) = G_CONCAT_VECTORS [[DEF]](<2 x s64>), [[DEF]](<2 x s64>), [[DEF]](<2 x s64>), [[DEF]](<2 x s64>)
    ; SSE2-NEXT: RET 0, implicit [[CONCAT_VECTORS]](<8 x s64>)
    ;
    ; AVX2-LABEL: name: test_basic_g_implicit_def_v8i64
    ; AVX2: [[DEF:%[0-9]+]]:_(<4 x s64>) = G_IMPLICIT_DEF
    ; AVX2-NEXT: [[CONCAT_VECTORS:%[0-9]+]]:_(<8 x s64>) = G_CONCAT_VECTORS [[DEF]](<4 x s64>), [[DEF]](<4 x s64>)
    ; AVX2-NEXT: RET 0, implicit [[CONCAT_VECTORS]](<8 x s64>)
    ;
    ; AVX512F-LABEL: name: test_basic_g_implicit_def_v8i64
    ; AVX512F: [[DEF:%[0-9]+]]:_(<8 x s64>) = G_IMPLICIT_DEF
    ; AVX512F-NEXT: RET 0, implicit [[DEF]](<8 x s64>)
    %0:_(<8 x s64>) = G_IMPLICIT_DEF
    RET 0, implicit %0
...

---
name: test_g_implicit_def_cample_size
body: |
  bb.1:
    ; SSE2-LABEL: name: test_g_implicit_def_cample_size
    ; SSE2: [[DEF:%[0-9]+]]:_(s64) = G_IMPLICIT_DEF
    ; SSE2-NEXT: [[BUILD_VECTOR:%[0-9]+]]:_(<5 x s64>) = G_BUILD_VECTOR [[DEF]](s64), [[DEF]](s64), [[DEF]](s64), [[DEF]](s64), [[DEF]](s64)
    ; SSE2-NEXT: [[TRUNC:%[0-9]+]]:_(<5 x s63>) = G_TRUNC [[BUILD_VECTOR]](<5 x s64>)
    ; SSE2-NEXT: RET 0, implicit [[TRUNC]](<5 x s63>)
    ;
    ; AVX2-LABEL: name: test_g_implicit_def_cample_size
    ; AVX2: [[DEF:%[0-9]+]]:_(s64) = G_IMPLICIT_DEF
    ; AVX2-NEXT: [[BUILD_VECTOR:%[0-9]+]]:_(<5 x s64>) = G_BUILD_VECTOR [[DEF]](s64), [[DEF]](s64), [[DEF]](s64), [[DEF]](s64), [[DEF]](s64)
    ; AVX2-NEXT: [[TRUNC:%[0-9]+]]:_(<5 x s63>) = G_TRUNC [[BUILD_VECTOR]](<5 x s64>)
    ; AVX2-NEXT: RET 0, implicit [[TRUNC]](<5 x s63>)
    ;
    ; AVX512F-LABEL: name: test_g_implicit_def_cample_size
    ; AVX512F: [[DEF:%[0-9]+]]:_(s64) = G_IMPLICIT_DEF
    ; AVX512F-NEXT: [[BUILD_VECTOR:%[0-9]+]]:_(<5 x s64>) = G_BUILD_VECTOR [[DEF]](s64), [[DEF]](s64), [[DEF]](s64), [[DEF]](s64), [[DEF]](s64)
    ; AVX512F-NEXT: [[TRUNC:%[0-9]+]]:_(<5 x s63>) = G_TRUNC [[BUILD_VECTOR]](<5 x s64>)
    ; AVX512F-NEXT: RET 0, implicit [[TRUNC]](<5 x s63>)
    %0:_(<5 x s63>) = G_IMPLICIT_DEF
    RET 0, implicit %0
...


