; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple=x86_64-linux-gnu    -global-isel -verify-machineinstrs                       < %s -o - | FileCheck %s --check-prefix=X64
; RUN: llc -mtriple=x86_64-apple-darwin -global-isel -verify-machineinstrs -relocation-model=pic < %s -o - | FileCheck %s --check-prefix=X64_DARWIN_PIC
; RUN: llc -mtriple=i386-linux-gnu      -global-isel -verify-machineinstrs                       < %s -o - | FileCheck %s --check-prefix=X86
; RUN: llc -mtriple=x86_64-linux-gnux32 -global-isel -verify-machineinstrs                       < %s -o - | FileCheck %s --check-prefix=X32

@g_int = dso_local global i32 0, align 4
@g_int_stub = global i32 0, align 4

define dso_local ptr @test_global_ptrv() {
; X64-LABEL: test_global_ptrv:
; X64:       # %bb.0: # %entry
; X64-NEXT:    leaq g_int, %rax
; X64-NEXT:    retq
;
; X64_DARWIN_PIC-LABEL: test_global_ptrv:
; X64_DARWIN_PIC:       ## %bb.0: ## %entry
; X64_DARWIN_PIC-NEXT:    leaq _g_int(%rip), %rax
; X64_DARWIN_PIC-NEXT:    retq
;
; X86-LABEL: test_global_ptrv:
; X86:       # %bb.0: # %entry
; X86-NEXT:    leal g_int, %eax
; X86-NEXT:    retl
;
; X32-LABEL: test_global_ptrv:
; X32:       # %bb.0: # %entry
; X32-NEXT:    leal g_int, %eax
; X32-NEXT:    movl %eax, %eax
; X32-NEXT:    retq
entry:
  ret ptr @g_int
}

define dso_local i32 @test_global_valv() {
; X64-LABEL: test_global_valv:
; X64:       # %bb.0: # %entry
; X64-NEXT:    movl g_int, %eax
; X64-NEXT:    retq
;
; X64_DARWIN_PIC-LABEL: test_global_valv:
; X64_DARWIN_PIC:       ## %bb.0: ## %entry
; X64_DARWIN_PIC-NEXT:    movl _g_int(%rip), %eax
; X64_DARWIN_PIC-NEXT:    retq
;
; X86-LABEL: test_global_valv:
; X86:       # %bb.0: # %entry
; X86-NEXT:    movl g_int, %eax
; X86-NEXT:    retl
;
; X32-LABEL: test_global_valv:
; X32:       # %bb.0: # %entry
; X32-NEXT:    movl g_int, %eax
; X32-NEXT:    retq
entry:
  %0 = load i32, ptr @g_int, align 4
  ret i32 %0
}

define dso_local ptr @test_global_stub_ptrv() {
; X64-LABEL: test_global_stub_ptrv:
; X64:       # %bb.0:
; X64-NEXT:    movq g_int_stub@GOTPCREL(%rip), %rax
; X64-NEXT:    retq
;
; X64_DARWIN_PIC-LABEL: test_global_stub_ptrv:
; X64_DARWIN_PIC:       ## %bb.0:
; X64_DARWIN_PIC-NEXT:    leaq _g_int_stub(%rip), %rax
; X64_DARWIN_PIC-NEXT:    retq
;
; X86-LABEL: test_global_stub_ptrv:
; X86:       # %bb.0:
; X86-NEXT:    leal g_int_stub, %eax
; X86-NEXT:    retl
;
; X32-LABEL: test_global_stub_ptrv:
; X32:       # %bb.0:
; X32-NEXT:    movl g_int_stub@GOTPCREL(%rip), %eax
; X32-NEXT:    retq
  ret ptr @g_int_stub
}

define dso_local i32 @test_global_stub_valv() {
; X64-LABEL: test_global_stub_valv:
; X64:       # %bb.0:
; X64-NEXT:    movq g_int_stub@GOTPCREL(%rip), %rax
; X64-NEXT:    movl (%rax), %eax
; X64-NEXT:    retq
;
; X64_DARWIN_PIC-LABEL: test_global_stub_valv:
; X64_DARWIN_PIC:       ## %bb.0:
; X64_DARWIN_PIC-NEXT:    movl _g_int_stub(%rip), %eax
; X64_DARWIN_PIC-NEXT:    retq
;
; X86-LABEL: test_global_stub_valv:
; X86:       # %bb.0:
; X86-NEXT:    movl g_int_stub, %eax
; X86-NEXT:    retl
;
; X32-LABEL: test_global_stub_valv:
; X32:       # %bb.0:
; X32-NEXT:    movl g_int_stub@GOTPCREL(%rip), %eax
; X32-NEXT:    movl (%eax), %eax
; X32-NEXT:    retq
  %val = load i32, ptr @g_int_stub, align 4
  ret i32 %val
}
