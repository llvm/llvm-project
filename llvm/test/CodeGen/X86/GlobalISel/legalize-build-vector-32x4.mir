# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 6
# RUN: llc -mtriple=x86_64-linux-gnu -mattr=sse,-sse2 -run-pass=legalizer -global-isel-abort=1 -pass-remarks-missed='gisel*' %s -o -  | FileCheck %s --check-prefixes=SSE
# RUN: llc -mtriple=x86_64-linux-gnu -mattr=sse2      -run-pass=legalizer -global-isel-abort=1 -pass-remarks-missed='gisel*' %s -o -  | FileCheck %s --check-prefixes=SSE2
# RUN: llc -mtriple=x86_64-linux-gnu -mattr=sse4.1    -run-pass=legalizer -global-isel-abort=1 -pass-remarks-missed='gisel*' %s -o -  | FileCheck %s --check-prefixes=SSE41
# RUN: llc -mtriple=x86_64-linux-gnu -mattr=avx       -run-pass=legalizer -global-isel-abort=1 -pass-remarks-missed='gisel*' %s -o -  | FileCheck %s --check-prefixes=AVX
# RUN: llc -mtriple=x86_64-linux-gnu -mattr=avx512f   -run-pass=legalizer -global-isel-abort=1 -pass-remarks-missed='gisel*' %s -o -  | FileCheck %s --check-prefixes=AVX512F

---
name: test_basic_build_v4i32
body: |
  bb.0:
    liveins: $edi, $esi, $edx, $ecx

    ; SSE-LABEL: name: test_basic_build_v4i32
    ; SSE: liveins: $edi, $esi, $edx, $ecx
    ; SSE-NEXT: {{  $}}
    ; SSE-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; SSE-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; SSE-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; SSE-NEXT: [[COPY3:%[0-9]+]]:_(s32) = COPY $ecx
    ; SSE-NEXT: [[FRAME_INDEX:%[0-9]+]]:_(p0) = G_FRAME_INDEX %stack.0
    ; SSE-NEXT: G_STORE [[COPY]](s32), [[FRAME_INDEX]](p0) :: (store (s32) into %stack.0, align 1)
    ; SSE-NEXT: [[C:%[0-9]+]]:_(s32) = G_CONSTANT i32 4
    ; SSE-NEXT: [[PTR_ADD:%[0-9]+]]:_(p0) = G_PTR_ADD [[FRAME_INDEX]], [[C]](s32)
    ; SSE-NEXT: G_STORE [[COPY1]](s32), [[PTR_ADD]](p0) :: (store (s32) into %stack.0, align 1)
    ; SSE-NEXT: [[PTR_ADD1:%[0-9]+]]:_(p0) = G_PTR_ADD [[PTR_ADD]], [[C]](s32)
    ; SSE-NEXT: G_STORE [[COPY2]](s32), [[PTR_ADD1]](p0) :: (store (s32) into %stack.0, align 1)
    ; SSE-NEXT: [[PTR_ADD2:%[0-9]+]]:_(p0) = G_PTR_ADD [[PTR_ADD1]], [[C]](s32)
    ; SSE-NEXT: G_STORE [[COPY3]](s32), [[PTR_ADD2]](p0) :: (store (s32) into %stack.0, align 1)
    ; SSE-NEXT: [[LOAD:%[0-9]+]]:_(<4 x s32>) = G_LOAD [[FRAME_INDEX]](p0) :: (load (<4 x s32>) from %stack.0)
    ; SSE-NEXT: RET 0, implicit [[LOAD]](<4 x s32>)
    ;
    ; SSE2-LABEL: name: test_basic_build_v4i32
    ; SSE2: liveins: $edi, $esi, $edx, $ecx
    ; SSE2-NEXT: {{  $}}
    ; SSE2-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; SSE2-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; SSE2-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; SSE2-NEXT: [[COPY3:%[0-9]+]]:_(s32) = COPY $ecx
    ; SSE2-NEXT: [[DEF:%[0-9]+]]:vr128(<4 x s32>) = G_IMPLICIT_DEF
    ; SSE2-NEXT: [[PINSRDrri:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[DEF]](<4 x s32>), [[COPY]](s32), 0
    ; SSE2-NEXT: [[PINSRDrri1:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri]](<4 x s32>), [[COPY1]](s32), 1
    ; SSE2-NEXT: [[PINSRDrri2:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri1]](<4 x s32>), [[COPY2]](s32), 2
    ; SSE2-NEXT: [[PINSRDrri3:%[0-9]+]]:_(<4 x s32>) = PINSRDrri [[PINSRDrri2]](<4 x s32>), [[COPY3]](s32), 3
    ; SSE2-NEXT: RET 0, implicit [[PINSRDrri3]](<4 x s32>)
    ;
    ; SSE41-LABEL: name: test_basic_build_v4i32
    ; SSE41: liveins: $edi, $esi, $edx, $ecx
    ; SSE41-NEXT: {{  $}}
    ; SSE41-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; SSE41-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; SSE41-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; SSE41-NEXT: [[COPY3:%[0-9]+]]:_(s32) = COPY $ecx
    ; SSE41-NEXT: [[DEF:%[0-9]+]]:vr128(<4 x s32>) = G_IMPLICIT_DEF
    ; SSE41-NEXT: [[PINSRDrri:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[DEF]](<4 x s32>), [[COPY]](s32), 0
    ; SSE41-NEXT: [[PINSRDrri1:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri]](<4 x s32>), [[COPY1]](s32), 1
    ; SSE41-NEXT: [[PINSRDrri2:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri1]](<4 x s32>), [[COPY2]](s32), 2
    ; SSE41-NEXT: [[PINSRDrri3:%[0-9]+]]:_(<4 x s32>) = PINSRDrri [[PINSRDrri2]](<4 x s32>), [[COPY3]](s32), 3
    ; SSE41-NEXT: RET 0, implicit [[PINSRDrri3]](<4 x s32>)
    ;
    ; AVX-LABEL: name: test_basic_build_v4i32
    ; AVX: liveins: $edi, $esi, $edx, $ecx
    ; AVX-NEXT: {{  $}}
    ; AVX-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; AVX-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; AVX-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; AVX-NEXT: [[COPY3:%[0-9]+]]:_(s32) = COPY $ecx
    ; AVX-NEXT: [[DEF:%[0-9]+]]:vr128(<4 x s32>) = G_IMPLICIT_DEF
    ; AVX-NEXT: [[PINSRDrri:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[DEF]](<4 x s32>), [[COPY]](s32), 0
    ; AVX-NEXT: [[PINSRDrri1:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri]](<4 x s32>), [[COPY1]](s32), 1
    ; AVX-NEXT: [[PINSRDrri2:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri1]](<4 x s32>), [[COPY2]](s32), 2
    ; AVX-NEXT: [[PINSRDrri3:%[0-9]+]]:_(<4 x s32>) = PINSRDrri [[PINSRDrri2]](<4 x s32>), [[COPY3]](s32), 3
    ; AVX-NEXT: RET 0, implicit [[PINSRDrri3]](<4 x s32>)
    ;
    ; AVX512F-LABEL: name: test_basic_build_v4i32
    ; AVX512F: liveins: $edi, $esi, $edx, $ecx
    ; AVX512F-NEXT: {{  $}}
    ; AVX512F-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; AVX512F-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; AVX512F-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; AVX512F-NEXT: [[COPY3:%[0-9]+]]:_(s32) = COPY $ecx
    ; AVX512F-NEXT: [[DEF:%[0-9]+]]:vr128(<4 x s32>) = G_IMPLICIT_DEF
    ; AVX512F-NEXT: [[PINSRDrri:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[DEF]](<4 x s32>), [[COPY]](s32), 0
    ; AVX512F-NEXT: [[PINSRDrri1:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri]](<4 x s32>), [[COPY1]](s32), 1
    ; AVX512F-NEXT: [[PINSRDrri2:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri1]](<4 x s32>), [[COPY2]](s32), 2
    ; AVX512F-NEXT: [[PINSRDrri3:%[0-9]+]]:_(<4 x s32>) = PINSRDrri [[PINSRDrri2]](<4 x s32>), [[COPY3]](s32), 3
    ; AVX512F-NEXT: RET 0, implicit [[PINSRDrri3]](<4 x s32>)
    %1:_(s32) = COPY $edi
    %2:_(s32) = COPY $esi
    %3:_(s32) = COPY $edx
    %4:_(s32) = COPY $ecx
    %0:_(<4 x s32>) = G_BUILD_VECTOR %1:_(s32), %2:_(s32), %3:_(s32), %4:_(s32)
    RET 0, implicit %0
...
---
name: test_v4i32_partially_implicit_def
body: |
  bb.0:
    liveins: $edi, $esi, $edx
    ; SSE-LABEL: name: test_v4i32_partially_implicit_def
    ; SSE: liveins: $edi, $esi, $edx
    ; SSE-NEXT: {{  $}}
    ; SSE-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; SSE-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; SSE-NEXT: [[DEF:%[0-9]+]]:_(s32) = G_IMPLICIT_DEF
    ; SSE-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; SSE-NEXT: [[FRAME_INDEX:%[0-9]+]]:_(p0) = G_FRAME_INDEX %stack.0
    ; SSE-NEXT: G_STORE [[COPY]](s32), [[FRAME_INDEX]](p0) :: (store (s32) into %stack.0, align 1)
    ; SSE-NEXT: [[C:%[0-9]+]]:_(s32) = G_CONSTANT i32 4
    ; SSE-NEXT: [[PTR_ADD:%[0-9]+]]:_(p0) = G_PTR_ADD [[FRAME_INDEX]], [[C]](s32)
    ; SSE-NEXT: G_STORE [[COPY1]](s32), [[PTR_ADD]](p0) :: (store (s32) into %stack.0, align 1)
    ; SSE-NEXT: [[PTR_ADD1:%[0-9]+]]:_(p0) = G_PTR_ADD [[PTR_ADD]], [[C]](s32)
    ; SSE-NEXT: G_STORE [[DEF]](s32), [[PTR_ADD1]](p0) :: (store (s32) into %stack.0, align 1)
    ; SSE-NEXT: [[PTR_ADD2:%[0-9]+]]:_(p0) = G_PTR_ADD [[PTR_ADD1]], [[C]](s32)
    ; SSE-NEXT: G_STORE [[COPY2]](s32), [[PTR_ADD2]](p0) :: (store (s32) into %stack.0, align 1)
    ; SSE-NEXT: [[LOAD:%[0-9]+]]:_(<4 x s32>) = G_LOAD [[FRAME_INDEX]](p0) :: (load (<4 x s32>) from %stack.0)
    ; SSE-NEXT: RET 0, implicit [[LOAD]](<4 x s32>)
    ;
    ; SSE2-LABEL: name: test_v4i32_partially_implicit_def
    ; SSE2: liveins: $edi, $esi, $edx
    ; SSE2-NEXT: {{  $}}
    ; SSE2-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; SSE2-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; SSE2-NEXT: [[DEF:%[0-9]+]]:_(s32) = G_IMPLICIT_DEF
    ; SSE2-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; SSE2-NEXT: [[DEF1:%[0-9]+]]:vr128(<4 x s32>) = G_IMPLICIT_DEF
    ; SSE2-NEXT: [[PINSRDrri:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[DEF1]](<4 x s32>), [[COPY]](s32), 0
    ; SSE2-NEXT: [[PINSRDrri1:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri]](<4 x s32>), [[COPY1]](s32), 1
    ; SSE2-NEXT: [[PINSRDrri2:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri1]](<4 x s32>), [[DEF]](s32), 2
    ; SSE2-NEXT: [[PINSRDrri3:%[0-9]+]]:_(<4 x s32>) = PINSRDrri [[PINSRDrri2]](<4 x s32>), [[COPY2]](s32), 3
    ; SSE2-NEXT: RET 0, implicit [[PINSRDrri3]](<4 x s32>)
    ;
    ; SSE41-LABEL: name: test_v4i32_partially_implicit_def
    ; SSE41: liveins: $edi, $esi, $edx
    ; SSE41-NEXT: {{  $}}
    ; SSE41-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; SSE41-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; SSE41-NEXT: [[DEF:%[0-9]+]]:_(s32) = G_IMPLICIT_DEF
    ; SSE41-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; SSE41-NEXT: [[DEF1:%[0-9]+]]:vr128(<4 x s32>) = G_IMPLICIT_DEF
    ; SSE41-NEXT: [[PINSRDrri:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[DEF1]](<4 x s32>), [[COPY]](s32), 0
    ; SSE41-NEXT: [[PINSRDrri1:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri]](<4 x s32>), [[COPY1]](s32), 1
    ; SSE41-NEXT: [[PINSRDrri2:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri1]](<4 x s32>), [[DEF]](s32), 2
    ; SSE41-NEXT: [[PINSRDrri3:%[0-9]+]]:_(<4 x s32>) = PINSRDrri [[PINSRDrri2]](<4 x s32>), [[COPY2]](s32), 3
    ; SSE41-NEXT: RET 0, implicit [[PINSRDrri3]](<4 x s32>)
    ;
    ; AVX-LABEL: name: test_v4i32_partially_implicit_def
    ; AVX: liveins: $edi, $esi, $edx
    ; AVX-NEXT: {{  $}}
    ; AVX-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; AVX-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; AVX-NEXT: [[DEF:%[0-9]+]]:_(s32) = G_IMPLICIT_DEF
    ; AVX-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; AVX-NEXT: [[DEF1:%[0-9]+]]:vr128(<4 x s32>) = G_IMPLICIT_DEF
    ; AVX-NEXT: [[PINSRDrri:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[DEF1]](<4 x s32>), [[COPY]](s32), 0
    ; AVX-NEXT: [[PINSRDrri1:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri]](<4 x s32>), [[COPY1]](s32), 1
    ; AVX-NEXT: [[PINSRDrri2:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri1]](<4 x s32>), [[DEF]](s32), 2
    ; AVX-NEXT: [[PINSRDrri3:%[0-9]+]]:_(<4 x s32>) = PINSRDrri [[PINSRDrri2]](<4 x s32>), [[COPY2]](s32), 3
    ; AVX-NEXT: RET 0, implicit [[PINSRDrri3]](<4 x s32>)
    ;
    ; AVX512F-LABEL: name: test_v4i32_partially_implicit_def
    ; AVX512F: liveins: $edi, $esi, $edx
    ; AVX512F-NEXT: {{  $}}
    ; AVX512F-NEXT: [[COPY:%[0-9]+]]:_(s32) = COPY $edi
    ; AVX512F-NEXT: [[COPY1:%[0-9]+]]:_(s32) = COPY $esi
    ; AVX512F-NEXT: [[DEF:%[0-9]+]]:_(s32) = G_IMPLICIT_DEF
    ; AVX512F-NEXT: [[COPY2:%[0-9]+]]:_(s32) = COPY $edx
    ; AVX512F-NEXT: [[DEF1:%[0-9]+]]:vr128(<4 x s32>) = G_IMPLICIT_DEF
    ; AVX512F-NEXT: [[PINSRDrri:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[DEF1]](<4 x s32>), [[COPY]](s32), 0
    ; AVX512F-NEXT: [[PINSRDrri1:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri]](<4 x s32>), [[COPY1]](s32), 1
    ; AVX512F-NEXT: [[PINSRDrri2:%[0-9]+]]:vr128(<4 x s32>) = PINSRDrri [[PINSRDrri1]](<4 x s32>), [[DEF]](s32), 2
    ; AVX512F-NEXT: [[PINSRDrri3:%[0-9]+]]:_(<4 x s32>) = PINSRDrri [[PINSRDrri2]](<4 x s32>), [[COPY2]](s32), 3
    ; AVX512F-NEXT: RET 0, implicit [[PINSRDrri3]](<4 x s32>)
    %1:_(s32) = COPY $edi
    %2:_(s32) = COPY $esi
    %3:_(s32) = G_IMPLICIT_DEF
    %4:_(s32) = COPY $edx
    %0:_(<4 x s32>) = G_BUILD_VECTOR %1:_(s32), %2:_(s32), %3:_(s32), %4:_(s32)
    RET 0, implicit %0
...
