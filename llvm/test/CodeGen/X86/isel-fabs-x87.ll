; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc < %s -mtriple=x86_64-- -mattr=+x87,-sse2,-sse | FileCheck %s --check-prefixes=X64
; RUN: llc < %s -mtriple=x86_64-- -mattr=+x87,-sse2,-sse -fast-isel | FileCheck %s --check-prefixes=X64
; RUN: llc < %s -mtriple=x86_64-- -mattr=+x87,-sse2,-sse -global-isel -global-isel-abort=1 | FileCheck %s --check-prefixes=X64
; RUN: llc < %s -mtriple=i686-- -mattr=+x87,-sse2,-sse | FileCheck %s --check-prefixes=X86,SDAG-ISEL
; RUN: llc < %s -mtriple=i686-- -mattr=+x87,-sse2,-sse -fast-isel | FileCheck %s --check-prefixes=X86,Fast-ISEL
; RUN: llc < %s -mtriple=i686-- -mattr=+x87,-sse2,-sse -global-isel -global-isel-abort=0 | FileCheck %s --check-prefixes=X86,GISEL-ISEL

define void @test_float_abs(ptr %argptr)   {
; SDAG-ISEL-LABEL: test_float_abs:
; SDAG-ISEL:       # %bb.0:
; SDAG-ISEL-NEXT:    movl {{[0-9]+}}(%esp), %eax
; SDAG-ISEL-NEXT:    andb $127, 3(%eax)
; SDAG-ISEL-NEXT:    retl
;
; Fast-ISEL-LABEL: test_float_abs:
; Fast-ISEL:       # %bb.0:
; Fast-ISEL-NEXT:    movl {{[0-9]+}}(%esp), %eax
; Fast-ISEL-NEXT:    andb $127, 3(%eax)
; Fast-ISEL-NEXT:    retl
;
; GISEL-ISEL-LABEL: test_float_abs:
; GISEL-ISEL:       # %bb.0:
; GISEL-ISEL-NEXT:    movl {{[0-9]+}}(%esp), %eax
; GISEL-ISEL-NEXT:    andl $2147483647, (%eax) # imm = 0x7FFFFFFF
; GISEL-ISEL-NEXT:    retl
     %arg = load  float, float* %argptr
     %abs = tail call float @llvm.fabs.f32(float %arg)
     store float %abs, ptr %argptr
     ret void
 }

define void @test_double_abs(ptr %argptr)  {
; X86-LABEL: test_double_abs:
; X86:       # %bb.0:
; X86-NEXT:    movl {{[0-9]+}}(%esp), %eax
; X86-NEXT:    fldl (%eax)
; X86-NEXT:    fabs
; X86-NEXT:    fstpl (%eax)
; X86-NEXT:    retl
    %arg = load double, double* %argptr
    %abs = tail call double @llvm.fabs.f64(double %arg)
    store double %abs, double* %argptr
    ret void
}

define x86_fp80 @test_x86_fp80_abs(x86_fp80 %arg) {
; X64-LABEL: test_x86_fp80_abs:
; X64:       # %bb.0:
; X64-NEXT:    fldt {{[0-9]+}}(%rsp)
; X64-NEXT:    fabs
; X64-NEXT:    retq
;
; X86-LABEL: test_x86_fp80_abs:
; X86:       # %bb.0:
; X86-NEXT:    fldt {{[0-9]+}}(%esp)
; X86-NEXT:    fabs
; X86-NEXT:    retl
  %abs = tail call x86_fp80 @llvm.fabs.f80(x86_fp80 %arg)
  ret x86_fp80 %abs
}
