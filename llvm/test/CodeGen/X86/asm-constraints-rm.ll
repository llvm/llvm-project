; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --filter "^\t#" --version 4
; RUN: llc -mtriple=x86_64-unknown-linux-gnu -O2 -regalloc=greedy < %s | FileCheck --check-prefix=GREEDY-X86_64 %s
; RUN: llc -mtriple=i386-unknown-linux-gnu -O2 -regalloc=greedy   < %s | FileCheck --check-prefix=GREEDY-I386 %s
; RUN: llc -mtriple=x86_64-unknown-linux-gnu -O2 -regalloc=basic  < %s | FileCheck --check-prefix=BASIC-X86_64 %s
; RUN: llc -mtriple=i386-unknown-linux-gnu -O2 -regalloc=basic    < %s | FileCheck --check-prefix=BASIC-I386 %s

; The non-fast register allocators should use registers when there isn't
; register pressure.

define dso_local i32 @test1(ptr nocapture noundef readonly %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test1:
;
; GREEDY-I386-LABEL: test1:
;
; BASIC-X86_64-LABEL: test1:
;
; BASIC-I386-LABEL: test1:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %0 = load i32, ptr %b, align 4
  %d = getelementptr inbounds nuw i8, ptr %ptr, i64 12
  %1 = load i32, ptr %d, align 4
  tail call void asm sideeffect "# dual 'rm' input no pressure -> $0 $1", "rm,rm,~{dirflag},~{fpsr},~{flags}"(i32 %0, i32 %1)
  %2 = load i32, ptr %ptr, align 4
  ret i32 %2
}

define dso_local i32 @test2(ptr nocapture noundef readonly %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test2:
;
; GREEDY-I386-LABEL: test2:
;
; BASIC-X86_64-LABEL: test2:
;
; BASIC-I386-LABEL: test2:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %0 = load i32, ptr %b, align 4
  %d = getelementptr inbounds nuw i8, ptr %ptr, i64 12
  %1 = load i32, ptr %d, align 4
  tail call void asm sideeffect "# dual 'rm' input pressure -> $0 $1", "rm,rm,~{ax},~{cx},~{dx},~{si},~{di},~{r8},~{r9},~{r10},~{r11},~{bx},~{bp},~{r14},~{r15},~{r12},~{r13},~{dirflag},~{fpsr},~{flags}"(i32 %0, i32 %1)
  %2 = load i32, ptr %ptr, align 4
  ret i32 %2
}

define dso_local i32 @test3(ptr noundef %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test3:
;
; GREEDY-I386-LABEL: test3:
;
; BASIC-X86_64-LABEL: test3:
;
; BASIC-I386-LABEL: test3:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %d = getelementptr inbounds nuw i8, ptr %ptr, i64 12
  %0 = tail call { i32, i32 } asm sideeffect "# dual 'rm' output no pressure -> $0 $1", "=rm,=rm,~{dirflag},~{fpsr},~{flags}"()
  %asmresult = extractvalue { i32, i32 } %0, 0
  %asmresult1 = extractvalue { i32, i32 } %0, 1
  store i32 %asmresult, ptr %b, align 4
  store i32 %asmresult1, ptr %d, align 4
  %1 = load i32, ptr %ptr, align 4
  ret i32 %1
}

define dso_local i32 @test4(ptr noundef %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test4:
;
; GREEDY-I386-LABEL: test4:
;
; BASIC-X86_64-LABEL: test4:
;
; BASIC-I386-LABEL: test4:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %d = getelementptr inbounds nuw i8, ptr %ptr, i64 12
  %0 = tail call { i32, i32 } asm sideeffect "# dual 'rm' output pressure -> $0 $1", "=rm,=rm,~{ax},~{cx},~{dx},~{si},~{di},~{r8},~{r9},~{r10},~{r11},~{bx},~{bp},~{r14},~{r15},~{r12},~{r13},~{dirflag},~{fpsr},~{flags}"()
  %asmresult = extractvalue { i32, i32 } %0, 0
  %asmresult1 = extractvalue { i32, i32 } %0, 1
  store i32 %asmresult, ptr %b, align 4
  store i32 %asmresult1, ptr %d, align 4
  %1 = load i32, ptr %ptr, align 4
  ret i32 %1
}

define dso_local i32 @test5(ptr nocapture noundef readonly %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test5:
;
; GREEDY-I386-LABEL: test5:
;
; BASIC-X86_64-LABEL: test5:
;
; BASIC-I386-LABEL: test5:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %0 = load i32, ptr %b, align 4
  %d = getelementptr inbounds nuw i8, ptr %ptr, i64 12
  %1 = load i32, ptr %d, align 4
  %2 = tail call { i32, i32 } asm sideeffect "# dual tied 'rm' no pressure -> $0 $1 $2 $3", "=rm,=rm,0,1,~{dirflag},~{fpsr},~{flags}"(i32 %0, i32 %1)
  %asmresult = extractvalue { i32, i32 } %2, 0
  %asmresult1 = extractvalue { i32, i32 } %2, 1
  store i32 %asmresult, ptr %b, align 4
  store i32 %asmresult1, ptr %d, align 4
  %3 = load i32, ptr %ptr, align 4
  ret i32 %3
}

define dso_local i32 @test6(ptr nocapture noundef readonly %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test6:
;
; GREEDY-I386-LABEL: test6:
;
; BASIC-X86_64-LABEL: test6:
;
; BASIC-I386-LABEL: test6:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %0 = load i32, ptr %b, align 4
  %d = getelementptr inbounds nuw i8, ptr %ptr, i64 12
  %1 = load i32, ptr %d, align 4
  %2 = tail call { i32, i32 } asm sideeffect "# dual tied 'rm' pressure -> $0 $1 $2 $3", "=rm,=rm,0,1,~{ax},~{cx},~{dx},~{si},~{di},~{r8},~{r9},~{r10},~{r11},~{bx},~{bp},~{r14},~{r15},~{r12},~{r13},~{dirflag},~{fpsr},~{flags}"(i32 %0, i32 %1)
  %asmresult = extractvalue { i32, i32 } %2, 0
  %asmresult1 = extractvalue { i32, i32 } %2, 1
  store i32 %asmresult, ptr %b, align 4
  store i32 %asmresult1, ptr %d, align 4
  %3 = load i32, ptr %ptr, align 4
  ret i32 %3
}

define dso_local i32 @test7(ptr noundef %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test7:
;
; GREEDY-I386-LABEL: test7:
;
; BASIC-X86_64-LABEL: test7:
;
; BASIC-I386-LABEL: test7:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %0 = load i32, ptr %b, align 4
  tail call void asm sideeffect "# single 'rm' input -> $0", "rm,~{dirflag},~{fpsr},~{flags}"(i32 %0)
  %1 = load i32, ptr %ptr, align 4
  ret i32 %1
}

define dso_local i32 @test8(ptr noundef %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test8:
;
; GREEDY-I386-LABEL: test8:
;
; BASIC-X86_64-LABEL: test8:
;
; BASIC-I386-LABEL: test8:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %0 = load i32, ptr %b, align 4
  %d = getelementptr inbounds nuw i8, ptr %ptr, i64 12
  %1 = load i32, ptr %d, align 4
  tail call void asm sideeffect "# dual 'rm' and 'r' input -> $0 $1", "rm,r,~{dirflag},~{fpsr},~{flags}"(i32 %0, i32 %1)
  %2 = load i32, ptr %ptr, align 4
  ret i32 %2
}

define dso_local i32 @test9(ptr nocapture noundef %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test9:
;
; GREEDY-I386-LABEL: test9:
;
; BASIC-X86_64-LABEL: test9:
;
; BASIC-I386-LABEL: test9:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %0 = tail call i32 asm sideeffect "# single 'rm' output -> $0", "=rm,~{dirflag},~{fpsr},~{flags}"()
  store i32 %0, ptr %b, align 4
  %1 = load i32, ptr %ptr, align 4
  ret i32 %1
}

define dso_local i32 @test10(ptr noundef captures(none) %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test10:
;
; GREEDY-I386-LABEL: test10:
;
; BASIC-X86_64-LABEL: test10:
;
; BASIC-I386-LABEL: test10:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %0 = load i32, ptr %b, align 4
  %1 = tail call i32 asm sideeffect "# simgle tied 'rm' input -> $0 $1", "=rm,0,~{dirflag},~{fpsr},~{flags}"(i32 %0)
  store i32 %1, ptr %b, align 4
  %2 = load i32, ptr %ptr, align 4
  ret i32 %2
}

define dso_local i32 @test11(ptr noundef captures(none) %ptr) local_unnamed_addr {
; GREEDY-X86_64-LABEL: test11:
;
; GREEDY-I386-LABEL: test11:
;
; BASIC-X86_64-LABEL: test11:
;
; BASIC-I386-LABEL: test11:
entry:
  %b = getelementptr inbounds nuw i8, ptr %ptr, i64 4
  %0 = load i32, ptr %b, align 4
  %1 = tail call i32 asm sideeffect "# dual 'r' output == input location -> $0 $1", "=r,0,~{dirflag},~{fpsr},~{flags}"(i32 %0)
  store i32 %1, ptr %b, align 4
  %2 = load i32, ptr %ptr, align 4
  ret i32 %2
}
