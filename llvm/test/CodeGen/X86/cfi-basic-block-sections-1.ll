; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 6
; RUN: llc -O0 %s --basic-block-sections=all -mtriple=x86_64 -filetype=asm --frame-pointer=all -o - | FileCheck --check-prefix=SECTIONS_CFI %s
; RUN: llc -O0 %s --basic-block-sections=all -mtriple=x86_64 -filetype=asm --frame-pointer=none -o - | FileCheck --check-prefix=SECTIONS_NOFP_CFI %s

;; void f1();
;; void f3(bool b) {
;;   if (b)
;;     f1();
;; }


; Function Attrs: noinline optnone uwtable
define dso_local void @_Z2f3b(i1 zeroext %b) {
; SECTIONS_CFI-LABEL: _Z2f3b:
; SECTIONS_CFI:       # %bb.0: # %entry
; SECTIONS_CFI-NEXT:    pushq %rbp
; SECTIONS_CFI-NEXT:    .cfi_def_cfa_offset 16
; SECTIONS_CFI-NEXT:    .cfi_offset %rbp, -16
; SECTIONS_CFI-NEXT:    movq %rsp, %rbp
; SECTIONS_CFI-NEXT:    .cfi_def_cfa_register %rbp
; SECTIONS_CFI-NEXT:    subq $16, %rsp
; SECTIONS_CFI-NEXT:    movb %dil, %al
; SECTIONS_CFI-NEXT:    andb $1, %al
; SECTIONS_CFI-NEXT:    movb %al, -1(%rbp)
; SECTIONS_CFI-NEXT:    testb $1, -1(%rbp)
; SECTIONS_CFI-NEXT:    je _Z2f3b.__part.2
; SECTIONS_CFI-NEXT:    jmp _Z2f3b.__part.1
; SECTIONS_CFI-NEXT:  .LBB_END0_0:
;
; SECTIONS_NOFP_CFI-LABEL: _Z2f3b:
; SECTIONS_NOFP_CFI:       # %bb.0: # %entry
; SECTIONS_NOFP_CFI-NEXT:    pushq %rax
; SECTIONS_NOFP_CFI-NEXT:    .cfi_def_cfa_offset 16
; SECTIONS_NOFP_CFI-NEXT:    movb %dil, %al
; SECTIONS_NOFP_CFI-NEXT:    andb $1, %al
; SECTIONS_NOFP_CFI-NEXT:    movb %al, {{[0-9]+}}(%rsp)
; SECTIONS_NOFP_CFI-NEXT:    testb $1, {{[0-9]+}}(%rsp)
; SECTIONS_NOFP_CFI-NEXT:    je _Z2f3b.__part.2
; SECTIONS_NOFP_CFI-NEXT:    jmp _Z2f3b.__part.1
; SECTIONS_NOFP_CFI-NEXT:  .LBB_END0_0:
entry:
  %b.addr = alloca i8, align 1
  %frombool = zext i1 %b to i8
  store i8 %frombool, ptr %b.addr, align 1
  %0 = load i8, ptr %b.addr, align 1
  %tobool = trunc i8 %0 to i1
  br i1 %tobool, label %if.then, label %if.end

if.then:                                          ; preds = %entry
  call void @_Z2f1v()
  br label %if.end

if.end:                                           ; preds = %if.then, %entry
  ret void
}

declare dso_local void @_Z2f1v()
