; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; REQUIRES: asserts
; RUN: llc < %s -mtriple=x86_64-- -debug-counter=dagcombine=0 | FileCheck %s

; BUG: shrinkAndImmediate folds away the AND after the ZEXT has already been folded away to SUBREG_TO_REG losing implicit zext.
define i64 @test() {
; CHECK-LABEL: test:
; CHECK:       # %bb.0:
; CHECK-NEXT:    movabsq $-4294967295, %rax # imm = 0xFFFFFFFF00000001
; CHECK-NEXT:    movzwl %ax, %eax
; CHECK-NEXT:    retq
  %x = bitcast i64 u0xffffffff00000001 to i64
  %t = trunc i64 %x to i32
  %a = and i32 %t, 1
  %e = zext i32 %a to i64
  ret i64 %e
}
