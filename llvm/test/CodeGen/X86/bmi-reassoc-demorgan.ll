; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=i686-unknown-unknown -mattr=+bmi | FileCheck %s --check-prefix=X86
; RUN: llc < %s -mtriple=x86_64-unknown-unknown -mattr=+bmi | FileCheck %s --check-prefix=X64

define i32 @reassoc_demorgan_i32(i32 %a, i32 %b) nounwind {
; X86-LABEL: reassoc_demorgan_i32:
; X86:       # %bb.0:
; X86-NEXT:    movl {{[0-9]+}}(%esp), %eax
; X86-NEXT:    movl {{[0-9]+}}(%esp), %ecx
; X86-NEXT:    notl %ecx
; X86-NEXT:    andnl %ecx, %eax, %eax
; X86-NEXT:    retl
;
; X64-LABEL: reassoc_demorgan_i32:
; X64:       # %bb.0:
; X64-NEXT:    notl %edi
; X64-NEXT:    andnl %edi, %esi, %eax
; X64-NEXT:    retq
  %temp = or i32 %b, %a
  %res = xor i32 %temp, -1
  ret i32 %res
}

define i32 @reassoc_demorgan_three_arguments_i32(i32 %a, i32 %b, i32 %c) nounwind {
; X86-LABEL: reassoc_demorgan_three_arguments_i32:
; X86:       # %bb.0:
; X86-NEXT:    movl {{[0-9]+}}(%esp), %eax
; X86-NEXT:    movl {{[0-9]+}}(%esp), %ecx
; X86-NEXT:    orl {{[0-9]+}}(%esp), %ecx
; X86-NEXT:    notl %eax
; X86-NEXT:    andnl %eax, %ecx, %eax
; X86-NEXT:    retl
;
; X64-LABEL: reassoc_demorgan_three_arguments_i32:
; X64:       # %bb.0:
; X64-NEXT:    orl %esi, %edi
; X64-NEXT:    notl %edx
; X64-NEXT:    andnl %edx, %edi, %eax
; X64-NEXT:    retq
  %and.demorgan = or i32 %b, %a
  %and3.demorgan = or i32 %and.demorgan, %c
  %and3 = xor i32 %and3.demorgan, -1
  ret i32 %and3
}

define i64 @reassoc_demorgan_i64(i64 %a, i64 %b) nounwind {
; X86-LABEL: reassoc_demorgan_i64:
; X86:       # %bb.0:
; X86-NEXT:    pushl %esi
; X86-NEXT:    movl {{[0-9]+}}(%esp), %eax
; X86-NEXT:    movl {{[0-9]+}}(%esp), %ecx
; X86-NEXT:    movl {{[0-9]+}}(%esp), %edx
; X86-NEXT:    movl {{[0-9]+}}(%esp), %esi
; X86-NEXT:    notl %edx
; X86-NEXT:    andnl %edx, %eax, %eax
; X86-NEXT:    notl %esi
; X86-NEXT:    andnl %esi, %ecx, %edx
; X86-NEXT:    popl %esi
; X86-NEXT:    retl
;
; X64-LABEL: reassoc_demorgan_i64:
; X64:       # %bb.0:
; X64-NEXT:    notq %rdi
; X64-NEXT:    andnq %rdi, %rsi, %rax
; X64-NEXT:    retq
  %temp = or i64 %b, %a
  %res = xor i64 %temp, -1
  ret i64 %res
}

define i64 @reassoc_demorgan_three_arguments_i64(i64 %a, i64 %b, i64 %c) nounwind {
; X86-LABEL: reassoc_demorgan_three_arguments_i64:
; X86:       # %bb.0:
; X86-NEXT:    pushl %esi
; X86-NEXT:    movl {{[0-9]+}}(%esp), %eax
; X86-NEXT:    movl {{[0-9]+}}(%esp), %ecx
; X86-NEXT:    movl {{[0-9]+}}(%esp), %edx
; X86-NEXT:    movl {{[0-9]+}}(%esp), %esi
; X86-NEXT:    orl {{[0-9]+}}(%esp), %esi
; X86-NEXT:    orl {{[0-9]+}}(%esp), %edx
; X86-NEXT:    notl %eax
; X86-NEXT:    andnl %eax, %edx, %eax
; X86-NEXT:    notl %ecx
; X86-NEXT:    andnl %ecx, %esi, %edx
; X86-NEXT:    popl %esi
; X86-NEXT:    retl
;
; X64-LABEL: reassoc_demorgan_three_arguments_i64:
; X64:       # %bb.0:
; X64-NEXT:    orq %rsi, %rdi
; X64-NEXT:    notq %rdx
; X64-NEXT:    andnq %rdx, %rdi, %rax
; X64-NEXT:    retq
  %and.demorgan = or i64 %b, %a
  %and3.demorgan = or i64 %and.demorgan, %c
  %and3 = xor i64 %and3.demorgan, -1
  ret i64 %and3
}
