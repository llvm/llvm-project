; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 6
; RUN: llc -mtriple=i386-unknown-code16 < %s | FileCheck %s

;; In 16-bit mode, the displacement must fit in 16 bits.
;; Test that we don't fold a large offset into the address mode.
;; The implementation simply doesn't fold any offset.

@X = external global i32, align 4

define i32 @small_offset() {
; CHECK-LABEL: small_offset:
; CHECK:       # %bb.0:
; CHECK-NEXT:    movl $X, %eax
; CHECK-NEXT:    addl $-4, %eax
; CHECK-NEXT:    retl
  ret i32 sub (i32 ptrtoint (ptr @X to i32), i32 4)
}

define i32 @large_offset() {
; CHECK-LABEL: large_offset:
; CHECK:       # %bb.0:
; CHECK-NEXT:    movl $X, %eax
; CHECK-NEXT:    addl $-65536, %eax # imm = 0xFFFF0000
; CHECK-NEXT:    retl
  ret i32 sub (i32 ptrtoint (ptr @X to i32), i32 65536)
}
