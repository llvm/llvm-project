; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 6
; RUN: llc < %s -mtriple=x86_64-linux | FileCheck %s -check-prefix=X64
; X64:      mov
; X64-NEXT: movb %ah, (%rsi)
; X64:      mov
; X64-NEXT: movb %ah, (%rsi)
; X64:      mov
; X64-NEXT: movb %ah, (%rsi)
; X64-NOT:      mov

; RUN: llc < %s -mtriple=x86_64-linux-gnux32 | FileCheck %s -check-prefix=X32
; X32:      mov
; X32-NEXT: movb %ah, (%esi)
; X32:      mov
; X32-NEXT: movb %ah, (%esi)
; X32:      mov
; X32-NEXT: movb %ah, (%esi)
; X32-NOT:      mov

; RUN: llc < %s -mtriple=x86_64-win32 | FileCheck %s -check-prefix=W64
; W64-NOT:      mov
; W64:      movb %ch, (%rdx)
; W64-NOT:      mov
; W64:      movb %ch, (%rdx)
; W64-NOT:      mov
; W64:      movb %ch, (%rdx)
; W64-NOT:      mov

; RUN: llc < %s -mtriple=i686-- | FileCheck %s -check-prefix=X86
; X86-NOT:      mov
; X86:      movb %ah, (%e
; X86-NOT:      mov
; X86:      movb %ah, (%e
; X86-NOT:      mov
; X86:      movb %ah, (%e
; X86-NOT:      mov

; Use h-register extract and store.

define void @foo16(i16 inreg %p, ptr inreg %z) nounwind {
; X64-LABEL: foo16:
; X64:       # %bb.0:
; X64-NEXT:    movl %edi, %eax
; X64-NEXT:    movzbl %ah, %eax
; X64-NEXT:    movb %al, (%rsi)
; X64-NEXT:    retq
;
; X32-LABEL: foo16:
; X32:       # %bb.0:
; X32-NEXT:    movl %edi, %eax
; X32-NEXT:    movzbl %ah, %eax
; X32-NEXT:    movb %al, (%esi)
; X32-NEXT:    retq
;
; W64-LABEL: foo16:
; W64:       # %bb.0:
; W64-NEXT:    movzwl %cx, %eax
; W64-NEXT:    shrl $8, %eax
; W64-NEXT:    movb %al, (%rdx)
; W64-NEXT:    retq
;
; X86-LABEL: foo16:
; X86:       # %bb.0:
; X86-NEXT:    movzbl %ah, %eax
; X86-NEXT:    movb %al, (%edx)
; X86-NEXT:    retl
  %q = lshr i16 %p, 8
  %t = trunc i16 %q to i8
  store i8 %t, ptr %z
  ret void
}
define void @foo32(i32 inreg %p, ptr inreg %z) nounwind {
; X64-LABEL: foo32:
; X64:       # %bb.0:
; X64-NEXT:    movl %edi, %eax
; X64-NEXT:    movb %ah, (%rsi)
; X64-NEXT:    retq
;
; X32-LABEL: foo32:
; X32:       # %bb.0:
; X32-NEXT:    movl %edi, %eax
; X32-NEXT:    movb %ah, (%esi)
; X32-NEXT:    retq
;
; W64-LABEL: foo32:
; W64:       # %bb.0:
; W64-NEXT:    movb %ch, (%rdx)
; W64-NEXT:    retq
;
; X86-LABEL: foo32:
; X86:       # %bb.0:
; X86-NEXT:    movb %ah, (%edx)
; X86-NEXT:    retl
  %q = lshr i32 %p, 8
  %t = trunc i32 %q to i8
  store i8 %t, ptr %z
  ret void
}
define void @foo64(i64 inreg %p, ptr inreg %z) nounwind {
; X64-LABEL: foo64:
; X64:       # %bb.0:
; X64-NEXT:    movq %rdi, %rax
; X64-NEXT:    movb %ah, (%rsi)
; X64-NEXT:    retq
;
; X32-LABEL: foo64:
; X32:       # %bb.0:
; X32-NEXT:    movq %rdi, %rax
; X32-NEXT:    movb %ah, (%esi)
; X32-NEXT:    retq
;
; W64-LABEL: foo64:
; W64:       # %bb.0:
; W64-NEXT:    movb %ch, (%rdx)
; W64-NEXT:    retq
;
; X86-LABEL: foo64:
; X86:       # %bb.0:
; X86-NEXT:    movb %ah, (%ecx)
; X86-NEXT:    retl
  %q = lshr i64 %p, 8
  %t = trunc i64 %q to i8
  store i8 %t, ptr %z
  ret void
}
