; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=x86_64-- -mattr=+avx,+pclmul | FileCheck %s --check-prefixes=AVX1
; RUN: llc < %s -mtriple=x86_64-- -mattr=+avx2,+pclmul | FileCheck %s --check-prefixes=AVX2,AVX2-PCLMUL
; RUN: llc < %s -mtriple=x86_64-- -mattr=+avx2,+vpclmulqdq | FileCheck %s --check-prefixes=AVX2,AVX2-VPCLMULQDQ
; RUN: llc < %s -mtriple=x86_64-- -mattr=+avx512vl,+vpclmulqdq | FileCheck %s --check-prefixes=AVX512

define <32 x i8> @clmul_v32i8(<32 x i8> %a, <32 x i8> %b) nounwind {
; AVX1-LABEL: clmul_v32i8:
; AVX1:       # %bb.0:
; AVX1-NEXT:    vextractf128 $1, %ymm0, %xmm2
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm3
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm4
; AVX1-NEXT:    vinsertf128 $1, %xmm3, %ymm4, %ymm3
; AVX1-NEXT:    vbroadcastf128 {{.*#+}} ymm4 = [255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0]
; AVX1-NEXT:    # ymm4 = mem[0,1,0,1]
; AVX1-NEXT:    vandps %ymm4, %ymm3, %ymm7
; AVX1-NEXT:    vbroadcastss {{.*#+}} ymm3 = [255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0]
; AVX1-NEXT:    vpandn %xmm5, %xmm3, %xmm5
; AVX1-NEXT:    vpmaddubsw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vpsllw $8, %xmm5, %xmm5
; AVX1-NEXT:    vpandn %xmm6, %xmm3, %xmm6
; AVX1-NEXT:    vpmaddubsw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpsllw $8, %xmm6, %xmm6
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vorps %ymm5, %ymm7, %ymm5
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm6
; AVX1-NEXT:    vextractf128 $1, %ymm6, %xmm7
; AVX1-NEXT:    vpmullw %xmm7, %xmm2, %xmm8
; AVX1-NEXT:    vpmullw %xmm6, %xmm0, %xmm9
; AVX1-NEXT:    vinsertf128 $1, %xmm8, %ymm9, %ymm8
; AVX1-NEXT:    vandps %ymm4, %ymm8, %ymm8
; AVX1-NEXT:    vpandn %xmm6, %xmm3, %xmm6
; AVX1-NEXT:    vpmaddubsw %xmm6, %xmm0, %xmm6
; AVX1-NEXT:    vpsllw $8, %xmm6, %xmm6
; AVX1-NEXT:    vpandn %xmm7, %xmm3, %xmm7
; AVX1-NEXT:    vpmaddubsw %xmm7, %xmm2, %xmm7
; AVX1-NEXT:    vpsllw $8, %xmm7, %xmm7
; AVX1-NEXT:    vinsertf128 $1, %xmm7, %ymm6, %ymm6
; AVX1-NEXT:    vorps %ymm6, %ymm8, %ymm6
; AVX1-NEXT:    vxorps %ymm5, %ymm6, %ymm5
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm6
; AVX1-NEXT:    vextractf128 $1, %ymm6, %xmm7
; AVX1-NEXT:    vpmullw %xmm7, %xmm2, %xmm8
; AVX1-NEXT:    vpmullw %xmm6, %xmm0, %xmm9
; AVX1-NEXT:    vinsertf128 $1, %xmm8, %ymm9, %ymm8
; AVX1-NEXT:    vandps %ymm4, %ymm8, %ymm8
; AVX1-NEXT:    vpandn %xmm6, %xmm3, %xmm6
; AVX1-NEXT:    vpmaddubsw %xmm6, %xmm0, %xmm6
; AVX1-NEXT:    vpsllw $8, %xmm6, %xmm6
; AVX1-NEXT:    vpandn %xmm7, %xmm3, %xmm7
; AVX1-NEXT:    vpmaddubsw %xmm7, %xmm2, %xmm7
; AVX1-NEXT:    vpsllw $8, %xmm7, %xmm7
; AVX1-NEXT:    vinsertf128 $1, %xmm7, %ymm6, %ymm6
; AVX1-NEXT:    vorps %ymm6, %ymm8, %ymm6
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm7
; AVX1-NEXT:    vextractf128 $1, %ymm7, %xmm8
; AVX1-NEXT:    vpmullw %xmm2, %xmm8, %xmm9
; AVX1-NEXT:    vpmullw %xmm7, %xmm0, %xmm10
; AVX1-NEXT:    vinsertf128 $1, %xmm9, %ymm10, %ymm9
; AVX1-NEXT:    vandps %ymm4, %ymm9, %ymm9
; AVX1-NEXT:    vpandn %xmm7, %xmm3, %xmm7
; AVX1-NEXT:    vpmaddubsw %xmm7, %xmm0, %xmm7
; AVX1-NEXT:    vpsllw $8, %xmm7, %xmm7
; AVX1-NEXT:    vpandn %xmm8, %xmm3, %xmm8
; AVX1-NEXT:    vpmaddubsw %xmm8, %xmm2, %xmm8
; AVX1-NEXT:    vpsllw $8, %xmm8, %xmm8
; AVX1-NEXT:    vinsertf128 $1, %xmm8, %ymm7, %ymm7
; AVX1-NEXT:    vorps %ymm7, %ymm9, %ymm7
; AVX1-NEXT:    vxorps %ymm7, %ymm6, %ymm6
; AVX1-NEXT:    vxorps %ymm6, %ymm5, %ymm5
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm6
; AVX1-NEXT:    vextractf128 $1, %ymm6, %xmm7
; AVX1-NEXT:    vpmullw %xmm7, %xmm2, %xmm8
; AVX1-NEXT:    vpmullw %xmm6, %xmm0, %xmm9
; AVX1-NEXT:    vinsertf128 $1, %xmm8, %ymm9, %ymm8
; AVX1-NEXT:    vandps %ymm4, %ymm8, %ymm8
; AVX1-NEXT:    vpandn %xmm6, %xmm3, %xmm6
; AVX1-NEXT:    vpmaddubsw %xmm6, %xmm0, %xmm6
; AVX1-NEXT:    vpsllw $8, %xmm6, %xmm6
; AVX1-NEXT:    vpandn %xmm7, %xmm3, %xmm7
; AVX1-NEXT:    vpmaddubsw %xmm7, %xmm2, %xmm7
; AVX1-NEXT:    vpsllw $8, %xmm7, %xmm7
; AVX1-NEXT:    vinsertf128 $1, %xmm7, %ymm6, %ymm6
; AVX1-NEXT:    vorps %ymm6, %ymm8, %ymm6
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm7
; AVX1-NEXT:    vextractf128 $1, %ymm7, %xmm8
; AVX1-NEXT:    vpmullw %xmm2, %xmm8, %xmm9
; AVX1-NEXT:    vpmullw %xmm7, %xmm0, %xmm10
; AVX1-NEXT:    vinsertf128 $1, %xmm9, %ymm10, %ymm9
; AVX1-NEXT:    vandps %ymm4, %ymm9, %ymm9
; AVX1-NEXT:    vpandn %xmm7, %xmm3, %xmm7
; AVX1-NEXT:    vpmaddubsw %xmm7, %xmm0, %xmm7
; AVX1-NEXT:    vpsllw $8, %xmm7, %xmm7
; AVX1-NEXT:    vpandn %xmm8, %xmm3, %xmm8
; AVX1-NEXT:    vpmaddubsw %xmm8, %xmm2, %xmm8
; AVX1-NEXT:    vpsllw $8, %xmm8, %xmm8
; AVX1-NEXT:    vinsertf128 $1, %xmm8, %ymm7, %ymm7
; AVX1-NEXT:    vorps %ymm7, %ymm9, %ymm7
; AVX1-NEXT:    vxorps %ymm7, %ymm6, %ymm6
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm7
; AVX1-NEXT:    vextractf128 $1, %ymm7, %xmm8
; AVX1-NEXT:    vpmullw %xmm2, %xmm8, %xmm9
; AVX1-NEXT:    vpmullw %xmm7, %xmm0, %xmm10
; AVX1-NEXT:    vinsertf128 $1, %xmm9, %ymm10, %ymm9
; AVX1-NEXT:    vandps %ymm4, %ymm9, %ymm4
; AVX1-NEXT:    vpandn %xmm7, %xmm3, %xmm7
; AVX1-NEXT:    vpmaddubsw %xmm7, %xmm0, %xmm7
; AVX1-NEXT:    vpsllw $8, %xmm7, %xmm7
; AVX1-NEXT:    vpandn %xmm8, %xmm3, %xmm8
; AVX1-NEXT:    vpmaddubsw %xmm8, %xmm2, %xmm8
; AVX1-NEXT:    vpsllw $8, %xmm8, %xmm8
; AVX1-NEXT:    vinsertf128 $1, %xmm8, %ymm7, %ymm7
; AVX1-NEXT:    vorps %ymm7, %ymm4, %ymm4
; AVX1-NEXT:    vxorps %ymm4, %ymm6, %ymm4
; AVX1-NEXT:    vxorps %ymm4, %ymm5, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm1
; AVX1-NEXT:    vextractf128 $1, %ymm1, %xmm5
; AVX1-NEXT:    vpmullw %xmm5, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm1, %xmm0, %xmm7
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm7, %ymm6
; AVX1-NEXT:    vandps %ymm3, %ymm6, %ymm6
; AVX1-NEXT:    vpandn %xmm1, %xmm3, %xmm1
; AVX1-NEXT:    vpmaddubsw %xmm1, %xmm0, %xmm0
; AVX1-NEXT:    vpsllw $8, %xmm0, %xmm0
; AVX1-NEXT:    vpandn %xmm5, %xmm3, %xmm1
; AVX1-NEXT:    vpmaddubsw %xmm1, %xmm2, %xmm1
; AVX1-NEXT:    vpsllw $8, %xmm1, %xmm1
; AVX1-NEXT:    vinsertf128 $1, %xmm1, %ymm0, %ymm0
; AVX1-NEXT:    vorps %ymm0, %ymm6, %ymm0
; AVX1-NEXT:    vxorps %ymm0, %ymm4, %ymm0
; AVX1-NEXT:    retq
;
; AVX2-LABEL: clmul_v32i8:
; AVX2:       # %bb.0:
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm3
; AVX2-NEXT:    vpmullw %ymm3, %ymm0, %ymm4
; AVX2-NEXT:    vpbroadcastw {{.*#+}} ymm2 = [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]
; AVX2-NEXT:    vpand %ymm2, %ymm4, %ymm4
; AVX2-NEXT:    vpandn %ymm3, %ymm2, %ymm3
; AVX2-NEXT:    vpmaddubsw %ymm3, %ymm0, %ymm3
; AVX2-NEXT:    vpsllw $8, %ymm3, %ymm3
; AVX2-NEXT:    vpor %ymm3, %ymm4, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm5
; AVX2-NEXT:    vpand %ymm2, %ymm5, %ymm5
; AVX2-NEXT:    vpandn %ymm4, %ymm2, %ymm4
; AVX2-NEXT:    vpmaddubsw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpsllw $8, %ymm4, %ymm4
; AVX2-NEXT:    vpor %ymm4, %ymm5, %ymm4
; AVX2-NEXT:    vpxor %ymm3, %ymm4, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm5
; AVX2-NEXT:    vpand %ymm2, %ymm5, %ymm5
; AVX2-NEXT:    vpandn %ymm4, %ymm2, %ymm4
; AVX2-NEXT:    vpmaddubsw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpsllw $8, %ymm4, %ymm4
; AVX2-NEXT:    vpor %ymm4, %ymm5, %ymm4
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX2-NEXT:    vpmullw %ymm5, %ymm0, %ymm6
; AVX2-NEXT:    vpand %ymm2, %ymm6, %ymm6
; AVX2-NEXT:    vpandn %ymm5, %ymm2, %ymm5
; AVX2-NEXT:    vpmaddubsw %ymm5, %ymm0, %ymm5
; AVX2-NEXT:    vpsllw $8, %ymm5, %ymm5
; AVX2-NEXT:    vpor %ymm5, %ymm6, %ymm5
; AVX2-NEXT:    vpxor %ymm5, %ymm4, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm5
; AVX2-NEXT:    vpand %ymm2, %ymm5, %ymm5
; AVX2-NEXT:    vpandn %ymm4, %ymm2, %ymm4
; AVX2-NEXT:    vpmaddubsw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpsllw $8, %ymm4, %ymm4
; AVX2-NEXT:    vpor %ymm4, %ymm5, %ymm4
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX2-NEXT:    vpmullw %ymm5, %ymm0, %ymm6
; AVX2-NEXT:    vpand %ymm2, %ymm6, %ymm6
; AVX2-NEXT:    vpandn %ymm5, %ymm2, %ymm5
; AVX2-NEXT:    vpmaddubsw %ymm5, %ymm0, %ymm5
; AVX2-NEXT:    vpsllw $8, %ymm5, %ymm5
; AVX2-NEXT:    vpor %ymm5, %ymm6, %ymm5
; AVX2-NEXT:    vpxor %ymm5, %ymm4, %ymm4
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX2-NEXT:    vpmullw %ymm5, %ymm0, %ymm6
; AVX2-NEXT:    vpand %ymm2, %ymm6, %ymm6
; AVX2-NEXT:    vpandn %ymm5, %ymm2, %ymm5
; AVX2-NEXT:    vpmaddubsw %ymm5, %ymm0, %ymm5
; AVX2-NEXT:    vpsllw $8, %ymm5, %ymm5
; AVX2-NEXT:    vpor %ymm5, %ymm6, %ymm5
; AVX2-NEXT:    vpxor %ymm5, %ymm4, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm1
; AVX2-NEXT:    vpmullw %ymm1, %ymm0, %ymm4
; AVX2-NEXT:    vpand %ymm2, %ymm4, %ymm4
; AVX2-NEXT:    vpandn %ymm1, %ymm2, %ymm1
; AVX2-NEXT:    vpmaddubsw %ymm1, %ymm0, %ymm0
; AVX2-NEXT:    vpsllw $8, %ymm0, %ymm0
; AVX2-NEXT:    vpor %ymm0, %ymm4, %ymm0
; AVX2-NEXT:    vpxor %ymm0, %ymm3, %ymm0
; AVX2-NEXT:    retq
;
; AVX512-LABEL: clmul_v32i8:
; AVX512:       # %bb.0:
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm3
; AVX512-NEXT:    vpbroadcastd {{.*#+}} ymm4 = [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]
; AVX512-NEXT:    vpandn %ymm2, %ymm4, %ymm2
; AVX512-NEXT:    vpmaddubsw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpsllw $8, %ymm2, %ymm2
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm2 = ymm2 | (ymm3 & ymm4)
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm3
; AVX512-NEXT:    vpmullw %ymm3, %ymm0, %ymm5
; AVX512-NEXT:    vpand %ymm4, %ymm5, %ymm5
; AVX512-NEXT:    vpandn %ymm3, %ymm4, %ymm3
; AVX512-NEXT:    vpmaddubsw %ymm3, %ymm0, %ymm3
; AVX512-NEXT:    vpsllw $8, %ymm3, %ymm3
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm3 = ymm2 ^ (ymm3 | ymm5)
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm5
; AVX512-NEXT:    vpand %ymm4, %ymm5, %ymm5
; AVX512-NEXT:    vpandn %ymm2, %ymm4, %ymm2
; AVX512-NEXT:    vpmaddubsw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpsllw $8, %ymm2, %ymm2
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm2 = ymm3 ^ (ymm2 | ymm5)
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm3
; AVX512-NEXT:    vpmullw %ymm3, %ymm0, %ymm5
; AVX512-NEXT:    vpand %ymm4, %ymm5, %ymm5
; AVX512-NEXT:    vpandn %ymm3, %ymm4, %ymm3
; AVX512-NEXT:    vpmaddubsw %ymm3, %ymm0, %ymm3
; AVX512-NEXT:    vpsllw $8, %ymm3, %ymm3
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm3 = ymm2 ^ (ymm3 | ymm5)
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm5
; AVX512-NEXT:    vpand %ymm4, %ymm5, %ymm5
; AVX512-NEXT:    vpandn %ymm2, %ymm4, %ymm2
; AVX512-NEXT:    vpmaddubsw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpsllw $8, %ymm2, %ymm2
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm2 = ymm3 ^ (ymm2 | ymm5)
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm3
; AVX512-NEXT:    vpmullw %ymm3, %ymm0, %ymm5
; AVX512-NEXT:    vpand %ymm4, %ymm5, %ymm5
; AVX512-NEXT:    vpandn %ymm3, %ymm4, %ymm3
; AVX512-NEXT:    vpmaddubsw %ymm3, %ymm0, %ymm3
; AVX512-NEXT:    vpsllw $8, %ymm3, %ymm3
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm3 = ymm2 ^ (ymm3 | ymm5)
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm5
; AVX512-NEXT:    vpand %ymm4, %ymm5, %ymm5
; AVX512-NEXT:    vpandn %ymm2, %ymm4, %ymm2
; AVX512-NEXT:    vpmaddubsw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpsllw $8, %ymm2, %ymm2
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm2 = ymm3 ^ (ymm2 | ymm5)
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm1
; AVX512-NEXT:    vpmullw %ymm1, %ymm0, %ymm3
; AVX512-NEXT:    vpand %ymm4, %ymm3, %ymm3
; AVX512-NEXT:    vpandn %ymm1, %ymm4, %ymm1
; AVX512-NEXT:    vpmaddubsw %ymm1, %ymm0, %ymm0
; AVX512-NEXT:    vpsllw $8, %ymm0, %ymm0
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm0 = ymm2 ^ (ymm0 | ymm3)
; AVX512-NEXT:    retq
  %res = call <32 x i8> @llvm.clmul.v32i8(<32 x i8> %a, <32 x i8> %b)
  ret <32 x i8> %res
}

define <16 x i16> @clmul_v16i16(<16 x i16> %a, <16 x i16> %b) nounwind {
; AVX1-LABEL: clmul_v16i16:
; AVX1:       # %bb.0:
; AVX1-NEXT:    vextractf128 $1, %ymm0, %xmm2
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm3
; AVX1-NEXT:    vextractf128 $1, %ymm3, %xmm4
; AVX1-NEXT:    vpmullw %xmm4, %xmm2, %xmm4
; AVX1-NEXT:    vpmullw %xmm3, %xmm0, %xmm3
; AVX1-NEXT:    vinsertf128 $1, %xmm4, %ymm3, %ymm3
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX1-NEXT:    vextractf128 $1, %ymm4, %xmm5
; AVX1-NEXT:    vpmullw %xmm5, %xmm2, %xmm5
; AVX1-NEXT:    vpmullw %xmm4, %xmm0, %xmm4
; AVX1-NEXT:    vinsertf128 $1, %xmm5, %ymm4, %ymm4
; AVX1-NEXT:    vxorps %ymm3, %ymm4, %ymm3
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX1-NEXT:    vextractf128 $1, %ymm4, %xmm5
; AVX1-NEXT:    vpmullw %xmm5, %xmm2, %xmm5
; AVX1-NEXT:    vpmullw %xmm4, %xmm0, %xmm4
; AVX1-NEXT:    vinsertf128 $1, %xmm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vxorps %ymm5, %ymm4, %ymm4
; AVX1-NEXT:    vxorps %ymm4, %ymm3, %ymm3
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX1-NEXT:    vextractf128 $1, %ymm4, %xmm5
; AVX1-NEXT:    vpmullw %xmm5, %xmm2, %xmm5
; AVX1-NEXT:    vpmullw %xmm4, %xmm0, %xmm4
; AVX1-NEXT:    vinsertf128 $1, %xmm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vxorps %ymm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vxorps %ymm5, %ymm4, %ymm4
; AVX1-NEXT:    vxorps %ymm4, %ymm3, %ymm3
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX1-NEXT:    vextractf128 $1, %ymm4, %xmm5
; AVX1-NEXT:    vpmullw %xmm5, %xmm2, %xmm5
; AVX1-NEXT:    vpmullw %xmm4, %xmm0, %xmm4
; AVX1-NEXT:    vinsertf128 $1, %xmm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vxorps %ymm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vxorps %ymm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vxorps %ymm5, %ymm4, %ymm4
; AVX1-NEXT:    vxorps %ymm4, %ymm3, %ymm3
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX1-NEXT:    vextractf128 $1, %ymm4, %xmm5
; AVX1-NEXT:    vpmullw %xmm5, %xmm2, %xmm5
; AVX1-NEXT:    vpmullw %xmm4, %xmm0, %xmm4
; AVX1-NEXT:    vinsertf128 $1, %xmm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vxorps %ymm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vxorps %ymm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm5
; AVX1-NEXT:    vextractf128 $1, %ymm5, %xmm6
; AVX1-NEXT:    vpmullw %xmm6, %xmm2, %xmm6
; AVX1-NEXT:    vpmullw %xmm5, %xmm0, %xmm5
; AVX1-NEXT:    vinsertf128 $1, %xmm6, %ymm5, %ymm5
; AVX1-NEXT:    vxorps %ymm5, %ymm4, %ymm4
; AVX1-NEXT:    vandps {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm1
; AVX1-NEXT:    vextractf128 $1, %ymm1, %xmm5
; AVX1-NEXT:    vpmullw %xmm5, %xmm2, %xmm2
; AVX1-NEXT:    vpmullw %xmm1, %xmm0, %xmm0
; AVX1-NEXT:    vinsertf128 $1, %xmm2, %ymm0, %ymm0
; AVX1-NEXT:    vxorps %ymm0, %ymm4, %ymm0
; AVX1-NEXT:    vxorps %ymm0, %ymm3, %ymm0
; AVX1-NEXT:    retq
;
; AVX2-LABEL: clmul_v16i16:
; AVX2:       # %bb.0:
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm2
; AVX2-NEXT:    vpmullw %ymm2, %ymm0, %ymm2
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm3
; AVX2-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX2-NEXT:    vpxor %ymm2, %ymm3, %ymm2
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm3
; AVX2-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpxor %ymm3, %ymm2, %ymm2
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm3
; AVX2-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpxor %ymm3, %ymm2, %ymm2
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm3
; AVX2-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpxor %ymm3, %ymm2, %ymm2
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm3
; AVX2-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm4
; AVX2-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX2-NEXT:    vpxor %ymm4, %ymm3, %ymm3
; AVX2-NEXT:    vpand {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %ymm1, %ymm1
; AVX2-NEXT:    vpmullw %ymm1, %ymm0, %ymm0
; AVX2-NEXT:    vpxor %ymm0, %ymm3, %ymm0
; AVX2-NEXT:    vpxor %ymm0, %ymm2, %ymm0
; AVX2-NEXT:    retq
;
; AVX512-LABEL: clmul_v16i16:
; AVX512:       # %bb.0:
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm3
; AVX512-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX512-NEXT:    vpxor %ymm2, %ymm3, %ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm3
; AVX512-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm4
; AVX512-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm4 = ymm4 ^ ymm2 ^ ymm3
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm3
; AVX512-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm3 = ymm3 ^ ymm4 ^ ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm4
; AVX512-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm4 = ymm4 ^ ymm3 ^ ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm3
; AVX512-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm3 = ymm3 ^ ymm4 ^ ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm4
; AVX512-NEXT:    vpmullw %ymm4, %ymm0, %ymm4
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm4 = ymm4 ^ ymm3 ^ ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm3
; AVX512-NEXT:    vpmullw %ymm3, %ymm0, %ymm3
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm3 = ymm3 ^ ymm4 ^ ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm2
; AVX512-NEXT:    vpmullw %ymm2, %ymm0, %ymm2
; AVX512-NEXT:    vpandd {{\.?LCPI[0-9]+_[0-9]+}}(%rip){1to8}, %ymm1, %ymm1
; AVX512-NEXT:    vpmullw %ymm1, %ymm0, %ymm0
; AVX512-NEXT:    vpternlogq {{.*#+}} ymm0 = ymm0 ^ ymm3 ^ ymm2
; AVX512-NEXT:    retq
  %res = call <16 x i16> @llvm.clmul.v16i16(<16 x i16> %a, <16 x i16> %b)
  ret <16 x i16> %res
}

define <8 x i32> @clmul_v8i32(<8 x i32> %a, <8 x i32> %b) nounwind {
; AVX1-LABEL: clmul_v8i32:
; AVX1:       # %bb.0:
; AVX1-NEXT:    vextractf128 $1, %ymm1, %xmm2
; AVX1-NEXT:    vextractf128 $1, %ymm0, %xmm3
; AVX1-NEXT:    vpclmulqdq $0, %xmm2, %xmm3, %xmm4
; AVX1-NEXT:    vpshufd {{.*#+}} xmm5 = xmm2[1,1,1,1]
; AVX1-NEXT:    vpshufd {{.*#+}} xmm6 = xmm3[1,1,1,1]
; AVX1-NEXT:    vpclmulqdq $0, %xmm5, %xmm6, %xmm5
; AVX1-NEXT:    vpunpckldq {{.*#+}} xmm4 = xmm4[0],xmm5[0],xmm4[1],xmm5[1]
; AVX1-NEXT:    vpclmulqdq $17, %xmm2, %xmm3, %xmm5
; AVX1-NEXT:    vmovq %xmm5, %rax
; AVX1-NEXT:    vpinsrd $2, %eax, %xmm4, %xmm4
; AVX1-NEXT:    vpshufd {{.*#+}} xmm2 = xmm2[3,3,3,3]
; AVX1-NEXT:    vpshufd {{.*#+}} xmm3 = xmm3[3,3,3,3]
; AVX1-NEXT:    vpclmulqdq $0, %xmm2, %xmm3, %xmm2
; AVX1-NEXT:    vmovq %xmm2, %rax
; AVX1-NEXT:    vpinsrd $3, %eax, %xmm4, %xmm2
; AVX1-NEXT:    vpclmulqdq $0, %xmm1, %xmm0, %xmm3
; AVX1-NEXT:    vpshufd {{.*#+}} xmm4 = xmm1[1,1,1,1]
; AVX1-NEXT:    vpshufd {{.*#+}} xmm5 = xmm0[1,1,1,1]
; AVX1-NEXT:    vpclmulqdq $0, %xmm4, %xmm5, %xmm4
; AVX1-NEXT:    vpunpckldq {{.*#+}} xmm3 = xmm3[0],xmm4[0],xmm3[1],xmm4[1]
; AVX1-NEXT:    vpclmulqdq $17, %xmm1, %xmm0, %xmm4
; AVX1-NEXT:    vmovq %xmm4, %rax
; AVX1-NEXT:    vpinsrd $2, %eax, %xmm3, %xmm3
; AVX1-NEXT:    vpshufd {{.*#+}} xmm1 = xmm1[3,3,3,3]
; AVX1-NEXT:    vpshufd {{.*#+}} xmm0 = xmm0[3,3,3,3]
; AVX1-NEXT:    vpclmulqdq $0, %xmm1, %xmm0, %xmm0
; AVX1-NEXT:    vmovq %xmm0, %rax
; AVX1-NEXT:    vpinsrd $3, %eax, %xmm3, %xmm0
; AVX1-NEXT:    vinsertf128 $1, %xmm2, %ymm0, %ymm0
; AVX1-NEXT:    retq
;
; AVX2-LABEL: clmul_v8i32:
; AVX2:       # %bb.0:
; AVX2-NEXT:    vextracti128 $1, %ymm1, %xmm2
; AVX2-NEXT:    vextracti128 $1, %ymm0, %xmm3
; AVX2-NEXT:    vpclmulqdq $0, %xmm2, %xmm3, %xmm4
; AVX2-NEXT:    vpshufd {{.*#+}} xmm5 = xmm2[1,1,1,1]
; AVX2-NEXT:    vpshufd {{.*#+}} xmm6 = xmm3[1,1,1,1]
; AVX2-NEXT:    vpclmulqdq $0, %xmm5, %xmm6, %xmm5
; AVX2-NEXT:    vpunpckldq {{.*#+}} xmm4 = xmm4[0],xmm5[0],xmm4[1],xmm5[1]
; AVX2-NEXT:    vpclmulqdq $17, %xmm2, %xmm3, %xmm5
; AVX2-NEXT:    vmovq %xmm5, %rax
; AVX2-NEXT:    vpinsrd $2, %eax, %xmm4, %xmm4
; AVX2-NEXT:    vpshufd {{.*#+}} xmm2 = xmm2[3,3,3,3]
; AVX2-NEXT:    vpshufd {{.*#+}} xmm3 = xmm3[3,3,3,3]
; AVX2-NEXT:    vpclmulqdq $0, %xmm2, %xmm3, %xmm2
; AVX2-NEXT:    vmovq %xmm2, %rax
; AVX2-NEXT:    vpinsrd $3, %eax, %xmm4, %xmm2
; AVX2-NEXT:    vpclmulqdq $0, %xmm1, %xmm0, %xmm3
; AVX2-NEXT:    vpshufd {{.*#+}} xmm4 = xmm1[1,1,1,1]
; AVX2-NEXT:    vpshufd {{.*#+}} xmm5 = xmm0[1,1,1,1]
; AVX2-NEXT:    vpclmulqdq $0, %xmm4, %xmm5, %xmm4
; AVX2-NEXT:    vpunpckldq {{.*#+}} xmm3 = xmm3[0],xmm4[0],xmm3[1],xmm4[1]
; AVX2-NEXT:    vpclmulqdq $17, %xmm1, %xmm0, %xmm4
; AVX2-NEXT:    vmovq %xmm4, %rax
; AVX2-NEXT:    vpinsrd $2, %eax, %xmm3, %xmm3
; AVX2-NEXT:    vpshufd {{.*#+}} xmm1 = xmm1[3,3,3,3]
; AVX2-NEXT:    vpshufd {{.*#+}} xmm0 = xmm0[3,3,3,3]
; AVX2-NEXT:    vpclmulqdq $0, %xmm1, %xmm0, %xmm0
; AVX2-NEXT:    vmovq %xmm0, %rax
; AVX2-NEXT:    vpinsrd $3, %eax, %xmm3, %xmm0
; AVX2-NEXT:    vinserti128 $1, %xmm2, %ymm0, %ymm0
; AVX2-NEXT:    retq
;
; AVX512-LABEL: clmul_v8i32:
; AVX512:       # %bb.0:
; AVX512-NEXT:    vextracti128 $1, %ymm1, %xmm2
; AVX512-NEXT:    vextracti128 $1, %ymm0, %xmm3
; AVX512-NEXT:    vpclmulqdq $0, %xmm2, %xmm3, %xmm4
; AVX512-NEXT:    vpshufd {{.*#+}} xmm5 = xmm2[1,1,1,1]
; AVX512-NEXT:    vpshufd {{.*#+}} xmm6 = xmm3[1,1,1,1]
; AVX512-NEXT:    vpclmulqdq $0, %xmm5, %xmm6, %xmm5
; AVX512-NEXT:    vpunpckldq {{.*#+}} xmm4 = xmm4[0],xmm5[0],xmm4[1],xmm5[1]
; AVX512-NEXT:    vpclmulqdq $17, %xmm2, %xmm3, %xmm5
; AVX512-NEXT:    vmovq %xmm5, %rax
; AVX512-NEXT:    vpinsrd $2, %eax, %xmm4, %xmm4
; AVX512-NEXT:    vpshufd {{.*#+}} xmm2 = xmm2[3,3,3,3]
; AVX512-NEXT:    vpshufd {{.*#+}} xmm3 = xmm3[3,3,3,3]
; AVX512-NEXT:    vpclmulqdq $0, %xmm2, %xmm3, %xmm2
; AVX512-NEXT:    vmovq %xmm2, %rax
; AVX512-NEXT:    vpinsrd $3, %eax, %xmm4, %xmm2
; AVX512-NEXT:    vpclmulqdq $0, %xmm1, %xmm0, %xmm3
; AVX512-NEXT:    vpshufd {{.*#+}} xmm4 = xmm1[1,1,1,1]
; AVX512-NEXT:    vpshufd {{.*#+}} xmm5 = xmm0[1,1,1,1]
; AVX512-NEXT:    vpclmulqdq $0, %xmm4, %xmm5, %xmm4
; AVX512-NEXT:    vpunpckldq {{.*#+}} xmm3 = xmm3[0],xmm4[0],xmm3[1],xmm4[1]
; AVX512-NEXT:    vpclmulqdq $17, %xmm1, %xmm0, %xmm4
; AVX512-NEXT:    vmovq %xmm4, %rax
; AVX512-NEXT:    vpinsrd $2, %eax, %xmm3, %xmm3
; AVX512-NEXT:    vpshufd {{.*#+}} xmm1 = xmm1[3,3,3,3]
; AVX512-NEXT:    vpshufd {{.*#+}} xmm0 = xmm0[3,3,3,3]
; AVX512-NEXT:    vpclmulqdq $0, %xmm1, %xmm0, %xmm0
; AVX512-NEXT:    vmovq %xmm0, %rax
; AVX512-NEXT:    vpinsrd $3, %eax, %xmm3, %xmm0
; AVX512-NEXT:    vinserti128 $1, %xmm2, %ymm0, %ymm0
; AVX512-NEXT:    retq
  %res = call <8 x i32> @llvm.clmul.v8i32(<8 x i32> %a, <8 x i32> %b)
  ret <8 x i32> %res
}

define <4 x i64> @clmul_v4i64(<4 x i64> %a, <4 x i64> %b) nounwind {
; AVX1-LABEL: clmul_v4i64:
; AVX1:       # %bb.0:
; AVX1-NEXT:    vextractf128 $1, %ymm1, %xmm2
; AVX1-NEXT:    vextractf128 $1, %ymm0, %xmm3
; AVX1-NEXT:    vpclmulqdq $17, %xmm2, %xmm3, %xmm4
; AVX1-NEXT:    vpclmulqdq $0, %xmm2, %xmm3, %xmm2
; AVX1-NEXT:    vpunpcklqdq {{.*#+}} xmm2 = xmm2[0],xmm4[0]
; AVX1-NEXT:    vpclmulqdq $17, %xmm1, %xmm0, %xmm3
; AVX1-NEXT:    vpclmulqdq $0, %xmm1, %xmm0, %xmm0
; AVX1-NEXT:    vpunpcklqdq {{.*#+}} xmm0 = xmm0[0],xmm3[0]
; AVX1-NEXT:    vinsertf128 $1, %xmm2, %ymm0, %ymm0
; AVX1-NEXT:    retq
;
; AVX2-PCLMUL-LABEL: clmul_v4i64:
; AVX2-PCLMUL:       # %bb.0:
; AVX2-PCLMUL-NEXT:    vextracti128 $1, %ymm1, %xmm2
; AVX2-PCLMUL-NEXT:    vextracti128 $1, %ymm0, %xmm3
; AVX2-PCLMUL-NEXT:    vpclmulqdq $17, %xmm2, %xmm3, %xmm4
; AVX2-PCLMUL-NEXT:    vpclmulqdq $17, %xmm1, %xmm0, %xmm5
; AVX2-PCLMUL-NEXT:    vinserti128 $1, %xmm4, %ymm5, %ymm4
; AVX2-PCLMUL-NEXT:    vpclmulqdq $0, %xmm2, %xmm3, %xmm2
; AVX2-PCLMUL-NEXT:    vpclmulqdq $0, %xmm1, %xmm0, %xmm0
; AVX2-PCLMUL-NEXT:    vinserti128 $1, %xmm2, %ymm0, %ymm0
; AVX2-PCLMUL-NEXT:    vpunpcklqdq {{.*#+}} ymm0 = ymm0[0],ymm4[0],ymm0[2],ymm4[2]
; AVX2-PCLMUL-NEXT:    retq
;
; AVX2-VPCLMULQDQ-LABEL: clmul_v4i64:
; AVX2-VPCLMULQDQ:       # %bb.0:
; AVX2-VPCLMULQDQ-NEXT:    vpclmulqdq $17, %ymm1, %ymm0, %ymm2
; AVX2-VPCLMULQDQ-NEXT:    vpclmulqdq $0, %ymm1, %ymm0, %ymm0
; AVX2-VPCLMULQDQ-NEXT:    vpunpcklqdq {{.*#+}} ymm0 = ymm0[0],ymm2[0],ymm0[2],ymm2[2]
; AVX2-VPCLMULQDQ-NEXT:    retq
;
; AVX512-LABEL: clmul_v4i64:
; AVX512:       # %bb.0:
; AVX512-NEXT:    vpclmulqdq $17, %ymm1, %ymm0, %ymm2
; AVX512-NEXT:    vpclmulqdq $0, %ymm1, %ymm0, %ymm0
; AVX512-NEXT:    vpunpcklqdq {{.*#+}} ymm0 = ymm0[0],ymm2[0],ymm0[2],ymm2[2]
; AVX512-NEXT:    retq
  %res = call <4 x i64> @llvm.clmul.v4i64(<4 x i64> %a, <4 x i64> %b)
  ret <4 x i64> %res
}
