# RUN: yaml2obj %s -o %t
# REQUIRES: x86-registered-target

# RUN: llvm-objdump -d %t --mattr=help 2>&1 \
# RUN:   | FileCheck %s --check-prefixes=CHECK,CHECK-DISASSEMBLE
# RUN: llvm-objdump -d %t --mcpu=help 2>&1 \
# RUN:   | FileCheck %s --check-prefixes=CHECK,CHECK-DISASSEMBLE

## The help message can be printed without -d.
# RUN: llvm-objdump --mattr=help %t 2>&1 \
# RUN:   | FileCheck %s --check-prefixes=CHECK,CHECK-NO-DISASSEMBLE
# RUN: llvm-objdump --mcpu=help %t 2>&1 \
# RUN:   | FileCheck %s --check-prefixes=CHECK,CHECK-NO-DISASSEMBLE

## We still handle other options.
# RUN: llvm-objdump --mattr=help --section-headers %t 2>&1 \
# RUN:   | FileCheck %s --check-prefixes=CHECK,CHECK-SECTION-HEADERS
# RUN: llvm-objdump --mcpu=help --section-headers %t 2>&1 \
# RUN:   | FileCheck %s --check-prefixes=CHECK,CHECK-SECTION-HEADERS

## We report an error when we can't infer the triple because we don't have --triple or an input object (including a.out).
# RUN: not llvm-objdump --mattr=help 2>&1 \
# RUN:   | FileCheck %s --check-prefix=CHECK-MISSING-ERROR --implicit-check-not=error: -DMSG=%errc_ENOENT
# RUN: not llvm-objdump --mcpu=help 2>&1 \
# RUN:   | FileCheck %s --check-prefix=CHECK-MISSING-ERROR --implicit-check-not=error: -DMSG=%errc_ENOENT

# RUN: yaml2obj --docnum=2 %s -o %t.minidump
## We report an error when the binary file isn't an object file format.
# RUN: not llvm-objdump --mattr=help %t.minidump 2>&1 \
# RUN:   | FileCheck %s --check-prefix=CHECK-UNSUPPORTED-ERROR --implicit-check-not=error: -DFILE=%t.minidump
# RUN: not llvm-objdump --mcpu=help %t.minidump 2>&1 \
# RUN:   | FileCheck %s --check-prefix=CHECK-UNSUPPORTED-ERROR --implicit-check-not=error: -DFILE=%t.minidump

# RUN: llvm-ar rcs %t.a %t
# RUN: llvm-objdump -d --mcpu=help %t.a 2>&1 \
# RUN:   | FileCheck %s --check-prefixes=CHECK,CHECK-DISASSEMBLE,CHECK-ARCHIVE-ERROR -DFILE=%t.a
# RUN: llvm-objdump -d --mattr=help %t.a 2>&1 \
# RUN:   | FileCheck %s --check-prefixes=CHECK,CHECK-DISASSEMBLE,CHECK-ARCHIVE-ERROR -DFILE=%t.a

# CHECK: Available CPUs for this target:
# CHECK: Available features for this target:
## To check we still disassemble the file:
# CHECK-DISASSEMBLE: file format elf64-x86-64
# CHECK-NO-DISASSEMBLE-NOT: file format elf64-x86-64

# CHECK-SECTION-HEADERS: Sections:
# CHECK-SECTION-HEADERS: Idx Name               Size     VMA              Type

# CHECK-MISSING-ERROR: llvm-objdump{{.*}}: error: 'a.out': triple was not specified and could not be inferred from the input file: [[MSG]]

# CHECK-UNSUPPORTED-ERROR: llvm-objdump{{.*}}: error: '[[FILE]]': input file is not an object file

# CHECK-ARCHIVE-ERROR-NOT: llvm-objdump{{.*}}: error: '[[FILE]]': input file is not an object file

--- !ELF
FileHeader:
  Class:           ELFCLASS64
  Data:            ELFDATA2LSB
  Type:            ET_EXEC
  Machine:         EM_X86_64

--- !minidump
Streams:
  - Type:            SystemInfo
    Processor Arch:  PPC
    Platform ID:     Linux
