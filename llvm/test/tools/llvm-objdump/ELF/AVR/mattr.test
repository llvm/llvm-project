## When --mattr and --mcpu are both empty, disassemble ELF with e_flags derived feature.
# RUN: yaml2obj -DARCH_ARCHVERSION=ARCH_AVR1 %s -o %t.avr1
# RUN: llvm-objdump -d %t.avr1 | FileCheck %s --check-prefixes=AVR1
# RUN: yaml2obj -DARCH_ARCHVERSION=ARCH_AVR3 %s -o %t.avr3
# RUN: llvm-objdump -d %t.avr3 | FileCheck %s --check-prefixes=ALL

## If --mattr or --mcpu is specified, don't default to the file's e_flags derived feature.
# RUN: llvm-objdump -d --mattr=+avr3 %t.avr1 | FileCheck %s --check-prefixes=ALL
# RUN: llvm-objdump -d --mcpu=avr3 %t.avr1 | FileCheck %s --check-prefixes=ALL

## If file's e_flags is not specified, default to "avr0".
# RUN: yaml2obj -DARCH_ARCHVERSION=LINKRELAX_PREPARED %s -o %t.noarchversion
# RUN: llvm-objdump -d %t.noarchversion | FileCheck %s --check-prefixes=AVR0

# AVR1:         <_start>:
# AVR1-COUNT-2:  <unknown>
# AVR1-NEXT:     lpm
# AVR1-NEXT:     rjmp    .-2

# ALL:      <_start>:
# ALL-NEXT:   call    0x0
# ALL-NEXT:   jmp     0x0
# ALL-NEXT:   lpm
# ALL-NEXT:   rjmp    .-2

# AVR0:         <_start>:
# AVR0-COUNT-3:   <unknown>

--- !ELF
FileHeader:
  Class:   ELFCLASS32
  Data:    ELFDATA2LSB
  Type:    ET_EXEC
  Machine: EM_AVR
  Flags:   [ EF_AVR_[[ARCH_ARCHVERSION]] ]
Sections:
  - Name:    .text
    Type:    SHT_PROGBITS
    Flags:   [ SHF_ALLOC, SHF_EXECINSTR ]
    Content: 0E9400000C940000C895FFCF
Symbols:
  - Name:    _start
    Section: .text
    Binding: STB_GLOBAL
