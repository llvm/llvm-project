RUN: llvm-objdump --macho --objc-meta-data    %p/Inputs/rel-method-lists-arm64_32.dylib | FileCheck %s --check-prefix=CHK32
RUN: llvm-otool -ov                           %p/Inputs/rel-method-lists-arm64_32.dylib | FileCheck %s --check-prefix=CHK32

RUN: llvm-objdump --macho --objc-meta-data    %p/Inputs/rel-method-lists-arm64.dylib    | FileCheck %s --check-prefix=CHK64
RUN: llvm-otool -ov                           %p/Inputs/rel-method-lists-arm64.dylib    | FileCheck %s --check-prefix=CHK64

CHK32:                 baseMethods 0x660 (struct method_list_t *)
CHK32-NEXT:                 entsize 12 (relative)
CHK32-NEXT:                   count 3
CHK32-NEXT:                    name 0x144 (0x7ac) instance_method_00
CHK32-NEXT:                   types 0x91 (0x6fd) v8@0:4
CHK32-NEXT:                     imp 0xffffff18 (0x588) -[MyClass instance_method_00]
CHK32-NEXT:                    name 0x13c (0x7b0) instance_method_01
CHK32-NEXT:                   types 0x85 (0x6fd) v8@0:4
CHK32-NEXT:                     imp 0xffffff28 (0x5a4) -[MyClass instance_method_01]
CHK32-NEXT:                    name 0x134 (0x7b4) instance_method_02
CHK32-NEXT:                   types 0x79 (0x6fd) v8@0:4
CHK32-NEXT:                     imp 0xffffff38 (0x5c0) -[MyClass instance_method_02]

CHK32:                 baseMethods 0x630 (struct method_list_t *)
CHK32-NEXT:                 entsize 12 (relative)
CHK32-NEXT:                   count 3
CHK32-NEXT:                    name 0x180 (0x7b8) class_method_00
CHK32-NEXT:                   types 0xc1 (0x6fd) v8@0:4
CHK32-NEXT:                     imp 0xffffff9c (0x5dc) +[MyClass class_method_00]
CHK32-NEXT:                    name 0x178 (0x7bc) class_method_01
CHK32-NEXT:                   types 0xb5 (0x6fd) v8@0:4
CHK32-NEXT:                     imp 0xffffffac (0x5f8) +[MyClass class_method_01]
CHK32-NEXT:                    name 0x170 (0x7c0) class_method_02
CHK32-NEXT:                   types 0xa9 (0x6fd) v8@0:4
CHK32-NEXT:                     imp 0xffffffbc (0x614) +[MyClass class_method_02]

CHK64:                  baseMethods 0x7d8 (struct method_list_t *)
CHK64-NEXT:                  entsize 24
CHK64-NEXT:                    count 3
CHK64-NEXT:                     name 0x6a4 instance_method_00
CHK64-NEXT:                    types 0x6dd v16@0:8
CHK64-NEXT:                      imp -[MyClass instance_method_00]
CHK64-NEXT:                     name 0x6b7 instance_method_01
CHK64-NEXT:                    types 0x6dd v16@0:8
CHK64-NEXT:                      imp -[MyClass instance_method_01]
CHK64-NEXT:                     name 0x6ca instance_method_02
CHK64-NEXT:                    types 0x6dd v16@0:8
CHK64-NEXT:                      imp -[MyClass instance_method_02]

CHK64:                  baseMethods 0x740 (struct method_list_t *)
CHK64-NEXT:                  entsize 24
CHK64-NEXT:                    count 3
CHK64-NEXT:                     name 0x674 class_method_00
CHK64-NEXT:                    types 0x6dd v16@0:8
CHK64-NEXT:                      imp +[MyClass class_method_00]
CHK64-NEXT:                     name 0x684 class_method_01
CHK64-NEXT:                    types 0x6dd v16@0:8
CHK64-NEXT:                      imp +[MyClass class_method_01]
CHK64-NEXT:                     name 0x694 class_method_02
CHK64-NEXT:                    types 0x6dd v16@0:8
CHK64-NEXT:                      imp +[MyClass class_method_02]


######## Generate rel-method-lists-arm64.dylib ########
// clang -c main.mm -o main.o -target arm64-apple-macos -arch arm64
// ld64.ld64 -dylib -demangle -dynamic main.o -o rel-method-lists-arm64.dylib -syslibroot MacOSX14.2.sdk -segalign 0x10 -objc_relative_method_lists

######## Generate rel-method-lists-arm64_32.dylib ########
// clang -c main.mm -o main.o -target arm64_32-apple-watchos -arch arm64_32
// ld64.ld64 -dylib -demangle -dynamic main.o -o rel-method-lists-arm64_32.dylib -syslibroot WatchOS.sdk -segalign 0x10 -objc_relative_method_lists

// ~~~~~~~~~~~~~~~~~~~~~~~~~ main.mm ~~~~~~~~~~~~~~~~~~~~~~~~~
__attribute__((objc_root_class))
@interface MyClass
- (void)instance_method_00;
- (void)instance_method_01;
- (void)instance_method_02;
+ (void)class_method_00;
+ (void)class_method_01;
+ (void)class_method_02;
@end
@implementation MyClass
- (void)instance_method_00 {}
- (void)instance_method_01 {}
- (void)instance_method_02 {}
+ (void)class_method_00 {}
+ (void)class_method_01 {}
+ (void)class_method_02 {}
@end
void *_objc_empty_cache;
void *_objc_empty_vtable;
