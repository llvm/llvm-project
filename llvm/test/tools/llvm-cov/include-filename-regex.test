########################
# Test "report" command.
########################
# Include only source files.
RUN: llvm-cov report -instr-profile %S/Inputs/sources_specified/main.profdata \
RUN:   -path-equivalence=/tmp,%S/Inputs -include-filename-regex='.*\.cc$' \
RUN:   %S/Inputs/sources_specified/main.covmapping --show-branch-summary=false \
RUN:   | FileCheck -check-prefix=REPORT_INCLUDE_SOURCE %s

REPORT_INCLUDE_SOURCE-NOT: {{.*}}dec.h{{.*}}
REPORT_INCLUDE_SOURCE-NOT: {{.*}}inc.h{{.*}}
REPORT_INCLUDE_SOURCE-NOT: {{.*}}abs.h{{.*}}
REPORT_INCLUDE_SOURCE: {{^}}TOTAL 1{{.*}}100.00%{{$}}

# Only include files from "extra" directory.
RUN: llvm-cov report -instr-profile %S/Inputs/sources_specified/main.profdata \
RUN:   -path-equivalence=/tmp,%S/Inputs -include-filename-regex='.*extra[/\\].*' \
RUN:   %S/Inputs/sources_specified/main.covmapping --show-branch-summary=false \
RUN:   | FileCheck -check-prefix=REPORT_INCLUDE_DIR %s

# llvm-cov uses extra as the base directory.
REPORT_INCLUDE_DIR: {{.*}}dec.h{{.*}}
REPORT_INCLUDE_DIR: {{.*}}inc.h{{.*}}
REPORT_INCLUDE_DIR-NOT: {{.*}}abs.h{{.*}}
REPORT_INCLUDE_DIR-NOT: {{.*}}main.cc{{.*}}
REPORT_INCLUDE_DIR: {{^}}TOTAL 2{{.*}}50.00%{{$}}

########################
# Test "show" command.
########################
# Include only header files.
RUN: llvm-cov show -instr-profile %S/Inputs/sources_specified/main.profdata \
RUN:   -path-equivalence=/tmp,%S/Inputs -include-filename-regex='.*\.h$' \
RUN:   %S/Inputs/sources_specified/main.covmapping \
RUN:   | FileCheck -check-prefix=SHOW_INCLUDE_HEADERS %s

# Order of files may differ, check that there are 3 files and not main.cc.
SHOW_INCLUDE_HEADERS-NOT: {{.*}}main.cc{{.*}}
SHOW_INCLUDE_HEADERS: {{.*}}sources_specified{{.*}}
SHOW_INCLUDE_HEADERS: {{.*}}sources_specified{{.*}}
SHOW_INCLUDE_HEADERS: {{.*}}sources_specified{{.*}}

########################
# Test "export" command.
########################
# Use a temp .json file as output in a single line. Only include headers that have
# name in a format of 3 symbols followed by ".h".
RUN: llvm-cov export -instr-profile %S/Inputs/sources_specified/main.profdata \
RUN:   -path-equivalence=/tmp,%S/Inputs -include-filename-regex='.*...\.h$' \
RUN:   %S/Inputs/sources_specified/main.covmapping \
RUN:   > %t.export.json

RUN: FileCheck -check-prefix=NO-EXPORT_INCLUDE_3_SYMBOLS_H %s < %t.export.json
RUN: FileCheck -check-prefix=EXPORT_INCLUDE_3_SYMBOLS_H %s < %t.export.json

NO-EXPORT_INCLUDE_3_SYMBOLS_H: {{"filename":"(/|\\\\)tmp(/|\\\\)sources_specified(/|\\\\)abs.h"}}
NO-EXPORT_INCLUDE_3_SYMBOLS_H: {{"filename":"(/|\\\\)tmp(/|\\\\)sources_specified(/|\\\\)extra(/|\\\\)dec.h"}}
NO-EXPORT_INCLUDE_3_SYMBOLS_H: {{"filename":"(/|\\\\)tmp(/|\\\\)sources_specified(/|\\\\)extra(/|\\\\)inc.h"}}
EXPORT_INCLUDE_3_SYMBOLS_H-NOT: {{"filename":"(/|\\\\)tmp(/|\\\\)sources_specified(/|\\\\)main.cc"}}
