## Tests that --call-graph-info fails if .callgraph section does not have
## an expected value, e.g., not as much call sites as the given count.

# REQUIRES: x86-registered-target

# RUN: llvm-mc %s -filetype=obj -triple=x86_64-pc-linux -o %t
# RUN: not llvm-readelf --call-graph-info %t 2>&1 | FileCheck %s --match-full-lines -DFILE=%t --check-prefix=ERR
# RUN: not llvm-readelf --elf-output-style=LLVM --call-graph-info %t 2>&1 | FileCheck %s --match-full-lines -DFILE=%t --check-prefix=ERR
# RUN: not llvm-readelf --elf-output-style=JSON --pretty-print --call-graph-info %t 2>&1 | FileCheck %s --match-full-lines -DFILE=%t --check-prefix=ERR

# ERR: {{.*}}llvm-readelf{{.*}}: error: 'While reading call graph info's [direct callee PC] for function at [0x0]': unexpected end of data at offset 0x28 while reading [0x28, 0x30)

.text
.globl _Z3foov
.type _Z3foov,@function
_Z3foov:
 callq _Z3foov
 retq

.section	.callgraph,"o",@progbits,.text
.quad 0  #< Format version number.
.quad 0  #< Function entry address.
.quad 0  #< Function kind.
.quad 0  #< Indirect call site count.
.quad 1  #< Direct call site count that follows.
         #< Missing direct call entries here.
.text
