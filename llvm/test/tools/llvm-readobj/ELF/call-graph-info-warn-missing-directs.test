## Tests that --call-graph-info fails if SHT_LLVM_CALL_GRAPH type section has flags
## that indicate there are direct calls but the direct call info is missing.

# RUN: yaml2obj --docnum=1 %s -o %t
# RUN: llvm-readelf --elf-output-style=LLVM --call-graph-info %t 2>&1 | FileCheck %s -DFILE=%t --check-prefix=WARN
# RUN: llvm-readelf --elf-output-style=JSON --pretty-print --call-graph-info %t 2>&1 | FileCheck %s -DFILE=%t --check-prefix=WARN

# WARN: warning: '[[FILE]]': unable to decode LEB128 at offset 0x00000012: malformed uleb128, extends past end

## YAML content was generated from this assembly using obj2yaml.
##    .section	.llvm.callgraph,"o",@llvm_call_graph,.text
##    .byte	0   #< Format version number.
##    .byte	3   #< Flag IsIndirectTarget true and has direct calls
##    .quad 0   #< Function entry address.
##    .quad 0   #< TypeID: unknown. 
##    # Missing direct callees info
##    .text

--- !ELF
FileHeader:
  Class:           ELFCLASS64
  Data:            ELFDATA2LSB
  Type:            ET_REL
  Machine:         EM_X86_64
  SectionHeaderStringTable: .strtab
Sections:
  - Name:            .text
    Type:            SHT_PROGBITS
    Flags:           [ SHF_ALLOC, SHF_EXECINSTR ]
    AddressAlign:    0x4
    Content:         E800000000
  - Name:            .llvm.callgraph
    Type:            SHT_LLVM_CALL_GRAPH
    Flags:           [ SHF_LINK_ORDER ]
    Link:            .text
    AddressAlign:    0x1
    Content:         '000300000000000000000000000000000000'
  - Name:            .rela.text
    Type:            SHT_RELA
    Flags:           [ SHF_INFO_LINK ]
    Link:            .symtab
    AddressAlign:    0x8
    Info:            .text
    Relocations:
      - Offset:          0x1
        Symbol:          _Z3foov
        Type:            R_X86_64_PLT32
        Addend:          -4
  - Type:            SectionHeaderTable
    Sections:
      - Name:            .strtab
      - Name:            .text
      - Name:            .rela.text
      - Name:            .llvm.callgraph
      - Name:            .symtab
Symbols:
  - Name:            _Z3foov
    Type:            STT_FUNC
    Section:         .text
    Binding:         STB_GLOBAL
...
