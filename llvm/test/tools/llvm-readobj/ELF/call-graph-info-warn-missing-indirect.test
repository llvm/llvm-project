## Tests that --call-graph-info fails if SHT_LLVM_CALL_GRAPH type section does not have
## an expected value, e.g., not as much call sites as the given count.

# RUN: yaml2obj --docnum=1 %s -o %t
# RUN: llvm-readelf --elf-output-style=LLVM --call-graph-info %t 2>&1 | FileCheck %s -DFILE=%t --check-prefix=WARN
# RUN: llvm-readelf --elf-output-style=JSON --pretty-print --call-graph-info %t 2>&1 | FileCheck %s -DFILE=%t --check-prefix=WARN

# WARN: warning: '[[FILE]]': unexpected end of data at offset 0x13 while reading [0x13, 0x1b)

## YAML content was generated from this assembly using obj2yaml.
##    .text
##    .globl _Z3foov
##    .type _Z3foov,@function
##    _Z3foov:
##     callq _Z3foov@PLT
##
##    .section	.llvm.callgraph,"o",@llvm_call_graph,.text
##    .byte 0  #< Format version number.
##    .byte 4  #< Flags
##    .quad 0  #< Function entry address.
##    .quad 0  #< Type ID
##    .byte 1  #< Indirect call site count that follows.
##             #< Missing indirect call entries here.
##    .text

--- !ELF
FileHeader:
  Class:           ELFCLASS64
  Data:            ELFDATA2LSB
  Type:            ET_DYN
  Machine:         EM_X86_64
Sections:
  - Name:            .text
    Type:            SHT_PROGBITS
    Size:            5
  - Name:            .llvm.callgraph
    Type:            SHT_LLVM_CALL_GRAPH
    ContentArray: [
      # --- Entry 1: _Z3foov (foo) ---
      0x00, # Format Version
      0x04, # Flags
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Function entry address
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # TypeID unknown

      # Indirect Callees List
      0x01, # NumIndirectTargetTypeIDs (1)
        #< Missing indirect call entries here.
    ]
Symbols:
  - Name:            _Z3foov
...
