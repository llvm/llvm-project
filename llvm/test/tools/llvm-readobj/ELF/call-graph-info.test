## Tests how --call-graph-info prints the call graph information.
# RUN: yaml2obj --docnum=1 %s -o %t
# RUN: llvm-readelf --call-graph-info %t 2>&1 | FileCheck %s --match-full-lines --allow-empty -DFILE=%t
# RUN: llvm-readelf --elf-output-style=LLVM --call-graph-info %t 2>&1 | FileCheck %s --match-full-lines --check-prefix=LLVM -DFILE=%t
# RUN: llvm-readelf --elf-output-style=JSON --pretty-print --call-graph-info %t 2>&1 | FileCheck %s --match-full-lines --check-prefix=JSON -DFILE=%t

## We do not support GNU format console output for --call-graph-info as it is an LLVM only info.
# CHECK-NOT: .

# LLVM:      CallGraph [
# LLVM-NEXT:     Function {
# LLVM-NEXT:       Names: [foo]
# LLVM-NEXT:       Address: 0x1790
# LLVM-NEXT:       Version: 0
# LLVM-NEXT:       IsIndirectTarget: Yes
# LLVM-NEXT:       TypeId: 0x3ECBEEF531F74424
# LLVM-NEXT:       NumDirectCallees: 0
# LLVM-NEXT:       DirectCallees [
# LLVM-NEXT:       ]
# LLVM-NEXT:       NumIndirectTargetTypeIDs: 0
# LLVM-NEXT:       IndirectTypeIDs: []
# LLVM-NEXT:     }
# LLVM-NEXT:     Function {
# LLVM-NEXT:       Names: [bar]
# LLVM-NEXT:       Address: 0x17A0
# LLVM-NEXT:       Version: 0
# LLVM-NEXT:       IsIndirectTarget: Yes
# LLVM-NEXT:       TypeId: 0x3ECBEEF531F74424
# LLVM-NEXT:       NumDirectCallees: 0
# LLVM-NEXT:       DirectCallees [
# LLVM-NEXT:       ]
# LLVM-NEXT:       NumIndirectTargetTypeIDs: 0
# LLVM-NEXT:       IndirectTypeIDs: []
# LLVM-NEXT:     }
# LLVM-NEXT:     Function {
# LLVM-NEXT:       Names: [baz]
# LLVM-NEXT:       Address: 0x17B0
# LLVM-NEXT:       Version: 0
# LLVM-NEXT:       IsIndirectTarget: Yes
# LLVM-NEXT:       TypeId: 0x308E4B8159BC8654
# LLVM-NEXT:       NumDirectCallees: 0
# LLVM-NEXT:       DirectCallees [
# LLVM-NEXT:       ]
# LLVM-NEXT:       NumIndirectTargetTypeIDs: 0
# LLVM-NEXT:       IndirectTypeIDs: []
# LLVM-NEXT:     }
# LLVM-NEXT:     Function {
# LLVM-NEXT:       Names: [main]
# LLVM-NEXT:       Address: 0x17C0
# LLVM-NEXT:       Version: 0
# LLVM-NEXT:       IsIndirectTarget: Yes
# LLVM-NEXT:       TypeId: 0xFA6809609A76AFCA
# LLVM-NEXT:       NumDirectCallees: 3
# LLVM-NEXT:       DirectCallees [
# LLVM-NEXT:         {
# LLVM-NEXT:           Names: [foo]
# LLVM-NEXT:           Address: 0x1790
# LLVM-NEXT:         }
# LLVM-NEXT:         {
# LLVM-NEXT:           Names: [bar]
# LLVM-NEXT:           Address: 0x17A0
# LLVM-NEXT:         }
# LLVM-NEXT:         {
# LLVM-NEXT:           Names: [baz]
# LLVM-NEXT:           Address: 0x17B0
# LLVM-NEXT:         }
# LLVM-NEXT:       ]
# LLVM-NEXT:       NumIndirectTargetTypeIDs: 2
# LLVM-NEXT:       IndirectTypeIDs: [0x3ECBEEF531F74424, 0x308E4B8159BC8654]
# LLVM-NEXT:     }
# LLVM-NEXT:   ]


# JSON:     "CallGraph": [
# JSON-NEXT:      {
# JSON-NEXT:        "Function": {
# JSON-NEXT:          "Names": [
# JSON-NEXT:            "foo"
# JSON-NEXT:          ],
# JSON-NEXT:          "Address": 6032,
# JSON-NEXT:          "Version": 0,
# JSON-NEXT:          "IsIndirectTarget": true,
# JSON-NEXT:          "TypeId": 4524972987496481828,
# JSON-NEXT:          "NumDirectCallees": 0,
# JSON-NEXT:          "DirectCallees": [],
# JSON-NEXT:          "NumIndirectTargetTypeIDs": 0,
# JSON-NEXT:          "IndirectTypeIDs": []
# JSON-NEXT:        }
# JSON-NEXT:      },
# JSON-NEXT:      {
# JSON-NEXT:        "Function": {
# JSON-NEXT:          "Names": [
# JSON-NEXT:            "bar"
# JSON-NEXT:          ],
# JSON-NEXT:          "Address": 6048,
# JSON-NEXT:          "Version": 0,
# JSON-NEXT:          "IsIndirectTarget": true,
# JSON-NEXT:          "TypeId": 4524972987496481828,
# JSON-NEXT:          "NumDirectCallees": 0,
# JSON-NEXT:          "DirectCallees": [],
# JSON-NEXT:          "NumIndirectTargetTypeIDs": 0,
# JSON-NEXT:          "IndirectTypeIDs": []
# JSON-NEXT:        }
# JSON-NEXT:      },
# JSON-NEXT:      {
# JSON-NEXT:        "Function": {
# JSON-NEXT:          "Names": [
# JSON-NEXT:            "baz"
# JSON-NEXT:          ],
# JSON-NEXT:          "Address": 6064,
# JSON-NEXT:          "Version": 0,
# JSON-NEXT:          "IsIndirectTarget": true,
# JSON-NEXT:          "TypeId": 3498816979441845844,
# JSON-NEXT:          "NumDirectCallees": 0,
# JSON-NEXT:          "DirectCallees": [],
# JSON-NEXT:          "NumIndirectTargetTypeIDs": 0,
# JSON-NEXT:          "IndirectTypeIDs": []
# JSON-NEXT:        }
# JSON-NEXT:      },
# JSON-NEXT:      {
# JSON-NEXT:        "Function": {
# JSON-NEXT:          "Names": [
# JSON-NEXT:            "main"
# JSON-NEXT:          ],
# JSON-NEXT:          "Address": 6080,
# JSON-NEXT:          "Version": 0,
# JSON-NEXT:          "IsIndirectTarget": true,
# JSON-NEXT:          "TypeId": 18043682217572872138,
# JSON-NEXT:          "NumDirectCallees": 3,
# JSON-NEXT:          "DirectCallees": [
# JSON-NEXT:            {
# JSON-NEXT:              "Names": [
# JSON-NEXT:                "foo"
# JSON-NEXT:              ],
# JSON-NEXT:              "Address": 6032
# JSON-NEXT:            },
# JSON-NEXT:            {
# JSON-NEXT:              "Names": [
# JSON-NEXT:                "bar"
# JSON-NEXT:              ],
# JSON-NEXT:              "Address": 6048
# JSON-NEXT:            },
# JSON-NEXT:            {
# JSON-NEXT:              "Names": [
# JSON-NEXT:                "baz"
# JSON-NEXT:              ],
# JSON-NEXT:              "Address": 6064
# JSON-NEXT:            }
# JSON-NEXT:          ],
# JSON-NEXT:          "NumIndirectTargetTypeIDs": 2,
# JSON-NEXT:          "IndirectTypeIDs": [
# JSON-NEXT:            4524972987496481828,
# JSON-NEXT:            3498816979441845844
# JSON-NEXT:          ]
# JSON-NEXT:        }
# JSON-NEXT:      }
# JSON-NEXT:    ]

--- !ELF
FileHeader:
  Class:           ELFCLASS64
  Data:            ELFDATA2LSB
  Type:            ET_DYN
  Machine:         EM_X86_64
Sections:
  - Name:            .text
    Type:            SHT_PROGBITS
    Flags:           [ SHF_ALLOC, SHF_EXECINSTR ]
    Size:            0x2000
  - Name:            .llvm.callgraph
    Type:            SHT_LLVM_CALL_GRAPH
    Flags:           [ SHF_LINK_ORDER ]
    Link:            .text
    ContentArray: [
      # --- foo ---
      0x00, # Version
      0x01, # Flags
      0x90, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # FunctionEntryPC: 0x1790
      0x24, 0x44, 0xF7, 0x31, 0xF5, 0xEE, 0xCB, 0x3E, # FunctionTypeID: 0x3ECBEEF531F74424

      # --- bar ---
      0x00, # Version
      0x01, # Flags
      0xA0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # FunctionEntryPC: 0x17A0
      0x24, 0x44, 0xF7, 0x31, 0xF5, 0xEE, 0xCB, 0x3E, # FunctionTypeID: 0x3ECBEEF531F74424

      # --- baz ---
      0x00, # Version
      0x01, # Flags
      0xB0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # FunctionEntryPC: 0x17B0
      0x54, 0x86, 0xBC, 0x59, 0x81, 0x4B, 0x8E, 0x30, # FunctionTypeID: 0x308E4B8159BC8654

      # --- main ---
      0x00, # Version
      0x07, # Flags
      0xC0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # FunctionEntryPC: 0x17C0
      0xCA, 0xAF, 0x76, 0x9A, 0x60, 0x09, 0x68, 0xFA, # FunctionTypeID: 0xFA6809609A76AFCA

      # Direct Callees
      0x03, # NumDirectCallees
      0x90, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Callee 1: 0x1790 (foo)
      0xA0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Callee 2: 0x17A0 (bar)
      0xB0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Callee 3: 0x17B0 (baz)

      # Indirect Callees
      0x02, # NumIndirectTargetTypeIDs
      0x24, 0x44, 0xF7, 0x31, 0xF5, 0xEE, 0xCB, 0x3E, # TypeID 1
      0x54, 0x86, 0xBC, 0x59, 0x81, 0x4B, 0x8E, 0x30  # TypeID 2
    ]
Symbols:
  - Name:            foo
    Type:            STT_FUNC
    Section:         .text
    Value:           0x1790
  - Name:            bar
    Type:            STT_FUNC
    Section:         .text
    Value:           0x17A0
  - Name:            baz
    Type:            STT_FUNC
    Section:         .text
    Value:           0x17B0
  - Name:            main
    Type:            STT_FUNC
    Section:         .text
    Value:           0x17C0
...
