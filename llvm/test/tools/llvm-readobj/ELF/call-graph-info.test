## Tests how --call-graph-info prints the call graph information.

## Check non-relocatable object file handling.
# RUN: yaml2obj --docnum=1 %s -o %t1
# RUN: llvm-readelf --call-graph-info %t1 2>&1 | FileCheck %s --match-full-lines --allow-empty --check-prefix=GNU_NONRELOC -DFILE=%t1
# RUN: llvm-readelf --elf-output-style=LLVM --call-graph-info %t1 2>&1 | FileCheck %s --match-full-lines --check-prefix=LLVM_NONRELOC -DFILE=%t1
# RUN: llvm-readelf --elf-output-style=JSON --pretty-print --call-graph-info %t1 2>&1 | FileCheck %s --match-full-lines --check-prefix=JSON_NONRELOC -DFILE=%t1

## We do not support GNU format console output for --call-graph-info as it is an LLVM only info.
# GNU_NONRELOC-NOT: .

# LLVM_NONRELOC:      CallGraph [
# LLVM_NONRELOC-NEXT:     Function {
# LLVM_NONRELOC-NEXT:       Names: [foo]
# LLVM_NONRELOC-NEXT:       Address: 0x1790
# LLVM_NONRELOC-NEXT:       Version: 0
# LLVM_NONRELOC-NEXT:       IsIndirectTarget: Yes
# LLVM_NONRELOC-NEXT:       TypeId: 0x3ECBEEF531F74424
# LLVM_NONRELOC-NEXT:       NumDirectCallees: 0
# LLVM_NONRELOC-NEXT:       DirectCallees [
# LLVM_NONRELOC-NEXT:       ]
# LLVM_NONRELOC-NEXT:       NumIndirectTargetTypeIDs: 0
# LLVM_NONRELOC-NEXT:       IndirectTypeIDs: []
# LLVM_NONRELOC-NEXT:     }
# LLVM_NONRELOC-NEXT:     Function {
# LLVM_NONRELOC-NEXT:       Names: [bar]
# LLVM_NONRELOC-NEXT:       Address: 0x17A0
# LLVM_NONRELOC-NEXT:       Version: 0
# LLVM_NONRELOC-NEXT:       IsIndirectTarget: Yes
# LLVM_NONRELOC-NEXT:       TypeId: 0x3ECBEEF531F74424
# LLVM_NONRELOC-NEXT:       NumDirectCallees: 0
# LLVM_NONRELOC-NEXT:       DirectCallees [
# LLVM_NONRELOC-NEXT:       ]
# LLVM_NONRELOC-NEXT:       NumIndirectTargetTypeIDs: 0
# LLVM_NONRELOC-NEXT:       IndirectTypeIDs: []
# LLVM_NONRELOC-NEXT:     }
# LLVM_NONRELOC-NEXT:     Function {
# LLVM_NONRELOC-NEXT:       Names: [baz]
# LLVM_NONRELOC-NEXT:       Address: 0x17B0
# LLVM_NONRELOC-NEXT:       Version: 0
# LLVM_NONRELOC-NEXT:       IsIndirectTarget: Yes
# LLVM_NONRELOC-NEXT:       TypeId: 0x308E4B8159BC8654
# LLVM_NONRELOC-NEXT:       NumDirectCallees: 0
# LLVM_NONRELOC-NEXT:       DirectCallees [
# LLVM_NONRELOC-NEXT:       ]
# LLVM_NONRELOC-NEXT:       NumIndirectTargetTypeIDs: 0
# LLVM_NONRELOC-NEXT:       IndirectTypeIDs: []
# LLVM_NONRELOC-NEXT:     }
# LLVM_NONRELOC-NEXT:     Function {
# LLVM_NONRELOC-NEXT:       Names: [main]
# LLVM_NONRELOC-NEXT:       Address: 0x17C0
# LLVM_NONRELOC-NEXT:       Version: 0
# LLVM_NONRELOC-NEXT:       IsIndirectTarget: Yes
# LLVM_NONRELOC-NEXT:       TypeId: 0xFA6809609A76AFCA
# LLVM_NONRELOC-NEXT:       NumDirectCallees: 3
# LLVM_NONRELOC-NEXT:       DirectCallees [
# LLVM_NONRELOC-NEXT:         {
# LLVM_NONRELOC-NEXT:           Names: [foo]
# LLVM_NONRELOC-NEXT:           Address: 0x1790
# LLVM_NONRELOC-NEXT:         }
# LLVM_NONRELOC-NEXT:         {
# LLVM_NONRELOC-NEXT:           Names: [bar]
# LLVM_NONRELOC-NEXT:           Address: 0x17A0
# LLVM_NONRELOC-NEXT:         }
# LLVM_NONRELOC-NEXT:         {
# LLVM_NONRELOC-NEXT:           Names: [baz]
# LLVM_NONRELOC-NEXT:           Address: 0x17B0
# LLVM_NONRELOC-NEXT:         }
# LLVM_NONRELOC-NEXT:       ]
# LLVM_NONRELOC-NEXT:       NumIndirectTargetTypeIDs: 2
# LLVM_NONRELOC-NEXT:       IndirectTypeIDs: [0x3ECBEEF531F74424, 0x308E4B8159BC8654]
# LLVM_NONRELOC-NEXT:     }
# LLVM_NONRELOC-NEXT:   ]

# JSON_NONRELOC:     "CallGraph": [
# JSON_NONRELOC-NEXT:      {
# JSON_NONRELOC-NEXT:        "Function": {
# JSON_NONRELOC-NEXT:          "Names": [
# JSON_NONRELOC-NEXT:            "foo"
# JSON_NONRELOC-NEXT:          ],
# JSON_NONRELOC-NEXT:          "Address": 6032,
# JSON_NONRELOC-NEXT:          "Version": 0,
# JSON_NONRELOC-NEXT:          "IsIndirectTarget": true,
# JSON_NONRELOC-NEXT:          "TypeId": 4524972987496481828,
# JSON_NONRELOC-NEXT:          "NumDirectCallees": 0,
# JSON_NONRELOC-NEXT:          "DirectCallees": [],
# JSON_NONRELOC-NEXT:          "NumIndirectTargetTypeIDs": 0,
# JSON_NONRELOC-NEXT:          "IndirectTypeIDs": []
# JSON_NONRELOC-NEXT:        }
# JSON_NONRELOC-NEXT:      },
# JSON_NONRELOC-NEXT:      {
# JSON_NONRELOC-NEXT:        "Function": {
# JSON_NONRELOC-NEXT:          "Names": [
# JSON_NONRELOC-NEXT:            "bar"
# JSON_NONRELOC-NEXT:          ],
# JSON_NONRELOC-NEXT:          "Address": 6048,
# JSON_NONRELOC-NEXT:          "Version": 0,
# JSON_NONRELOC-NEXT:          "IsIndirectTarget": true,
# JSON_NONRELOC-NEXT:          "TypeId": 4524972987496481828,
# JSON_NONRELOC-NEXT:          "NumDirectCallees": 0,
# JSON_NONRELOC-NEXT:          "DirectCallees": [],
# JSON_NONRELOC-NEXT:          "NumIndirectTargetTypeIDs": 0,
# JSON_NONRELOC-NEXT:          "IndirectTypeIDs": []
# JSON_NONRELOC-NEXT:        }
# JSON_NONRELOC-NEXT:      },
# JSON_NONRELOC-NEXT:      {
# JSON_NONRELOC-NEXT:        "Function": {
# JSON_NONRELOC-NEXT:          "Names": [
# JSON_NONRELOC-NEXT:            "baz"
# JSON_NONRELOC-NEXT:          ],
# JSON_NONRELOC-NEXT:          "Address": 6064,
# JSON_NONRELOC-NEXT:          "Version": 0,
# JSON_NONRELOC-NEXT:          "IsIndirectTarget": true,
# JSON_NONRELOC-NEXT:          "TypeId": 3498816979441845844,
# JSON_NONRELOC-NEXT:          "NumDirectCallees": 0,
# JSON_NONRELOC-NEXT:          "DirectCallees": [],
# JSON_NONRELOC-NEXT:          "NumIndirectTargetTypeIDs": 0,
# JSON_NONRELOC-NEXT:          "IndirectTypeIDs": []
# JSON_NONRELOC-NEXT:        }
# JSON_NONRELOC-NEXT:      },
# JSON_NONRELOC-NEXT:      {
# JSON_NONRELOC-NEXT:        "Function": {
# JSON_NONRELOC-NEXT:          "Names": [
# JSON_NONRELOC-NEXT:            "main"
# JSON_NONRELOC-NEXT:          ],
# JSON_NONRELOC-NEXT:          "Address": 6080,
# JSON_NONRELOC-NEXT:          "Version": 0,
# JSON_NONRELOC-NEXT:          "IsIndirectTarget": true,
# JSON_NONRELOC-NEXT:          "TypeId": 18043682217572872138,
# JSON_NONRELOC-NEXT:          "NumDirectCallees": 3,
# JSON_NONRELOC-NEXT:          "DirectCallees": [
# JSON_NONRELOC-NEXT:            {
# JSON_NONRELOC-NEXT:              "Names": [
# JSON_NONRELOC-NEXT:                "foo"
# JSON_NONRELOC-NEXT:              ],
# JSON_NONRELOC-NEXT:              "Address": 6032
# JSON_NONRELOC-NEXT:            },
# JSON_NONRELOC-NEXT:            {
# JSON_NONRELOC-NEXT:              "Names": [
# JSON_NONRELOC-NEXT:                "bar"
# JSON_NONRELOC-NEXT:              ],
# JSON_NONRELOC-NEXT:              "Address": 6048
# JSON_NONRELOC-NEXT:            },
# JSON_NONRELOC-NEXT:            {
# JSON_NONRELOC-NEXT:              "Names": [
# JSON_NONRELOC-NEXT:                "baz"
# JSON_NONRELOC-NEXT:              ],
# JSON_NONRELOC-NEXT:              "Address": 6064
# JSON_NONRELOC-NEXT:            }
# JSON_NONRELOC-NEXT:          ],
# JSON_NONRELOC-NEXT:          "NumIndirectTargetTypeIDs": 2,
# JSON_NONRELOC-NEXT:          "IndirectTypeIDs": [
# JSON_NONRELOC-NEXT:            4524972987496481828,
# JSON_NONRELOC-NEXT:            3498816979441845844
# JSON_NONRELOC-NEXT:          ]
# JSON_NONRELOC-NEXT:        }
# JSON_NONRELOC-NEXT:      }
# JSON_NONRELOC-NEXT:    ]

--- !ELF
FileHeader:
  Class:    ELFCLASS64
  Data:     ELFDATA2LSB
  Type:     ET_DYN
  Machine:  EM_X86_64
Sections:
  - Name:   .text
    Type:   SHT_PROGBITS
    Flags:  [ SHF_ALLOC, SHF_EXECINSTR ]
    Size:   0x2000
  - Name:   .llvm.callgraph
    Type:   SHT_LLVM_CALL_GRAPH
    Flags:  [ SHF_LINK_ORDER ]
    Link:   .text
    ContentArray: [
      # --- foo ---
      0x00, # Version
      0x01, # Flags
      0x90, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # FunctionEntryPC: 0x1790
      0x24, 0x44, 0xF7, 0x31, 0xF5, 0xEE, 0xCB, 0x3E, # FunctionTypeID: 0x3ECBEEF531F74424

      # --- bar ---
      0x00, # Version
      0x01, # Flags
      0xA0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # FunctionEntryPC: 0x17A0
      0x24, 0x44, 0xF7, 0x31, 0xF5, 0xEE, 0xCB, 0x3E, # FunctionTypeID: 0x3ECBEEF531F74424

      # --- baz ---
      0x00, # Version
      0x01, # Flags
      0xB0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # FunctionEntryPC: 0x17B0
      0x54, 0x86, 0xBC, 0x59, 0x81, 0x4B, 0x8E, 0x30, # FunctionTypeID: 0x308E4B8159BC8654

      # --- main ---
      0x00, # Version
      0x07, # Flags
      0xC0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # FunctionEntryPC: 0x17C0
      0xCA, 0xAF, 0x76, 0x9A, 0x60, 0x09, 0x68, 0xFA, # FunctionTypeID: 0xFA6809609A76AFCA

      # Direct Callees
      0x03, # NumDirectCallees
      0x90, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Callee 1: 0x1790 (foo)
      0xA0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Callee 2: 0x17A0 (bar)
      0xB0, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Callee 3: 0x17B0 (baz)

      # Indirect Callees
      0x02, # NumIndirectTargetTypeIDs
      0x24, 0x44, 0xF7, 0x31, 0xF5, 0xEE, 0xCB, 0x3E, # TypeID 1
      0x54, 0x86, 0xBC, 0x59, 0x81, 0x4B, 0x8E, 0x30  # TypeID 2
    ]
Symbols:
  - Name:     foo
    Type:     STT_FUNC
    Section:  .text
    Value:    0x1790
  - Name:     bar
    Type:     STT_FUNC
    Section:  .text
    Value:    0x17A0
  - Name:     baz
    Type:     STT_FUNC
    Section:  .text
    Value:    0x17B0
  - Name:     main
    Type:     STT_FUNC
    Section:  .text
    Value:    0x17C0
...

## Check relocatable object file handling.
# RUN: yaml2obj --docnum=2 %s -o %t2
# RUN: llvm-readelf --call-graph-info %t2 2>&1 | FileCheck %s --match-full-lines --allow-empty -check-prefix=GNU_RELOC -DFILE=%t2
# RUN: llvm-readelf --elf-output-style=LLVM --call-graph-info %t2 2>&1 | FileCheck %s --match-full-lines --check-prefix=LLVM_RELOC -DFILE=%t2
# RUN: llvm-readelf --elf-output-style=JSON --pretty-print --call-graph-info %t2 2>&1 | FileCheck %s --match-full-lines --check-prefix=JSON_RELOC -DFILE=%t2

## We do not support GNU format console output for --call-graph-info as it is an LLVM only info.
# GNU_RELOC-NOT: .

# LLVM_RELOC:   CallGraph [
# LLVM_RELOC-NEXT:   Function {
# LLVM_RELOC-NEXT:     Name: foo
# LLVM_RELOC-NEXT:     Version: 0
# LLVM_RELOC-NEXT:     IsIndirectTarget: Yes
# LLVM_RELOC-NEXT:     TypeId: 0xF85C699BB8EF20A2
# LLVM_RELOC-NEXT:     NumDirectCallees: 0
# LLVM_RELOC-NEXT:     DirectCallees [
# LLVM_RELOC-NEXT:     ]
# LLVM_RELOC-NEXT:     NumIndirectTargetTypeIDs: 0
# LLVM_RELOC-NEXT:     IndirectTypeIDs: []
# LLVM_RELOC-NEXT:   }
# LLVM_RELOC-NEXT:   Function {
# LLVM_RELOC-NEXT:     Name: bar
# LLVM_RELOC-NEXT:     Version: 0
# LLVM_RELOC-NEXT:     IsIndirectTarget: Yes
# LLVM_RELOC-NEXT:     TypeId: 0xF85C699BB8EF20A2
# LLVM_RELOC-NEXT:     NumDirectCallees: 0
# LLVM_RELOC-NEXT:     DirectCallees [
# LLVM_RELOC-NEXT:     ]
# LLVM_RELOC-NEXT:     NumIndirectTargetTypeIDs: 0
# LLVM_RELOC-NEXT:     IndirectTypeIDs: []
# LLVM_RELOC-NEXT:   }
# LLVM_RELOC-NEXT:   Function {
# LLVM_RELOC-NEXT:     Name: baz
# LLVM_RELOC-NEXT:     Version: 0
# LLVM_RELOC-NEXT:     IsIndirectTarget: Yes
# LLVM_RELOC-NEXT:     TypeId: 0x308E4B8159BC8654
# LLVM_RELOC-NEXT:     NumDirectCallees: 0
# LLVM_RELOC-NEXT:     DirectCallees [
# LLVM_RELOC-NEXT:     ]
# LLVM_RELOC-NEXT:     NumIndirectTargetTypeIDs: 0
# LLVM_RELOC-NEXT:     IndirectTypeIDs: []
# LLVM_RELOC-NEXT:   }
# LLVM_RELOC-NEXT:   Function {
# LLVM_RELOC-NEXT:     Name: caller
# LLVM_RELOC-NEXT:     Version: 0
# LLVM_RELOC-NEXT:     IsIndirectTarget: Yes
# LLVM_RELOC-NEXT:     TypeId: 0xA9494DEF81A01DC
# LLVM_RELOC-NEXT:     NumDirectCallees: 3
# LLVM_RELOC-NEXT:     DirectCallees [
# LLVM_RELOC-NEXT:       {
# LLVM_RELOC-NEXT:         Name: foo
# LLVM_RELOC-NEXT:       }
# LLVM_RELOC-NEXT:       {
# LLVM_RELOC-NEXT:         Name: bar
# LLVM_RELOC-NEXT:       }
# LLVM_RELOC-NEXT:       {
# LLVM_RELOC-NEXT:         Name: baz
# LLVM_RELOC-NEXT:       }
# LLVM_RELOC-NEXT:     ]
# LLVM_RELOC-NEXT:     NumIndirectTargetTypeIDs: 2
# LLVM_RELOC-NEXT:     IndirectTypeIDs: [0xF85C699BB8EF20A2, 0x308E4B8159BC8654]
# LLVM_RELOC-NEXT:   }
# LLVM_RELOC-NEXT: ]

# JSON_RELOC:     "CallGraph": [
# JSON_RELOC-NEXT:      {
# JSON_RELOC-NEXT:        "Function": {
# JSON_RELOC-NEXT:          "Name": "foo",
# JSON_RELOC-NEXT:          "Version": 0,
# JSON_RELOC-NEXT:          "IsIndirectTarget": true,
# JSON_RELOC-NEXT:          "TypeId": 17896295136807035042,
# JSON_RELOC-NEXT:          "NumDirectCallees": 0,
# JSON_RELOC-NEXT:          "DirectCallees": [],
# JSON_RELOC-NEXT:          "NumIndirectTargetTypeIDs": 0,
# JSON_RELOC-NEXT:          "IndirectTypeIDs": []
# JSON_RELOC-NEXT:        }
# JSON_RELOC-NEXT:      },
# JSON_RELOC-NEXT:      {
# JSON_RELOC-NEXT:        "Function": {
# JSON_RELOC-NEXT:          "Name": "bar",
# JSON_RELOC-NEXT:          "Version": 0,
# JSON_RELOC-NEXT:          "IsIndirectTarget": true,
# JSON_RELOC-NEXT:          "TypeId": 17896295136807035042,
# JSON_RELOC-NEXT:          "NumDirectCallees": 0,
# JSON_RELOC-NEXT:          "DirectCallees": [],
# JSON_RELOC-NEXT:          "NumIndirectTargetTypeIDs": 0,
# JSON_RELOC-NEXT:          "IndirectTypeIDs": []
# JSON_RELOC-NEXT:        }
# JSON_RELOC-NEXT:      },
# JSON_RELOC-NEXT:      {
# JSON_RELOC-NEXT:        "Function": {
# JSON_RELOC-NEXT:          "Name": "baz",
# JSON_RELOC-NEXT:          "Version": 0,
# JSON_RELOC-NEXT:          "IsIndirectTarget": true,
# JSON_RELOC-NEXT:          "TypeId": 3498816979441845844,
# JSON_RELOC-NEXT:          "NumDirectCallees": 0,
# JSON_RELOC-NEXT:          "DirectCallees": [],
# JSON_RELOC-NEXT:          "NumIndirectTargetTypeIDs": 0,
# JSON_RELOC-NEXT:          "IndirectTypeIDs": []
# JSON_RELOC-NEXT:        }
# JSON_RELOC-NEXT:      },
# JSON_RELOC-NEXT:      {
# JSON_RELOC-NEXT:        "Function": {
# JSON_RELOC-NEXT:          "Name": "caller",
# JSON_RELOC-NEXT:          "Version": 0,
# JSON_RELOC-NEXT:          "IsIndirectTarget": true,
# JSON_RELOC-NEXT:          "TypeId": 762397922298560988,
# JSON_RELOC-NEXT:          "NumDirectCallees": 3,
# JSON_RELOC-NEXT:          "DirectCallees": [
# JSON_RELOC-NEXT:            {
# JSON_RELOC-NEXT:              "Name": "foo"
# JSON_RELOC-NEXT:            },
# JSON_RELOC-NEXT:            {
# JSON_RELOC-NEXT:              "Name": "bar"
# JSON_RELOC-NEXT:            },
# JSON_RELOC-NEXT:            {
# JSON_RELOC-NEXT:              "Name": "baz"
# JSON_RELOC-NEXT:            }
# JSON_RELOC-NEXT:          ],
# JSON_RELOC-NEXT:          "NumIndirectTargetTypeIDs": 2,
# JSON_RELOC-NEXT:          "IndirectTypeIDs": [
# JSON_RELOC-NEXT:            17896295136807035042,
# JSON_RELOC-NEXT:            3498816979441845844
# JSON_RELOC-NEXT:          ]
# JSON_RELOC-NEXT:        }
# JSON_RELOC-NEXT:      }
# JSON_RELOC-NEXT:    ]

--- !ELF
FileHeader:
  Class:    ELFCLASS64
  Data:     ELFDATA2LSB
  Type:     ET_REL
  Machine:  EM_X86_64
Sections:
  - Name:   .text
    Type:   SHT_PROGBITS
    Size:   0x84
  - Name:   .llvm.callgraph
    Type:   SHT_LLVM_CALL_GRAPH
    Flags:  [ SHF_LINK_ORDER ]
    Link:   .text
    ContentArray: [
      # --- Entry 1: foo (foo) ---
      # Offset 0x0
      0x00, # Format Version
      0x01, # Flags
      # Offset 0x2 (Matches Reloc: foo)
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Address of foo
      0xA2, 0x20, 0xEF, 0xB8, 0x9B, 0x69, 0x5C, 0xF8, # TypeID of foo

      # --- Entry 2: bar (bar) ---
      # Offset 0x12
      0x00, # Format Version
      0x01, # Flags
      # Offset 0x14 (Matches Reloc: bar)
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Address of bar
      0xA2, 0x20, 0xEF, 0xB8, 0x9B, 0x69, 0x5C, 0xF8, # TypeID of bar

      # --- Entry 3: baz (baz) ---
      # Offset 0x24
      0x00, # Format Version
      0x01, # Flags
      # Offset 0x26 (Matches Reloc: baz)
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Address of baz
      0x54, 0x86, 0xBC, 0x59, 0x81, 0x4B, 0x8E, 0x30, # TypeID of baz

      # --- Entry 4: caller (caller) ---
      # Offset 0x36
      0x00, # Format Version
      0x07, # Flags (HasDirectCallees | IsIndirectTarget | ...)
      # Offset 0x38 (Matches Reloc: caller)
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Address of caller
      0xDC, 0x01, 0x1A, 0xF8, 0xDE, 0x94, 0x94, 0x0A, # TypeID of caller

      # Direct Callees List
      0x03, # NumDirectCallees (3)
      # Offset 0x49 (Matches Reloc: foo)
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Callee 1: foo
      # Offset 0x51 (Matches Reloc: bar)
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Callee 2: bar
      # Offset 0x59 (Matches Reloc: baz)
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # Callee 3: baz

      # Indirect Callees List
      0x02, # NumIndirectTargetTypeIDs (2)
      0xA2, 0x20, 0xEF, 0xB8, 0x9B, 0x69, 0x5C, 0xF8, # Indirect TypeID 1 (matches foo/bar)
      0x54, 0x86, 0xBC, 0x59, 0x81, 0x4B, 0x8E, 0x30  # Indirect TypeID 2 (matches baz)
    ]
  - Name:   .rela.llvm.callgraph
    Type:   SHT_RELA
    Flags:  [ SHF_INFO_LINK ]
    Info:   .llvm.callgraph
    Relocations:
      - Offset:  0x2
        Symbol:  foo
        Type:    R_X86_64_64
      - Offset:  0x14
        Symbol:  bar
        Type:    R_X86_64_64
      - Offset:  0x26
        Symbol:  baz
        Type:    R_X86_64_64
      - Offset:  0x38
        Symbol:  caller
        Type:    R_X86_64_64
      - Offset:  0x49
        Symbol:  foo
        Type:    R_X86_64_64
      - Offset:  0x51
        Symbol:  bar
        Type:    R_X86_64_64
      - Offset:  0x59
        Symbol:  baz
        Type:    R_X86_64_64
Symbols:
  - Name:  foo
  - Name:  bar
  - Name:  baz
  - Name:  caller
...

## Check ARM 32-bit Thumb address handling.
# RUN: yaml2obj --docnum=3 %s -o %t3
# RUN: llvm-readelf --elf-output-style=LLVM --call-graph-info %t3 2>&1 | FileCheck %s --match-full-lines --check-prefix=LLVM_ARM_THUMB -DFILE=%t3
# RUN: llvm-readelf --elf-output-style=JSON --pretty-print --call-graph-info %t3 2>&1 | FileCheck %s --match-full-lines --check-prefix=JSON_ARM_THUMB -DFILE=%t3

# LLVM_ARM_THUMB:      CallGraph [
# LLVM_ARM_THUMB-NEXT:   Function {
# LLVM_ARM_THUMB-NEXT:     Name: foo
# LLVM_ARM_THUMB-NEXT:     Version: 0
# LLVM_ARM_THUMB-NEXT:     IsIndirectTarget: No
# LLVM_ARM_THUMB-NEXT:     TypeId: 0x123456789ABCDEF0
# LLVM_ARM_THUMB-NEXT:     NumDirectCallees: 0
# LLVM_ARM_THUMB-NEXT:     DirectCallees [
# LLVM_ARM_THUMB-NEXT:     ]
# LLVM_ARM_THUMB-NEXT:     NumIndirectTargetTypeIDs: 0
# LLVM_ARM_THUMB-NEXT:     IndirectTypeIDs: []
# LLVM_ARM_THUMB-NEXT:   }
# LLVM_ARM_THUMB-NEXT: ]

# JSON_ARM_THUMB:       "CallGraph": [
# JSON_ARM_THUMB-NEXT:    {
# JSON_ARM_THUMB-NEXT:      "Function": {
# JSON_ARM_THUMB-NEXT:        "Name": "foo",
# JSON_ARM_THUMB-NEXT:        "Version": 0,
# JSON_ARM_THUMB-NEXT:        "IsIndirectTarget": false,
# JSON_ARM_THUMB-NEXT:        "TypeId": 1311768467463790320,
# JSON_ARM_THUMB-NEXT:        "NumDirectCallees": 0,
# JSON_ARM_THUMB-NEXT:        "DirectCallees": [],
# JSON_ARM_THUMB-NEXT:        "NumIndirectTargetTypeIDs": 0,
# JSON_ARM_THUMB-NEXT:        "IndirectTypeIDs": []
# JSON_ARM_THUMB-NEXT:      }
# JSON_ARM_THUMB-NEXT:    }
# JSON_ARM_THUMB-NEXT:  ]


--- !ELF
FileHeader:
  Class:    ELFCLASS32
  Data:     ELFDATA2LSB
  Type:     ET_REL
  Machine:  EM_ARM
Sections:
  - Name:   .text
    Type:   SHT_PROGBITS
    Size:   0x100
  - Name:   .llvm.callgraph
    Type:   SHT_LLVM_CALL_GRAPH
    Flags:  [ SHF_LINK_ORDER ]
    Link:   .text
    ContentArray: [
      # --- foo+1 (Thumb address) ---
      0x00, # Version
      0x00, # Flags
      0x01, 0x00, 0x00, 0x00, # FunctionEntryPC: 0x1 (relative to foo)
      0xF0, 0xDE, 0xBC, 0x9A, 0x78, 0x56, 0x34, 0x12 # FunctionTypeID: 0x123456789ABCDEF0
    ]
  - Name:   .rela.llvm.callgraph
    Type:   SHT_RELA
    Flags:  [ SHF_INFO_LINK ]
    Info:   .llvm.callgraph
    Relocations:
      - Offset:  0x2 # Offset to FunctionEntryPC
        Symbol:  foo
        Type:    R_ARM_ABS32
Symbols:
  - Name:     foo
    Type:     STT_FUNC
    Section:  .text
    Value:    0x0 
...
