Tests for output-size-limit option. Functions with least sample count are
dropped. This test only checks the correctness of the output. The output size
checks are in llvm/unittests/tools/llvm-profdata/OutputSizeLimitTest.cpp because
there isn't a cross platform way to get file size.

1- No effect if output size limit >= original size
RUN: llvm-profdata merge --sample --text --output-size-limit=212 %p/Inputs/sample-profile.proftext | FileCheck %s --check-prefix=TEST_TEXT1
TEST_TEXT1: main:184019:0
TEST_TEXT1-NEXT:  4: 534
TEST_TEXT1-NEXT:  4.2: 534
TEST_TEXT1-NEXT:  5: 1075
TEST_TEXT1-NEXT:  5.1: 1075
TEST_TEXT1-NEXT:  6: 2080
TEST_TEXT1-NEXT:  7: 534
TEST_TEXT1-NEXT:  9: 2064 _Z3bari:1471 _Z3fooi:631
TEST_TEXT1-NEXT:  10: inline1:1000
TEST_TEXT1-NEXT:   1: 1000
TEST_TEXT1-NEXT:  10: inline2:2000
TEST_TEXT1-NEXT:   1: 2000
TEST_TEXT1-NEXT: _Z3bari:20301:1437
TEST_TEXT1-NEXT:  1: 1437
TEST_TEXT1-NEXT: _Z3fooi:7711:610
TEST_TEXT1-NEXT:  1: 610

2- 1 function dropped
RUN: llvm-profdata merge --sample --text --output-size-limit=211 %p/Inputs/sample-profile.proftext | FileCheck %s --check-prefix=TEST_TEXT2
RUN: llvm-profdata merge --sample --text --output-size-limit=187 %p/Inputs/sample-profile.proftext | FileCheck %s --check-prefix=TEST_TEXT2
TEST_TEXT2: main:184019:0
TEST_TEXT2-NEXT:  4: 534
TEST_TEXT2-NEXT:  4.2: 534
TEST_TEXT2-NEXT:  5: 1075
TEST_TEXT2-NEXT:  5.1: 1075
TEST_TEXT2-NEXT:  6: 2080
TEST_TEXT2-NEXT:  7: 534
TEST_TEXT2-NEXT:  9: 2064 _Z3bari:1471 _Z3fooi:631
TEST_TEXT2-NEXT:  10: inline1:1000
TEST_TEXT2-NEXT:   1: 1000
TEST_TEXT2-NEXT:  10: inline2:2000
TEST_TEXT2-NEXT:   1: 2000
TEST_TEXT2-NEXT: _Z3bari:20301:1437
TEST_TEXT2-NEXT:  1: 1437

3- 2 functions dropped
RUN: llvm-profdata merge --sample --text --output-size-limit=170 %p/Inputs/sample-profile.proftext | FileCheck %s --check-prefix=TEST_TEXT3
TEST_TEXT3: main:184019:0
TEST_TEXT3-NEXT:  4: 534
TEST_TEXT3-NEXT:  4.2: 534
TEST_TEXT3-NEXT:  5: 1075
TEST_TEXT3-NEXT:  5.1: 1075
TEST_TEXT3-NEXT:  6: 2080
TEST_TEXT3-NEXT:  7: 534
TEST_TEXT3-NEXT:  9: 2064 _Z3bari:1471 _Z3fooi:631
TEST_TEXT3-NEXT:  10: inline1:1000
TEST_TEXT3-NEXT:   1: 1000
TEST_TEXT3-NEXT:  10: inline2:2000
TEST_TEXT3-NEXT:   1: 2000

4- All functions dropped, should report an error
RUN: not llvm-profdata merge --sample --text --output-size-limit=158 %p/Inputs/sample-profile.proftext 2>&1 | FileCheck %s --check-prefix=INVALID1
INVALID1: error: Too much profile data

5- ExtBinary form, no function dropped. Check output size and file content converted back to text
RUN: llvm-profdata merge --sample --extbinary --output-size-limit=489  %p/Inputs/sample-profile.proftext -o %t.output
RUN: llvm-profdata merge --sample --text %t.output | FileCheck %s --check-prefix=TEST_EXTBINARY1
TEST_EXTBINARY1: main:184019:0
TEST_EXTBINARY1-NEXT:  4: 534
TEST_EXTBINARY1-NEXT:  4.2: 534
TEST_EXTBINARY1-NEXT:  5: 1075
TEST_EXTBINARY1-NEXT:  5.1: 1075
TEST_EXTBINARY1-NEXT:  6: 2080
TEST_EXTBINARY1-NEXT:  7: 534
TEST_EXTBINARY1-NEXT:  9: 2064 _Z3bari:1471 _Z3fooi:631
TEST_EXTBINARY1-NEXT:  10: inline1:1000
TEST_EXTBINARY1-NEXT:   1: 1000
TEST_EXTBINARY1-NEXT:  10: inline2:2000
TEST_EXTBINARY1-NEXT:   1: 2000
TEST_EXTBINARY1-NEXT: _Z3bari:20301:1437
TEST_EXTBINARY1-NEXT:  1: 1437
TEST_EXTBINARY1-NEXT: _Z3fooi:7711:610
TEST_EXTBINARY1-NEXT:  1: 610

6- ExtBinary form, 1 function dropped
RUN: llvm-profdata merge --sample --extbinary --output-size-limit=488  %p/Inputs/sample-profile.proftext -o %t.output
RUN: llvm-profdata merge --sample --text %t.output | FileCheck %s --check-prefix=TEST_EXTBINARY2
TEST_EXTBINARY2: main:184019:0
TEST_EXTBINARY2-NEXT:  4: 534
TEST_EXTBINARY2-NEXT:  4.2: 534
TEST_EXTBINARY2-NEXT:  5: 1075
TEST_EXTBINARY2-NEXT:  5.1: 1075
TEST_EXTBINARY2-NEXT:  6: 2080
TEST_EXTBINARY2-NEXT:  7: 534
TEST_EXTBINARY2-NEXT:  9: 2064 _Z3bari:1471 _Z3fooi:631
TEST_EXTBINARY2-NEXT:  10: inline1:1000
TEST_EXTBINARY2-NEXT:   1: 1000
TEST_EXTBINARY2-NEXT:  10: inline2:2000
TEST_EXTBINARY2-NEXT:   1: 2000
TEST_EXTBINARY2-NEXT: _Z3bari:20301:1437
TEST_EXTBINARY2-NEXT:  1: 1437

7- ExtBinary form, 2 functions dropped
RUN: llvm-profdata merge --sample --extbinary --output-size-limit=474  %p/Inputs/sample-profile.proftext -o %t.output
RUN: llvm-profdata merge --sample --text %t.output | FileCheck %s --check-prefix=TEST_EXTBINARY3
TEST_EXTBINARY3: main:184019:0
TEST_EXTBINARY3-NEXT:  4: 534
TEST_EXTBINARY3-NEXT:  4.2: 534
TEST_EXTBINARY3-NEXT:  5: 1075
TEST_EXTBINARY3-NEXT:  5.1: 1075
TEST_EXTBINARY3-NEXT:  6: 2080
TEST_EXTBINARY3-NEXT:  7: 534
TEST_EXTBINARY3-NEXT:  9: 2064 _Z3bari:1471 _Z3fooi:631
TEST_EXTBINARY3-NEXT:  10: inline1:1000
TEST_EXTBINARY3-NEXT:   1: 1000
TEST_EXTBINARY3-NEXT:  10: inline2:2000
TEST_EXTBINARY3-NEXT:   1: 2000

8- ExtBinary form, all functions dropped
RUN: not llvm-profdata merge --sample --extbinary --output-size-limit=400  %p/Inputs/sample-profile.proftext 2>&1 | FileCheck %s --check-prefix=INVALID2
INVALID2: error: Too much profile data
