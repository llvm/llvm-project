## Test archive member recognition by name (GNU archive format).

# RUN: rm -rf %t.dir && mkdir %t.dir && cd %t.dir

# RUN: yaml2obj -DSYMBOL=foo1 %s -o 1.o
# RUN: yaml2obj -DSYMBOL=foo2 %s -o 2.o

# RUN: llvm-ar --format=gnu crv archive.a 1.o 2.o

## Test symbolization by member name with architecture via --default-arch flag.
# RUN: llvm-symbolizer --default-arch=ppc64 --obj="archive.a(1.o)" 0x0 | FileCheck %s --check-prefix=CHECK-1
# RUN: llvm-symbolizer --default-arch=ppc64 --obj="archive.a(2.o)" 0x0 | FileCheck %s --check-prefix=CHECK-2

## Test architecture specified via :arch suffix notation.
# RUN: llvm-symbolizer --obj="archive.a(1.o):ppc64" 0x0 | FileCheck %s --check-prefix=CHECK-1
# RUN: llvm-symbolizer --obj="archive.a(2.o):ppc64" 0x0 | FileCheck %s --check-prefix=CHECK-2

# CHECK-1: foo1
# CHECK-2: foo2

## Test error cases.
# RUN: not llvm-symbolizer --default-arch=ppc64 --obj="archive.a(nonexistent.o)" 0x1000 2>&1 | FileCheck %s --check-prefix=CHECK-ERROR
# CHECK-ERROR: error: 'archive.a(nonexistent.o)': no matching member 'nonexistent.o' with arch 'ppc64' in 'archive.a'

# RUN: not llvm-symbolizer --obj="1.o(1.o)" 0x1000 2>&1 | FileCheck %s --check-prefix=CHECK-NOTARCHIVE
# CHECK-NOTARCHIVE: error: '1.o(1.o)': '1.o' is not a valid archive

# RUN: not llvm-symbolizer --obj="archive.a():ppc64" 0x1000 2>&1 | FileCheck %s --check-prefix=CHECK-NOSYMBOL
# CHECK-NOSYMBOL: error: 'archive.a():ppc64': no matching member '' with arch 'ppc64' in 'archive.a'

--- !XCOFF
FileHeader:
  MagicNumber: 0x1F7
Sections:
  - Name:        .text
    Flags:       [ STYP_TEXT ]
    SectionData: 4E800020
Symbols:
  - Name:                .file
    Section:             N_DEBUG
    StorageClass:        C_FILE
    NumberOfAuxEntries:  1
    AuxEntries:
      - Type:            AUX_FILE
        FileNameOrString: foo.c
        FileStringType:  XFT_FN
  - Name:                .[[SYMBOL]]
    Section:             .text
    StorageClass:        C_EXT
    NumberOfAuxEntries:  1
    AuxEntries:
      - Type:                   AUX_CSECT
        SymbolType:              XTY_LD
        StorageMappingClass:     XMC_PR
  - Name:                [[SYMBOL]]
    Section:             .text
    StorageClass:        C_EXT
    NumberOfAuxEntries:  1
    AuxEntries:
      - Type:                   AUX_CSECT
        SymbolType:              XTY_SD
        StorageMappingClass:     XMC_PR
