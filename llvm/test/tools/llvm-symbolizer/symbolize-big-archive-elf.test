## Test archive member recognition by name (ELF format).

# RUN: rm -rf %t.dir && mkdir %t.dir && cd %t.dir

# RUN: yaml2obj -DSYMBOL=foo1 %s -o 1.o
# RUN: yaml2obj -DSYMBOL=foo2 %s -o 2.o

# RUN: llvm-ar crv archive.a 1.o 2.o

## Test symbolization by member name with architecture via --default-arch flag.
# RUN: llvm-symbolizer --default-arch=ppc64le --obj="archive.a(1.o)" 0x0 | FileCheck %s --check-prefix=CHECK-1
# RUN: llvm-symbolizer --default-arch=ppc64le --obj="archive.a(2.o)" 0x0 | FileCheck %s --check-prefix=CHECK-2

## Test architecture specified via :arch suffix notation.
# RUN: llvm-symbolizer --obj="archive.a(1.o):ppc64le" 0x0 | FileCheck %s --check-prefix=CHECK-1
# RUN: llvm-symbolizer --obj="archive.a(2.o):ppc64le" 0x0 | FileCheck %s --check-prefix=CHECK-2

# CHECK-1: foo1
# CHECK-2: foo2

## Test error cases.
# RUN: not llvm-symbolizer --obj="archive.a(nonexistent.o)" 0x1000 2>&1 | FileCheck %s --check-prefix=CHECK-ERROR
# CHECK-ERROR: error: no matching member 'nonexistent.o' with arch {{.*}} in 'archive.a'

# RUN: not llvm-symbolizer --obj="1.o(1.o)" 0x1000 2>&1 | FileCheck %s --check-prefix=CHECK-NOTARCHIVE
# CHECK-NOTARCHIVE: error: '1.o' is not a valid archive

# RUN: not llvm-symbolizer --obj="archive.a()" 0x1000 2>&1 | FileCheck %s --check-prefix=CHECK-NOSYMBOL
# CHECK-NOSYMBOL: error: no matching member '' with arch {{.*}} in 'archive.a'

--- !ELF
FileHeader:
  Class:           ELFCLASS64
  Data:            ELFDATA2LSB
  Type:            ET_REL
  Machine:         EM_PPC64
Sections:
  - Name:            .text
    Type:            SHT_PROGBITS
    Flags:           [ SHF_ALLOC, SHF_EXECINSTR ]
    AddressAlign:    0x10
    Content:         '2000804E000000000000000000000000'
Symbols:
  - Name:            [[SYMBOL]].c
    Type:            STT_FILE
    Index:           SHN_ABS
  - Name:            .text
    Type:            STT_SECTION
    Section:         .text
  - Name:            [[SYMBOL]]
    Type:            STT_FUNC
    Section:         .text
    Binding:         STB_GLOBAL
    Size:            0x10
