# This file is licensed under the Apache License v2.0 with LLVM Exceptions.
# See https://llvm.org/LICENSE.txt for license information.
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
load("@bazel_skylib//rules:common_settings.bzl", "bool_flag")
load("@rules_cc//cc:defs.bzl", "cc_library")

cc_library(name = "empty_lib")

bool_flag(
    name = "llvm_enable_zstd",
    build_setting_default = True,
)

config_setting(
    name = "llvm_zstd_enabled",
    flag_values = {":llvm_enable_zstd": "true"},
)

cc_library(
    name = "zstd_wrapper",
    defines = select({
        ":llvm_zstd_enabled": [
            "LLVM_ENABLE_ZSTD=1",
            "ZSTD_MULTITHREAD",
        ],
        "//conditions:default": [],
    }),
    deps = [
        "@llvm_zstd//:zstd",
    ],
)

alias(
    name = "zstd",
    actual = select({
        ":llvm_zstd_enabled": ":zstd_wrapper",
        "//conditions:default": ":empty_lib",
    }),
    visibility = ["//visibility:public"],
)
