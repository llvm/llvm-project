# REQUIRES: system-linux

# RUN: rm -rf %t && mkdir -p %t && cd %t
# RUN: split-file %s %t
# RUN: %clangxx -g -gdwarf-4 -gsplit-dwarf %t/main.cpp %t/callee.cpp -o main.exe
# RUN: llvm-dwp -e %t/main.exe -o %t/main.exe.dwp
# RUN: llvm-bolt %t/main.exe -o %t/main.exe.bolt -update-debug-sections  2>&1 | FileCheck %s

# CHECK-NOT: Assertion


#--- main.cpp
int hotFunction(int x);

int main(int argc, char **argv) {
    int sum = 0;
    for (int i = 0; i < 50000000; ++i) { // 让运行时间更久
        sum += hotFunction(i);
    }
    if (sum)
        return 0;
    else
        return 1;
}

#--- callee.cpp
int hotFunction(int x) {
    if ((x & 1) == 0) {
        x = x * 3 + 1;
        if (x % 5 == 0) {
            x += 7;
        }
    } else {
        x = x * x;
        if (x % 3 == 0) {
            x -= 4;
        }
    }
    return x;
}

