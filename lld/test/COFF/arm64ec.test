REQUIRES: aarch64
RUN: split-file %s %t.dir && cd %t.dir

RUN: llvm-mc -filetype=obj -triple=arm64ec-windows arm64ec-data-sym.s -o arm64ec-data-sym.obj
RUN: llvm-cvtres -machine:arm64x -out:arm64x-resource.obj %S/Inputs/resource.res

RUN: lld-link -out:test.dll -machine:arm64ec arm64ec-data-sym.obj -dll -noentry
RUN: llvm-readobj --file-headers test.dll | FileCheck -check-prefix=ARM64EC-HEADER %s
ARM64EC-HEADER:      Format: COFF-x86-64
ARM64EC-HEADER-NEXT: Arch: x86_64
ARM64EC-HEADER-NEXT: AddressSize: 64bit
ARM64EC-HEADER:      Machine: IMAGE_FILE_MACHINE_AMD64 (0x8664)

RUN: lld-link -out:test.dll -machine:arm64x arm64x-resource.obj -dll -noentry
RUN: llvm-readobj --file-headers test.dll | FileCheck -check-prefix=ARM64X-HEADER %s
ARM64X-HEADER:      Machine: IMAGE_FILE_MACHINE_ARM64 (0xAA64)

#--- arm64ec-data-sym.s
    .data
    .globl arm64ec_data_sym
    .p2align 2, 0x0
arm64ec_data_sym:
    .word 0x02020202
