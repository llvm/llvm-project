RUN: yaml2obj %p/Inputs/pdb1.yaml -o %t1.obj
RUN: yaml2obj %p/Inputs/pdb2.yaml -o %t2.obj
RUN: rm -f %t.dll %t.pdb

## Check that it emits the debug directory in .cvinfo section when
## /nodbgdirmerge is specified
RUN: lld-link /debug /pdb:%t.pdb /pdbaltpath:test.pdb /dll /out:%t.dll \
RUN:   /entry:main /nodefaultlib /nodbgdirmerge %t1.obj %t2.obj
RUN: llvm-readobj --sections %t.dll | FileCheck -check-prefix=CHECKNOTMERGED %s

CHECKNOTMERGED:   Section {
CHECKNOTMERGED:     Number: 3
CHECKNOTMERGED-NEXT:     Name: .cvinfo
CHECKNOTMERGED-NEXT:     VirtualSize: 0x3D
CHECKNOTMERGED-NEXT:     VirtualAddress: 0x3000
CHECKNOTMERGED-NEXT:     RawDataSize: 512
CHECKNOTMERGED-NEXT:     PointerToRawData: 0x800
CHECKNOTMERGED-NEXT:     PointerToRelocations: 0
CHECKNOTMERGED-NEXT:     PointerToLineNumbers: 0
CHECKNOTMERGED-NEXT:     RelocationCount: 0
CHECKNOTMERGED-NEXT:     LineNumberCount: 0
CHECKNOTMERGED-NEXT:     Characteristics [ (0x40000040)
CHECKNOTMERGED-NEXT:       IMAGE_SCN_CNT_INITIALIZED_DATA (0x40)
CHECKNOTMERGED-NEXT:       IMAGE_SCN_MEM_READ (0x40000000)
CHECKNOTMERGED-NEXT:     ]
CHECKNOTMERGED-NEXT:   }

## Check that it triggers merge on when /nodbgdirmerge is not specified
RUN: lld-link /debug /pdb:%t.pdb /pdbaltpath:test.pdb /dll /out:%t.dll \
RUN:   /entry:main /nodefaultlib %t1.obj %t2.obj
RUN: llvm-readobj --sections %t.dll | FileCheck -check-prefix=CHECKMERGED %s

CHECKMERGED-NOT:     Name: .cvinfo
