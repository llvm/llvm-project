RUN: yaml2obj %p/Inputs/pdb1.yaml -o %t1.obj
RUN: yaml2obj %p/Inputs/pdb2.yaml -o %t2.obj
RUN: rm -f %t.dll %t.pdb

## Check that it emits the debug directory in .build section when
## /nodbgdirmerge is specified
RUN: lld-link /debug /pdb:%t.pdb /pdbaltpath:test.pdb /dll /out:%t.dll \
RUN:   /entry:main /nodefaultlib /nodbgdirmerge %t1.obj %t2.obj
RUN: llvm-readobj --sections %t.dll | FileCheck -check-prefix=CHECKNOTMERGED %s

CHECKNOTMERGED:   Section {
CHECKNOTMERGED:     Number: 3
CHECKNOTMERGED:     Name: .cvinfo
CHECKNOTMERGED:     Characteristics [ (0x40000040)
CHECKNOTMERGED:       IMAGE_SCN_CNT_INITIALIZED_DATA (0x40)
CHECKNOTMERGED:       IMAGE_SCN_MEM_READ (0x40000000)
CHECKNOTMERGED:     ]
CHECKNOTMERGED:   }

## Check that it triggers merge on when /nodbgdirmerge is not specified
RUN: lld-link /debug /pdb:%t.pdb /pdbaltpath:test.pdb /dll /out:%t.dll \
RUN:   /entry:main /nodefaultlib %t1.obj %t2.obj
RUN: llvm-readobj --sections %t.dll | FileCheck -check-prefix=CHECKMERGED %s

CHECKMERGED:   Section {
CHECKMERGED:     Number: 3
CHECKMERGED-NOT:     Name: .cvinfo
CHECKMERGED:   }
