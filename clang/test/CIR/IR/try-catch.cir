// RUN: cir-opt %s --verify-roundtrip | FileCheck %s

!u8i = !cir.int<u, 8>
!s32i = !cir.int<s, 32>
!void = !cir.void

module {

cir.global "private" constant external @_ZTIi : !cir.ptr<!u8i>
cir.global "private" constant external @_ZTIPKc : !cir.ptr<!u8i>

cir.func dso_local @empty_try_block_with_catch_all() {
  cir.scope {
    cir.try {
      cir.yield
    } catch all {
      %0 = cir.catch_param : !cir.ptr<!void>
      cir.yield
    }
  }
  cir.return
}

// CHECK: cir.func dso_local @empty_try_block_with_catch_all() {
// CHECK:   cir.scope {
// CHECK:     cir.try {
// CHECK:       cir.yield
// CHECK:     } catch all {
// CHECK:       %[[CP:.*]] = cir.catch_param : !cir.ptr<!void>
// CHECK:       cir.yield
// CHECK:     }
// CHECK:   }
// CHECK:   cir.return
// CHECK: }

cir.func dso_local @empty_try_block_with_catch_unwind() {
  cir.scope {
    cir.try {
      cir.yield
    } unwind {
      cir.yield
    }
  }
  cir.return
}

// CHECK: cir.func dso_local @empty_try_block_with_catch_unwind() {
// CHECK:   cir.scope {
// CHECK:     cir.try {
// CHECK:       cir.yield
// CHECK:     } unwind {
// CHECK:       cir.yield
// CHECK:     }
// CHECK:   }
// CHECK:   cir.return
// CHECK: }

cir.func dso_local @empty_try_block_with_catch_ist() {
  cir.scope {
    cir.try {
      cir.yield
    } catch [type #cir.global_view<@_ZTIi> : !cir.ptr<!u8i>] {
      %0 = cir.catch_param : !cir.ptr<!s32i>
      cir.yield
    } catch [type #cir.global_view<@_ZTIPKc> : !cir.ptr<!u8i>] {
      %0 = cir.catch_param : !cir.ptr<!cir.ptr<!u8i>>
      cir.yield
    } unwind {
      cir.yield
    }
  }
  cir.return
}

// CHECK: cir.func dso_local @empty_try_block_with_catch_ist() {
// CHECK:   cir.scope {
// CHECK:     cir.try {
// CHECK:       cir.yield
// CHECK:     } catch [type #cir.global_view<@_ZTIi> : !cir.ptr<!u8i>] {
// CHECK:       %[[CP1:.*]] = cir.catch_param : !cir.ptr<!s32i>
// CHECK:       cir.yield
// CHECK:     } catch [type #cir.global_view<@_ZTIPKc> : !cir.ptr<!u8i>] {
// CHECK:       %[[CP2:.*]] = cir.catch_param : !cir.ptr<!cir.ptr<!u8i>>
// CHECK:       cir.yield
// CHECK:     } unwind {
// CHECK:       cir.yield
// CHECK:     }
// CHECK:   }
// CHECK:   cir.return
// CHECK: }

cir.func @empty_try_block_with_catch_unwind_contains_resume() {
  cir.scope {
    cir.try {
      cir.yield
    } unwind {
      cir.resume
    }
  }
  cir.return
}

// CHECK: cir.func @empty_try_block_with_catch_unwind_contains_resume() {
// CHECK:   cir.scope {
// CHECK:     cir.try {
// CHECK:       cir.yield
// CHECK:     } unwind {
// CHECK:       cir.resume
// CHECK:     }
// CHECK:   }
// CHECK:   cir.return
// CHECK: }

}
