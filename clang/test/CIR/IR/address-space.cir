// RUN: cir-opt %s --verify-roundtrip | FileCheck %s

!s32i = !cir.int<s, 32>

module {
  // ---- PointerType with address space ----

  cir.func @target_address_space_ptr(%p: !cir.ptr<!s32i, target_address_space(1)>) {
    cir.return
  }

  cir.func @lang_address_space_offload_local(%p: !cir.ptr<!s32i, lang_address_space(offload_local)>) {
    cir.return
  }

  cir.func @lang_address_space_offload_global(%p: !cir.ptr<!s32i, lang_address_space(offload_global)>) {
    cir.return
  }

  cir.func @lang_address_space_offload_constant(%p: !cir.ptr<!s32i, lang_address_space(offload_constant)>) {
    cir.return
  }

  cir.func @lang_address_space_offload_private(%p: !cir.ptr<!s32i, lang_address_space(offload_private)>) {
    cir.return
  }

  cir.func @lang_address_space_offload_generic(%p: !cir.ptr<!s32i, lang_address_space(offload_generic)>) {
    cir.return
  }

  cir.func @default_address_space(%p: !cir.ptr<!s32i>) {
    cir.return
  }

  // ---- GlobalOp with address space ----

  cir.global external target_address_space(1) @global_target_as = #cir.int<42> : !s32i
  cir.global "private" internal lang_address_space(offload_local) @global_lang_local : !s32i
  cir.global external lang_address_space(offload_global) @global_lang_global = #cir.int<1> : !s32i
  cir.global external lang_address_space(offload_constant) @global_lang_constant = #cir.int<2> : !s32i
  cir.global external @global_default_as = #cir.int<0> : !s32i

  // ---- GetGlobalOp with address space ----

  cir.func @get_global_with_address_space() {
    %0 = cir.get_global @global_target_as : !cir.ptr<!s32i, target_address_space(1)>
    %1 = cir.get_global @global_lang_global : !cir.ptr<!s32i, lang_address_space(offload_global)>
    %2 = cir.get_global @global_default_as : !cir.ptr<!s32i>
    cir.return
  }
}

// CHECK: cir.func @target_address_space_ptr(%arg0: !cir.ptr<!s32i, target_address_space(1)>)
// CHECK: cir.func @lang_address_space_offload_local(%arg0: !cir.ptr<!s32i, lang_address_space(offload_local)>)
// CHECK: cir.func @lang_address_space_offload_global(%arg0: !cir.ptr<!s32i, lang_address_space(offload_global)>)
// CHECK: cir.func @lang_address_space_offload_constant(%arg0: !cir.ptr<!s32i, lang_address_space(offload_constant)>)
// CHECK: cir.func @lang_address_space_offload_private(%arg0: !cir.ptr<!s32i, lang_address_space(offload_private)>)
// CHECK: cir.func @lang_address_space_offload_generic(%arg0: !cir.ptr<!s32i, lang_address_space(offload_generic)>)
// CHECK: cir.func @default_address_space(%arg0: !cir.ptr<!s32i>)

// CHECK: cir.global external target_address_space(1) @global_target_as = #cir.int<42> : !s32i
// CHECK: cir.global "private" internal lang_address_space(offload_local) @global_lang_local : !s32i
// CHECK: cir.global external lang_address_space(offload_global) @global_lang_global = #cir.int<1> : !s32i
// CHECK: cir.global external lang_address_space(offload_constant) @global_lang_constant = #cir.int<2> : !s32i
// CHECK: cir.global external @global_default_as = #cir.int<0> : !s32i

// CHECK: cir.func @get_global_with_address_space()
// CHECK:   cir.get_global @global_target_as : !cir.ptr<!s32i, target_address_space(1)>
// CHECK:   cir.get_global @global_lang_global : !cir.ptr<!s32i, lang_address_space(offload_global)>
// CHECK:   cir.get_global @global_default_as : !cir.ptr<!s32i>
