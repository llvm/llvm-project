// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py
// REQUIRES: amdgpu-registered-target
// RUN: %clang_cc1 -triple amdgcn-amd-amdhsa -O3 -target-cpu gfx1250 -emit-llvm -fcuda-is-device -o - %s | FileCheck %s

#define __device__ __attribute__((device))

typedef int    v4i   __attribute__((ext_vector_type(4)));

template<unsigned AO, unsigned Scope>
__device__ v4i templated_amdgcn_flat_load_monitor_b128(v4i* inptr)
{
  return __builtin_amdgcn_flat_load_monitor_b128(inptr, AO, Scope);
}


// CHECK-LABEL: @_Z48test_amdgcn_flat_load_monitor_b128_from_templatePDv4_iS0_(
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[TMP0:%.*]] = tail call noundef <4 x i32> @llvm.amdgcn.flat.load.monitor.b128.v4i32(ptr [[INPTR:%.*]], i32 5, metadata [[META8:![0-9]+]])
// CHECK-NEXT:    store <4 x i32> [[TMP0]], ptr [[OUT:%.*]], align 16, !tbaa [[TBAA9:![0-9]+]]
// CHECK-NEXT:    ret void
//
__device__ void test_amdgcn_flat_load_monitor_b128_from_template(v4i* inptr, v4i *out)
{
  *out = templated_amdgcn_flat_load_monitor_b128<__ATOMIC_SEQ_CST, __MEMORY_SCOPE_SYSTEM>(inptr);
}
