// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py
// REQUIRES: amdgpu-registered-target
// RUN: %clang_cc1 -triple amdgcn-unknown-unknown -target-cpu gfx1300 -target-feature +wavefrontsize32 -emit-llvm -o - %s | FileCheck %s --check-prefix=CHECK-GFX1300

typedef unsigned int uint;
typedef unsigned long ulong;
typedef half  v2h   __attribute__((ext_vector_type(2)));
typedef half  v4h   __attribute__((ext_vector_type(4)));
typedef half  v6h   __attribute__((ext_vector_type(6)));
typedef half  v8h   __attribute__((ext_vector_type(8)));
typedef half  v10h   __attribute__((ext_vector_type(10)));
typedef half  v18h   __attribute__((ext_vector_type(18)));
typedef half  v36h   __attribute__((ext_vector_type(36)));


// 3x3

// CHECK-GFX1300-LABEL: @test_amdgcn_builtin_amdgcn_wconv_3x3_8x4(
// CHECK-GFX1300-NEXT:  entry:
// CHECK-GFX1300-NEXT:    [[TMP0:%.*]] = tail call <8 x half> @llvm.amdgcn.wconv.3x3.v8f16.v8f16.v10f16.v8f16(<8 x half> [[ACC:%.*]], <10 x half> [[WEIGHTS:%.*]], <8 x half> [[COL_CENTER:%.*]], <8 x half> [[COL_LEFT:%.*]], <8 x half> [[COL_RIGHT:%.*]], i32 42, i1 true)
// CHECK-GFX1300-NEXT:    store <8 x half> [[TMP0]], ptr addrspace(1) [[OUT:%.*]], align 16, !tbaa [[TBAA4:![0-9]+]]
// CHECK-GFX1300-NEXT:    ret void
//
void test_amdgcn_builtin_amdgcn_wconv_3x3_8x4(global v8h* out, v8h acc, v10h weights, v8h col_center, v8h col_left, v8h col_right)
{
  *out = __builtin_amdgcn_wconv_3x3_8x4(acc, weights, col_center, col_left, col_right, 42, true);
}

// CHECK-GFX1300-LABEL: @test_amdgcn_builtin_amdgcn_wconv_3x3_4x4(
// CHECK-GFX1300-NEXT:  entry:
// CHECK-GFX1300-NEXT:    [[TMP0:%.*]] = tail call <8 x half> @llvm.amdgcn.wconv.3x3.v8f16.v8f16.v18f16.v6f16(<8 x half> [[ACC:%.*]], <18 x half> [[WEIGHTS:%.*]], <6 x half> [[COL_CENTER:%.*]], <6 x half> [[COL_LEFT:%.*]], <6 x half> [[COL_RIGHT:%.*]], i32 42, i1 true)
// CHECK-GFX1300-NEXT:    store <8 x half> [[TMP0]], ptr addrspace(1) [[OUT:%.*]], align 16, !tbaa [[TBAA4]]
// CHECK-GFX1300-NEXT:    ret void
//
void test_amdgcn_builtin_amdgcn_wconv_3x3_4x4(global v8h* out, v8h acc, v18h weights, v6h col_center, v6h col_left, v6h col_right)
{
  *out = __builtin_amdgcn_wconv_3x3_4x4(acc, weights, col_center, col_left, col_right, 42, true);
}

// CHECK-GFX1300-LABEL: @test_amdgcn_builtin_amdgcn_wconv_3x3_4x2(
// CHECK-GFX1300-NEXT:  entry:
// CHECK-GFX1300-NEXT:    [[TMP0:%.*]] = tail call <8 x half> @llvm.amdgcn.wconv.3x3.v8f16.v8f16.v36f16.v6f16(<8 x half> [[ACC:%.*]], <36 x half> [[WEIGHTS:%.*]], <6 x half> [[COL_CENTER:%.*]], <6 x half> [[COL_LEFT:%.*]], <6 x half> [[COL_RIGHT:%.*]], i32 42, i1 true)
// CHECK-GFX1300-NEXT:    store <8 x half> [[TMP0]], ptr addrspace(1) [[OUT:%.*]], align 16, !tbaa [[TBAA4]]
// CHECK-GFX1300-NEXT:    ret void
//
void test_amdgcn_builtin_amdgcn_wconv_3x3_4x2(global v8h* out, v8h acc, v36h weights, v6h col_center, v6h col_left, v6h col_right)
{
  *out = __builtin_amdgcn_wconv_3x3_4x2(acc, weights, col_center, col_left, col_right, 42, true);
}

// 1x1

// CHECK-GFX1300-LABEL: @test_amdgcn_builtin_amdgcn_wconv_1x1_8x4(
// CHECK-GFX1300-NEXT:  entry:
// CHECK-GFX1300-NEXT:    [[TMP0:%.*]] = tail call <8 x half> @llvm.amdgcn.wconv.1x1.v8f16.v8f16.v2f16.v4f16(<8 x half> [[ACC:%.*]], <2 x half> [[WEIGHTS:%.*]], <4 x half> [[TEN_0:%.*]], <4 x half> [[TEN_1:%.*]], <4 x half> [[TEN_2:%.*]], <4 x half> [[TEN_3:%.*]], i32 42, i1 true)
// CHECK-GFX1300-NEXT:    store <8 x half> [[TMP0]], ptr addrspace(1) [[OUT:%.*]], align 16, !tbaa [[TBAA4]]
// CHECK-GFX1300-NEXT:    ret void
//
void test_amdgcn_builtin_amdgcn_wconv_1x1_8x4(global v8h* out, v8h acc, v2h weights, v4h ten_0, v4h ten_1, v4h ten_2, v4h ten_3)
{
  *out = __builtin_amdgcn_wconv_1x1_8x4(acc, weights, ten_0, ten_1, ten_2, ten_3, 42, true);
}

// CHECK-GFX1300-LABEL: @test_amdgcn_builtin_amdgcn_wconv_1x1_4x4(
// CHECK-GFX1300-NEXT:  entry:
// CHECK-GFX1300-NEXT:    [[TMP0:%.*]] = tail call <8 x half> @llvm.amdgcn.wconv.1x1.v8f16.v8f16.v2f16.v2f16(<8 x half> [[ACC:%.*]], <2 x half> [[WEIGHTS:%.*]], <2 x half> [[TEN_0:%.*]], <2 x half> [[TEN_1:%.*]], <2 x half> [[TEN_2:%.*]], <2 x half> [[TEN_3:%.*]], i32 42, i1 true)
// CHECK-GFX1300-NEXT:    store <8 x half> [[TMP0]], ptr addrspace(1) [[OUT:%.*]], align 16, !tbaa [[TBAA4]]
// CHECK-GFX1300-NEXT:    ret void
//
void test_amdgcn_builtin_amdgcn_wconv_1x1_4x4(global v8h* out, v8h acc, v2h weights, v2h ten_0, v2h ten_1, v2h ten_2, v2h ten_3)
{
  *out = __builtin_amdgcn_wconv_1x1_4x4(acc, weights, ten_0, ten_1, ten_2, ten_3, 42, true);
}

// CHECK-GFX1300-LABEL: @test_amdgcn_builtin_amdgcn_wconv_1x1_4x2(
// CHECK-GFX1300-NEXT:  entry:
// CHECK-GFX1300-NEXT:    [[TMP0:%.*]] = tail call <8 x half> @llvm.amdgcn.wconv.1x1.v8f16.v8f16.v4f16.v2f16(<8 x half> [[ACC:%.*]], <4 x half> [[WEIGHTS:%.*]], <2 x half> [[TEN_0:%.*]], <2 x half> [[TEN_1:%.*]], <2 x half> [[TEN_2:%.*]], <2 x half> [[TEN_3:%.*]], i32 42, i1 true)
// CHECK-GFX1300-NEXT:    store <8 x half> [[TMP0]], ptr addrspace(1) [[OUT:%.*]], align 16, !tbaa [[TBAA4]]
// CHECK-GFX1300-NEXT:    ret void
//
void test_amdgcn_builtin_amdgcn_wconv_1x1_4x2(global v8h* out, v8h acc, v4h weights, v2h ten_0, v2h ten_1, v2h ten_2, v2h ten_3)
{
  *out = __builtin_amdgcn_wconv_1x1_4x2(acc, weights, ten_0, ten_1, ten_2, ten_3, 42, true);
}
