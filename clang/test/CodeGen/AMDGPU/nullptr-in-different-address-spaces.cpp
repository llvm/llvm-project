// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py UTC_ARGS: --version 6
// RUN: %clang_cc1 -triple amdgcn-amd-amdhsa -target-cpu gfx900 -emit-llvm -o - %s | FileCheck %s

extern __attribute__((address_space(3))) unsigned char * ptr_as3; // local address space
extern __attribute__((address_space(5))) unsigned char * ptr_as5; // private address space

// CHECK-LABEL: define dso_local noundef ptr @_Z11get_ptr_as3b(
// CHECK-SAME: i1 noundef zeroext [[V:%.*]]) #[[ATTR0:[0-9]+]] {
// CHECK-NEXT:  [[ENTRY:.*:]]
// CHECK-NEXT:    [[RETVAL:%.*]] = alloca ptr, align 8, addrspace(5)
// CHECK-NEXT:    [[V_ADDR:%.*]] = alloca i8, align 1, addrspace(5)
// CHECK-NEXT:    [[RETVAL_ASCAST:%.*]] = addrspacecast ptr addrspace(5) [[RETVAL]] to ptr
// CHECK-NEXT:    [[V_ADDR_ASCAST:%.*]] = addrspacecast ptr addrspace(5) [[V_ADDR]] to ptr
// CHECK-NEXT:    [[STOREDV:%.*]] = zext i1 [[V]] to i8
// CHECK-NEXT:    store i8 [[STOREDV]], ptr [[V_ADDR_ASCAST]], align 1
// CHECK-NEXT:    [[TMP0:%.*]] = load i8, ptr [[V_ADDR_ASCAST]], align 1
// CHECK-NEXT:    [[LOADEDV:%.*]] = trunc i8 [[TMP0]] to i1
// CHECK-NEXT:    br i1 [[LOADEDV]], label %[[COND_TRUE:.*]], label %[[COND_FALSE:.*]]
// CHECK:       [[COND_TRUE]]:
// CHECK-NEXT:    [[TMP1:%.*]] = load ptr addrspace(3), ptr addrspacecast (ptr addrspace(1) @ptr_as3 to ptr), align 4
// CHECK-NEXT:    br label %[[COND_END:.*]]
// CHECK:       [[COND_FALSE]]:
// CHECK-NEXT:    br label %[[COND_END]]
// CHECK:       [[COND_END]]:
// CHECK-NEXT:    [[COND:%.*]] = phi ptr addrspace(3) [ [[TMP1]], %[[COND_TRUE]] ], [ addrspacecast (ptr null to ptr addrspace(3)), %[[COND_FALSE]] ]
// CHECK-NEXT:    [[COND_ASCAST:%.*]] = addrspacecast ptr addrspace(3) [[COND]] to ptr
// CHECK-NEXT:    ret ptr [[COND_ASCAST]]
//
unsigned char *get_ptr_as3(bool v) {
  return v ? ptr_as3 : nullptr;
}

// CHECK-LABEL: define dso_local noundef ptr @_Z11get_ptr_as5b(
// CHECK-SAME: i1 noundef zeroext [[V:%.*]]) #[[ATTR0]] {
// CHECK-NEXT:  [[ENTRY:.*:]]
// CHECK-NEXT:    [[RETVAL:%.*]] = alloca ptr, align 8, addrspace(5)
// CHECK-NEXT:    [[V_ADDR:%.*]] = alloca i8, align 1, addrspace(5)
// CHECK-NEXT:    [[RETVAL_ASCAST:%.*]] = addrspacecast ptr addrspace(5) [[RETVAL]] to ptr
// CHECK-NEXT:    [[V_ADDR_ASCAST:%.*]] = addrspacecast ptr addrspace(5) [[V_ADDR]] to ptr
// CHECK-NEXT:    [[STOREDV:%.*]] = zext i1 [[V]] to i8
// CHECK-NEXT:    store i8 [[STOREDV]], ptr [[V_ADDR_ASCAST]], align 1
// CHECK-NEXT:    [[TMP0:%.*]] = load i8, ptr [[V_ADDR_ASCAST]], align 1
// CHECK-NEXT:    [[LOADEDV:%.*]] = trunc i8 [[TMP0]] to i1
// CHECK-NEXT:    br i1 [[LOADEDV]], label %[[COND_TRUE:.*]], label %[[COND_FALSE:.*]]
// CHECK:       [[COND_TRUE]]:
// CHECK-NEXT:    [[TMP1:%.*]] = load ptr addrspace(5), ptr addrspacecast (ptr addrspace(1) @ptr_as5 to ptr), align 4
// CHECK-NEXT:    br label %[[COND_END:.*]]
// CHECK:       [[COND_FALSE]]:
// CHECK-NEXT:    br label %[[COND_END]]
// CHECK:       [[COND_END]]:
// CHECK-NEXT:    [[COND:%.*]] = phi ptr addrspace(5) [ [[TMP1]], %[[COND_TRUE]] ], [ addrspacecast (ptr null to ptr addrspace(5)), %[[COND_FALSE]] ]
// CHECK-NEXT:    [[COND_ASCAST:%.*]] = addrspacecast ptr addrspace(5) [[COND]] to ptr
// CHECK-NEXT:    ret ptr [[COND_ASCAST]]
//
unsigned char *get_ptr_as5(bool v) {
  return v ? ptr_as5 : nullptr;
}
