// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py UTC_ARGS: --version 6
// RUN: %clang_cc1 -triple x86_64-windows -fasync-exceptions -fcxx-exceptions -fexceptions -fms-extensions -x c++ -Wno-implicit-function-declaration -emit-llvm %s -o - | FileCheck %s
// Check that the try scope of main is properly terminated.
[[noreturn]] void Exit();

// CHECK-LABEL: define dso_local noundef i32 @main(
// CHECK-SAME: i32 noundef [[ARGC:%.*]], ptr noundef [[TMP0:%.*]]) #[[ATTR0:[0-9]+]] personality ptr @__CxxFrameHandler3 {
// CHECK-NEXT:  [[ENTRY:.*:]]
// CHECK-NEXT:    [[RETVAL:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[DOTADDR:%.*]] = alloca ptr, align 8
// CHECK-NEXT:    [[ARGC_ADDR:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[TMP:%.*]] = alloca i32, align 4
// CHECK-NEXT:    store i32 0, ptr [[RETVAL]], align 4
// CHECK-NEXT:    store ptr [[TMP0]], ptr [[DOTADDR]], align 8
// CHECK-NEXT:    store i32 [[ARGC]], ptr [[ARGC_ADDR]], align 4
// CHECK-NEXT:    invoke void @llvm.seh.try.begin()
// CHECK-NEXT:            to label %[[INVOKE_CONT:.*]] unwind label %[[CATCH_DISPATCH:.*]]
// CHECK:       [[INVOKE_CONT]]:
// CHECK-NEXT:    [[TMP1:%.*]] = load i32, ptr [[ARGC_ADDR]], align 4
// CHECK-NEXT:    [[TOBOOL:%.*]] = icmp ne i32 [[TMP1]], 0
// CHECK-NEXT:    br i1 [[TOBOOL]], label %[[IF_END:.*]], label %[[IF_THEN:.*]]
// CHECK:       [[IF_THEN]]:
// CHECK-NEXT:    store i32 -1, ptr [[TMP]], align 4
// CHECK-NEXT:    invoke void @_CxxThrowException(ptr [[TMP]], ptr @_TI1H) #[[ATTR4:[0-9]+]]
// CHECK-NEXT:            to label %[[UNREACHABLE:.*]] unwind label %[[CATCH_DISPATCH]]
// CHECK:       [[IF_END]]:
// CHECK-NEXT:    [[TMP2:%.*]] = load i32, ptr [[ARGC_ADDR]], align 4
// CHECK-NEXT:    store i32 [[TMP2]], ptr [[RETVAL]], align 4
// CHECK-NEXT:    invoke void @llvm.seh.scope.end()
// CHECK-NEXT:            to label %[[INVOKE_CONT1:.*]] unwind label %[[CATCH_DISPATCH]]
// CHECK:       [[CATCH_DISPATCH]]:
// CHECK-NEXT:    [[TMP3:%.*]] = catchswitch within none [label %[[CATCH:.*]]] unwind to caller
// CHECK:       [[CATCH]]:
// CHECK-NEXT:    [[TMP4:%.*]] = catchpad within [[TMP3]] [ptr null, i32 0, ptr null]
// CHECK-NEXT:    catchret from [[TMP4]] to label %[[CATCHRET_DEST:.*]]
// CHECK:       [[CATCHRET_DEST]]:
// CHECK-NEXT:    br label %[[TRY_CONT:.*]]
// CHECK:       [[TRY_CONT]]:
// CHECK-NEXT:    call void @"?Exit@@YAXXZ"() #[[ATTR4]]
// CHECK-NEXT:    unreachable
// CHECK:       [[INVOKE_CONT1]]:
// CHECK-NEXT:    [[TMP5:%.*]] = load i32, ptr [[RETVAL]], align 4
// CHECK-NEXT:    ret i32 [[TMP5]]
// CHECK:       [[UNREACHABLE]]:
// CHECK-NEXT:    unreachable
//
int main(int argc, char**) noexcept
{
  try {
    if (!argc) { throw -1; }
    return argc;
  } catch (...) {
  }

  Exit();
  return 0;
}
