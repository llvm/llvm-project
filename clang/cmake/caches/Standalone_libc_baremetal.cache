message(STATUS "--- Discovered target triple: ${ARCH_TRIPLE} ---")

set(CMAKE_SYSTEM_NAME Generic CACHE STRING "")
set(CMAKE_TRY_COMPILE_TARGET_TYPE STATIC_LIBRARY CACHE STRING "")
set(LLVM_ENABLE_RUNTIMES "libc" CACHE STRING "")
set(LLVM_ENABLE_ASSERTIONS OFF CACHE BOOL "")
set(LLVM_INCLUDE_TESTS OFF CACHE BOOL "")
set(LLVM_LIBC_FULL_BUILD "ON" CACHE BOOL "")
set(LIBC_ENABLE_USE_BY_CLANG ON CACHE BOOL "")
set(CMAKE_C_COMPILER_WORKS ON CACHE BOOL "")
set(CMAKE_CXX_COMPILER_WORKS ON CACHE BOOL "")
set(CMAKE_SYSROOT "" CACHE STRING "")
set(LLVM_LIBC_INCLUDE_SCUDO OFF CACHE BOOL "")

set(LLVM_DEFAULT_TARGET_TRIPLE ${ARCH_TRIPLE} CACHE STRING "")
set(LIBC_TARGET_TRIPLE ${ARCH_TRIPLE} CACHE STRING "")
set(CMAKE_C_COMPILER_TARGET ${ARCH_TRIPLE} CACHE STRING "")
set(CMAKE_CXX_COMPILER_TARGET ${ARCH_TRIPLE} CACHE STRING "")
set(CMAKE_ASM_COMPILER_TARGET ${ARCH_TRIPLE} CACHE STRING "")

if(ARCH_TRIPLE MATCHES "^arm.*")
  set(CMAKE_SYSTEM_PROCESSOR arm CACHE STRING "")
endif()
if(ARCH_TRIPLE MATCHES "^riscv.*")
  set(CMAKE_SYSTEM_PROCESSOR RISCV CACHE STRING "")
endif()


foreach(lang C;CXX;ASM)
  if(${ARCH_TRIPLE} STREQUAL "armv6m-none-eabi")
    set(CMAKE_${lang}_FLAGS "-march=armv6m -mcpu=cortex-m0plus -mfloat-abi=soft -Wno-atomic-alignment \"-Dvfprintf(stream, format, vlist)=vprintf(format, vlist)\" \"-Dfprintf(stream, format, ...)=printf(format)\" \"-Dfputs(string, stream)=puts(string)\" -D_LIBCPP_PRINT=1" CACHE STRING "")
  endif()
  if(${ARCH_TRIPLE} STREQUAL "armv7m-none-eabi")
    set(CMAKE_${lang}_FLAGS "-march=armv7m -mcpu=cortex-m4 -mfloat-abi=soft -Wno-atomic-alignment \"-Dvfprintf(stream, format, vlist)=vprintf(format, vlist)\" \"-Dfprintf(stream, format, ...)=printf(format)\" \"-Dfputs(string, stream)=puts(string)\" -D_LIBCPP_PRINT=1" CACHE STRING "")
  endif()
  if(${ARCH_TRIPLE} STREQUAL "armv7em-none-eabi")
    set(CMAKE_${lang}_FLAGS "-march=armv7em -mcpu=cortex-m4 -mfloat-abi=soft -Wno-atomic-alignment \"-Dvfprintf(stream, format, vlist)=vprintf(format, vlist)\" \"-Dfprintf(stream, format, ...)=printf(format)\" \"-Dfputs(string, stream)=puts(string)\" -D_LIBCPP_PRINT=1" CACHE STRING "")
  endif()
  if(${ARCH_TRIPLE} STREQUAL "armv8m.main-none-eabi")
    set(CMAKE_${lang}_FLAGS "-mfloat-abi=softfp -march=armv8m.main+fp+dsp -mcpu=cortex-m33" CACHE STRING "")
  endif()
  if(${ARCH_TRIPLE} STREQUAL "armv8.1m.main-none-eabi")
    set(CMAKE_${lang}_FLAGS "-mfloat-abi=hard -march=armv8.1-m.main+mve.fp+fp.dp -mcpu=cortex-m55" CACHE STRING "")
  endif()
endforeach()
